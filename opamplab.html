<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Op-Amp Lab Activity: Inverting vs. Non-Inverting Configurations</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap');

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --blue: #1a56db;
    --blue-light: #e8f0fe;
    --blue-mid: #3b7de8;
    --red: #c0392b;
    --red-light: #fdecea;
    --green: #1a7a4a;
    --green-light: #e8f5ee;
    --gray-1: #f8f9fa;
    --gray-2: #e9ecef;
    --gray-3: #dee2e6;
    --gray-4: #adb5bd;
    --gray-5: #6c757d;
    --gray-6: #343a40;
    --text: #1a1a2e;
    --mono: 'IBM Plex Mono', monospace;
    --sans: 'IBM Plex Sans', sans-serif;
  }

  body {
    font-family: var(--sans);
    background: #ffffff;
    color: var(--text);
    min-height: 100vh;
  }

  /* HEADER */
  header {
    background: var(--blue);
    color: white;
    padding: 20px 32px;
    display: flex;
    align-items: center;
    gap: 16px;
    box-shadow: 0 2px 8px rgba(26,86,219,0.3);
  }
  header .icon {
    width: 48px; height: 48px;
    background: rgba(255,255,255,0.15);
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px;
  }
  header h1 { font-size: 1.4rem; font-weight: 700; letter-spacing: -0.3px; }
  header p { font-size: 0.85rem; opacity: 0.85; margin-top: 2px; }
  header .badge {
    margin-left: auto;
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.35);
    border-radius: 20px;
    padding: 4px 14px;
    font-size: 0.78rem;
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  /* TABS */
  .tab-nav {
    display: flex;
    background: white;
    border-bottom: 2px solid var(--gray-3);
    padding: 0 32px;
    gap: 0;
    overflow-x: auto;
  }
  .tab-btn {
    padding: 14px 20px;
    font-family: var(--sans);
    font-size: 0.88rem;
    font-weight: 600;
    color: var(--gray-5);
    background: none;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    white-space: nowrap;
    margin-bottom: -2px;
    transition: color 0.2s, border-color 0.2s;
    display: flex; align-items: center; gap: 7px;
  }
  .tab-btn:hover { color: var(--blue); }
  .tab-btn.active { color: var(--blue); border-bottom-color: var(--blue); }
  .tab-btn .tab-num {
    width: 22px; height: 22px;
    border-radius: 50%;
    background: var(--gray-2);
    font-size: 0.72rem;
    display: flex; align-items: center; justify-content: center;
    font-weight: 700;
    transition: background 0.2s, color 0.2s;
  }
  .tab-btn.active .tab-num { background: var(--blue); color: white; }

  /* TAB PANELS */
  .tab-panel { display: none; padding: 32px; max-width: 1100px; margin: 0 auto; }
  .tab-panel.active { display: block; animation: fadeIn 0.25s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

  /* TYPOGRAPHY */
  h2 { font-size: 1.5rem; font-weight: 700; color: var(--text); margin-bottom: 8px; }
  h3 { font-size: 1.05rem; font-weight: 600; color: var(--text); margin-bottom: 10px; }
  p { line-height: 1.7; color: #333; font-size: 0.95rem; margin-bottom: 12px; }

  /* CARDS */
  .card {
    background: white;
    border: 1px solid var(--gray-3);
    border-radius: 10px;
    padding: 22px 26px;
    margin-bottom: 20px;
  }
  .card.blue { border-left: 4px solid var(--blue); background: var(--blue-light); }
  .card.red { border-left: 4px solid var(--red); background: var(--red-light); }
  .card.green { border-left: 4px solid var(--green); background: var(--green-light); }
  .card.gray { background: var(--gray-1); border-color: var(--gray-3); }

  /* OBJECTIVES LIST */
  .obj-list { list-style: none; display: flex; flex-direction: column; gap: 8px; margin: 14px 0; }
  .obj-list li {
    display: flex; align-items: flex-start; gap: 10px;
    font-size: 0.93rem; line-height: 1.5;
  }
  .obj-list li::before {
    content: '‚úì';
    min-width: 22px; height: 22px;
    background: var(--blue);
    color: white;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.72rem;
    font-weight: 700;
    margin-top: 1px;
  }

  /* SIMULATOR SECTION */
  .sim-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
    margin-bottom: 24px;
  }
  @media (max-width: 700px) { .sim-grid { grid-template-columns: 1fr; } }

  .sim-box {
    border: 1px solid var(--gray-3);
    border-radius: 12px;
    overflow: hidden;
  }
  .sim-header {
    padding: 14px 20px;
    font-weight: 700;
    font-size: 0.9rem;
    letter-spacing: 0.3px;
    display: flex; align-items: center; gap: 8px;
  }
  .sim-header.inv { background: var(--red); color: white; }
  .sim-header.noninv { background: var(--blue); color: white; }
  .sim-body { padding: 20px; background: white; }

  /* SLIDERS */
  .slider-group { margin-bottom: 16px; }
  .slider-group label {
    display: flex; justify-content: space-between;
    font-size: 0.85rem; font-weight: 600;
    color: var(--gray-6);
    margin-bottom: 6px;
  }
  .slider-group label span { font-family: var(--mono); font-weight: 600; }
  input[type=range] {
    width: 100%; height: 6px;
    -webkit-appearance: none;
    background: var(--gray-3);
    border-radius: 3px;
    outline: none;
    cursor: pointer;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px; height: 18px;
    border-radius: 50%;
    background: var(--blue);
    cursor: pointer;
    box-shadow: 0 1px 4px rgba(0,0,0,0.25);
  }
  .inv-sim input[type=range]::-webkit-slider-thumb { background: var(--red); }

  /* OUTPUT DISPLAY */
  .output-display {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 18px;
  }
  .output-box {
    border-radius: 8px;
    padding: 12px 14px;
    text-align: center;
  }
  .output-box .label { font-size: 0.72rem; font-weight: 700; letter-spacing: 0.8px; text-transform: uppercase; opacity: 0.7; }
  .output-box .value { font-family: var(--mono); font-size: 1.25rem; font-weight: 600; margin-top: 4px; }
  .out-gain { background: #fff3e0; }
  .out-vout { background: #e8eaf6; }
  .inv-sim .out-gain { background: #fdecea; }
  .inv-sim .out-vout { background: #fce4e4; }

  /* WAVEFORM CANVAS */
  canvas {
    width: 100%;
    border-radius: 8px;
    background: #111;
    margin-top: 14px;
    display: block;
  }

  /* FORMULA BOX */
  .formula {
    background: var(--gray-6);
    color: #f8f9fa;
    font-family: var(--mono);
    font-size: 1rem;
    padding: 14px 20px;
    border-radius: 8px;
    text-align: center;
    margin: 14px 0;
    letter-spacing: 0.5px;
  }

  /* DATA TABLE */
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
    margin-top: 10px;
  }
  th {
    background: var(--gray-6);
    color: white;
    padding: 10px 14px;
    text-align: left;
    font-size: 0.8rem;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }
  td {
    padding: 10px 14px;
    border-bottom: 1px solid var(--gray-3);
    font-family: var(--mono);
    font-size: 0.88rem;
  }
  tr:nth-child(even) td { background: var(--gray-1); }
  tr:hover td { background: var(--blue-light); }

  /* RESULTS FORM */
  .results-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }
  @media (max-width: 700px) { .results-grid { grid-template-columns: 1fr; } }

  .form-group { margin-bottom: 16px; }
  .form-group label {
    display: block;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--gray-6);
    margin-bottom: 6px;
  }
  .form-group input, .form-group select, .form-group textarea {
    width: 100%;
    padding: 9px 12px;
    border: 1px solid var(--gray-3);
    border-radius: 6px;
    font-family: var(--mono);
    font-size: 0.88rem;
    color: var(--text);
    background: white;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
    border-color: var(--blue);
    box-shadow: 0 0 0 3px rgba(26,86,219,0.12);
  }
  .form-group textarea { resize: vertical; min-height: 80px; }

  /* COMPARISON TABLE */
  .compare-table th:first-child { width: 220px; }
  .compare-table .inv-col { background: #fff5f5; color: var(--red); font-weight: 700; }
  .compare-table .noninv-col { background: #f0f4ff; color: var(--blue); font-weight: 700; }

  /* ANALYSIS SECTION */
  .analysis-q {
    background: white;
    border: 1px solid var(--gray-3);
    border-radius: 10px;
    padding: 20px 24px;
    margin-bottom: 16px;
  }
  .analysis-q .q-num {
    font-size: 0.72rem;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--blue);
    margin-bottom: 6px;
  }
  .analysis-q .q-text {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 12px;
    line-height: 1.5;
  }
  .analysis-q textarea {
    width: 100%;
    padding: 10px 14px;
    border: 1px solid var(--gray-3);
    border-radius: 6px;
    font-family: var(--sans);
    font-size: 0.9rem;
    color: var(--text);
    background: var(--gray-1);
    resize: vertical;
    min-height: 90px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .analysis-q textarea:focus {
    border-color: var(--blue);
    background: white;
    box-shadow: 0 0 0 3px rgba(26,86,219,0.1);
  }

  /* BUTTONS */
  .btn {
    display: inline-flex; align-items: center; gap: 7px;
    padding: 10px 20px;
    border-radius: 7px;
    font-family: var(--sans);
    font-size: 0.88rem;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
    text-decoration: none;
  }
  .btn-primary { background: var(--blue); color: white; }
  .btn-primary:hover { background: #1348b8; }
  .btn-secondary { background: var(--gray-2); color: var(--gray-6); }
  .btn-secondary:hover { background: var(--gray-3); }
  .btn-success { background: var(--green); color: white; }
  .btn-success:hover { background: #145e38; }
  .btn-row { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 20px; }

  /* PROGRESS BAR */
  .progress-wrap { margin: 20px 0; }
  .progress-label { font-size: 0.82rem; font-weight: 600; color: var(--gray-5); margin-bottom: 6px; display: flex; justify-content: space-between; }
  .progress-bar { height: 8px; background: var(--gray-2); border-radius: 4px; overflow: hidden; }
  .progress-fill { height: 100%; background: var(--blue); border-radius: 4px; transition: width 0.4s ease; }

  /* RUBRIC */
  .rubric-row { display: grid; grid-template-columns: 2fr 1fr 3fr; gap: 0; }
  .rubric-row > div { padding: 10px 14px; border-bottom: 1px solid var(--gray-3); font-size: 0.87rem; }
  .rubric-head { background: var(--gray-6); color: white; font-weight: 700; font-size: 0.78rem; letter-spacing: 0.5px; text-transform: uppercase; }
  .rubric-points { font-family: var(--mono); font-weight: 700; color: var(--blue); text-align: center; }

  /* AI FEEDBACK PANEL */
  .ai-panel {
    border: 2px solid var(--blue);
    border-radius: 12px;
    overflow: hidden;
    margin-top: 24px;
  }
  .ai-header {
    background: var(--blue);
    color: white;
    padding: 14px 20px;
    display: flex; align-items: center; gap: 10px;
    font-weight: 700;
    font-size: 0.92rem;
  }
  .ai-body { padding: 20px; background: var(--blue-light); }
  .ai-body p { color: var(--gray-6); font-size: 0.9rem; }
  .ai-prompt {
    background: white;
    border: 1px solid var(--gray-3);
    border-radius: 8px;
    padding: 14px;
    margin-top: 12px;
    font-family: var(--mono);
    font-size: 0.82rem;
    color: var(--gray-5);
    line-height: 1.7;
    white-space: pre-wrap;
  }

  /* SECTION DIVIDER */
  .section-title {
    display: flex; align-items: center; gap: 12px;
    margin: 28px 0 16px;
  }
  .section-title h3 { margin: 0; }
  .section-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--gray-3);
  }

  /* STEP INDICATOR */
  .steps {
    display: flex; gap: 0;
    margin-bottom: 28px;
    border: 1px solid var(--gray-3);
    border-radius: 10px;
    overflow: hidden;
  }
  .step {
    flex: 1; padding: 12px 16px;
    text-align: center;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--gray-4);
    background: var(--gray-1);
    border-right: 1px solid var(--gray-3);
    cursor: pointer;
    transition: all 0.2s;
  }
  .step:last-child { border-right: none; }
  .step.done { color: var(--green); background: var(--green-light); }
  .step.current { color: var(--blue); background: var(--blue-light); font-weight: 700; }
  .step .step-n { font-size: 1rem; display: block; margin-bottom: 2px; }

  /* TOOLTIP */
  .tip {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 18px; height: 18px;
    border-radius: 50%;
    background: var(--gray-4);
    color: white;
    font-size: 0.68rem;
    font-weight: 700;
    cursor: help;
    position: relative;
  }
  .tip:hover::after {
    content: attr(data-tip);
    position: absolute;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--gray-6);
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 0.75rem;
    white-space: nowrap;
    z-index: 10;
    font-weight: 400;
    font-family: var(--sans);
  }
</style>
</head>
<body>

<header>
  <div class="icon">‚ö°</div>
  <div>
    <h1>Operational Amplifier Lab Activity</h1>
    <p>Inverting vs. Non-Inverting Configurations ‚Äî Comparative Analysis</p>
  </div>
  <div class="badge">ELT 201 Lab</div>
</header>

<!-- TAB NAV -->
<nav class="tab-nav">
  <button class="tab-btn active" onclick="switchTab('overview', this)">
    <span class="tab-num">1</span> Activity Overview
  </button>
  <button class="tab-btn" onclick="switchTab('inverting', this)">
    <span class="tab-num">2</span> Inverting Op-Amp
  </button>
  <button class="tab-btn" onclick="switchTab('noninverting', this)">
    <span class="tab-num">3</span> Non-Inverting Op-Amp
  </button>
  <button class="tab-btn" onclick="switchTab('results', this)">
    <span class="tab-num">4</span> Results
  </button>
  <button class="tab-btn" onclick="switchTab('analysis', this)">
    <span class="tab-num">5</span> Analysis
  </button>
</nav>

<!-- =================== TAB 1: OVERVIEW =================== -->
<div id="tab-overview" class="tab-panel active">

  <div class="steps">
    <div class="step current"><span class="step-n">üìã</span> Overview</div>
    <div class="step"><span class="step-n">üî¥</span> Inverting</div>
    <div class="step"><span class="step-n">üîµ</span> Non-Inverting</div>
    <div class="step"><span class="step-n">üìä</span> Results</div>
    <div class="step"><span class="step-n">üß†</span> Analysis</div>
  </div>

  <h2>Lab Activity Overview</h2>
  <p style="color:var(--gray-5); margin-bottom: 20px;">Estimated time: 60‚Äì90 minutes &nbsp;|&nbsp; Individual or paired activity</p>

  <div class="card blue">
    <h3>üéØ Learning Objectives</h3>
    <ul class="obj-list">
      <li>Explain the difference between inverting and non-inverting operational amplifier configurations.</li>
      <li>Calculate voltage gain using the appropriate formula for each configuration.</li>
      <li>Predict output voltage based on input voltage and resistor values.</li>
      <li>Interpret waveform phase relationships between input and output signals.</li>
      <li>Synthesize findings into a comparative analysis of both configurations.</li>
    </ul>
  </div>

  <div class="section-title"><h3>Background</h3></div>
  <p>The operational amplifier (op-amp) is one of the most versatile building blocks in analog electronics. Depending on how feedback resistors are connected, the same op-amp IC can amplify a signal while preserving its phase (non-inverting) or flip the output 180¬∞ out of phase with the input (inverting). Understanding both configurations is essential for designing analog circuits in audio, instrumentation, and control systems.</p>

  <div class="section-title"><h3>Lab Procedure</h3></div>

  <div class="card gray">
    <h3>Step 1 ‚Äî Inverting Op-Amp Simulator (Tab 2)</h3>
    <p>Use the interactive simulator to explore the inverting configuration. Adjust the input voltage (Vin), feedback resistor (Rf), and input resistor (Rin). Record at least <strong>four</strong> data points in the Results table. Observe the waveform and note the phase relationship.</p>
  </div>

  <div class="card gray">
    <h3>Step 2 ‚Äî Non-Inverting Op-Amp Simulator (Tab 3)</h3>
    <p>Switch to the non-inverting simulator. Adjust Vin, Rf, and Rg. Record at least <strong>four</strong> data points. Note the minimum gain of 1 and observe that the output remains in phase with the input.</p>
  </div>

  <div class="card gray">
    <h3>Step 3 ‚Äî Results Table (Tab 4)</h3>
    <p>Enter your collected data into the structured results table. Verify your hand-calculated gain values match the simulator output. Complete the comparison summary.</p>
  </div>

  <div class="card gray">
    <h3>Step 4 ‚Äî Analysis Questions (Tab 5)</h3>
    <p>Answer all six analysis questions using your data and observations. Submit your completed lab to your instructor for AI-enhanced feedback review.</p>
  </div>

  <div class="section-title"><h3>Grading Rubric</h3></div>

  <div style="border:1px solid var(--gray-3); border-radius:10px; overflow:hidden; margin-bottom:20px;">
    <div class="rubric-row">
      <div class="rubric-head">Criterion</div>
      <div class="rubric-head" style="text-align:center;">Points</div>
      <div class="rubric-head">Performance Indicators</div>
    </div>
    <div class="rubric-row">
      <div>Simulator Exploration & Data Collection</div>
      <div class="rubric-points">25</div>
      <div>4+ data points for each configuration; Vin, Rf, Rin/Rg, calculated gain, Vout all recorded accurately.</div>
    </div>
    <div class="rubric-row">
      <div style="background:var(--gray-1)">Gain Formula Application</div>
      <div class="rubric-points" style="background:var(--gray-1)">20</div>
      <div style="background:var(--gray-1)">Correct formula used for each type; hand-calculated values match simulator within ¬±5%.</div>
    </div>
    <div class="rubric-row">
      <div>Phase Relationship Identification</div>
      <div class="rubric-points">15</div>
      <div>Correctly identifies 180¬∞ phase inversion for inverting; in-phase relationship for non-inverting.</div>
    </div>
    <div class="rubric-row">
      <div style="background:var(--gray-1)">Comparative Analysis</div>
      <div class="rubric-points" style="background:var(--gray-1)">25</div>
      <div style="background:var(--gray-1)">Analysis questions answered with specific references to data; demonstrates conceptual synthesis beyond simple description.</div>
    </div>
    <div class="rubric-row">
      <div>Application Scenario</div>
      <div class="rubric-points">15</div>
      <div>Correctly identifies a real-world application for each configuration with engineering justification.</div>
    </div>
    <div class="rubric-row" style="background:var(--blue); color:white;">
      <div style="font-weight:700;">Total</div>
      <div style="font-weight:700; text-align:center; font-family:var(--mono); font-size:1.1rem; color:white;">100</div>
      <div></div>
    </div>
  </div>

  <div class="btn-row">
    <button class="btn btn-primary" onclick="switchTab('inverting', document.querySelectorAll('.tab-btn')[1])">Begin Lab ‚Üí Inverting Op-Amp</button>
  </div>
</div>

<!-- =================== TAB 2: INVERTING =================== -->
<div id="tab-inverting" class="tab-panel">

  <h2>üî¥ Inverting Op-Amp Configuration</h2>
  <p>In this configuration, the input signal is applied through Rin to the inverting (‚àí) terminal. The output is 180¬∞ out of phase with the input. Gain is always negative.</p>

  <div class="formula">Av = ‚àí(Rf / Rin) &nbsp;&nbsp; | &nbsp;&nbsp; Vout = Av √ó Vin</div>

  <div class="sim-box inv-sim">
    <div class="sim-header inv">‚ö° Inverting Op-Amp Simulator</div>
    <div class="sim-body">

      <div class="slider-group">
        <label>Vin (Input Voltage) <span id="inv-vin-val">1.0 V</span></label>
        <input type="range" id="inv-vin" min="-5" max="5" step="0.1" value="1" oninput="updateInv()" class="inv">
      </div>
      <div class="slider-group">
        <label>Rf (Feedback Resistor) <span id="inv-rf-val">10 kŒ©</span></label>
        <input type="range" id="inv-rf" min="1" max="100" step="1" value="10" oninput="updateInv()">
      </div>
      <div class="slider-group">
        <label>Rin (Input Resistor) <span id="inv-rin-val">10 kŒ©</span></label>
        <input type="range" id="inv-rin" min="1" max="100" step="1" value="10" oninput="updateInv()">
      </div>

      <div class="output-display">
        <div class="output-box out-gain">
          <div class="label">Voltage Gain (Av)</div>
          <div class="value" id="inv-gain">‚àí1.00</div>
        </div>
        <div class="output-box out-vout">
          <div class="label">Vout</div>
          <div class="value" id="inv-vout">‚àí1.00 V</div>
        </div>
      </div>

      <canvas id="inv-canvas" height="140"></canvas>

      <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
        <button class="btn btn-secondary" onclick="recordInv()" style="font-size:0.82rem;">üìã Record This Data Point</button>
        <button class="btn btn-secondary" onclick="clearInvTable()" style="font-size:0.82rem;">üóë Clear Table</button>
      </div>

      <div class="section-title" style="margin-top:20px;"><h3>Recorded Data Points</h3></div>
      <div style="overflow-x:auto;">
        <table id="inv-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Vin (V)</th>
              <th>Rf (kŒ©)</th>
              <th>Rin (kŒ©)</th>
              <th>Av (calc)</th>
              <th>Vout (V)</th>
              <th>Phase</th>
            </tr>
          </thead>
          <tbody id="inv-tbody">
            <tr><td colspan="7" style="text-align:center; color:var(--gray-4); font-family:var(--sans);">No data recorded yet. Adjust sliders and click Record.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="card blue" style="margin-top:20px;">
    <h3>üí° Key Observations to Note</h3>
    <ul class="obj-list">
      <li>What happens to the output polarity when Vin is positive? Negative?</li>
      <li>When Rf = Rin, what is the gain? What does this tell you about unity gain?</li>
      <li>How does doubling Rf while keeping Rin constant affect the output voltage?</li>
      <li>Observe the waveform ‚Äî the output is 180¬∞ shifted from the input.</li>
    </ul>
  </div>

  <div class="btn-row">
    <button class="btn btn-secondary" onclick="switchTab('overview', document.querySelectorAll('.tab-btn')[0])">‚Üê Back</button>
    <button class="btn btn-primary" onclick="switchTab('noninverting', document.querySelectorAll('.tab-btn')[2])">Next: Non-Inverting ‚Üí</button>
  </div>
</div>

<!-- =================== TAB 3: NON-INVERTING =================== -->
<div id="tab-noninverting" class="tab-panel">

  <h2>üîµ Non-Inverting Op-Amp Configuration</h2>
  <p>The input signal is applied directly to the non-inverting (+) terminal. Output is in phase with the input. Gain is always ‚â• 1 (positive).</p>

  <div class="formula">Av = 1 + (Rf / Rg) &nbsp;&nbsp; | &nbsp;&nbsp; Vout = Av √ó Vin</div>

  <div class="sim-box" style="border-color:var(--blue);">
    <div class="sim-header noninv">‚ö° Non-Inverting Op-Amp Simulator</div>
    <div class="sim-body">

      <div class="slider-group">
        <label>Vin (Input Voltage) <span id="ni-vin-val">1.0 V</span></label>
        <input type="range" id="ni-vin" min="-5" max="5" step="0.1" value="1" oninput="updateNI()">
      </div>
      <div class="slider-group">
        <label>Rf (Feedback Resistor) <span id="ni-rf-val">10 kŒ©</span></label>
        <input type="range" id="ni-rf" min="1" max="100" step="1" value="10" oninput="updateNI()">
      </div>
      <div class="slider-group">
        <label>Rg (Ground Resistor) <span id="ni-rg-val">10 kŒ©</span></label>
        <input type="range" id="ni-rg" min="1" max="100" step="1" value="10" oninput="updateNI()">
      </div>

      <div class="output-display">
        <div class="output-box out-gain">
          <div class="label">Voltage Gain (Av)</div>
          <div class="value" id="ni-gain">+2.00</div>
        </div>
        <div class="output-box out-vout">
          <div class="label">Vout</div>
          <div class="value" id="ni-vout">+2.00 V</div>
        </div>
      </div>

      <canvas id="ni-canvas" height="140"></canvas>

      <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
        <button class="btn btn-secondary" onclick="recordNI()" style="font-size:0.82rem;">üìã Record This Data Point</button>
        <button class="btn btn-secondary" onclick="clearNITable()" style="font-size:0.82rem;">üóë Clear Table</button>
      </div>

      <div class="section-title" style="margin-top:20px;"><h3>Recorded Data Points</h3></div>
      <div style="overflow-x:auto;">
        <table id="ni-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Vin (V)</th>
              <th>Rf (kŒ©)</th>
              <th>Rg (kŒ©)</th>
              <th>Av (calc)</th>
              <th>Vout (V)</th>
              <th>Phase</th>
            </tr>
          </thead>
          <tbody id="ni-tbody">
            <tr><td colspan="7" style="text-align:center; color:var(--gray-4); font-family:var(--sans);">No data recorded yet. Adjust sliders and click Record.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="card blue" style="margin-top:20px;">
    <h3>üí° Key Observations to Note</h3>
    <ul class="obj-list">
      <li>What is the minimum possible gain for a non-inverting amplifier, and why?</li>
      <li>How does the phase of the output compare to the input in every trial?</li>
      <li>When Rf = 0 (or Rg is very large), what configuration does this approach?</li>
      <li>Compare the gain formula here to the inverting: what is structurally different?</li>
    </ul>
  </div>

  <div class="btn-row">
    <button class="btn btn-secondary" onclick="switchTab('inverting', document.querySelectorAll('.tab-btn')[1])">‚Üê Inverting</button>
    <button class="btn btn-primary" onclick="switchTab('results', document.querySelectorAll('.tab-btn')[3])">Next: Results ‚Üí</button>
  </div>
</div>

<!-- =================== TAB 4: RESULTS =================== -->
<div id="tab-results" class="tab-panel">

  <h2>üìä Results & Data Summary</h2>
  <p>Enter your final recorded data below. Ensure at least 4 trials for each configuration. Verify your hand-calculated values against the simulator outputs.</p>

  <div class="section-title"><h3>Inverting Op-Amp ‚Äî Final Data Table</h3></div>

  <div style="overflow-x:auto; margin-bottom:24px;">
    <table>
      <thead>
        <tr>
          <th>Trial</th>
          <th>Vin (V)</th>
          <th>Rf (kŒ©)</th>
          <th>Rin (kŒ©)</th>
          <th>Av Formula = ‚àíRf/Rin</th>
          <th>Vout = Av √ó Vin</th>
          <th>Phase Shift</th>
        </tr>
      </thead>
      <tbody>
        <tr id="inv-res-1">
          <td style="font-weight:700; color:var(--red);">1</td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><select style="padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;"><option>180¬∞</option><option>0¬∞</option></select></td>
        </tr>
        <tr>
          <td style="font-weight:700; color:var(--red);">2</td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><select style="padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;"><option>180¬∞</option><option>0¬∞</option></select></td>
        </tr>
        <tr>
          <td style="font-weight:700; color:var(--red);">3</td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><select style="padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;"><option>180¬∞</option><option>0¬∞</option></select></td>
        </tr>
        <tr>
          <td style="font-weight:700; color:var(--red);">4</td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><select style="padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;"><option>180¬∞</option><option>0¬∞</option></select></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="section-title"><h3>Non-Inverting Op-Amp ‚Äî Final Data Table</h3></div>

  <div style="overflow-x:auto; margin-bottom:24px;">
    <table>
      <thead>
        <tr>
          <th>Trial</th>
          <th>Vin (V)</th>
          <th>Rf (kŒ©)</th>
          <th>Rg (kŒ©)</th>
          <th>Av Formula = 1+Rf/Rg</th>
          <th>Vout = Av √ó Vin</th>
          <th>Phase Shift</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="font-weight:700; color:var(--blue);">1</td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><select style="padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;"><option>0¬∞</option><option>180¬∞</option></select></td>
        </tr>
        <tr>
          <td style="font-weight:700; color:var(--blue);">2</td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><select style="padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;"><option>0¬∞</option><option>180¬∞</option></select></td>
        </tr>
        <tr>
          <td style="font-weight:700; color:var(--blue);">3</td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><select style="padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;"><option>0¬∞</option><option>180¬∞</option></select></td>
        </tr>
        <tr>
          <td style="font-weight:700; color:var(--blue);">4</td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:70px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><input type="text" style="width:80px; padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;" placeholder="‚Äî"></td>
          <td><select style="padding:4px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;"><option>0¬∞</option><option>180¬∞</option></select></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="section-title"><h3>Configuration Comparison Summary</h3></div>

  <div style="overflow-x:auto; margin-bottom:20px; border:1px solid var(--gray-3); border-radius:10px; overflow:hidden;">
    <table class="compare-table">
      <thead>
        <tr>
          <th>Parameter</th>
          <th class="inv-col">Inverting</th>
          <th class="noninv-col">Non-Inverting</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Gain Formula</strong></td>
          <td style="background:#fff5f5; font-family:var(--mono);">Av = ‚àíRf/Rin</td>
          <td style="background:#f0f4ff; font-family:var(--mono);">Av = 1 + Rf/Rg</td>
        </tr>
        <tr>
          <td><strong>Minimum Gain</strong></td>
          <td style="background:#fff5f5; font-family:var(--mono);">No lower limit (neg.)</td>
          <td style="background:#f0f4ff; font-family:var(--mono);">Always ‚â• 1</td>
        </tr>
        <tr>
          <td><strong>Phase Shift</strong></td>
          <td style="background:#fff5f5; font-family:var(--mono);">180¬∞</td>
          <td style="background:#f0f4ff; font-family:var(--mono);">0¬∞ (in-phase)</td>
        </tr>
        <tr>
          <td><strong>Input Impedance</strong></td>
          <td style="background:#fff5f5; font-family:var(--mono);">Equal to Rin</td>
          <td style="background:#f0f4ff; font-family:var(--mono);">Very High (‚âà ‚àû)</td>
        </tr>
        <tr>
          <td><strong>Input Terminal Used</strong></td>
          <td style="background:#fff5f5; font-family:var(--mono);">Inverting (‚àí)</td>
          <td style="background:#f0f4ff; font-family:var(--mono);">Non-Inverting (+)</td>
        </tr>
        <tr>
          <td><strong>Unity Gain Possible?</strong></td>
          <td style="background:#fff5f5; font-family:var(--mono);"><input type="text" placeholder="Your answer" style="width:120px; padding:3px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;"></td>
          <td style="background:#f0f4ff; font-family:var(--mono);"><input type="text" placeholder="Your answer" style="width:120px; padding:3px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;"></td>
        </tr>
        <tr>
          <td><strong>Real-World Application</strong></td>
          <td style="background:#fff5f5;"><input type="text" placeholder="Your example" style="width:170px; padding:3px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;"></td>
          <td style="background:#f0f4ff;"><input type="text" placeholder="Your example" style="width:170px; padding:3px 6px; font-family:var(--mono); border:1px solid var(--gray-3); border-radius:4px;"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="progress-wrap">
    <div class="progress-label"><span>Lab Completion Progress</span><span id="progress-pct">20%</span></div>
    <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:20%"></div></div>
  </div>

  <div class="btn-row">
    <button class="btn btn-secondary" onclick="switchTab('noninverting', document.querySelectorAll('.tab-btn')[2])">‚Üê Non-Inverting</button>
    <button class="btn btn-primary" onclick="switchTab('analysis', document.querySelectorAll('.tab-btn')[4])">Next: Analysis ‚Üí</button>
  </div>
</div>

<!-- =================== TAB 5: ANALYSIS =================== -->
<div id="tab-analysis" class="tab-panel">

  <h2>üß† Analysis & Synthesis</h2>
  <p>Answer all six questions thoughtfully using your collected data. Reference specific trial numbers and values where possible. Demonstrate conceptual understanding, not just data recitation.</p>

  <div style="margin-bottom:8px; font-size:0.82rem; color:var(--gray-5);">
    Student Name: <input type="text" id="student-name" placeholder="Enter your name" style="margin-left:8px; padding:5px 10px; border:1px solid var(--gray-3); border-radius:5px; font-family:var(--sans); width:220px;">
    &nbsp;&nbsp; Date: <input type="date" id="lab-date" style="margin-left:8px; padding:5px 10px; border:1px solid var(--gray-3); border-radius:5px; font-family:var(--sans);">
  </div>

  <div style="height:20px;"></div>

  <div class="analysis-q">
    <div class="q-num">Question 1 ‚Äî Gain Formula Comparison</div>
    <div class="q-text">Compare the gain formulas for the inverting and non-inverting op-amp configurations. Explain why the inverting configuration produces a negative gain value, and what this means physically for the output signal.</div>
    <textarea id="q1" placeholder="Type your answer here. Reference your data where applicable..."></textarea>
    <div style="font-size:0.78rem; color:var(--gray-4); margin-top:6px; text-align:right;" id="q1-count">0 / 50 words minimum</div>
  </div>

  <div class="analysis-q">
    <div class="q-num">Question 2 ‚Äî Phase Relationship</div>
    <div class="q-text">Describe the phase relationship between input and output for each configuration. Use your waveform observations to support your explanation. Why does the phase inversion occur in the inverting configuration?</div>
    <textarea id="q2" placeholder="Type your answer here..."></textarea>
    <div style="font-size:0.78rem; color:var(--gray-4); margin-top:6px; text-align:right;" id="q2-count">0 / 50 words minimum</div>
  </div>

  <div class="analysis-q">
    <div class="q-num">Question 3 ‚Äî Minimum Gain Analysis</div>
    <div class="q-text">Explain why the minimum gain of the non-inverting op-amp is always 1 (or greater). What resistor values would achieve a gain of exactly 1, and what is this special configuration called?</div>
    <textarea id="q3" placeholder="Type your answer here..."></textarea>
    <div style="font-size:0.78rem; color:var(--gray-4); margin-top:6px; text-align:right;" id="q3-count">0 / 40 words minimum</div>
  </div>

  <div class="analysis-q">
    <div class="q-num">Question 4 ‚Äî Input Impedance</div>
    <div class="q-text">The non-inverting configuration has significantly higher input impedance than the inverting configuration. Explain why this is the case based on where the input signal is applied. Describe one practical scenario where this difference would matter to a circuit designer.</div>
    <textarea id="q4" placeholder="Type your answer here..."></textarea>
    <div style="font-size:0.78rem; color:var(--gray-4); margin-top:6px; text-align:right;" id="q4-count">0 / 50 words minimum</div>
  </div>

  <div class="analysis-q">
    <div class="q-num">Question 5 ‚Äî Real-World Application Selection</div>
    <div class="q-text">You are designing a signal conditioning circuit for a microphone that feeds into an audio amplifier. The microphone has a very high output impedance. Which op-amp configuration would you choose and why? Would you need phase inversion to be a concern?</div>
    <textarea id="q5" placeholder="Type your answer here..."></textarea>
    <div style="font-size:0.78rem; color:var(--gray-4); margin-top:6px; text-align:right;" id="q5-count">0 / 60 words minimum</div>
  </div>

  <div class="analysis-q">
    <div class="q-num">Question 6 ‚Äî Synthesis & Critical Thinking</div>
    <div class="q-text">Based on all of your data and observations, write a concise technical summary (3‚Äì5 sentences) that a junior technician could use to decide which op-amp configuration to use for a given design task. Include gain behavior, phase, and impedance considerations.</div>
    <textarea id="q6" placeholder="Type your synthesis here..." style="min-height:120px;"></textarea>
    <div style="font-size:0.78rem; color:var(--gray-4); margin-top:6px; text-align:right;" id="q6-count">0 / 75 words minimum</div>
  </div>

  <!-- AI FEEDBACK PANEL -->
  <div class="ai-panel">
    <div class="ai-header">
      ü§ñ AI-Enhanced Feedback ‚Äî Instructor Tool
    </div>
    <div class="ai-body">
      <p>When students submit this lab, instructors can paste the student's responses into the AI prompt below to generate targeted, rubric-aligned feedback. The AI is provided the lesson objectives and grading criteria to ensure feedback is specific, formative, and exam-focused.</p>
      <button class="btn btn-primary" onclick="generatePrompt()" style="margin-top:12px;">Generate AI Feedback Prompt</button>
      <div id="ai-prompt-output" style="display:none;">
        <div style="margin-top:16px; font-weight:600; font-size:0.88rem; color:var(--gray-6);">üìã Copy this prompt into your AI system:</div>
        <div class="ai-prompt" id="ai-prompt-text"></div>
        <button class="btn btn-secondary" onclick="copyPrompt()" style="margin-top:10px; font-size:0.82rem;">üìã Copy to Clipboard</button>
      </div>
    </div>
  </div>

  <!-- SUBMIT -->
  <div class="card green" style="margin-top:24px;">
    <h3>‚úÖ Ready to Submit?</h3>
    <p>Ensure all six analysis questions are answered and your data tables in Tab 4 are complete. Click the button below to generate a printable summary of your responses.</p>
    <div class="btn-row">
      <button class="btn btn-success" onclick="printLab()">üñ® Print / Save Lab Report</button>
      <button class="btn btn-secondary" onclick="switchTab('results', document.querySelectorAll('.tab-btn')[3])">‚Üê Back to Results</button>
    </div>
  </div>

</div>

<script>
// =================== TAB SWITCHING ===================
function switchTab(tabName, btnEl) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + tabName).classList.add('active');
  if (btnEl) btnEl.classList.add('active');
  window.scrollTo(0, 0);
  updateProgress();
}

// =================== INVERTING SIMULATOR ===================
let invData = [];
let niData = [];

function updateInv() {
  const vin = parseFloat(document.getElementById('inv-vin').value);
  const rf = parseFloat(document.getElementById('inv-rf').value);
  const rin = parseFloat(document.getElementById('inv-rin').value);

  document.getElementById('inv-vin-val').textContent = vin.toFixed(1) + ' V';
  document.getElementById('inv-rf-val').textContent = rf + ' kŒ©';
  document.getElementById('inv-rin-val').textContent = rin + ' kŒ©';

  const gain = -(rf / rin);
  const vout = gain * vin;

  document.getElementById('inv-gain').textContent = gain.toFixed(2);
  document.getElementById('inv-vout').textContent = vout.toFixed(2) + ' V';

  drawWaveform('inv-canvas', vin, vout, '#ff4444', '#ff8888', true);
}

function updateNI() {
  const vin = parseFloat(document.getElementById('ni-vin').value);
  const rf = parseFloat(document.getElementById('ni-rf').value);
  const rg = parseFloat(document.getElementById('ni-rg').value);

  document.getElementById('ni-vin-val').textContent = vin.toFixed(1) + ' V';
  document.getElementById('ni-rf-val').textContent = rf + ' kŒ©';
  document.getElementById('ni-rg-val').textContent = rg + ' kŒ©';

  const gain = 1 + (rf / rg);
  const vout = gain * vin;

  document.getElementById('ni-gain').textContent = '+' + gain.toFixed(2);
  document.getElementById('ni-vout').textContent = vout.toFixed(2) + ' V';

  drawWaveform('ni-canvas', vin, vout, '#4488ff', '#88bbff', false);
}

function drawWaveform(canvasId, vin, vout, colorIn, colorOut, invert) {
  const canvas = document.getElementById(canvasId);
  const ctx = canvas.getContext('2d');
  const W = canvas.offsetWidth || 600;
  const H = 140;
  canvas.width = W;
  canvas.height = H;

  ctx.fillStyle = '#111827';
  ctx.fillRect(0, 0, W, H);

  // Grid
  ctx.strokeStyle = 'rgba(255,255,255,0.07)';
  ctx.lineWidth = 1;
  for (let x = 0; x < W; x += 40) {
    ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke();
  }
  for (let y = 0; y < H; y += 20) {
    ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke();
  }

  // Center line
  ctx.strokeStyle = 'rgba(255,255,255,0.2)';
  ctx.setLineDash([4, 4]);
  ctx.beginPath(); ctx.moveTo(0, H/2); ctx.lineTo(W, H/2); ctx.stroke();
  ctx.setLineDash([]);

  const maxV = Math.max(Math.abs(vin), Math.abs(vout), 1) * 1.3;
  const scaleY = (H / 2 - 12) / maxV;

  function drawSine(phase, amplitude, color) {
    ctx.strokeStyle = color;
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    for (let x = 0; x < W; x++) {
      const t = (x / W) * 2 * Math.PI * 2;
      const y = H / 2 - Math.sin(t + phase) * amplitude * scaleY;
      if (x === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    }
    ctx.stroke();
  }

  drawSine(0, Math.abs(vin), colorIn);
  drawSine(invert ? Math.PI : 0, Math.abs(vout), colorOut);

  // Labels
  ctx.font = '11px IBM Plex Mono, monospace';
  ctx.fillStyle = colorIn;
  ctx.fillText('Vin = ' + vin.toFixed(1) + 'V', 8, 16);
  ctx.fillStyle = colorOut;
  ctx.fillText('Vout = ' + vout.toFixed(2) + 'V', 8, 32);
  ctx.fillStyle = 'rgba(255,255,255,0.5)';
  ctx.fillText(invert ? 'Phase: 180¬∞' : 'Phase: 0¬∞', W - 95, 16);
}

function recordInv() {
  const vin = parseFloat(document.getElementById('inv-vin').value);
  const rf = parseFloat(document.getElementById('inv-rf').value);
  const rin = parseFloat(document.getElementById('inv-rin').value);
  const gain = -(rf / rin);
  const vout = gain * vin;

  invData.push({ vin, rf, rin, gain, vout });
  renderInvTable();
  updateProgress();
}

function renderInvTable() {
  const tbody = document.getElementById('inv-tbody');
  if (invData.length === 0) {
    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; color:var(--gray-4); font-family:var(--sans);">No data recorded yet.</td></tr>';
    return;
  }
  tbody.innerHTML = invData.map((d, i) => `
    <tr>
      <td>${i+1}</td>
      <td>${d.vin.toFixed(1)}</td>
      <td>${d.rf}</td>
      <td>${d.rin}</td>
      <td>${d.gain.toFixed(2)}</td>
      <td>${d.vout.toFixed(2)}</td>
      <td>180¬∞</td>
    </tr>
  `).join('');
}

function recordNI() {
  const vin = parseFloat(document.getElementById('ni-vin').value);
  const rf = parseFloat(document.getElementById('ni-rf').value);
  const rg = parseFloat(document.getElementById('ni-rg').value);
  const gain = 1 + (rf / rg);
  const vout = gain * vin;

  niData.push({ vin, rf, rg, gain, vout });
  renderNITable();
  updateProgress();
}

function renderNITable() {
  const tbody = document.getElementById('ni-tbody');
  if (niData.length === 0) {
    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; color:var(--gray-4); font-family:var(--sans);">No data recorded yet.</td></tr>';
    return;
  }
  tbody.innerHTML = niData.map((d, i) => `
    <tr>
      <td>${i+1}</td>
      <td>${d.vin.toFixed(1)}</td>
      <td>${d.rf}</td>
      <td>${d.rg}</td>
      <td>+${d.gain.toFixed(2)}</td>
      <td>${d.vout.toFixed(2)}</td>
      <td>0¬∞</td>
    </tr>
  `).join('');
}

function clearInvTable() { invData = []; renderInvTable(); updateProgress(); }
function clearNITable() { niData = []; renderNITable(); updateProgress(); }

// =================== WORD COUNT ===================
const qMins = { q1: 50, q2: 50, q3: 40, q4: 50, q5: 60, q6: 75 };
['q1','q2','q3','q4','q5','q6'].forEach(id => {
  document.getElementById(id).addEventListener('input', function() {
    const words = this.value.trim().split(/\s+/).filter(w => w.length > 0).length;
    const min = qMins[id];
    const el = document.getElementById(id + '-count');
    el.textContent = words + ' / ' + min + ' words minimum';
    el.style.color = words >= min ? 'var(--green)' : 'var(--gray-4)';
    updateProgress();
  });
});

// =================== PROGRESS ===================
function updateProgress() {
  const invDone = invData.length >= 4 ? 20 : Math.round((invData.length / 4) * 20);
  const niDone = niData.length >= 4 ? 20 : Math.round((niData.length / 4) * 20);
  
  const qAnswered = ['q1','q2','q3','q4','q5','q6'].filter(id => {
    const words = document.getElementById(id).value.trim().split(/\s+/).filter(w=>w.length>0).length;
    return words >= qMins[id];
  }).length;
  const qPct = Math.round((qAnswered / 6) * 60);

  const total = invDone + niDone + qPct;
  document.getElementById('progress-fill').style.width = total + '%';
  document.getElementById('progress-pct').textContent = total + '%';
}

// =================== AI PROMPT GENERATOR ===================
function generatePrompt() {
  const name = document.getElementById('student-name').value || '[Student Name]';
  const q1 = document.getElementById('q1').value || '[No response]';
  const q2 = document.getElementById('q2').value || '[No response]';
  const q3 = document.getElementById('q3').value || '[No response]';
  const q4 = document.getElementById('q4').value || '[No response]';
  const q5 = document.getElementById('q5').value || '[No response]';
  const q6 = document.getElementById('q6').value || '[No response]';

  const invSummary = invData.length > 0 
    ? invData.map((d,i) => `  Trial ${i+1}: Vin=${d.vin}V, Rf=${d.rf}kŒ©, Rin=${d.rin}kŒ© ‚Üí Av=${d.gain.toFixed(2)}, Vout=${d.vout.toFixed(2)}V`).join('\n')
    : '  [No data recorded]';
  const niSummary = niData.length > 0
    ? niData.map((d,i) => `  Trial ${i+1}: Vin=${d.vin}V, Rf=${d.rf}kŒ©, Rg=${d.rg}kŒ© ‚Üí Av=+${d.gain.toFixed(2)}, Vout=${d.vout.toFixed(2)}V`).join('\n')
    : '  [No data recorded]';

  const prompt = `You are an expert electronics instructor providing formative feedback on a student lab report about operational amplifiers. Use the rubric and student responses below to provide specific, encouraging, and exam-focused feedback.

GRADING RUBRIC:
- Data Collection (25 pts): 4+ accurate trials per configuration with correct values
- Gain Formula Application (20 pts): Correct formula used; hand-calculated values match simulator ¬±5%
- Phase Relationship (15 pts): Correct identification of 180¬∞ (inverting) and 0¬∞ (non-inverting)
- Comparative Analysis (25 pts): Specific data references; conceptual synthesis beyond description
- Application Scenario (15 pts): Correct real-world application with engineering justification

STUDENT: ${name}

INVERTING OP-AMP DATA:
${invSummary}

NON-INVERTING OP-AMP DATA:
${niSummary}

STUDENT ANALYSIS RESPONSES:
Q1 (Gain Formula): ${q1}
Q2 (Phase Relationship): ${q2}
Q3 (Minimum Gain): ${q3}
Q4 (Input Impedance): ${q4}
Q5 (Application Selection): ${q5}
Q6 (Synthesis): ${q6}

Please provide:
1. A brief overall assessment (2‚Äì3 sentences)
2. Specific feedback on each question (strengths + one improvement per question)
3. Two or three targeted study recommendations to help this student perform better on the unit exam
4. A preliminary score estimate based on the rubric

Be specific, reference the student's actual words and data, and frame all feedback constructively.`;

  document.getElementById('ai-prompt-text').textContent = prompt;
  document.getElementById('ai-prompt-output').style.display = 'block';
}

function copyPrompt() {
  const text = document.getElementById('ai-prompt-text').textContent;
  navigator.clipboard.writeText(text).then(() => {
    const btn = event.target;
    btn.textContent = '‚úÖ Copied!';
    setTimeout(() => btn.textContent = 'üìã Copy to Clipboard', 2000);
  });
}

// =================== PRINT ===================
function printLab() {
  window.print();
}

// =================== INIT ===================
updateInv();
updateNI();

window.addEventListener('resize', () => {
  updateInv();
  updateNI();
});
</script>
</body>
</html>
