<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ”” ICMP Learning Center</title>
<style>
  /* â”€â”€ Reset & base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --blue:       #1565C0;
    --blue-light: #1E88E5;
    --blue-pale:  #E3F2FD;
    --blue-mid:   #BBDEFB;
    --red:        #C62828;
    --red-light:  #E53935;
    --red-pale:   #FFEBEE;
    --red-mid:    #FFCDD2;
    --white:      #FFFFFF;
    --gray-50:    #FAFAFA;
    --gray-100:   #F5F5F5;
    --gray-200:   #EEEEEE;
    --gray-400:   #BDBDBD;
    --gray-700:   #616161;
    --gray-900:   #212121;
    --shadow:     0 2px 8px rgba(0,0,0,.12);
    --radius:     10px;
  }

  body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: var(--white);
    color: var(--gray-900);
    line-height: 1.65;
  }

  /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  header {
    background: linear-gradient(135deg, var(--blue) 0%, var(--blue-light) 60%, #1a3a6b 100%);
    color: var(--white);
    text-align: center;
    padding: 44px 20px 36px;
    position: relative;
    overflow: hidden;
  }
  header::before {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(ellipse at 70% 50%, rgba(229,57,53,.25) 0%, transparent 65%);
  }
  header h1 { font-size: 2.5rem; font-weight: 800; position: relative; }
  header h1 span { color: #FFD54F; }
  header p  { font-size: 1.1rem; margin-top: 10px; opacity: .9; position: relative; }

  /* â”€â”€ Nav tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  nav {
    background: var(--blue);
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 4px;
    padding: 10px 12px;
    position: sticky; top: 0; z-index: 100;
    box-shadow: 0 2px 6px rgba(0,0,0,.25);
  }
  nav button {
    background: transparent;
    color: rgba(255,255,255,.78);
    border: none;
    padding: 9px 18px;
    border-radius: 6px;
    cursor: pointer;
    font-size: .92rem;
    font-weight: 600;
    transition: background .2s, color .2s;
  }
  nav button:hover   { background: rgba(255,255,255,.15); color: #fff; }
  nav button.active  { background: var(--red); color: #fff; }

  /* â”€â”€ Main layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  main { max-width: 1060px; margin: 0 auto; padding: 32px 18px 60px; }

  section.tab { display: none; }
  section.tab.active { display: block; }

  /* â”€â”€ Section headings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  h2 {
    font-size: 1.7rem;
    color: var(--blue);
    border-left: 5px solid var(--red);
    padding-left: 14px;
    margin-bottom: 22px;
  }
  h3 { font-size: 1.2rem; color: var(--blue); margin: 22px 0 10px; }
  h4 { font-size: 1rem; color: var(--red); margin: 14px 0 6px; }

  /* â”€â”€ Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .card {
    background: var(--white);
    border: 1px solid var(--gray-200);
    border-radius: var(--radius);
    padding: 22px 24px;
    box-shadow: var(--shadow);
    margin-bottom: 22px;
  }
  .card.blue-tint { background: var(--blue-pale); border-color: var(--blue-mid); }
  .card.red-tint  { background: var(--red-pale);  border-color: var(--red-mid); }

  /* â”€â”€ Component flow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .flow {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    margin: 18px 0;
  }
  .flow-box {
    background: var(--blue);
    color: #fff;
    border-radius: var(--radius);
    padding: 14px 16px;
    text-align: center;
    min-width: 130px;
    flex: 1;
  }
  .flow-box .icon { font-size: 1.6rem; display: block; margin-bottom: 6px; }
  .flow-box .label { font-weight: 700; font-size: .9rem; }
  .flow-box .sub   { font-size: .78rem; opacity: .85; margin-top: 3px; }
  .flow-box.red    { background: var(--red); }
  .arrow { font-size: 1.5rem; color: var(--blue); font-weight: 900; }

  /* â”€â”€ Process steps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .steps { display: flex; flex-wrap: wrap; gap: 10px; margin: 18px 0; }
  .step {
    background: var(--gray-100);
    border-left: 4px solid var(--blue);
    border-radius: 0 var(--radius) var(--radius) 0;
    padding: 12px 16px;
    flex: 1; min-width: 180px;
  }
  .step .num {
    background: var(--blue);
    color: #fff;
    border-radius: 50%;
    width: 26px; height: 26px;
    display: inline-flex; align-items: center; justify-content: center;
    font-weight: 800; font-size: .85rem;
    margin-right: 8px;
  }
  .step.red-step { border-color: var(--red); }
  .step.red-step .num { background: var(--red); }

  /* â”€â”€ Message-type grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .type-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 14px;
    margin: 18px 0;
  }
  .type-card {
    border-radius: var(--radius);
    padding: 16px;
    border: 2px solid transparent;
    cursor: pointer;
    transition: transform .15s, box-shadow .15s;
  }
  .type-card:hover { transform: translateY(-3px); box-shadow: 0 6px 18px rgba(0,0,0,.15); }
  .type-card.blue-card { background: var(--blue-pale); border-color: var(--blue-light); }
  .type-card.red-card  { background: var(--red-pale);  border-color: var(--red-light); }
  .type-card .type-icon { font-size: 2rem; display: block; margin-bottom: 6px; }
  .type-card .type-num  { font-size: .75rem; font-weight: 700; color: var(--gray-700); text-transform: uppercase; letter-spacing: .5px; }
  .type-card .type-name { font-weight: 700; color: var(--blue); margin: 3px 0; }
  .type-card.red-card .type-name { color: var(--red); }
  .type-card .type-desc { font-size: .85rem; color: var(--gray-700); }
  .type-detail {
    display: none;
    background: var(--blue-pale);
    border-radius: var(--radius);
    padding: 18px 20px;
    margin-top: 14px;
    border-left: 4px solid var(--blue);
  }
  .type-detail.red-detail { background: var(--red-pale); border-color: var(--red); }
  .type-detail.visible { display: block; }

  /* â”€â”€ Header table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .header-wrapper { overflow-x: auto; }
  .header-table {
    border-collapse: collapse;
    width: 100%;
    font-size: .82rem;
    min-width: 560px;
  }
  .header-table th, .header-table td {
    border: 1px solid var(--gray-400);
    padding: 7px 4px;
    text-align: center;
  }
  .header-table thead tr:first-child th { background: var(--gray-200); font-size: .72rem; }
  .header-table .row-label { background: var(--blue); color: #fff; font-weight: 700; font-size: .78rem; min-width: 80px; }
  .header-table .field-blue { background: var(--blue-pale); font-weight: 600; }
  .header-table .field-red  { background: var(--red-pale);  font-weight: 600; }
  .header-table .field-gray { background: var(--gray-100); }

  .field-list { list-style: none; padding: 0; }
  .field-list li { padding: 8px 0; border-bottom: 1px solid var(--gray-200); display: flex; gap: 10px; align-items: flex-start; }
  .field-list li:last-child { border-bottom: none; }
  .field-tag {
    background: var(--blue);
    color: #fff;
    border-radius: 5px;
    padding: 2px 9px;
    font-size: .78rem;
    font-weight: 700;
    white-space: nowrap;
    flex-shrink: 0;
    margin-top: 2px;
  }
  .field-tag.red { background: var(--red); }

  /* â”€â”€ Packet builder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .builder-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }
  @media(max-width:620px){ .builder-grid { grid-template-columns: 1fr; } }

  .form-group { margin-bottom: 14px; }
  .form-group label { display: block; font-weight: 600; color: var(--blue); margin-bottom: 5px; font-size: .9rem; }
  .form-group input, .form-group select, .form-group textarea {
    width: 100%;
    padding: 9px 12px;
    border: 2px solid var(--blue-mid);
    border-radius: 6px;
    font-size: .92rem;
    outline: none;
    transition: border-color .2s;
    background: var(--white);
  }
  .form-group input:focus, .form-group select:focus { border-color: var(--blue); }

  .btn {
    display: inline-block;
    padding: 10px 22px;
    border: none;
    border-radius: 7px;
    font-size: .95rem;
    font-weight: 700;
    cursor: pointer;
    transition: opacity .2s, transform .1s;
  }
  .btn:hover  { opacity: .88; }
  .btn:active { transform: scale(.97); }
  .btn-blue { background: var(--blue); color: #fff; }
  .btn-red  { background: var(--red);  color: #fff; }
  .btn-gray { background: var(--gray-200); color: var(--gray-900); }

  /* Packet visual */
  .packet-visual {
    margin-top: 20px;
    font-family: 'Courier New', monospace;
    font-size: .82rem;
  }
  .packet-row {
    display: flex;
    border: 1px solid var(--gray-400);
    margin-bottom: -1px;
  }
  .packet-row:first-child { border-radius: var(--radius) var(--radius) 0 0; }
  .packet-row:last-child  { border-radius: 0 0 var(--radius) var(--radius); }
  .packet-cell {
    border-right: 1px solid var(--gray-400);
    padding: 9px 6px;
    text-align: center;
    flex: 1;
    font-size: .78rem;
    word-break: break-all;
  }
  .packet-cell:last-child { border-right: none; }
  .packet-cell.label-cell { background: var(--blue); color: #fff; font-weight: 700; max-width: 100px; font-size: .75rem; }
  .packet-cell.blue { background: var(--blue-pale); }
  .packet-cell.red  { background: var(--red-pale); }
  .packet-cell.gray { background: var(--gray-100); }
  .packet-header-row { background: var(--gray-200); }
  .packet-header-row .packet-cell { font-weight: 700; font-size: .72rem; }

  /* ping simulator */
  .ping-output {
    background: #0d0d0d;
    color: #00e676;
    font-family: 'Courier New', monospace;
    font-size: .85rem;
    padding: 18px;
    border-radius: var(--radius);
    min-height: 150px;
    white-space: pre;
    overflow-x: auto;
    margin-top: 14px;
  }
  .ping-output .err { color: #ff5252; }
  .ping-output .warn { color: #FFD54F; }
  .ping-output .info { color: #64B5F6; }

  /* â”€â”€ Quiz â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .quiz-q {
    background: var(--white);
    border: 2px solid var(--blue-mid);
    border-radius: var(--radius);
    padding: 20px 22px;
    margin-bottom: 18px;
  }
  .quiz-q p { font-weight: 700; margin-bottom: 12px; color: var(--gray-900); }
  .quiz-option {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 9px 14px;
    border-radius: 7px;
    cursor: pointer;
    margin-bottom: 6px;
    border: 2px solid transparent;
    background: var(--gray-50);
    transition: background .15s, border-color .15s;
  }
  .quiz-option:hover { background: var(--blue-pale); border-color: var(--blue-mid); }
  .quiz-option.correct  { background: #E8F5E9; border-color: #4CAF50; color: #1B5E20; }
  .quiz-option.wrong    { background: var(--red-pale); border-color: var(--red-light); color: var(--red); }
  .quiz-option input { accent-color: var(--blue); width: 16px; height: 16px; }
  .quiz-feedback { font-weight: 700; margin-top: 10px; font-size: .9rem; }
  .quiz-feedback.ok  { color: #2E7D32; }
  .quiz-feedback.bad { color: var(--red); }
  .quiz-score {
    text-align: center;
    padding: 24px;
    background: var(--blue-pale);
    border-radius: var(--radius);
    font-size: 1.3rem;
    font-weight: 800;
    color: var(--blue);
    display: none;
    margin-top: 18px;
  }

  /* â”€â”€ Utility â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .badge {
    display: inline-block;
    padding: 2px 10px;
    border-radius: 20px;
    font-size: .78rem;
    font-weight: 700;
  }
  .badge-blue { background: var(--blue); color: #fff; }
  .badge-red  { background: var(--red);  color: #fff; }

  .info-box {
    background: var(--blue-pale);
    border-left: 4px solid var(--blue);
    border-radius: 0 var(--radius) var(--radius) 0;
    padding: 14px 18px;
    margin: 18px 0;
  }
  .warn-box {
    background: var(--red-pale);
    border-left: 4px solid var(--red);
    border-radius: 0 var(--radius) var(--radius) 0;
    padding: 14px 18px;
    margin: 18px 0;
  }
  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }
  @media(max-width:640px){ .two-col { grid-template-columns: 1fr; } }

  table.plain { border-collapse: collapse; width: 100%; margin: 14px 0; }
  table.plain th { background: var(--blue); color: #fff; padding: 9px 12px; text-align: left; }
  table.plain td { padding: 8px 12px; border-bottom: 1px solid var(--gray-200); font-size: .88rem; }
  table.plain tr:nth-child(even) td { background: var(--gray-50); }

  footer {
    background: var(--gray-100);
    text-align: center;
    padding: 18px;
    font-size: .82rem;
    color: var(--gray-700);
    border-top: 1px solid var(--gray-200);
  }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  HEADER  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header>
  <h1>ğŸ”” <span>ICMP</span> Learning Center</h1>
  <p>Master the Internet Control Message Protocol with interactive lessons and hands-on practice</p>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  NAV  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav id="mainNav">
  <button class="active" onclick="showTab('overview',this)">Overview</button>
  <button onclick="showTab('howworks',this)">How ICMP Works</button>
  <button onclick="showTab('types',this)">Message Types</button>
  <button onclick="showTab('header',this)">ICMP Header</button>
  <button onclick="showTab('builder',this)">Packet Builder</button>
  <button onclick="showTab('quiz',this)">Quiz</button>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  MAIN  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<main>

  <!-- â•â•â•â•â•â•â•â•â•â• TAB 1 Â· OVERVIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section id="overview" class="tab active">
    <h2>What is ICMP?</h2>

    <div class="card">
      <p>
        The <strong>Internet Control Message Protocol (ICMP)</strong> is a network-layer support protocol used by network devices â€” routers, hosts, and gateways â€” to send <em>error messages</em> and <em>operational information</em> about network conditions. It is defined in <strong>RFC 792</strong> (IPv4) and <strong>RFC 4443</strong> (ICMPv6).
      </p>
      <p style="margin-top:10px;">
        Unlike TCP or UDP, ICMP does <strong>not</strong> carry application data. Instead, it acts as the <em>diagnostic and control layer</em> of the internet â€” the messenger that tells routers and hosts when things go wrong.
      </p>
    </div>

    <h3>Why Do We Need ICMP?</h3>
    <div class="two-col">
      <div class="card blue-tint">
        <h4>ğŸ›‘ Error Reporting</h4>
        <p>When a packet cannot be delivered (e.g., host unreachable, TTL expired), ICMP sends an error back to the source.</p>
      </div>
      <div class="card blue-tint">
        <h4>ğŸ“¡ Network Diagnostics</h4>
        <p>Tools like <strong>ping</strong> and <strong>traceroute</strong> rely entirely on ICMP to test reachability and map network paths.</p>
      </div>
      <div class="card red-tint">
        <h4>â±ï¸ Congestion &amp; Flow Control</h4>
        <p>Source Quench messages (Type 4, now deprecated) were used to signal congestion to sending hosts.</p>
      </div>
      <div class="card red-tint">
        <h4>ğŸ”€ Redirect Routing</h4>
        <p>Routers send ICMP Redirect messages to inform hosts of a better route for a specific destination.</p>
      </div>
    </div>

    <h3>ICMP in the Protocol Stack</h3>
    <div class="flow">
      <div class="flow-box"><span class="icon">ğŸ“±</span><span class="label">Application</span><span class="sub">HTTP, DNS, FTPâ€¦</span></div>
      <div class="arrow">â†“</div>
      <div class="flow-box"><span class="icon">ğŸ”—</span><span class="label">Transport</span><span class="sub">TCP / UDP</span></div>
      <div class="arrow">â†“</div>
      <div class="flow-box red"><span class="icon">ğŸ””</span><span class="label">Network â€” ICMP</span><span class="sub">Lives inside IP (Proto 1)</span></div>
      <div class="arrow">â†“</div>
      <div class="flow-box"><span class="icon">ğŸ–§</span><span class="label">Data Link</span><span class="sub">Ethernet, Wi-Fi</span></div>
      <div class="arrow">â†“</div>
      <div class="flow-box"><span class="icon">âš¡</span><span class="label">Physical</span><span class="sub">Cables, Radio</span></div>
    </div>

    <div class="info-box">
      <strong>ğŸ“Œ Key fact:</strong> ICMP is encapsulated directly inside an IP datagram with <strong>Protocol Number 1</strong> (ICMPv6 uses Protocol Number 58). It is <em>not</em> a transport-layer protocol â€” it lives at the network layer alongside IP.
    </div>

    <h3>ICMP vs. Other Protocols</h3>
    <table class="plain">
      <thead><tr><th>Feature</th><th>ICMP</th><th>TCP</th><th>UDP</th></tr></thead>
      <tbody>
        <tr><td>Layer</td><td>Network (3)</td><td>Transport (4)</td><td>Transport (4)</td></tr>
        <tr><td>Purpose</td><td>Control &amp; Error Messages</td><td>Reliable Data Transfer</td><td>Fast Data Transfer</td></tr>
        <tr><td>Carries App Data?</td><td>âŒ No</td><td>âœ… Yes</td><td>âœ… Yes</td></tr>
        <tr><td>Connection?</td><td>Connectionless</td><td>Connection-oriented</td><td>Connectionless</td></tr>
        <tr><td>IP Protocol #</td><td>1 (ICMPv6: 58)</td><td>6</td><td>17</td></tr>
        <tr><td>Common tools</td><td>ping, traceroute</td><td>HTTP, SSH, FTP</td><td>DNS, DHCP, streaming</td></tr>
      </tbody>
    </table>

    <h3>Versions of ICMP</h3>
    <div class="two-col">
      <div class="card">
        <h4>ICMPv4 <span class="badge badge-blue">RFC 792</span></h4>
        <p>Used with IPv4. Protocol number <strong>1</strong>. The classic protocol behind <em>ping</em> and <em>traceroute</em> on most networks today.</p>
      </div>
      <div class="card">
        <h4>ICMPv6 <span class="badge badge-red">RFC 4443</span></h4>
        <p>Enhanced version for IPv6. Protocol number <strong>58</strong>. Adds Neighbor Discovery Protocol (NDP) and Multicast Listener Discovery (MLD) â€” functions that replaced ARP in IPv6.</p>
      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â• TAB 2 Â· HOW ICMP WORKS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section id="howworks" class="tab">
    <h2>How ICMP Works</h2>

    <div class="card">
      <p>ICMP operates as a companion to IP. When an IP packet encounters a problem in transit, the device that detects the problem generates an ICMP message, wraps it in an IP packet, and sends it back to the <strong>original source</strong> of the failed packet.</p>
    </div>

    <h3>Ping: Echo Request / Echo Reply</h3>
    <p>The most familiar use of ICMP is the <strong>ping</strong> command:</p>
    <div class="steps">
      <div class="step"><span class="num">1</span> <strong>Echo Request (Type 8)</strong><br>Source sends an ICMP Echo Request to the destination.</div>
      <div class="step"><span class="num">2</span> <strong>IP Encapsulation</strong><br>The ICMP message is wrapped inside an IPv4 datagram with Protocol = 1.</div>
      <div class="step"><span class="num">3</span> <strong>Network Transit</strong><br>Routers forward the IP packet hop-by-hop toward the destination.</div>
      <div class="step"><span class="num">4</span> <strong>Echo Reply (Type 0)</strong><br>Destination receives the request and sends back a matching Echo Reply.</div>
      <div class="step"><span class="num">5</span> <strong>RTT Measured</strong><br>Source calculates Round-Trip Time (RTT) â€” time from request to reply.</div>
    </div>

    <h3>Traceroute: Mapping the Path</h3>
    <p>Traceroute exploits the <strong>Time-To-Live (TTL)</strong> field in the IP header:</p>
    <div class="steps">
      <div class="step red-step"><span class="num">1</span>Send packet with <strong>TTL = 1</strong> â†’ Router 1 decrements TTL to 0 â†’ sends back <em>ICMP Time Exceeded (Type 11)</em>.</div>
      <div class="step red-step"><span class="num">2</span>Send packet with <strong>TTL = 2</strong> â†’ Router 2 decrements TTL to 0 â†’ sends back <em>ICMP Time Exceeded</em>.</div>
      <div class="step red-step"><span class="num">3</span>Continue incrementing TTL each round until the <strong>destination</strong> replies (or max hops reached).</div>
      <div class="step red-step"><span class="num">4</span>Each hop's IP address and RTT reveals the <strong>full path</strong> across the network.</div>
    </div>

    <h3>Error Reporting Flow</h3>
    <div class="flow" style="flex-wrap:wrap;">
      <div class="flow-box"><span class="icon">ğŸ’»</span><span class="label">Source Host</span><span class="sub">Sends IP packet</span></div>
      <div class="arrow">â†’</div>
      <div class="flow-box red"><span class="icon">ğŸ”€</span><span class="label">Router / Gateway</span><span class="sub">Detects problem</span></div>
      <div class="arrow">â†’</div>
      <div class="flow-box"><span class="icon">ğŸ””</span><span class="label">ICMP Message</span><span class="sub">Generated &amp; sent back</span></div>
      <div class="arrow">â†’</div>
      <div class="flow-box"><span class="icon">ğŸ’»</span><span class="label">Source Host</span><span class="sub">Receives error notice</span></div>
    </div>

    <h3>Important ICMP Rules</h3>
    <div class="two-col">
      <div class="card blue-tint">
        <h4>âœ… When ICMP CAN be generated</h4>
        <ul style="margin-left:16px;margin-top:8px;">
          <li>Destination unreachable</li>
          <li>TTL expired in transit</li>
          <li>Fragmentation needed but DF bit set</li>
          <li>Echo Request received</li>
          <li>Router redirect needed</li>
        </ul>
      </div>
      <div class="card red-tint">
        <h4>ğŸš« When ICMP CANNOT be generated</h4>
        <ul style="margin-left:16px;margin-top:8px;">
          <li>In response to another ICMP error</li>
          <li>For broadcast or multicast destination packets</li>
          <li>For fragment other than the first fragment</li>
          <li>For packets with source address of 0.0.0.0</li>
        </ul>
      </div>
    </div>

    <div class="warn-box">
      <strong>ğŸ” Security Note:</strong> ICMP is commonly blocked or rate-limited by firewalls because it can be exploited in <em>ICMP flood attacks (ping of death, smurf attacks)</em> and used for <em>covert channel communications</em>. Network engineers must balance diagnostic utility with security.
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â• TAB 3 Â· MESSAGE TYPES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section id="types" class="tab">
    <h2>ICMP Message Types</h2>

    <div class="card">
      <p>Every ICMP message is identified by a <strong>Type</strong> (1 byte) and a <strong>Code</strong> (1 byte). The Type identifies the broad category; the Code provides more specific detail within that type.</p>
    </div>

    <h3>Click any message type to learn more</h3>
    <div class="type-grid" id="typeGrid">

      <div class="type-card blue-card" onclick="showTypeDetail('echo-reply')">
        <span class="type-icon">âœ…</span>
        <span class="type-num">Type 0 Â· Code 0</span>
        <div class="type-name">Echo Reply</div>
        <div class="type-desc">Response to a ping Echo Request</div>
      </div>

      <div class="type-card red-card" onclick="showTypeDetail('dest-unreach')">
        <span class="type-icon">ğŸš«</span>
        <span class="type-num">Type 3 Â· Codes 0â€“15</span>
        <div class="type-name">Destination Unreachable</div>
        <div class="type-desc">Packet could not reach destination</div>
      </div>

      <div class="type-card red-card" onclick="showTypeDetail('src-quench')">
        <span class="type-icon">â¸ï¸</span>
        <span class="type-num">Type 4 Â· Code 0</span>
        <div class="type-name">Source Quench (Deprecated)</div>
        <div class="type-desc">Request sender to slow down (RFC 1812)</div>
      </div>

      <div class="type-card blue-card" onclick="showTypeDetail('redirect')">
        <span class="type-icon">ğŸ”€</span>
        <span class="type-num">Type 5 Â· Codes 0â€“3</span>
        <div class="type-name">Redirect</div>
        <div class="type-desc">Inform host of a better route</div>
      </div>

      <div class="type-card blue-card" onclick="showTypeDetail('echo-req')">
        <span class="type-icon">ğŸ“¡</span>
        <span class="type-num">Type 8 Â· Code 0</span>
        <div class="type-name">Echo Request</div>
        <div class="type-desc">Ping â€” test host reachability</div>
      </div>

      <div class="type-card blue-card" onclick="showTypeDetail('router-adv')">
        <span class="type-icon">ğŸ“¢</span>
        <span class="type-num">Type 9 Â· Code 0</span>
        <div class="type-name">Router Advertisement</div>
        <div class="type-desc">Router announces its presence</div>
      </div>

      <div class="type-card blue-card" onclick="showTypeDetail('router-sol')">
        <span class="type-icon">ğŸ”</span>
        <span class="type-num">Type 10 Â· Code 0</span>
        <div class="type-name">Router Solicitation</div>
        <div class="type-desc">Host requests router info</div>
      </div>

      <div class="type-card red-card" onclick="showTypeDetail('time-exceeded')">
        <span class="type-icon">â±ï¸</span>
        <span class="type-num">Type 11 Â· Codes 0â€“1</span>
        <div class="type-name">Time Exceeded</div>
        <div class="type-desc">TTL expired â€” used by traceroute</div>
      </div>

      <div class="type-card red-card" onclick="showTypeDetail('param-problem')">
        <span class="type-icon">âš ï¸</span>
        <span class="type-num">Type 12 Â· Codes 0â€“2</span>
        <div class="type-name">Parameter Problem</div>
        <div class="type-desc">Bad IP header field detected</div>
      </div>

      <div class="type-card blue-card" onclick="showTypeDetail('timestamp')">
        <span class="type-icon">ğŸ•°ï¸</span>
        <span class="type-num">Type 13/14 Â· Code 0</span>
        <div class="type-name">Timestamp Request/Reply</div>
        <div class="type-desc">Synchronize clocks between hosts</div>
      </div>

    </div>

    <!-- Detail panels -->
    <div id="echo-reply" class="type-detail">
      <strong>Echo Reply (Type 0, Code 0)</strong><br/>
      Sent in response to an ICMP Echo Request. Contains the same Identifier and Sequence Number as the request. Used by <code>ping</code> to confirm that a host is reachable and measure round-trip time. If a host receives an Echo Request and is operational, it MUST send an Echo Reply.
    </div>

    <div id="dest-unreach" class="type-detail red-detail">
      <strong>Destination Unreachable (Type 3)</strong><br/>
      Generated when a router or host cannot deliver a packet. The Code field specifies the reason:<br/>
      <table class="plain" style="margin-top:10px;">
        <thead><tr><th>Code</th><th>Meaning</th></tr></thead>
        <tbody>
          <tr><td>0</td><td>Net Unreachable</td></tr>
          <tr><td>1</td><td>Host Unreachable</td></tr>
          <tr><td>2</td><td>Protocol Unreachable</td></tr>
          <tr><td>3</td><td>Port Unreachable</td></tr>
          <tr><td>4</td><td>Fragmentation Needed &amp; DF Set</td></tr>
          <tr><td>5</td><td>Source Route Failed</td></tr>
          <tr><td>13</td><td>Communication Administratively Prohibited</td></tr>
        </tbody>
      </table>
    </div>

    <div id="src-quench" class="type-detail red-detail">
      <strong>Source Quench (Type 4, Code 0)</strong> <span class="badge badge-red">Deprecated</span><br/>
      Originally sent by a router experiencing congestion to request the source slow its transmission rate. Deprecated in RFC 1812 (1995) and formally obsoleted in RFC 6633 (2012) because it caused more harm than good â€” often resulting in TCP retransmissions that worsened congestion.
    </div>

    <div id="redirect" class="type-detail">
      <strong>Redirect (Type 5)</strong><br/>
      Sent by a router when it knows a better path for a destination exists. Tells the host to update its routing table. Codes: 0 = Redirect for Network, 1 = Redirect for Host, 2 = Redirect for Type of Service &amp; Network, 3 = Redirect for Type of Service &amp; Host.
    </div>

    <div id="echo-req" class="type-detail">
      <strong>Echo Request (Type 8, Code 0)</strong><br/>
      The foundation of the <code>ping</code> command. Contains an Identifier (to match replies), a Sequence Number (to detect lost packets), and optional Data. The destination must respond with an Echo Reply containing the same Identifier and Sequence Number.
    </div>

    <div id="router-adv" class="type-detail">
      <strong>Router Advertisement (Type 9, Code 0)</strong><br/>
      Routers broadcast or multicast this message to announce their existence and routing capabilities. Hosts use these to automatically discover default gateways without manual configuration. Part of the IRDP (ICMP Router Discovery Protocol).
    </div>

    <div id="router-sol" class="type-detail">
      <strong>Router Solicitation (Type 10, Code 0)</strong><br/>
      A host sends this message on startup to request immediate Router Advertisements rather than waiting for the periodic broadcast. Enables faster network configuration after boot. Part of IRDP.
    </div>

    <div id="time-exceeded" class="type-detail red-detail">
      <strong>Time Exceeded (Type 11)</strong><br/>
      Code 0 â€” <em>TTL Expired in Transit</em>: A router decremented the IP TTL to zero and discarded the packet. This is the core mechanism <code>traceroute</code> uses to discover each hop.<br/>
      Code 1 â€” <em>Fragment Reassembly Time Exceeded</em>: Not all fragments of a fragmented IP datagram arrived within the reassembly timeout window.
    </div>

    <div id="param-problem" class="type-detail red-detail">
      <strong>Parameter Problem (Type 12)</strong><br/>
      Sent when a router or host finds a problem with an IP header field. Includes a Pointer field indicating which byte caused the problem. Code 0 = Pointer indicates error, Code 1 = Missing required option, Code 2 = Bad length.
    </div>

    <div id="timestamp" class="type-detail">
      <strong>Timestamp Request/Reply (Type 13/14, Code 0)</strong><br/>
      Used to synchronize clocks between network devices. The Request includes the sender's originate timestamp; the Reply adds the receive timestamp and transmit timestamp. Largely replaced by NTP (Network Time Protocol) in modern networks, but still present in some diagnostic tools.
    </div>

  </section>

  <!-- â•â•â•â•â•â•â•â•â•â• TAB 4 Â· ICMP HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section id="header" class="tab">
    <h2>ICMP Header Format</h2>

    <div class="card">
      <p>Every ICMP message has a fixed <strong>4-byte header</strong> followed by a variable-length data section. The content of the data section depends on the message Type and Code.</p>
    </div>

    <h3>ICMP Header Structure (4 bytes minimum)</h3>
    <div class="header-wrapper">
      <table class="header-table">
        <thead>
          <tr>
            <th></th>
            <th colspan="8">Bits 0â€“7</th>
            <th colspan="8">Bits 8â€“15</th>
            <th colspan="8">Bits 16â€“23</th>
            <th colspan="8">Bits 24â€“31</th>
          </tr>
          <tr>
            <th>Byte</th>
            <th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th>
            <th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th>
            <th>16</th><th>17</th><th>18</th><th>19</th><th>20</th><th>21</th><th>22</th><th>23</th>
            <th>24</th><th>25</th><th>26</th><th>27</th><th>28</th><th>29</th><th>30</th><th>31</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="row-label">0â€“3</td>
            <td colspan="8" class="field-blue">Type (8 bits)</td>
            <td colspan="8" class="field-red">Code (8 bits)</td>
            <td colspan="16" class="field-gray">Checksum (16 bits)</td>
          </tr>
          <tr>
            <td class="row-label">4â€“7</td>
            <td colspan="32" class="field-blue">Rest of Header / Data (varies by Type)</td>
          </tr>
          <tr>
            <td class="row-label">8â€“n</td>
            <td colspan="32" class="field-gray">Optional Data Payload (e.g., original IP header + first 8 bytes of original datagram for errors)</td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3>Core Header Fields</h3>
    <ul class="field-list">
      <li>
        <span class="field-tag">Type</span>
        <div><strong>8 bits.</strong> Identifies the ICMP message category. Common values: 0 (Echo Reply), 3 (Destination Unreachable), 8 (Echo Request), 11 (Time Exceeded).</div>
      </li>
      <li>
        <span class="field-tag red">Code</span>
        <div><strong>8 bits.</strong> Provides a sub-type within the Type category. For Echo Request/Reply, Code is always 0. For Destination Unreachable, Code specifies the exact reason (0=Net Unreachable, 1=Host Unreachable, etc.).</div>
      </li>
      <li>
        <span class="field-tag">Checksum</span>
        <div><strong>16 bits.</strong> Internet checksum covering the entire ICMP message (header + data). Computed with the checksum field set to zero, then the one's complement sum of all 16-bit words is taken.</div>
      </li>
      <li>
        <span class="field-tag red">Rest of Header</span>
        <div><strong>32 bits.</strong> Content depends on Type/Code. For Echo messages: upper 16 bits = Identifier, lower 16 bits = Sequence Number. For Destination Unreachable and Time Exceeded: this field is unused (set to 0).</div>
      </li>
    </ul>

    <h3>Echo Request / Echo Reply â€” Expanded Header</h3>
    <div class="header-wrapper">
      <table class="header-table">
        <thead>
          <tr>
            <th></th>
            <th colspan="16">Bits 0â€“15</th>
            <th colspan="16">Bits 16â€“31</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="row-label">0â€“3</td>
            <td colspan="8" class="field-blue">Type (0 or 8)</td>
            <td colspan="8" class="field-gray">Code (0)</td>
            <td colspan="16" class="field-blue">Checksum</td>
          </tr>
          <tr>
            <td class="row-label">4â€“7</td>
            <td colspan="16" class="field-red">Identifier</td>
            <td colspan="16" class="field-red">Sequence Number</td>
          </tr>
          <tr>
            <td class="row-label">8â€“n</td>
            <td colspan="32" class="field-gray">Optional Data (Payload â€” often timestamps or arbitrary bytes)</td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3>Destination Unreachable â€” Expanded Header</h3>
    <div class="header-wrapper">
      <table class="header-table">
        <thead>
          <tr>
            <th></th>
            <th colspan="16">Bits 0â€“15</th>
            <th colspan="16">Bits 16â€“31</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="row-label">0â€“3</td>
            <td colspan="8" class="field-red">Type (3)</td>
            <td colspan="8" class="field-red">Code (0â€“15)</td>
            <td colspan="16" class="field-blue">Checksum</td>
          </tr>
          <tr>
            <td class="row-label">4â€“7</td>
            <td colspan="32" class="field-gray">Unused (must be 0)</td>
          </tr>
          <tr>
            <td class="row-label">8â€“35</td>
            <td colspan="32" class="field-red">Original IP Header (20 bytes) + First 8 bytes of original datagram</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="info-box">
      <strong>ğŸ“ Why include the original IP header?</strong> Attaching the original IP header plus the first 8 bytes of the failed datagram allows the source host to determine which upper-layer protocol (TCP/UDP) and which socket was affected, enabling proper error handling at the application layer.
    </div>

    <h3>ICMP Checksum Algorithm</h3>
    <div class="card">
      <ol style="margin-left:18px;line-height:2;">
        <li>Set the Checksum field to <code>0x0000</code></li>
        <li>Treat the entire ICMP message as a sequence of 16-bit words</li>
        <li>Sum all 16-bit words using one's complement arithmetic (carry bits wrap around)</li>
        <li>Take the one's complement of the result â†’ this is the Checksum</li>
        <li>On receipt: sum all 16-bit words including the Checksum. Result must equal <code>0xFFFF</code></li>
      </ol>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â• TAB 5 Â· PACKET BUILDER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section id="builder" class="tab">
    <h2>ICMP Packet Builder &amp; Ping Simulator</h2>

    <div class="builder-grid">
      <!-- LEFT: Build form -->
      <div class="card">
        <h3 style="margin-top:0;">ğŸ”¨ Build an ICMP Message</h3>

        <div class="form-group">
          <label>Message Type</label>
          <select id="b-type" onchange="updateBuilderForm()">
            <option value="8">Type 8 â€” Echo Request (ping)</option>
            <option value="0">Type 0 â€” Echo Reply</option>
            <option value="3">Type 3 â€” Destination Unreachable</option>
            <option value="11">Type 11 â€” Time Exceeded</option>
            <option value="5">Type 5 â€” Redirect</option>
          </select>
        </div>

        <div class="form-group" id="b-code-group">
          <label>Code</label>
          <select id="b-code"></select>
        </div>

        <div class="form-group" id="b-id-group">
          <label>Identifier (hex)</label>
          <input type="text" id="b-id" value="0x1A2B" maxlength="6" />
        </div>

        <div class="form-group" id="b-seq-group">
          <label>Sequence Number</label>
          <input type="number" id="b-seq" value="1" min="0" max="65535" />
        </div>

        <div class="form-group" id="b-src-group">
          <label>Source IP</label>
          <input type="text" id="b-src" value="192.168.1.10" />
        </div>

        <div class="form-group" id="b-dst-group">
          <label>Destination IP</label>
          <input type="text" id="b-dst" value="8.8.8.8" />
        </div>

        <div class="form-group" id="b-ttl-group">
          <label>IP TTL</label>
          <input type="number" id="b-ttl" value="64" min="1" max="255" />
        </div>

        <div class="form-group" id="b-data-group">
          <label>Data Payload (text)</label>
          <input type="text" id="b-data" value="abcdefghijklmnop" maxlength="40" />
        </div>

        <button class="btn btn-blue" onclick="buildPacket()">Build ICMP Packet</button>
        &nbsp;
        <button class="btn btn-gray" onclick="clearPacket()">Clear</button>
      </div>

      <!-- RIGHT: Packet visual -->
      <div class="card">
        <h3 style="margin-top:0;">ğŸ“¦ Packet Structure</h3>
        <div id="packetOut">
          <p style="color:var(--gray-400);text-align:center;margin-top:40px;">
            â† Configure and click <strong>Build ICMP Packet</strong>
          </p>
        </div>
      </div>
    </div>

    <!-- Ping Simulator -->
    <div class="card" style="margin-top:4px;">
      <h3 style="margin-top:0;">ğŸ“¡ Ping Simulator</h3>
      <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end;">
        <div class="form-group" style="flex:1;min-width:180px;margin:0;">
          <label>Target Host / IP</label>
          <input type="text" id="pingHost" value="8.8.8.8" />
        </div>
        <div class="form-group" style="width:100px;margin:0;">
          <label>Count</label>
          <input type="number" id="pingCount" value="4" min="1" max="10" />
        </div>
        <div class="form-group" style="width:100px;margin:0;">
          <label>Size (bytes)</label>
          <input type="number" id="pingSize" value="32" min="0" max="65500" />
        </div>
        <div class="form-group" style="width:100px;margin:0;">
          <label>TTL</label>
          <input type="number" id="pingTTL" value="128" min="1" max="255" />
        </div>
        <button class="btn btn-blue" onclick="runPing()">â–¶ Run Ping</button>
        <button class="btn btn-red"  onclick="clearPing()">âœ• Clear</button>
      </div>
      <div class="ping-output" id="pingOut">Ready. Configure options and click Run Ping.</div>
    </div>

    <!-- Traceroute Simulator -->
    <div class="card">
      <h3 style="margin-top:0;">ğŸ—ºï¸ Traceroute Simulator</h3>
      <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end;">
        <div class="form-group" style="flex:1;min-width:200px;margin:0;">
          <label>Target Host / IP</label>
          <input type="text" id="traceHost" value="www.google.com" />
        </div>
        <div class="form-group" style="width:120px;margin:0;">
          <label>Max Hops</label>
          <input type="number" id="traceHops" value="15" min="1" max="30" />
        </div>
        <button class="btn btn-blue" onclick="runTrace()">â–¶ Run Traceroute</button>
        <button class="btn btn-gray" onclick="clearTrace()">âœ• Clear</button>
      </div>
      <div class="ping-output" id="traceOut">Ready. Click Run Traceroute to simulate.</div>
    </div>

  </section>

  <!-- â•â•â•â•â•â•â•â•â•â• TAB 6 Â· QUIZ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section id="quiz" class="tab">
    <h2>ICMP Knowledge Quiz</h2>
    <div class="card">
      <p>Test your understanding of ICMP! Select an answer for each question, then check your score.</p>
    </div>

    <div id="quizContainer"></div>

    <div style="display:flex;gap:12px;margin-top:18px;flex-wrap:wrap;">
      <button class="btn btn-blue" onclick="checkQuiz()">âœ” Submit Quiz</button>
      <button class="btn btn-gray" onclick="resetQuiz()">â†º Reset</button>
    </div>

    <div class="quiz-score" id="quizScore"></div>
  </section>

</main>

<footer>
  <p>ICMP Interactive Learning Center &nbsp;|&nbsp; Designed for Cybersecurity &amp; Networking Education</p>
  <p style="margin-top:4px;">RFC 792 (ICMPv4) &nbsp;Â·&nbsp; RFC 4443 (ICMPv6) &nbsp;Â·&nbsp; RFC 1122 (Host Requirements)</p>
</footer>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  JAVASCRIPT  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
/* â”€â”€â”€ Tab navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showTab(id, btn) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
  // reset any open type details
  document.querySelectorAll('.type-detail').forEach(d => d.classList.remove('visible'));
}

/* â”€â”€â”€ Type detail panels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showTypeDetail(id) {
  const panel = document.getElementById(id);
  if (panel.classList.contains('visible')) {
    panel.classList.remove('visible');
    return;
  }
  document.querySelectorAll('.type-detail').forEach(d => d.classList.remove('visible'));
  panel.classList.add('visible');
  setTimeout(() => panel.scrollIntoView({ behavior: 'smooth', block: 'nearest' }), 50);
}

/* â”€â”€â”€ Packet Builder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const typeCodes = {
  '8': [{ v: 0, l: 'Code 0 â€” No additional data' }],
  '0': [{ v: 0, l: 'Code 0 â€” No additional data' }],
  '3': [
    { v: 0, l: 'Code 0 â€” Net Unreachable' },
    { v: 1, l: 'Code 1 â€” Host Unreachable' },
    { v: 2, l: 'Code 2 â€” Protocol Unreachable' },
    { v: 3, l: 'Code 3 â€” Port Unreachable' },
    { v: 4, l: 'Code 4 â€” Fragmentation Needed & DF Set' },
    { v: 5, l: 'Code 5 â€” Source Route Failed' },
    { v: 13, l: 'Code 13 â€” Administratively Prohibited' }
  ],
  '11': [
    { v: 0, l: 'Code 0 â€” TTL Expired in Transit' },
    { v: 1, l: 'Code 1 â€” Fragment Reassembly Time Exceeded' }
  ],
  '5': [
    { v: 0, l: 'Code 0 â€” Redirect for Network' },
    { v: 1, l: 'Code 1 â€” Redirect for Host' },
    { v: 2, l: 'Code 2 â€” Redirect for TOS & Network' },
    { v: 3, l: 'Code 3 â€” Redirect for TOS & Host' }
  ]
};

function updateBuilderForm() {
  const type = document.getElementById('b-type').value;
  const codeSelect = document.getElementById('b-code');
  codeSelect.innerHTML = '';
  (typeCodes[type] || [{ v: 0, l: 'Code 0' }]).forEach(c => {
    const o = document.createElement('option');
    o.value = c.v; o.textContent = c.l;
    codeSelect.appendChild(o);
  });
  const isEcho = type === '8' || type === '0';
  document.getElementById('b-id-group').style.display  = isEcho ? '' : 'none';
  document.getElementById('b-seq-group').style.display = isEcho ? '' : 'none';
  document.getElementById('b-data-group').style.display = isEcho ? '' : 'none';
}
updateBuilderForm();

function hex(n, w) {
  return ('0'.repeat(w) + n.toString(16).toUpperCase()).slice(-w);
}
function calcChecksum(type, code, id, seq, data) {
  // Simple demo checksum (real one would need full message bytes)
  let sum = (type << 8 | code) + id + seq;
  for (let i = 0; i < data.length; i++) sum += data.charCodeAt(i);
  while (sum >> 16) sum = (sum & 0xFFFF) + (sum >> 16);
  return (~sum & 0xFFFF);
}

function buildPacket() {
  const type = parseInt(document.getElementById('b-type').value);
  const code = parseInt(document.getElementById('b-code').value);
  const id   = parseInt(document.getElementById('b-id').value, 16) || 0x1A2B;
  const seq  = parseInt(document.getElementById('b-seq').value) || 1;
  const src  = document.getElementById('b-src').value || '192.168.1.10';
  const dst  = document.getElementById('b-dst').value || '8.8.8.8';
  const ttl  = parseInt(document.getElementById('b-ttl').value) || 64;
  const data = document.getElementById('b-data').value || '';

  const isEcho = type === 8 || type === 0;
  const chk    = calcChecksum(type, code, id, seq, isEcho ? data : '');
  const typeNames = { 0:'Echo Reply', 3:'Destination Unreachable', 4:'Source Quench', 5:'Redirect', 8:'Echo Request', 11:'Time Exceeded', 12:'Parameter Problem' };

  const html = `
    <div class="packet-visual">
      <p style="font-size:.8rem;color:var(--gray-700);margin-bottom:8px;font-family:sans-serif;">
        <strong>IP Encapsulation</strong> â€” ICMP is carried inside an IPv4 datagram (Proto = 1)
      </p>

      <div style="margin-bottom:6px;">
        <strong style="font-size:.8rem;font-family:sans-serif;color:var(--blue);">IP Header (simplified)</strong>
        <div class="packet-row" style="margin-top:4px;">
          <div class="packet-cell label-cell">IP HDR</div>
          <div class="packet-cell gray">Ver: 4<br>IHL: 20B</div>
          <div class="packet-cell gray">DSCP/ECN<br>0x00</div>
          <div class="packet-cell blue">TTL<br>${ttl}</div>
          <div class="packet-cell blue">Proto<br>1 (ICMP)</div>
          <div class="packet-cell gray">Src: ${src}</div>
          <div class="packet-cell gray">Dst: ${dst}</div>
        </div>
      </div>

      <div>
        <strong style="font-size:.8rem;font-family:sans-serif;color:var(--red);">ICMP Message</strong>
        <div class="packet-row packet-header-row" style="margin-top:4px;">
          <div class="packet-cell label-cell">Field</div>
          <div class="packet-cell">Type</div>
          <div class="packet-cell">Code</div>
          <div class="packet-cell">Checksum</div>
          ${isEcho ? '<div class="packet-cell">Identifier</div><div class="packet-cell">Sequence</div>' : '<div class="packet-cell" colspan="2">Rest of Header</div>'}
        </div>
        <div class="packet-row">
          <div class="packet-cell label-cell">Dec</div>
          <div class="packet-cell red">${type}</div>
          <div class="packet-cell red">${code}</div>
          <div class="packet-cell blue">${chk}</div>
          ${isEcho ? `<div class="packet-cell blue">${id}</div><div class="packet-cell blue">${seq}</div>` : '<div class="packet-cell gray">0x00000000</div>'}
        </div>
        <div class="packet-row">
          <div class="packet-cell label-cell">Hex</div>
          <div class="packet-cell red">${hex(type,2)}</div>
          <div class="packet-cell red">${hex(code,2)}</div>
          <div class="packet-cell blue">${hex(chk,4)}</div>
          ${isEcho ? `<div class="packet-cell blue">${hex(id,4)}</div><div class="packet-cell blue">${hex(seq,4)}</div>` : '<div class="packet-cell gray">00 00 00 00</div>'}
        </div>
        ${isEcho && data ? `
        <div class="packet-row">
          <div class="packet-cell label-cell">Data</div>
          <div class="packet-cell gray" style="word-break:break-all;" colspan="5">${[...data].map(c=>hex(c.charCodeAt(0),2)).join(' ')} <span style="color:var(--gray-700)">(${data.length} bytes: "${data}")</span></div>
        </div>` : ''}
      </div>

      <div style="margin-top:12px;padding:10px;background:var(--blue-pale);border-radius:8px;font-family:sans-serif;font-size:.83rem;">
        <strong>Summary:</strong> ${typeNames[type] || 'ICMP'} message | Type=${type} Code=${code} | Checksum=0x${hex(chk,4)} | ${isEcho?`ID=0x${hex(id,4)} Seq=${seq}`:'No identifier'} | Encapsulated in IP (TTL=${ttl}) from ${src} â†’ ${dst}
      </div>
    </div>
  `;
  document.getElementById('packetOut').innerHTML = html;
}

function clearPacket() {
  document.getElementById('packetOut').innerHTML = '<p style="color:var(--gray-400);text-align:center;margin-top:40px;">â† Configure and click <strong>Build ICMP Packet</strong></p>';
  document.getElementById('b-type').value = '8';
  document.getElementById('b-seq').value = '1';
  document.getElementById('b-id').value = '0x1A2B';
  document.getElementById('b-data').value = 'abcdefghijklmnop';
  updateBuilderForm();
}

/* â”€â”€â”€ Ping Simulator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const pingHosts = {
  '8.8.8.8':       { rtt: [12,11,13], name: '8.8.8.8' },
  '1.1.1.1':       { rtt: [9,10,9],   name: '1.1.1.1' },
  '192.168.1.1':   { rtt: [1,1,2],    name: '192.168.1.1' },
  'localhost':      { rtt: [0,0,0],    name: 'localhost (127.0.0.1)' },
  '127.0.0.1':     { rtt: [0,0,0],    name: '127.0.0.1' },
  '10.0.0.1':      { rtt: [2,2,3],    name: '10.0.0.1' },
  '172.16.0.1':    { rtt: [5,4,6],    name: '172.16.0.1' }
};

function randBetween(a, b) { return Math.floor(Math.random() * (b - a + 1)) + a; }

function runPing() {
  const host  = document.getElementById('pingHost').value.trim() || '8.8.8.8';
  const count = Math.min(10, parseInt(document.getElementById('pingCount').value) || 4);
  const size  = parseInt(document.getElementById('pingSize').value) || 32;
  const ttl   = parseInt(document.getElementById('pingTTL').value) || 128;
  const out   = document.getElementById('pingOut');

  const hostInfo = pingHosts[host] || null;
  const displayName = hostInfo ? hostInfo.name : host;

  // Determine if "unreachable" (simulate a failed host with obvious fake IPs)
  const unreachable = host === '10.10.10.254' || host === '192.0.2.1' || host.endsWith('.999');

  out.textContent = `Pinging ${displayName} with ${size} bytes of data:\n`;

  let seq = 1;
  let sent = 0, recv = 0, minRTT = 9999, maxRTT = 0, totalRTT = 0;

  const interval = setInterval(() => {
    if (seq > count) {
      clearInterval(interval);
      const loss = Math.round((sent - recv) / sent * 100);
      out.textContent += `\nPing statistics for ${displayName}:\n`;
      out.textContent += `    Packets: Sent = ${sent}, Received = ${recv}, Lost = ${sent - recv} (${loss}% loss),\n`;
      if (recv > 0) {
        out.textContent += `Approximate round trip times in milli-seconds:\n`;
        out.textContent += `    Minimum = ${minRTT}ms, Maximum = ${maxRTT}ms, Average = ${Math.round(totalRTT / recv)}ms\n`;
      }
      return;
    }

    sent++;
    const baseRTT = hostInfo ? (hostInfo.rtt[Math.floor(Math.random()*3)] + randBetween(-1, 2)) : randBetween(20, 150);
    const rtt = Math.max(0, baseRTT);

    if (unreachable || (!hostInfo && Math.random() < 0.5)) {
      out.textContent += `\x1b`;
      const errLine = `Request to ${displayName} timed out. (seq=${seq})\n`;
      out.textContent += errLine;
      // style inline via innerHTML trick below
    } else {
      recv++;
      if (rtt < minRTT) minRTT = rtt;
      if (rtt > maxRTT) maxRTT = rtt;
      totalRTT += rtt;
      out.textContent += `Reply from ${displayName}: bytes=${size} time=${rtt}ms TTL=${ttl - randBetween(0,4)}\n`;
    }
    seq++;
  }, 400);
}

function clearPing() {
  document.getElementById('pingOut').textContent = 'Ready. Configure options and click Run Ping.';
}

/* â”€â”€â”€ Traceroute Simulator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const tracePaths = {
  'www.google.com': [
    '192.168.1.1', '10.0.0.1', '72.14.221.1', '108.170.226.1', '209.85.168.1', '142.250.72.14'
  ],
  'www.amazon.com': [
    '192.168.1.1', '10.0.0.1', '205.251.242.1', '52.84.16.1', '52.94.200.1', '205.251.249.1', '54.239.28.1'
  ],
  'default': [
    '192.168.1.1', '10.0.0.1', '203.0.113.1', '198.51.100.1', '203.0.113.254'
  ]
};

function runTrace() {
  const host = document.getElementById('traceHost').value.trim() || 'www.google.com';
  const maxH = Math.min(30, parseInt(document.getElementById('traceHops').value) || 15);
  const out  = document.getElementById('traceOut');

  const hops = tracePaths[host] || tracePaths['default'];
  const path = hops.slice(0, maxH);
  let lineNum = 1;

  out.textContent = `Tracing route to ${host} over a maximum of ${maxH} hops:\n\n`;

  const run = () => {
    if (lineNum > path.length) {
      out.textContent += `\nTrace complete.\n`;
      return;
    }
    const ip  = path[lineNum - 1];
    const r1  = randBetween(3, 25);
    const r2  = randBetween(3, 25);
    const r3  = randBetween(3, 25);
    const isFinal = lineNum === path.length;
    const label   = isFinal ? ` [${host}]` : '';
    const line = `  ${String(lineNum).padStart(2)}    ${r1} ms    ${r2} ms    ${r3} ms  ${ip}${label}\n`;
    out.textContent += line;
    lineNum++;
    setTimeout(run, 300);
  };
  setTimeout(run, 200);
}

function clearTrace() {
  document.getElementById('traceOut').textContent = 'Ready. Click Run Traceroute to simulate.';
}

/* â”€â”€â”€ Quiz â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const quizData = [
  {
    q: 'What IP Protocol number identifies ICMP in an IPv4 header?',
    opts: ['Protocol 6', 'Protocol 17', 'Protocol 1', 'Protocol 58'],
    ans: 2,
    exp: 'ICMP uses Protocol Number 1. TCP is 6, UDP is 17, and ICMPv6 is 58.'
  },
  {
    q: 'Which ICMP Type number is used for Echo Request (ping)?',
    opts: ['Type 0', 'Type 3', 'Type 8', 'Type 11'],
    ans: 2,
    exp: 'Type 8 = Echo Request. Type 0 = Echo Reply.'
  },
  {
    q: 'What ICMP message does traceroute exploit to map network hops?',
    opts: ['Echo Reply (Type 0)', 'Time Exceeded (Type 11)', 'Redirect (Type 5)', 'Destination Unreachable (Type 3)'],
    ans: 1,
    exp: 'Traceroute sends packets with incrementing TTL values. Routers that decrement TTL to 0 send back ICMP Time Exceeded (Type 11) messages.'
  },
  {
    q: 'ICMP Destination Unreachable Code 3 means:',
    opts: ['Host Unreachable', 'Network Unreachable', 'Protocol Unreachable', 'Port Unreachable'],
    ans: 3,
    exp: 'Code 0=Net Unreachable, Code 1=Host Unreachable, Code 2=Protocol Unreachable, Code 3=Port Unreachable.'
  },
  {
    q: 'How many bytes does the mandatory ICMP header occupy?',
    opts: ['2 bytes', '4 bytes', '8 bytes', '12 bytes'],
    ans: 1,
    exp: 'The ICMP header is always at least 4 bytes: 1 byte Type + 1 byte Code + 2 bytes Checksum.'
  },
  {
    q: 'Which ICMP message type was deprecated because it worsened network congestion?',
    opts: ['Redirect (Type 5)', 'Source Quench (Type 4)', 'Parameter Problem (Type 12)', 'Router Solicitation (Type 10)'],
    ans: 1,
    exp: 'Source Quench (Type 4) was deprecated in RFC 1812 and formally obsoleted in RFC 6633. It caused retransmissions that worsened congestion.'
  },
  {
    q: 'When an ICMP error message is generated, the data section includes:',
    opts: [
      'The full original packet that caused the error',
      'The original IP header + first 8 bytes of the original datagram',
      'Only the IP source and destination addresses',
      'Nothing â€” the data section is empty for errors'
    ],
    ans: 1,
    exp: 'ICMP error messages include the original IP header plus the first 8 bytes of the failed datagram. This allows the source to identify which protocol and socket was affected.'
  },
  {
    q: 'ICMPv6 is primarily used with which version of IP?',
    opts: ['IPv4', 'IPv5', 'IPv6', 'Both IPv4 and IPv6'],
    ans: 2,
    exp: 'ICMPv6 (RFC 4443) is used with IPv6 only. It uses Protocol Number 58 and also incorporates Neighbor Discovery Protocol (NDP) functions.'
  },
  {
    q: 'Which tool uses ICMP Echo Request and Echo Reply to test host reachability?',
    opts: ['nmap', 'netstat', 'ping', 'arp'],
    ans: 2,
    exp: 'The ping command sends ICMP Echo Request (Type 8) messages and waits for Echo Reply (Type 0) responses to test whether a host is reachable.'
  },
  {
    q: 'ICMP is classified at which layer of the OSI model?',
    opts: ['Transport (Layer 4)', 'Session (Layer 5)', 'Network (Layer 3)', 'Data Link (Layer 2)'],
    ans: 2,
    exp: 'ICMP operates at the Network Layer (Layer 3). It is encapsulated within IP datagrams and does not use TCP or UDP port numbers.'
  }
];

function buildQuiz() {
  const container = document.getElementById('quizContainer');
  container.innerHTML = '';
  quizData.forEach((q, qi) => {
    const div = document.createElement('div');
    div.className = 'quiz-q';
    div.innerHTML = `<p>${qi + 1}. ${q.q}</p>` +
      q.opts.map((o, oi) => `
        <label class="quiz-option" id="opt-${qi}-${oi}">
          <input type="radio" name="q${qi}" value="${oi}" />
          ${o}
        </label>`).join('') +
      `<div class="quiz-feedback" id="fb-${qi}"></div>`;
    container.appendChild(div);
  });
}

function checkQuiz() {
  let score = 0;
  quizData.forEach((q, qi) => {
    const selected = document.querySelector(`input[name="q${qi}"]:checked`);
    const fb = document.getElementById(`fb-${qi}`);
    // Reset
    q.opts.forEach((_, oi) => {
      const el = document.getElementById(`opt-${qi}-${oi}`);
      el.classList.remove('correct', 'wrong');
    });

    if (!selected) {
      fb.textContent = 'âš ï¸ Please select an answer.';
      fb.className = 'quiz-feedback bad';
      return;
    }

    const userAns = parseInt(selected.value);
    document.getElementById(`opt-${qi}-${q.ans}`).classList.add('correct');
    if (userAns !== q.ans) {
      document.getElementById(`opt-${qi}-${userAns}`).classList.add('wrong');
      fb.textContent = `âœ— ${q.exp}`;
      fb.className = 'quiz-feedback bad';
    } else {
      score++;
      fb.textContent = `âœ“ Correct! ${q.exp}`;
      fb.className = 'quiz-feedback ok';
    }
  });

  const scoreEl = document.getElementById('quizScore');
  const pct = Math.round(score / quizData.length * 100);
  let msg = pct >= 90 ? 'ğŸ† Excellent!' : pct >= 70 ? 'ğŸ‘ Good job!' : pct >= 50 ? 'ğŸ“š Keep studying!' : 'ğŸ”„ Review the material and try again.';
  scoreEl.innerHTML = `Score: ${score} / ${quizData.length} &nbsp;(${pct}%) &nbsp; ${msg}`;
  scoreEl.style.display = 'block';
  scoreEl.style.background = pct >= 70 ? 'var(--blue-pale)' : 'var(--red-pale)';
  scoreEl.style.color = pct >= 70 ? 'var(--blue)' : 'var(--red)';
  scoreEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function resetQuiz() {
  buildQuiz();
  document.getElementById('quizScore').style.display = 'none';
}

/* â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
buildQuiz();
</script>
</body>
</html>
