<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPv4 Network Protocol Learning Simulator</title>
<style>
  :root {
    --blue: #1a4fa0;
    --blue-dark: #0d2d6b;
    --blue-mid: #2563c7;
    --blue-light: #dbeafe;
    --blue-pale: #eff6ff;
    --red: #c0152a;
    --red-dark: #8b0e1e;
    --red-light: #fee2e5;
    --white: #ffffff;
    --gray-100: #f1f5f9;
    --gray-200: #e2e8f0;
    --gray-400: #94a3b8;
    --gray-600: #475569;
    --gray-800: #1e293b;
    --font-display: 'Trebuchet MS', 'Segoe UI', sans-serif;
    --font-mono: 'Courier New', monospace;
    --shadow: 0 4px 16px rgba(26,79,160,0.12);
    --shadow-lg: 0 8px 32px rgba(26,79,160,0.18);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--font-display);
    background: var(--white);
    color: var(--gray-800);
    line-height: 1.6;
  }

  /* ===== HEADER ===== */
  header {
    background: linear-gradient(135deg, var(--blue-dark) 0%, var(--blue) 60%, var(--blue-mid) 100%);
    color: white;
    padding: 0;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 12px rgba(0,0,0,0.3);
  }

  .header-top {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 14px 32px;
    border-bottom: 1px solid rgba(255,255,255,0.15);
  }

  .header-icon {
    width: 48px;
    height: 48px;
    background: var(--red);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    flex-shrink: 0;
    box-shadow: 0 2px 8px rgba(192,21,42,0.4);
  }

  .header-title h1 {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: 0.5px;
  }

  .header-title p {
    font-size: 0.82rem;
    opacity: 0.8;
    letter-spacing: 0.3px;
  }

  /* ===== NAV ===== */
  nav {
    display: flex;
    flex-wrap: wrap;
    gap: 0;
    padding: 0 24px;
    background: rgba(0,0,0,0.15);
  }

  nav button {
    background: none;
    border: none;
    color: rgba(255,255,255,0.82);
    padding: 10px 16px;
    cursor: pointer;
    font-family: var(--font-display);
    font-size: 0.82rem;
    font-weight: 600;
    letter-spacing: 0.4px;
    text-transform: uppercase;
    border-bottom: 3px solid transparent;
    transition: all 0.2s;
    white-space: nowrap;
  }

  nav button:hover {
    color: white;
    background: rgba(255,255,255,0.08);
    border-bottom-color: rgba(255,255,255,0.4);
  }

  nav button.active {
    color: white;
    border-bottom-color: var(--red);
    background: rgba(255,255,255,0.1);
  }

  /* ===== MAIN ===== */
  main {
    max-width: 1100px;
    margin: 0 auto;
    padding: 32px 24px;
  }

  .section { display: none; animation: fadeIn 0.35s ease; }
  .section.active { display: block; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ===== SECTION HEADER ===== */
  .section-header {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-bottom: 28px;
    padding-bottom: 16px;
    border-bottom: 3px solid var(--blue);
  }

  .section-icon {
    width: 44px;
    height: 44px;
    background: var(--blue);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
    flex-shrink: 0;
  }

  .section-header h2 {
    font-size: 1.7rem;
    color: var(--blue-dark);
    font-weight: 700;
  }

  .section-header p {
    color: var(--gray-600);
    font-size: 0.9rem;
  }

  /* ===== CARDS ===== */
  .card {
    background: white;
    border: 1px solid var(--gray-200);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
  }

  .card h3 {
    color: var(--blue-dark);
    font-size: 1.15rem;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--blue-light);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .card h3 .badge {
    background: var(--red);
    color: white;
    font-size: 0.7rem;
    padding: 2px 8px;
    border-radius: 20px;
    letter-spacing: 0.5px;
  }

  .card p { color: var(--gray-600); margin-bottom: 10px; font-size: 0.95rem; }
  .card ul { color: var(--gray-600); padding-left: 20px; font-size: 0.95rem; }
  .card ul li { margin-bottom: 6px; }

  /* ===== GRIDS ===== */
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }

  @media(max-width: 700px) {
    .grid-2, .grid-3 { grid-template-columns: 1fr; }
    nav button { font-size: 0.72rem; padding: 8px 10px; }
  }

  /* ===== IP PACKET DIAGRAM ===== */
  .packet-diagram {
    font-family: var(--font-mono);
    font-size: 0.8rem;
    overflow-x: auto;
  }

  .packet-row {
    display: flex;
    border: 1px solid var(--blue);
    margin-bottom: -1px;
  }

  .packet-row:first-child { border-radius: 8px 8px 0 0; }
  .packet-row:last-child { border-radius: 0 0 8px 8px; }

  .packet-field {
    border-right: 1px solid var(--blue);
    padding: 8px;
    text-align: center;
    flex: 1;
    background: var(--blue-pale);
    color: var(--blue-dark);
    font-weight: 600;
    font-size: 0.78rem;
  }

  .packet-field:last-child { border-right: none; }
  .packet-field.red { background: var(--red-light); color: var(--red-dark); }
  .packet-field.wide { flex: 2; }
  .packet-field.wider { flex: 4; }

  .packet-bits {
    font-size: 0.7rem;
    opacity: 0.7;
    display: block;
  }

  /* ===== ADDRESS VISUAL ===== */
  .octet-display {
    display: flex;
    gap: 0;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    gap: 4px;
    margin: 20px 0;
  }

  .octet-box {
    background: var(--blue);
    color: white;
    padding: 14px 18px;
    border-radius: 8px;
    font-family: var(--font-mono);
    font-size: 1.4rem;
    font-weight: 700;
    min-width: 70px;
    text-align: center;
    box-shadow: 0 3px 10px rgba(26,79,160,0.3);
    position: relative;
  }

  .octet-box.net { background: var(--blue-dark); }
  .octet-box.host { background: var(--red); }

  .octet-label {
    font-size: 0.65rem;
    opacity: 0.8;
    display: block;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  .octet-dot {
    font-size: 2rem;
    color: var(--gray-400);
    font-weight: 700;
    margin: 0 2px;
  }

  .binary-row {
    display: flex;
    gap: 4px;
    justify-content: center;
    flex-wrap: wrap;
    margin: 8px 0;
  }

  .bit-group {
    display: flex;
    gap: 2px;
  }

  .bit {
    width: 26px;
    height: 26px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-mono);
    font-size: 0.8rem;
    font-weight: 700;
  }

  .bit.one { background: var(--blue); color: white; }
  .bit.zero { background: var(--gray-200); color: var(--gray-600); }
  .bit.network { background: var(--blue-dark); color: white; }
  .bit.host { background: var(--red); color: white; }

  /* ===== CLASS CARDS ===== */
  .class-card {
    border: 2px solid var(--blue-light);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
    transition: all 0.2s;
    cursor: default;
  }

  .class-card:hover {
    border-color: var(--blue);
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
  }

  .class-card h3 {
    font-size: 1.1rem;
    color: var(--blue-dark);
    margin-bottom: 8px;
  }

  .class-badge {
    display: inline-block;
    background: var(--blue);
    color: white;
    font-size: 1.5rem;
    font-weight: 900;
    width: 44px;
    height: 44px;
    border-radius: 8px;
    line-height: 44px;
    text-align: center;
    margin-right: 12px;
    float: left;
  }

  .class-badge.a { background: #1a4fa0; }
  .class-badge.b { background: #2563c7; }
  .class-badge.c { background: #3b7fe8; }
  .class-badge.d { background: var(--red); }
  .class-badge.e { background: var(--red-dark); }

  .range-pill {
    display: inline-block;
    background: var(--blue-pale);
    border: 1px solid var(--blue-light);
    color: var(--blue-dark);
    font-family: var(--font-mono);
    font-size: 0.82rem;
    padding: 4px 10px;
    border-radius: 20px;
    margin: 3px;
    font-weight: 600;
  }

  .range-pill.red { background: var(--red-light); border-color: #fca5a5; color: var(--red-dark); }

  /* ===== CALCULATOR ===== */
  .calc-form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 20px;
  }

  @media(max-width: 600px) { .calc-form { grid-template-columns: 1fr; } }

  .form-group label {
    display: block;
    font-size: 0.85rem;
    font-weight: 700;
    color: var(--blue-dark);
    margin-bottom: 6px;
    letter-spacing: 0.3px;
  }

  .form-group input, .form-group select {
    width: 100%;
    padding: 10px 14px;
    border: 2px solid var(--gray-200);
    border-radius: 8px;
    font-family: var(--font-mono);
    font-size: 1rem;
    transition: border-color 0.2s;
    color: var(--gray-800);
  }

  .form-group input:focus, .form-group select:focus {
    outline: none;
    border-color: var(--blue);
    box-shadow: 0 0 0 3px var(--blue-light);
  }

  .btn {
    background: var(--blue);
    color: white;
    border: none;
    padding: 12px 28px;
    border-radius: 8px;
    font-family: var(--font-display);
    font-size: 0.92rem;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 0.4px;
    transition: all 0.2s;
    box-shadow: 0 3px 8px rgba(26,79,160,0.3);
  }

  .btn:hover { background: var(--blue-dark); transform: translateY(-1px); box-shadow: 0 5px 14px rgba(26,79,160,0.35); }

  .btn-red {
    background: var(--red);
    box-shadow: 0 3px 8px rgba(192,21,42,0.3);
  }

  .btn-red:hover { background: var(--red-dark); }

  .result-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 14px;
    margin-top: 20px;
  }

  .result-item {
    background: var(--blue-pale);
    border: 1px solid var(--blue-light);
    border-radius: 10px;
    padding: 14px;
    text-align: center;
  }

  .result-item.red { background: var(--red-light); border-color: #fca5a5; }

  .result-item .result-label {
    font-size: 0.75rem;
    color: var(--gray-600);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 700;
  }

  .result-item .result-value {
    font-family: var(--font-mono);
    font-size: 1.05rem;
    color: var(--blue-dark);
    font-weight: 700;
    margin-top: 4px;
    word-break: break-all;
  }

  .result-item.red .result-value { color: var(--red-dark); }

  .cidr-slider-wrap {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .cidr-slider-wrap input[type=range] {
    flex: 1;
    accent-color: var(--blue);
    height: 6px;
  }

  .cidr-value {
    background: var(--blue);
    color: white;
    padding: 6px 14px;
    border-radius: 8px;
    font-family: var(--font-mono);
    font-weight: 700;
    font-size: 1.05rem;
    min-width: 60px;
    text-align: center;
  }

  /* ===== TABLES ===== */
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
    margin-top: 12px;
  }

  thead tr { background: var(--blue); color: white; }
  thead th { padding: 10px 14px; text-align: left; font-weight: 700; letter-spacing: 0.3px; }
  tbody tr:nth-child(even) { background: var(--blue-pale); }
  tbody tr:hover { background: var(--blue-light); }
  tbody td { padding: 9px 14px; font-family: var(--font-mono); font-size: 0.87rem; border-bottom: 1px solid var(--gray-200); }
  tbody td:first-child { font-weight: 700; color: var(--blue-dark); font-family: var(--font-display); }

  /* ===== INFO BOX ===== */
  .info-box {
    background: var(--blue-pale);
    border-left: 4px solid var(--blue);
    border-radius: 0 8px 8px 0;
    padding: 14px 18px;
    margin: 14px 0;
    font-size: 0.92rem;
    color: var(--blue-dark);
  }

  .info-box.red {
    background: var(--red-light);
    border-left-color: var(--red);
    color: var(--red-dark);
  }

  .info-box strong { font-weight: 800; }

  /* ===== IP BINARY VISUALIZER ===== */
  .binary-visualizer {
    background: var(--gray-100);
    border-radius: 12px;
    padding: 20px;
    font-family: var(--font-mono);
    overflow-x: auto;
  }

  .bv-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
    flex-wrap: nowrap;
  }

  .bv-label {
    width: 120px;
    flex-shrink: 0;
    font-size: 0.78rem;
    color: var(--gray-600);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .bv-bits {
    display: flex;
    gap: 2px;
    flex-wrap: wrap;
  }

  .bv-sep {
    color: var(--gray-400);
    font-size: 1.2rem;
    margin: 0 2px;
  }

  /* ===== QUIZ ===== */
  .quiz-card {
    background: white;
    border: 2px solid var(--gray-200);
    border-radius: 12px;
    padding: 28px;
    margin-bottom: 20px;
  }

  .quiz-card .question {
    font-size: 1.05rem;
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: 18px;
    line-height: 1.5;
  }

  .quiz-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  @media(max-width: 580px) { .quiz-options { grid-template-columns: 1fr; } }

  .quiz-option {
    background: white;
    border: 2px solid var(--gray-200);
    border-radius: 8px;
    padding: 12px 16px;
    cursor: pointer;
    font-family: var(--font-display);
    font-size: 0.9rem;
    text-align: left;
    transition: all 0.15s;
    color: var(--gray-800);
    line-height: 1.4;
  }

  .quiz-option:hover { border-color: var(--blue); background: var(--blue-pale); }
  .quiz-option.correct { border-color: #15803d; background: #dcfce7; color: #14532d; }
  .quiz-option.incorrect { border-color: var(--red); background: var(--red-light); color: var(--red-dark); }
  .quiz-option:disabled { cursor: not-allowed; }

  .quiz-feedback {
    margin-top: 14px;
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 0.92rem;
    font-weight: 600;
    display: none;
  }

  .quiz-feedback.show { display: block; }
  .quiz-feedback.correct { background: #dcfce7; color: #14532d; border: 1px solid #86efac; }
  .quiz-feedback.incorrect { background: var(--red-light); color: var(--red-dark); border: 1px solid #fca5a5; }

  .score-bar {
    display: flex;
    align-items: center;
    gap: 16px;
    background: var(--blue-pale);
    border: 1px solid var(--blue-light);
    border-radius: 10px;
    padding: 14px 20px;
    margin-bottom: 24px;
  }

  .score-num {
    font-size: 1.8rem;
    font-weight: 900;
    color: var(--blue);
    font-family: var(--font-mono);
    line-height: 1;
  }

  .score-label { font-size: 0.8rem; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.5px; }

  .progress-bar-wrap { flex: 1; background: var(--gray-200); border-radius: 99px; height: 12px; overflow: hidden; }
  .progress-bar-fill { height: 100%; background: linear-gradient(90deg, var(--blue), var(--blue-mid)); border-radius: 99px; transition: width 0.5s; width: 0%; }

  /* ===== NAT DIAGRAM ===== */
  .nat-diagram {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0;
    flex-wrap: wrap;
    margin: 20px 0;
    padding: 20px;
    background: var(--gray-100);
    border-radius: 12px;
    overflow-x: auto;
  }

  .nat-box {
    background: white;
    border: 2px solid var(--blue);
    border-radius: 10px;
    padding: 14px 18px;
    text-align: center;
    min-width: 130px;
    box-shadow: var(--shadow);
  }

  .nat-box.router { border-color: var(--red); background: var(--red-light); }
  .nat-box .nat-title { font-weight: 800; color: var(--blue-dark); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; }
  .nat-box.router .nat-title { color: var(--red-dark); }
  .nat-box .nat-ip { font-family: var(--font-mono); font-size: 0.9rem; color: var(--gray-600); margin-top: 4px; }

  .nat-arrow {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0 8px;
  }

  .arrow-line {
    width: 60px;
    height: 3px;
    background: var(--blue);
    position: relative;
  }

  .arrow-label { font-size: 0.72rem; color: var(--gray-600); font-weight: 600; margin: 4px 0; white-space: nowrap; }

  /* ===== CIDR REFERENCE TABLE ===== */
  .cidr-table-wrap { overflow-x: auto; }

  /* ===== TABS WITHIN SECTION ===== */
  .tabs {
    display: flex;
    gap: 0;
    border-bottom: 2px solid var(--blue-light);
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .tab-btn {
    background: none;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
    font-family: var(--font-display);
    font-size: 0.88rem;
    font-weight: 700;
    color: var(--gray-600);
    border-bottom: 3px solid transparent;
    margin-bottom: -2px;
    transition: all 0.2s;
    letter-spacing: 0.3px;
  }

  .tab-btn:hover { color: var(--blue); }
  .tab-btn.active { color: var(--blue-dark); border-bottom-color: var(--red); }

  .tab-panel { display: none; }
  .tab-panel.active { display: block; animation: fadeIn 0.25s ease; }

  /* ===== OVERVIEW STATS ===== */
  .stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 14px;
    margin-bottom: 24px;
  }

  .stat-card {
    background: linear-gradient(135deg, var(--blue-dark), var(--blue));
    color: white;
    border-radius: 12px;
    padding: 18px;
    text-align: center;
    box-shadow: var(--shadow);
  }

  .stat-card.red { background: linear-gradient(135deg, var(--red-dark), var(--red)); }

  .stat-card .stat-num {
    font-size: 2rem;
    font-weight: 900;
    font-family: var(--font-mono);
    line-height: 1;
  }

  .stat-card .stat-desc {
    font-size: 0.75rem;
    opacity: 0.85;
    margin-top: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* ===== FOOTER ===== */
  footer {
    background: var(--blue-dark);
    color: rgba(255,255,255,0.75);
    text-align: center;
    padding: 18px;
    font-size: 0.82rem;
    margin-top: 40px;
    letter-spacing: 0.3px;
  }

  footer strong { color: white; }

  /* ===== CLASS GAME BUTTONS ===== */
  .cg-class-btn {
    width: 80px;
    height: 80px;
    border-radius: 14px;
    border: 3px solid var(--blue-light);
    background: white;
    font-family: var(--font-display);
    font-size: 2rem;
    font-weight: 900;
    color: var(--blue-dark);
    cursor: pointer;
    transition: all 0.18s;
    box-shadow: var(--shadow);
  }

  .cg-class-btn:hover {
    transform: translateY(-4px) scale(1.06);
    box-shadow: var(--shadow-lg);
    border-color: var(--blue);
    background: var(--blue-pale);
  }

  .cg-class-btn[data-class="A"]:hover { background: var(--blue-dark); color: white; border-color: var(--blue-dark); }
  .cg-class-btn[data-class="B"]:hover { background: var(--blue); color: white; border-color: var(--blue); }
  .cg-class-btn[data-class="C"]:hover { background: var(--blue-mid); color: white; border-color: var(--blue-mid); }
  .cg-class-btn[data-class="D"]:hover { background: var(--red); color: white; border-color: var(--red); }
  .cg-class-btn[data-class="E"]:hover { background: var(--red-dark); color: white; border-color: var(--red-dark); }

  .cg-class-btn.correct-ans {
    background: #15803d !important; color: white !important; border-color: #15803d !important;
    animation: pulse-correct 0.4s ease;
  }
  .cg-class-btn.wrong-ans {
    background: var(--red) !important; color: white !important; border-color: var(--red) !important;
    animation: shake 0.4s ease;
  }
  .cg-class-btn:disabled { cursor: not-allowed; transform: none !important; opacity: 0.75; }

  @keyframes pulse-correct {
    0% { transform: scale(1); }
    50% { transform: scale(1.15); }
    100% { transform: scale(1); }
  }

  @keyframes shake {
    0%,100% { transform: translateX(0); }
    20% { transform: translateX(-7px); }
    40% { transform: translateX(7px); }
    60% { transform: translateX(-4px); }
    80% { transform: translateX(4px); }
  }

  @keyframes ip-appear {
    0% { opacity: 0; transform: scale(0.82); }
    100% { opacity: 1; transform: scale(1); }
  }

  .cg-history-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    border-bottom: 1px solid var(--gray-200);
    font-size: 0.85rem;
  }
  .cg-history-row:last-child { border-bottom: none; }
  .cg-history-row .cg-hist-ip { font-family: var(--font-mono); font-weight: 700; color: var(--blue-dark); flex: 1; }
  .cg-history-row .cg-hist-result { font-weight: 800; font-size: 1.1rem; }
  .cg-history-row .cg-hist-result.ok { color: #15803d; }
  .cg-history-row .cg-hist-result.bad { color: var(--red); }
  .cg-history-row .cg-hist-label { font-size: 0.75rem; color: var(--gray-600); }

  /* ===== SUBNET VISUAL CHART ===== */
  .subnet-visual {
    width: 100%;
    height: 40px;
    border-radius: 8px;
    overflow: hidden;
    display: flex;
    margin: 10px 0;
    font-size: 0.75rem;
    font-weight: 700;
  }

  .sv-net {
    background: var(--blue);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: flex 0.4s;
  }

  .sv-host {
    background: var(--red);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: flex 0.4s;
  }
</style>
</head>
<body>

<header>
  <div class="header-top">
    <div class="header-icon">üåê</div>
    <div class="header-title">
      <h1>IPv4 Network Protocol Learning Simulator</h1>
      <p>Moraine Valley Community College ‚Äî Cybersecurity &amp; Networking Education</p>
    </div>
  </div>
  <nav id="mainNav">
    <button class="active" onclick="showSection('overview', this)">üè† Overview</button>
    <button onclick="showSection('address', this)">üî¢ Address Structure</button>
    <button onclick="showSection('classes', this)">üìä Network Classes</button>
    <button onclick="showSection('subnet', this)">üßÆ Subnet Calculator</button>
    <button onclick="showSection('broadcast', this)">üì° Broadcast</button>
    <button onclick="showSection('host', this)">üíª Host Addresses</button>
    <button onclick="showSection('nat', this)">üîÑ NAT</button>
    <button onclick="showSection('cidr', this)">üóÇÔ∏è CIDR</button>
    <button onclick="showSection('quiz', this)">‚úÖ Test Your Knowledge</button>
  </nav>
</header>

<main>

<!-- ===== OVERVIEW ===== -->
<section id="overview" class="section active">
  <div class="section-header">
    <div class="section-icon">üåê</div>
    <div>
      <h2>IPv4 Protocol Overview</h2>
      <p>Internet Protocol version 4 ‚Äî the foundation of modern networking</p>
    </div>
  </div>

  <div class="stat-grid">
    <div class="stat-card"><div class="stat-num">32</div><div class="stat-desc">Address Bits</div></div>
    <div class="stat-card"><div class="stat-num">4.3B</div><div class="stat-desc">Total Addresses</div></div>
    <div class="stat-card red"><div class="stat-num">1981</div><div class="stat-desc">RFC 791 Year</div></div>
    <div class="stat-card"><div class="stat-num">4</div><div class="stat-desc">Octets (Bytes)</div></div>
    <div class="stat-card red"><div class="stat-num">TTL</div><div class="stat-desc">Header Field</div></div>
    <div class="stat-card"><div class="stat-num">20</div><div class="stat-desc">Min Header Bytes</div></div>
  </div>

  <div class="card">
    <h3>üìã What is IPv4?</h3>
    <p>IPv4 (Internet Protocol version 4) is the fourth version of the Internet Protocol and the first version deployed for production on ARPANET in 1983. It is a connectionless protocol for use on packet-switched networks and operates as a best-effort delivery model.</p>
    <p>IPv4 uses 32-bit addresses, limiting the address space to 4,294,967,296 (2¬≥¬≤) unique addresses. Due to growing demand, address exhaustion led to the development of techniques like NAT and CIDR, and eventually IPv6.</p>
  </div>

  <div class="grid-2">
    <div class="card">
      <h3>üì¶ IPv4 Header Structure</h3>
      <div class="packet-diagram">
        <div class="packet-row">
          <div class="packet-field" style="flex:0.5">Version<span class="packet-bits">4b</span></div>
          <div class="packet-field" style="flex:0.5">IHL<span class="packet-bits">4b</span></div>
          <div class="packet-field">DSCP/ECN<span class="packet-bits">8b</span></div>
          <div class="packet-field wide">Total Length<span class="packet-bits">16b</span></div>
        </div>
        <div class="packet-row">
          <div class="packet-field wider">Identification<span class="packet-bits">16b</span></div>
          <div class="packet-field">Flags<span class="packet-bits">3b</span></div>
          <div class="packet-field wide">Fragment Offset<span class="packet-bits">13b</span></div>
        </div>
        <div class="packet-row">
          <div class="packet-field">TTL<span class="packet-bits">8b</span></div>
          <div class="packet-field">Protocol<span class="packet-bits">8b</span></div>
          <div class="packet-field wider">Header Checksum<span class="packet-bits">16b</span></div>
        </div>
        <div class="packet-row">
          <div class="packet-field red wider" style="flex:4">Source IP Address<span class="packet-bits">32 bits</span></div>
        </div>
        <div class="packet-row">
          <div class="packet-field red wider" style="flex:4">Destination IP Address<span class="packet-bits">32 bits</span></div>
        </div>
        <div class="packet-row">
          <div class="packet-field wider" style="flex:4">Options (if IHL &gt; 5) + Data Payload</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>‚öôÔ∏è Key Header Fields</h3>
      <table>
        <thead><tr><th>Field</th><th>Size</th><th>Purpose</th></tr></thead>
        <tbody>
          <tr><td>Version</td><td>4b</td><td>Always 4 for IPv4</td></tr>
          <tr><td>IHL</td><td>4b</td><td>Header length in 32-bit words</td></tr>
          <tr><td>Total Length</td><td>16b</td><td>Entire packet size (max 65535)</td></tr>
          <tr><td>TTL</td><td>8b</td><td>Hop count before discard</td></tr>
          <tr><td>Protocol</td><td>8b</td><td>TCP=6, UDP=17, ICMP=1</td></tr>
          <tr><td>Checksum</td><td>16b</td><td>Header error detection</td></tr>
          <tr><td>Src IP</td><td>32b</td><td>Sender's IP address</td></tr>
          <tr><td>Dst IP</td><td>32b</td><td>Receiver's IP address</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <h3>üîë Core Concepts for Network Administrators</h3>
    <ul>
      <li><strong>IP Addressing:</strong> Every device on a network must have a unique IP address to communicate.</li>
      <li><strong>Subnetting:</strong> Divides large networks into smaller, manageable subnetworks to improve performance and security.</li>
      <li><strong>Subnet Mask:</strong> Determines which portion of an IP address identifies the network vs. the host.</li>
      <li><strong>Default Gateway:</strong> The router address used when a packet's destination is not on the local subnet.</li>
      <li><strong>CIDR:</strong> Classless Inter-Domain Routing replaces classful addressing for flexible prefix lengths.</li>
      <li><strong>NAT:</strong> Network Address Translation allows private addresses to communicate through public internet.</li>
      <li><strong>Broadcast:</strong> Packets sent to all devices on a network segment simultaneously.</li>
      <li><strong>Loopback (127.0.0.1):</strong> Used to test the local IP stack without sending packets over the network.</li>
    </ul>
  </div>
</section>

<!-- ===== ADDRESS STRUCTURE ===== -->
<section id="address" class="section">
  <div class="section-header">
    <div class="section-icon">üî¢</div>
    <div>
      <h2>IPv4 Address Structure</h2>
      <p>Understanding 32-bit addressing, octets, and binary representation</p>
    </div>
  </div>

  <div class="card">
    <h3>üìê Address Anatomy</h3>
    <p>An IPv4 address is a 32-bit number written in <strong>dotted-decimal notation</strong> as four octets (8-bit groups), each ranging from 0‚Äì255.</p>

    <div class="octet-display">
      <div class="octet-box net">192<span class="octet-label">Network</span></div>
      <div class="octet-dot">.</div>
      <div class="octet-box net">168<span class="octet-label">Network</span></div>
      <div class="octet-dot">.</div>
      <div class="octet-box">1<span class="octet-label">Subnet</span></div>
      <div class="octet-dot">.</div>
      <div class="octet-box host">100<span class="octet-label">Host</span></div>
    </div>

    <div id="binaryDisplay" class="binary-visualizer">
      <div class="bv-row">
        <div class="bv-label">Decimal</div>
        <span style="font-size:1.1rem;font-weight:700;color:var(--blue-dark)">192 . 168 . 1 . 100</span>
      </div>
      <div class="bv-row">
        <div class="bv-label">Binary</div>
        <div class="bv-bits" id="binaryBits"></div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>üîÑ Interactive Binary Converter</h3>
    <div class="calc-form">
      <div class="form-group">
        <label>Enter IP Address</label>
        <input type="text" id="ipInput" placeholder="e.g. 192.168.10.1" value="192.168.1.100" oninput="updateBinaryDisplay()">
      </div>
      <div class="form-group">
        <label>Enter Decimal (0‚Äì255)</label>
        <input type="number" id="decInput" min="0" max="255" value="192" oninput="updateDecToBin()">
      </div>
    </div>
    <div id="decBinResult" class="info-box" style="font-family:var(--font-mono)"></div>
  </div>

  <div class="grid-2">
    <div class="card">
      <h3>üéØ Special IPv4 Addresses</h3>
      <table>
        <thead><tr><th>Address</th><th>Purpose</th></tr></thead>
        <tbody>
          <tr><td>0.0.0.0</td><td>This host (used in DHCP)</td></tr>
          <tr><td>127.0.0.1</td><td>Loopback / localhost</td></tr>
          <tr><td>169.254.x.x</td><td>APIPA (link-local)</td></tr>
          <tr><td>10.x.x.x</td><td>Private Class A</td></tr>
          <tr><td>172.16‚Äì31.x.x</td><td>Private Class B</td></tr>
          <tr><td>192.168.x.x</td><td>Private Class C</td></tr>
          <tr><td>255.255.255.255</td><td>Limited broadcast</td></tr>
          <tr><td>224.0.0.0‚Äì239.x</td><td>Multicast range</td></tr>
        </tbody>
      </table>
    </div>
    <div class="card">
      <h3>üìè Octet Value Weights</h3>
      <p>Each bit position in an octet carries a specific positional value (power of 2):</p>
      <div class="binary-visualizer" style="font-size:0.85rem">
        <div style="display:flex;gap:4px;justify-content:center;flex-wrap:wrap">
          <div style="text-align:center">
            <div class="bit one">1</div><div style="font-size:0.7rem;color:var(--gray-600)">128</div>
          </div>
          <div style="text-align:center">
            <div class="bit one">1</div><div style="font-size:0.7rem;color:var(--gray-600)">64</div>
          </div>
          <div style="text-align:center">
            <div class="bit zero">0</div><div style="font-size:0.7rem;color:var(--gray-600)">32</div>
          </div>
          <div style="text-align:center">
            <div class="bit zero">0</div><div style="font-size:0.7rem;color:var(--gray-600)">16</div>
          </div>
          <div style="text-align:center">
            <div class="bit zero">0</div><div style="font-size:0.7rem;color:var(--gray-600)">8</div>
          </div>
          <div style="text-align:center">
            <div class="bit zero">0</div><div style="font-size:0.7rem;color:var(--gray-600)">4</div>
          </div>
          <div style="text-align:center">
            <div class="bit zero">0</div><div style="font-size:0.7rem;color:var(--gray-600)">2</div>
          </div>
          <div style="text-align:center">
            <div class="bit zero">0</div><div style="font-size:0.7rem;color:var(--gray-600)">1</div>
          </div>
        </div>
        <div class="info-box" style="margin-top:14px">
          <strong>Example:</strong> 11000000 = 128 + 64 = <strong>192</strong>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== NETWORK CLASSES ===== -->
<section id="classes" class="section">
  <div class="section-header">
    <div class="section-icon">üìä</div>
    <div>
      <h2>Network Classes</h2>
      <p>Classful addressing: the original IPv4 organization scheme</p>
    </div>
  </div>

  <!-- SUB-TABS -->
  <div class="tabs">
    <button class="tab-btn active" onclick="switchClassTab('reference', this)">üìö Class Reference</button>
    <button class="tab-btn" onclick="switchClassTab('identifier', this)">üéØ Identify the Class</button>
    <button class="tab-btn" onclick="switchClassTab('private', this)">üîí Private Ranges</button>
  </div>

  <!-- TAB: REFERENCE -->
  <div class="tab-panel active" id="classtab-reference">
    <div class="info-box">
      <strong>Tip:</strong> The first octet of an IPv4 address is all you need to determine its class. Memorize the boundary values: <strong>1‚Äì126 = A</strong>, <strong>128‚Äì191 = B</strong>, <strong>192‚Äì223 = C</strong>, <strong>224‚Äì239 = D</strong>, <strong>240‚Äì255 = E</strong>.
    </div>

    <!-- Visual class ruler -->
    <div class="card" style="overflow-x:auto">
      <h3>üìè IPv4 Class Range Ruler (First Octet 0‚Äì255)</h3>
      <div style="margin:16px 0 8px">
        <div style="display:flex;width:100%;border-radius:8px;overflow:hidden;height:44px;font-weight:700;font-size:0.82rem">
          <div style="flex:126;background:#0d2d6b;color:white;display:flex;align-items:center;justify-content:center;min-width:0">A&nbsp;<span style="font-size:0.68rem;opacity:0.8">1‚Äì126</span></div>
          <div style="flex:1;background:#555;color:white;display:flex;align-items:center;justify-content:center;font-size:0.6rem;min-width:18px">127</div>
          <div style="flex:64;background:#1a4fa0;color:white;display:flex;align-items:center;justify-content:center;min-width:0">B&nbsp;<span style="font-size:0.68rem;opacity:0.8">128‚Äì191</span></div>
          <div style="flex:32;background:#2563c7;color:white;display:flex;align-items:center;justify-content:center;min-width:0">C&nbsp;<span style="font-size:0.68rem;opacity:0.8">192‚Äì223</span></div>
          <div style="flex:16;background:#c0152a;color:white;display:flex;align-items:center;justify-content:center;min-width:0">D&nbsp;<span style="font-size:0.68rem;opacity:0.8">224‚Äì239</span></div>
          <div style="flex:16;background:#8b0e1e;color:white;display:flex;align-items:center;justify-content:center;min-width:0">E&nbsp;<span style="font-size:0.68rem;opacity:0.8">240‚Äì255</span></div>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:0.7rem;color:var(--gray-600);margin-top:4px;font-family:var(--font-mono)">
          <span>0</span><span>64</span><span>128</span><span>192</span><span>224</span><span>240</span><span>255</span>
        </div>
      </div>
    </div>

    <div class="class-card">
      <div class="class-badge a">A</div>
      <h3>Class A ‚Äî Large Networks</h3>
      <div style="clear:both;margin-top:8px">
        <p>Leading bit pattern: <strong style="font-family:var(--font-mono)">0xxxxxxx</strong>. Network portion: first octet only. Host portion: last 3 octets.</p>
        <span class="range-pill">1.0.0.0 ‚Äì 126.255.255.255</span>
        <span class="range-pill red">127.x.x.x (Loopback ‚Äî reserved)</span>
        <table style="margin-top:10px">
          <tr><th>Default Mask</th><th>Networks</th><th>Hosts/Network</th><th>1st Octet Range</th></tr>
          <tr><td>255.0.0.0 (/8)</td><td>126</td><td>16,777,214</td><td>1 ‚Äì 126</td></tr>
        </table>
      </div>
    </div>

    <div class="class-card">
      <div class="class-badge b">B</div>
      <h3>Class B ‚Äî Medium Networks</h3>
      <div style="clear:both;margin-top:8px">
        <p>Leading bit pattern: <strong style="font-family:var(--font-mono)">10xxxxxx</strong>. Network portion: first two octets. Host portion: last 2 octets.</p>
        <span class="range-pill">128.0.0.0 ‚Äì 191.255.255.255</span>
        <table style="margin-top:10px">
          <tr><th>Default Mask</th><th>Networks</th><th>Hosts/Network</th><th>1st Octet Range</th></tr>
          <tr><td>255.255.0.0 (/16)</td><td>16,384</td><td>65,534</td><td>128 ‚Äì 191</td></tr>
        </table>
      </div>
    </div>

    <div class="class-card">
      <div class="class-badge c">C</div>
      <h3>Class C ‚Äî Small Networks</h3>
      <div style="clear:both;margin-top:8px">
        <p>Leading bit pattern: <strong style="font-family:var(--font-mono)">110xxxxx</strong>. Network portion: first three octets. Host portion: last octet only.</p>
        <span class="range-pill">192.0.0.0 ‚Äì 223.255.255.255</span>
        <table style="margin-top:10px">
          <tr><th>Default Mask</th><th>Networks</th><th>Hosts/Network</th><th>1st Octet Range</th></tr>
          <tr><td>255.255.255.0 (/24)</td><td>2,097,152</td><td>254</td><td>192 ‚Äì 223</td></tr>
        </table>
      </div>
    </div>

    <div class="grid-2">
      <div class="class-card">
        <div class="class-badge d">D</div>
        <h3>Class D ‚Äî Multicast</h3>
        <div style="clear:both;margin-top:8px">
          <p>Leading bit pattern: <strong style="font-family:var(--font-mono)">1110xxxx</strong>. Reserved for multicast groups. Not assigned to individual hosts.</p>
          <span class="range-pill red">224.0.0.0 ‚Äì 239.255.255.255</span>
        </div>
      </div>
      <div class="class-card">
        <div class="class-badge e">E</div>
        <h3>Class E ‚Äî Experimental</h3>
        <div style="clear:both;margin-top:8px">
          <p>Leading bit pattern: <strong style="font-family:var(--font-mono)">1111xxxx</strong>. Reserved by IANA for research. Not routed on public internet.</p>
          <span class="range-pill red">240.0.0.0 ‚Äì 255.255.255.254</span>
        </div>
      </div>
    </div>

    <!-- Quick decision flowchart -->
    <div class="card">
      <h3>üå≥ Class Identification Decision Tree</h3>
      <div class="binary-visualizer" style="font-family:var(--font-display);font-size:0.88rem;line-height:2">
        <div style="color:var(--blue-dark);font-weight:700;margin-bottom:6px">Look at the FIRST OCTET value:</div>
        <div style="padding-left:0">
          <div>‚îú‚îÄ <strong>1‚Äì126</strong> &nbsp;&nbsp;&nbsp;‚Üí <span style="background:var(--blue-dark);color:white;padding:2px 10px;border-radius:4px;font-weight:700">Class A</span> &nbsp;(default mask /8)</div>
          <div>‚îú‚îÄ <strong>127</strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚Üí <span style="background:#555;color:white;padding:2px 10px;border-radius:4px;font-weight:700">Loopback</span> &nbsp;(reserved, not routed)</div>
          <div>‚îú‚îÄ <strong>128‚Äì191</strong> ‚Üí  <span style="background:var(--blue);color:white;padding:2px 10px;border-radius:4px;font-weight:700">Class B</span> &nbsp;(default mask /16)</div>
          <div>‚îú‚îÄ <strong>192‚Äì223</strong> ‚Üí  <span style="background:var(--blue-mid);color:white;padding:2px 10px;border-radius:4px;font-weight:700">Class C</span> &nbsp;(default mask /24)</div>
          <div>‚îú‚îÄ <strong>224‚Äì239</strong> ‚Üí  <span style="background:var(--red);color:white;padding:2px 10px;border-radius:4px;font-weight:700">Class D</span> &nbsp;(multicast)</div>
          <div>‚îî‚îÄ <strong>240‚Äì255</strong> ‚Üí  <span style="background:var(--red-dark);color:white;padding:2px 10px;border-radius:4px;font-weight:700">Class E</span> &nbsp;(experimental)</div>
        </div>
      </div>
    </div>
  </div>

  <!-- TAB: IDENTIFIER GAME -->
  <div class="tab-panel" id="classtab-identifier">
    <div class="card" style="border:2px solid var(--blue);background:var(--blue-pale)">
      <h3 style="font-size:1.2rem">üéØ Class Identification Challenge</h3>
      <p style="margin-bottom:0">A random IPv4 address will be displayed. Identify its class by clicking the correct button. The first octet is your key clue!</p>
    </div>

    <!-- Scoreboard -->
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px">
      <div style="background:var(--blue-dark);color:white;border-radius:10px;padding:14px;text-align:center">
        <div style="font-size:2rem;font-weight:900;font-family:var(--font-mono)" id="cg-correct">0</div>
        <div style="font-size:0.72rem;opacity:0.8;text-transform:uppercase;letter-spacing:0.5px">Correct</div>
      </div>
      <div style="background:var(--red);color:white;border-radius:10px;padding:14px;text-align:center">
        <div style="font-size:2rem;font-weight:900;font-family:var(--font-mono)" id="cg-wrong">0</div>
        <div style="font-size:0.72rem;opacity:0.8;text-transform:uppercase;letter-spacing:0.5px">Incorrect</div>
      </div>
      <div style="background:var(--blue);color:white;border-radius:10px;padding:14px;text-align:center">
        <div style="font-size:2rem;font-weight:900;font-family:var(--font-mono)" id="cg-streak">0</div>
        <div style="font-size:0.72rem;opacity:0.8;text-transform:uppercase;letter-spacing:0.5px">Streak üî•</div>
      </div>
      <div style="background:var(--gray-100);border:2px solid var(--gray-200);border-radius:10px;padding:14px;text-align:center">
        <div style="font-size:2rem;font-weight:900;font-family:var(--font-mono);color:var(--blue)" id="cg-pct">‚Äî</div>
        <div style="font-size:0.72rem;color:var(--gray-600);text-transform:uppercase;letter-spacing:0.5px">Accuracy</div>
      </div>
    </div>

    <!-- Main challenge card -->
    <div style="background:white;border:2px solid var(--gray-200);border-radius:16px;padding:32px;margin-bottom:20px;text-align:center" id="cg-card">

      <div style="font-size:0.8rem;font-weight:700;color:var(--gray-600);text-transform:uppercase;letter-spacing:1px;margin-bottom:16px">What class is this IPv4 address?</div>

      <!-- IP display with octet highlighting -->
      <div style="margin:20px 0" id="cg-ip-display">
        <div style="font-family:var(--font-mono);font-size:3rem;font-weight:900;letter-spacing:4px;color:var(--blue-dark)" id="cg-ip-text">‚Äî.‚Äî.‚Äî.‚Äî</div>
        <div style="margin-top:10px;display:flex;gap:6px;justify-content:center;flex-wrap:wrap" id="cg-octet-pills"></div>
        <div style="margin-top:12px;font-size:0.82rem;color:var(--gray-600)" id="cg-binary-hint"></div>
      </div>

      <!-- Hint toggle -->
      <div style="margin-bottom:20px">
        <button class="btn" style="background:var(--gray-600);font-size:0.8rem;padding:8px 18px" onclick="toggleHint()">üí° Show Hint</button>
        <div id="cg-hint-box" style="display:none;margin-top:12px;background:var(--blue-pale);border:1px solid var(--blue-light);border-radius:8px;padding:12px;font-size:0.88rem;color:var(--blue-dark)"></div>
      </div>

      <!-- Answer buttons -->
      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-bottom:20px" id="cg-answer-btns">
        <button class="cg-class-btn" data-class="A" onclick="submitClassAnswer('A')">A</button>
        <button class="cg-class-btn" data-class="B" onclick="submitClassAnswer('B')">B</button>
        <button class="cg-class-btn" data-class="C" onclick="submitClassAnswer('C')">C</button>
        <button class="cg-class-btn" data-class="D" onclick="submitClassAnswer('D')">D</button>
        <button class="cg-class-btn" data-class="E" onclick="submitClassAnswer('E')">E</button>
      </div>

      <!-- Feedback area -->
      <div id="cg-feedback" style="display:none;border-radius:10px;padding:16px 20px;margin-bottom:16px;text-align:left"></div>

      <!-- Next button -->
      <button class="btn" id="cg-next-btn" style="display:none;font-size:1rem;padding:12px 36px" onclick="nextClassQuestion()">Next Address ‚Üí</button>
    </div>

    <!-- History log -->
    <div class="card">
      <h3>üìã Answer History <span id="cg-history-count" class="badge" style="background:var(--blue)">0 questions</span></h3>
      <div id="cg-history" style="max-height:260px;overflow-y:auto">
        <p style="color:var(--gray-400);font-size:0.88rem;text-align:center;padding:20px">Your answer history will appear here.</p>
      </div>
      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn btn-red" style="font-size:0.82rem;padding:8px 18px" onclick="resetClassGame()">‚Ü∫ Reset Game</button>
        <button class="btn" style="font-size:0.82rem;padding:8px 18px;background:var(--gray-600)" onclick="toggleDifficulty()">‚öôÔ∏è Difficulty: <span id="cg-diff-label">All Classes</span></button>
      </div>
    </div>
  </div>

  <!-- TAB: PRIVATE RANGES -->
  <div class="tab-panel" id="classtab-private">
    <div class="info-box">
      <strong>RFC 1918</strong> defines three blocks of address space for private internets. These addresses are not routed on the public internet and require NAT to communicate externally.
    </div>
    <div class="card">
      <h3>üîí Private Address Ranges (RFC 1918)</h3>
      <table>
        <thead><tr><th>Class</th><th>Range</th><th>CIDR</th><th>Total Hosts</th><th>Typical Use</th></tr></thead>
        <tbody>
          <tr><td>Class A</td><td>10.0.0.0 ‚Äì 10.255.255.255</td><td>10.0.0.0/8</td><td>16,777,214</td><td>Large enterprise / ISP backbone</td></tr>
          <tr><td>Class B</td><td>172.16.0.0 ‚Äì 172.31.255.255</td><td>172.16.0.0/12</td><td>1,048,574</td><td>Mid-size corporate networks</td></tr>
          <tr><td>Class C</td><td>192.168.0.0 ‚Äì 192.168.255.255</td><td>192.168.0.0/16</td><td>65,534</td><td>Home / SOHO networks</td></tr>
        </tbody>
      </table>
    </div>
    <div class="grid-2">
      <div class="card">
        <h3>üö´ Other Reserved Ranges</h3>
        <table>
          <thead><tr><th>Range</th><th>Purpose</th></tr></thead>
          <tbody>
            <tr><td>0.0.0.0/8</td><td>This network (DHCP source)</td></tr>
            <tr><td>100.64.0.0/10</td><td>Shared address space (CGN)</td></tr>
            <tr><td>127.0.0.0/8</td><td>Loopback (localhost)</td></tr>
            <tr><td>169.254.0.0/16</td><td>APIPA (link-local)</td></tr>
            <tr><td>192.0.0.0/24</td><td>IETF Protocol Assignments</td></tr>
            <tr><td>192.0.2.0/24</td><td>TEST-NET-1 (documentation)</td></tr>
            <tr><td>198.51.100.0/24</td><td>TEST-NET-2 (documentation)</td></tr>
            <tr><td>203.0.113.0/24</td><td>TEST-NET-3 (documentation)</td></tr>
            <tr><td>224.0.0.0/4</td><td>Multicast (Class D)</td></tr>
            <tr><td>240.0.0.0/4</td><td>Reserved/Experimental (Class E)</td></tr>
            <tr><td>255.255.255.255/32</td><td>Limited broadcast</td></tr>
          </tbody>
        </table>
      </div>
      <div class="card">
        <h3>üí° Why Private Addresses?</h3>
        <ul>
          <li><strong>IPv4 Exhaustion:</strong> Only ~4.3 billion public IPs exist; private ranges allow billions of internal devices to share a small pool of public IPs via NAT.</li>
          <li><strong>Security:</strong> Private addresses are not reachable from the internet by default, adding a layer of isolation.</li>
          <li><strong>Cost:</strong> Organizations don't need to purchase public IP addresses for every internal device.</li>
          <li><strong>Flexibility:</strong> Internal addressing can be freely designed without coordination with IANA.</li>
          <li><strong>RFC 1918</strong> was published in 1996 and remains the standard today.</li>
        </ul>
      </div>
    </div>
  </div>
</section>

<!-- ===== SUBNET CALCULATOR ===== -->
<section id="subnet" class="section">
  <div class="section-header">
    <div class="section-icon">üßÆ</div>
    <div>
      <h2>Subnet Mask Calculator</h2>
      <p>Calculate network addresses, host ranges, and broadcast addresses</p>
    </div>
  </div>

  <div class="card">
    <h3>‚öôÔ∏è Interactive Subnet Calculator</h3>
    <div class="calc-form">
      <div class="form-group">
        <label>IP Address</label>
        <input type="text" id="subnetIP" value="192.168.10.0" placeholder="e.g. 192.168.10.0">
      </div>
      <div class="form-group">
        <label>CIDR Prefix Length</label>
        <div class="cidr-slider-wrap">
          <input type="range" id="cidrSlider" min="1" max="30" value="24" oninput="updateCIDRLabel()">
          <div class="cidr-value" id="cidrLabel">/24</div>
        </div>
      </div>
    </div>
    <div style="margin-bottom:16px">
      <div class="subnet-visual">
        <div class="sv-net" id="svNet" style="flex:24">Network (24)</div>
        <div class="sv-host" id="svHost" style="flex:8">Host (8)</div>
      </div>
    </div>
    <button class="btn" onclick="calculateSubnet()">üßÆ Calculate Subnet</button>

    <div id="subnetResults" class="result-grid" style="display:none"></div>
    <div id="subnetBinary" style="margin-top:16px;display:none"></div>
  </div>

  <div class="card">
    <h3>üìã Subnet Mask Reference Table</h3>
    <div class="cidr-table-wrap">
      <table>
        <thead>
          <tr><th>CIDR</th><th>Subnet Mask</th><th>Wildcard</th><th>Addresses</th><th>Usable Hosts</th><th>Class Equiv.</th></tr>
        </thead>
        <tbody id="subnetRefTable"></tbody>
      </table>
    </div>
  </div>
</section>

<!-- ===== BROADCAST ===== -->
<section id="broadcast" class="section">
  <div class="section-header">
    <div class="section-icon">üì°</div>
    <div>
      <h2>Broadcast Addresses</h2>
      <p>Understanding directed, limited, and subnet broadcasts</p>
    </div>
  </div>

  <div class="card">
    <h3>üì° What is a Broadcast Address?</h3>
    <p>A broadcast address is a special address that allows data to be sent to all devices on a network simultaneously. It is always the last address in a subnet ‚Äî all host bits are set to 1.</p>
    <div class="info-box red"><strong>Formula:</strong> Broadcast = Network Address OR (NOT Subnet Mask)</div>
  </div>

  <div class="grid-2">
    <div class="card">
      <h3>üì§ Types of Broadcasts</h3>
      <table>
        <thead><tr><th>Type</th><th>Address</th><th>Scope</th></tr></thead>
        <tbody>
          <tr><td>Limited Broadcast</td><td>255.255.255.255</td><td>Local subnet only (not routed)</td></tr>
          <tr><td>Directed Broadcast</td><td>Network + all-1s host</td><td>Specific remote subnet</td></tr>
          <tr><td>Subnet Broadcast</td><td>Last address in subnet</td><td>All hosts in subnet</td></tr>
          <tr><td>Network Broadcast</td><td>192.168.1.255 (/24)</td><td>All hosts in /24</td></tr>
        </tbody>
      </table>
    </div>
    <div class="card">
      <h3>üßÆ Broadcast Calculator</h3>
      <div class="form-group" style="margin-bottom:12px">
        <label>Network Address / CIDR</label>
        <input type="text" id="bcIP" placeholder="e.g. 192.168.5.0/24" value="192.168.5.0/24">
      </div>
      <button class="btn" onclick="calcBroadcast()">Calculate Broadcast</button>
      <div id="bcResult" style="margin-top:14px"></div>
    </div>
  </div>

  <div class="card">
    <h3>üî¢ Broadcast Calculation Walk-through</h3>
    <div id="bcWalkthrough" class="binary-visualizer">
      <p style="color:var(--gray-600);font-family:var(--font-display);font-size:0.9rem">Enter a network address above and click Calculate to see the step-by-step binary walk-through.</p>
    </div>
  </div>
</section>

<!-- ===== HOST ADDRESSES ===== -->
<section id="host" class="section">
  <div class="section-header">
    <div class="section-icon">üíª</div>
    <div>
      <h2>Host Addresses</h2>
      <p>Understanding usable host ranges and address allocation</p>
    </div>
  </div>

  <div class="card">
    <h3>üíª Host Address Rules</h3>
    <div class="info-box"><strong>Usable Hosts = 2‚Åø ‚àí 2</strong> where n = number of host bits. We subtract 2 for the network address (all 0s) and broadcast address (all 1s).</div>
    <div class="grid-2" style="margin-top:16px">
      <div>
        <p><strong>First host:</strong> Network address + 1 (host bits = ...0001)</p>
        <p style="margin-top:8px"><strong>Last host:</strong> Broadcast address ‚àí 1 (host bits = ...1110)</p>
      </div>
      <div class="binary-visualizer" style="font-size:0.85rem">
        <div style="margin-bottom:6px"><strong>Example: 192.168.1.0/24</strong></div>
        <div>Network: 192.168.1.<strong>0</strong></div>
        <div>First Host: 192.168.1.<strong>1</strong></div>
        <div>Last Host: 192.168.1.<strong>254</strong></div>
        <div>Broadcast: 192.168.1.<strong>255</strong></div>
        <div style="margin-top:8px;color:var(--red-dark)">Usable: 2‚Å∏ - 2 = <strong>254</strong> hosts</div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>üî¢ Host Range Calculator</h3>
    <div class="calc-form">
      <div class="form-group">
        <label>Network Address</label>
        <input type="text" id="hrIP" value="10.0.0.0" placeholder="e.g. 10.0.0.0">
      </div>
      <div class="form-group">
        <label>CIDR Prefix / Subnet Mask</label>
        <input type="text" id="hrCIDR" value="/8" placeholder="/24 or 255.255.255.0">
      </div>
    </div>
    <button class="btn" onclick="calcHostRange()">Calculate Host Range</button>
    <div id="hrResult" class="result-grid" style="margin-top:16px;display:none"></div>
  </div>

  <div class="card">
    <h3>üìä Hosts per Prefix Reference</h3>
    <table>
      <thead><tr><th>CIDR</th><th>Host Bits</th><th>Total</th><th>Usable</th><th>Common Use</th></tr></thead>
      <tbody>
        <tr><td>/30</td><td>2</td><td>4</td><td>2</td><td>Point-to-point links</td></tr>
        <tr><td>/29</td><td>3</td><td>8</td><td>6</td><td>Small office</td></tr>
        <tr><td>/28</td><td>4</td><td>16</td><td>14</td><td>Small department</td></tr>
        <tr><td>/27</td><td>5</td><td>32</td><td>30</td><td>Department/VLAN</td></tr>
        <tr><td>/26</td><td>6</td><td>64</td><td>62</td><td>Medium VLAN</td></tr>
        <tr><td>/25</td><td>7</td><td>128</td><td>126</td><td>Large department</td></tr>
        <tr><td>/24</td><td>8</td><td>256</td><td>254</td><td>Standard LAN</td></tr>
        <tr><td>/23</td><td>9</td><td>512</td><td>510</td><td>Large LAN</td></tr>
        <tr><td>/22</td><td>10</td><td>1,024</td><td>1,022</td><td>Campus segment</td></tr>
        <tr><td>/16</td><td>16</td><td>65,536</td><td>65,534</td><td>Class B default</td></tr>
        <tr><td>/8</td><td>24</td><td>16.7M</td><td>16,777,214</td><td>Class A default</td></tr>
      </tbody>
    </table>
  </div>
</section>

<!-- ===== NAT ===== -->
<section id="nat" class="section">
  <div class="section-header">
    <div class="section-icon">üîÑ</div>
    <div>
      <h2>Network Address Translation (NAT)</h2>
      <p>Conserving IPv4 addresses by mapping private to public IPs</p>
    </div>
  </div>

  <div class="card">
    <h3>üîÑ How NAT Works</h3>
    <p>NAT (RFC 3022) translates private IP addresses in packet headers as packets pass through a router. This allows multiple internal hosts to share a single public IP address.</p>

    <div class="nat-diagram">
      <div style="display:flex;flex-direction:column;gap:8px">
        <div class="nat-box"><div class="nat-title">üñ•Ô∏è Host A</div><div class="nat-ip">192.168.1.10</div></div>
        <div class="nat-box"><div class="nat-title">üñ•Ô∏è Host B</div><div class="nat-ip">192.168.1.11</div></div>
        <div class="nat-box"><div class="nat-title">üñ•Ô∏è Host C</div><div class="nat-ip">192.168.1.12</div></div>
      </div>
      <div class="nat-arrow">
        <div class="arrow-label">Private</div>
        <div class="arrow-line"></div>
        <div class="arrow-label">‚Üí Router</div>
      </div>
      <div class="nat-box router">
        <div class="nat-title">üîÑ NAT Router</div>
        <div class="nat-ip">Inside: 192.168.1.1<br>Outside: 203.0.113.5</div>
      </div>
      <div class="nat-arrow">
        <div class="arrow-label">Public</div>
        <div class="arrow-line"></div>
        <div class="arrow-label">‚Üí Internet</div>
      </div>
      <div class="nat-box">
        <div class="nat-title">üåê Internet</div>
        <div class="nat-ip">Sees: 203.0.113.5</div>
      </div>
    </div>
  </div>

  <div class="grid-2">
    <div class="card">
      <h3>üìã Types of NAT <span class="badge">3 Types</span></h3>
      <table>
        <thead><tr><th>Type</th><th>Mapping</th><th>Use Case</th></tr></thead>
        <tbody>
          <tr><td>Static NAT</td><td>1:1 permanent</td><td>Servers needing fixed public IP</td></tr>
          <tr><td>Dynamic NAT</td><td>1:1 from pool</td><td>Large orgs with IP pool</td></tr>
          <tr><td>PAT/NAT Overload</td><td>Many:1 (ports)</td><td>Home/SOHO ‚Äî most common</td></tr>
        </tbody>
      </table>
    </div>
    <div class="card">
      <h3>‚úÖ NAT Advantages &amp; ‚ö†Ô∏è Limitations</h3>
      <table>
        <thead><tr><th>Advantage</th><th>Limitation</th></tr></thead>
        <tbody>
          <tr><td>Conserves public IPs</td><td>Breaks end-to-end connectivity</td></tr>
          <tr><td>Hides internal topology</td><td>Complicates some protocols (SIP, FTP)</td></tr>
          <tr><td>Security through obscurity</td><td>Adds translation overhead</td></tr>
          <tr><td>Easy internal renumbering</td><td>Complicates troubleshooting</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <h3>üîå PAT (Port Address Translation) ‚Äî How It Works</h3>
    <p>PAT, also called NAT Overload, uses port numbers to track multiple simultaneous connections from different internal hosts through a single public IP address.</p>
    <table style="margin-top:12px">
      <thead><tr><th>Internal IP : Port</th><th>External IP : Port</th><th>Destination</th></tr></thead>
      <tbody>
        <tr><td>192.168.1.10:1024</td><td>203.0.113.5:10001</td><td>8.8.8.8:80</td></tr>
        <tr><td>192.168.1.11:1025</td><td>203.0.113.5:10002</td><td>8.8.8.8:80</td></tr>
        <tr><td>192.168.1.12:1026</td><td>203.0.113.5:10003</td><td>93.184.216.34:443</td></tr>
      </tbody>
    </table>
    <div class="info-box" style="margin-top:14px">The router maintains a <strong>NAT translation table</strong> mapping each internal {IP:Port} to a unique external {IP:Port} to correctly route return packets.</div>
  </div>
</section>

<!-- ===== CIDR ===== -->
<section id="cidr" class="section">
  <div class="section-header">
    <div class="section-icon">üóÇÔ∏è</div>
    <div>
      <h2>CIDR ‚Äî Classless Inter-Domain Routing</h2>
      <p>Flexible prefix-based addressing that replaced classful networking</p>
    </div>
  </div>

  <div class="card">
    <h3>üìñ What is CIDR?</h3>
    <p>Introduced in 1993 (RFC 1519/4632), CIDR replaced classful addressing to slow IPv4 exhaustion. Instead of fixed class boundaries, CIDR uses a variable-length subnet mask (VLSM) denoted by a <strong>slash notation</strong> (e.g., /20).</p>
    <div class="info-box"><strong>CIDR Notation:</strong> 192.168.10.0<strong>/24</strong> ‚Äî The /24 means 24 bits are the network prefix, leaving 8 bits for hosts.</div>
  </div>

  <div class="grid-2">
    <div class="card">
      <h3>üî¢ CIDR Aggregation (Supernetting)</h3>
      <p>CIDR enables route summarization ‚Äî combining multiple contiguous networks into one route entry to reduce routing table size.</p>
      <div class="binary-visualizer" style="font-size:0.85rem">
        <div style="margin-bottom:8px"><strong>Aggregating four /24s into one /22:</strong></div>
        <div>192.168.0.0/24</div>
        <div>192.168.1.0/24</div>
        <div>192.168.2.0/24</div>
        <div>192.168.3.0/24</div>
        <div style="border-top:2px solid var(--blue);margin-top:8px;padding-top:8px;color:var(--blue-dark);font-weight:700">= 192.168.0.0/22 (4 √ó /24 summarized)</div>
      </div>
    </div>
    <div class="card">
      <h3>‚úÇÔ∏è VLSM ‚Äî Variable Length Subnet Masking</h3>
      <p>VLSM lets you allocate differently-sized subnets from the same address space ‚Äî allocating exactly what each segment needs.</p>
      <div class="binary-visualizer" style="font-size:0.85rem">
        <div style="margin-bottom:8px"><strong>From 10.1.0.0/16:</strong></div>
        <div>üè¢ HQ LAN: 10.1.0.0/<strong>22</strong> ‚Üí 1022 hosts</div>
        <div>üè¨ Branch: 10.1.4.0/<strong>24</strong> ‚Üí 254 hosts</div>
        <div>üîó WAN Link: 10.1.5.0/<strong>30</strong> ‚Üí 2 hosts</div>
        <div>üñ•Ô∏è Server: 10.1.5.4/<strong>29</strong> ‚Üí 6 hosts</div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>üìä Complete CIDR Reference Chart</h3>
    <div class="cidr-table-wrap">
      <table>
        <thead>
          <tr><th>CIDR</th><th>Subnet Mask</th><th>Wildcard Mask</th><th>Total IPs</th><th>Usable Hosts</th><th>Class Note</th></tr>
        </thead>
        <tbody id="cidrFullTable"></tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <h3>üßÆ CIDR Notation Converter</h3>
    <div class="calc-form">
      <div class="form-group">
        <label>Subnet Mask (dotted-decimal)</label>
        <input type="text" id="cidrMaskIn" value="255.255.255.0" placeholder="e.g. 255.255.255.0" oninput="convertCIDR()">
      </div>
      <div class="form-group">
        <label>CIDR Prefix</label>
        <input type="text" id="cidrPrefixIn" value="/24" placeholder="e.g. /24" oninput="convertCIDRFromPrefix()">
      </div>
    </div>
    <div id="cidrConvResult" class="info-box"></div>
  </div>
</section>

<!-- ===== QUIZ ===== -->
<section id="quiz" class="section">
  <div class="section-header">
    <div class="section-icon">‚úÖ</div>
    <div>
      <h2>Test Your Knowledge</h2>
      <p>20 questions covering all IPv4 topics</p>
    </div>
  </div>

  <div class="score-bar">
    <div>
      <div class="score-num" id="quizScore">0</div>
      <div class="score-label">Correct</div>
    </div>
    <div>
      <div class="score-num" id="quizTotal">0</div>
      <div class="score-label">Answered</div>
    </div>
    <div class="progress-bar-wrap">
      <div class="progress-bar-fill" id="quizProgress"></div>
    </div>
    <div>
      <div class="score-num" id="quizPct">0%</div>
      <div class="score-label">Score</div>
    </div>
    <button class="btn btn-red" onclick="resetQuiz()">‚Ü∫ Reset</button>
  </div>

  <div id="quizContainer"></div>
</section>

</main>

<footer>
  <strong>IPv4 Learning Simulator</strong> ‚Äî Moraine Valley Community College | Cybersecurity &amp; Networking Program<br>
  Educational resource for CompTIA Network+, CCNA, and cybersecurity workforce development
</footer>

<script>
// ===== NAVIGATION =====
function showSection(id, btn) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
}

// ===== BINARY UTILITIES =====
function decToBin(n, bits=8) {
  return (n >>> 0).toString(2).padStart(bits,'0');
}

function ipToBinary(ip) {
  return ip.split('.').map(o => decToBin(parseInt(o)));
}

function binaryToIp(bins) {
  return bins.map(b => parseInt(b,2)).join('.');
}

function cidrToMask(prefix) {
  let mask = 0xFFFFFFFF << (32 - prefix);
  return [(mask>>>24)&255,(mask>>>16)&255,(mask>>>8)&255,mask&255].join('.');
}

function maskToPrefix(mask) {
  return mask.split('.').map(o=>parseInt(o).toString(2)).join('').split('').filter(b=>b==='1').length;
}

function ipToNum(ip) {
  const p = ip.split('.').map(Number);
  return ((p[0]<<24)|(p[1]<<16)|(p[2]<<8)|p[3]) >>> 0;
}

function numToIp(n) {
  return [n>>>24,(n>>>16)&255,(n>>>8)&255,n&255].join('.');
}

// ===== BINARY DISPLAY =====
function makeBitSpan(bit, type) {
  return `<div class="bit ${bit==='1'?'one':'zero'} ${type}">${bit}</div>`;
}

function updateBinaryDisplay() {
  const ip = document.getElementById('ipInput').value.trim();
  const parts = ip.split('.');
  if(parts.length !== 4 || parts.some(p=>isNaN(p)||p<0||p>255)) return;
  const container = document.getElementById('binaryBits');
  let html = '';
  parts.forEach((p,i) => {
    const bin = decToBin(parseInt(p));
    html += '<div class="bit-group">';
    bin.split('').forEach(b => html += makeBitSpan(b,''));
    html += '</div>';
    if(i<3) html += '<div class="bv-sep">.</div>';
  });
  container.innerHTML = html;
}

function updateDecToBin() {
  const v = parseInt(document.getElementById('decInput').value);
  if(isNaN(v)||v<0||v>255) return;
  const bin = decToBin(v);
  let html = '<div class="bit-group" style="margin-bottom:6px">';
  bin.split('').forEach(b => html += makeBitSpan(b,''));
  html += '</div>';
  let weights = [128,64,32,16,8,4,2,1];
  let total = 0;
  let calc = [];
  bin.split('').forEach((b,i)=>{if(b==='1'){total+=weights[i];calc.push(weights[i]);}});
  document.getElementById('decBinResult').innerHTML =
    `Decimal: <strong>${v}</strong> &nbsp;‚Üí&nbsp; Binary: <strong>${bin}</strong><br>` + html +
    `<br>Calculation: ${calc.join(' + ') || '0'} = <strong>${total}</strong>`;
}

// ===== SUBNET CALCULATOR =====
function updateCIDRLabel() {
  const v = document.getElementById('cidrSlider').value;
  document.getElementById('cidrLabel').textContent = '/' + v;
  document.getElementById('svNet').style.flex = v;
  document.getElementById('svNet').textContent = `Network (${v})`;
  const h = 32-v;
  document.getElementById('svHost').style.flex = Math.max(h,1);
  document.getElementById('svHost').textContent = `Host (${h})`;
}

function calculateSubnet() {
  const ipStr = document.getElementById('subnetIP').value.trim();
  const prefix = parseInt(document.getElementById('cidrSlider').value);
  const parts = ipStr.split('.').map(Number);
  if(parts.length!==4||parts.some(p=>isNaN(p)||p<0||p>255)){alert('Invalid IP'); return;}

  const mask = cidrToMask(prefix);
  const ipNum = ipToNum(ipStr);
  const maskNum = ipToNum(mask);
  const wildcard = (~maskNum)>>>0;
  const network = (ipNum & maskNum)>>>0;
  const broadcast = (network | wildcard)>>>0;
  const firstHost = (network + 1)>>>0;
  const lastHost = (broadcast - 1)>>>0;
  const usableHosts = Math.max(0, Math.pow(2, 32-prefix) - 2);

  const results = [
    {label:'Network Address', value: numToIp(network)},
    {label:'Subnet Mask', value: mask},
    {label:'Wildcard Mask', value: numToIp(wildcard)},
    {label:'CIDR Notation', value: numToIp(network)+'/'+prefix},
    {label:'Broadcast Address', value: numToIp(broadcast), red:true},
    {label:'First Host', value: numToIp(firstHost)},
    {label:'Last Host', value: numToIp(lastHost)},
    {label:'Usable Hosts', value: usableHosts.toLocaleString(), red:true},
  ];

  const grid = document.getElementById('subnetResults');
  grid.style.display = 'grid';
  grid.innerHTML = results.map(r=>`
    <div class="result-item ${r.red?'red':''}">
      <div class="result-label">${r.label}</div>
      <div class="result-value">${r.value}</div>
    </div>`).join('');

  // Binary visualization
  const binDiv = document.getElementById('subnetBinary');
  binDiv.style.display = 'block';
  const ipBins = ipToBinary(numToIp(network));
  const maskBins = ipToBinary(mask);
  let rows = [
    {label:'Network', bins: ipBins.join(''), prefix},
    {label:'Subnet Mask', bins: maskBins.join(''), type:'mask'},
    {label:'Broadcast', bins: ipToBinary(numToIp(broadcast)).join(''), prefix, host:true}
  ];

  binDiv.innerHTML = '<div class="binary-visualizer">' + rows.map(r=>{
    let html = `<div class="bv-row"><div class="bv-label">${r.label}</div><div class="bv-bits">`;
    r.bins.split('').forEach((b,i)=>{
      const isNet = i < (r.prefix||0);
      let cls = '';
      if(r.type==='mask') cls = b==='1'?'network':'host';
      else if(r.prefix !== undefined) cls = isNet ? 'network' : (r.host?'host':'');
      html += `<div class="bit ${b==='1'?'one':'zero'} ${cls}">${b}</div>`;
      if((i+1)%8===0 && i<31) html += '<div class="bv-sep">.</div>';
    });
    html += '</div></div>';
    return html;
  }).join('') + '</div>';
}

// Build subnet ref table
function buildSubnetTable() {
  const tbody = document.getElementById('subnetRefTable');
  if(!tbody) return;
  const data = [
    ['/8','255.0.0.0','Class A'],
    ['/16','255.255.0.0','Class B'],
    ['/24','255.255.255.0','Class C'],
  ];
  const rows = [];
  for(let p=1;p<=30;p++){
    const mask = cidrToMask(p);
    const total = Math.pow(2,32-p);
    const hosts = Math.max(0,total-2);
    const wildcard = numToIp((~ipToNum(mask))>>>0);
    let cls = p<=8?'Class A equiv':(p<=16?'Class B equiv':(p<=24?'Class C equiv':'Subnet'));
    if(p===8) cls='Class A';
    if(p===16) cls='Class B';
    if(p===24) cls='Class C';
    rows.push(`<tr><td>/${p}</td><td>${mask}</td><td>${wildcard}</td><td>${total.toLocaleString()}</td><td>${hosts.toLocaleString()}</td><td>${cls}</td></tr>`);
  }
  tbody.innerHTML = rows.join('');
}

// Build CIDR full table
function buildCIDRTable() {
  const tbody = document.getElementById('cidrFullTable');
  if(!tbody) return;
  const rows = [];
  for(let p=8;p<=32;p++){
    const mask = p===32?'255.255.255.255':cidrToMask(p);
    const total = Math.pow(2,32-p);
    const hosts = Math.max(0,total-2);
    const wildcard = p===32?'0.0.0.0':numToIp((~ipToNum(mask))>>>0);
    let cls = p<8?'Supernet':(p===8?'Class A':(p<=15?'Class A sub':(p===16?'Class B':(p<=23?'Class B sub':(p===24?'Class C':(p<=30?'Subnet':'Host/P2P'))))));
    rows.push(`<tr><td>/${p}</td><td>${mask}</td><td>${wildcard}</td><td>${total.toLocaleString()}</td><td>${p>=31?p===32?'1 host':'2 hosts':hosts.toLocaleString()}</td><td>${cls}</td></tr>`);
  }
  tbody.innerHTML = rows.join('');
}

// ===== BROADCAST CALC =====
function calcBroadcast() {
  const input = document.getElementById('bcIP').value.trim();
  let ip, prefix;
  if(input.includes('/')) {
    [ip, prefix] = input.split('/');
    prefix = parseInt(prefix);
  } else {
    alert('Please enter in CIDR notation: x.x.x.x/prefix');
    return;
  }
  const maskNum = ipToNum(cidrToMask(prefix));
  const ipNum = ipToNum(ip);
  const network = (ipNum & maskNum)>>>0;
  const broadcast = (network | (~maskNum>>>0))>>>0;

  document.getElementById('bcResult').innerHTML = `
    <div class="result-grid">
      <div class="result-item"><div class="result-label">Network</div><div class="result-value">${numToIp(network)}</div></div>
      <div class="result-item red"><div class="result-label">Broadcast</div><div class="result-value">${numToIp(broadcast)}</div></div>
      <div class="result-item"><div class="result-label">Subnet Mask</div><div class="result-value">${cidrToMask(prefix)}</div></div>
      <div class="result-item"><div class="result-label">Total IPs</div><div class="result-value">${Math.pow(2,32-prefix)}</div></div>
    </div>`;

  // Walkthrough
  const netBin = ipToBinary(numToIp(network));
  const bcBin = ipToBinary(numToIp(broadcast));
  const maskBin = ipToBinary(cidrToMask(prefix));
  let html = '<div class="binary-visualizer">';
  html += '<div style="margin-bottom:10px;font-weight:700;color:var(--blue-dark)">Step-by-step binary calculation:</div>';
  const rows2 = [{label:'IP Address',b:ipToBinary(ip).join(''),p:prefix},{label:'Subnet Mask',b:maskBin.join(''),type:'mask'},{label:'Network Addr',b:netBin.join(''),p:prefix},{label:'Broadcast',b:bcBin.join(''),p:prefix,host:true}];
  rows2.forEach(r=>{
    html += `<div class="bv-row"><div class="bv-label">${r.label}</div><div class="bv-bits">`;
    r.b.split('').forEach((bit,i)=>{
      const n = i<(r.p||0);
      let cls = r.type==='mask'?(bit==='1'?'network':'host'):(r.p!==undefined?(n?'network':(r.host?'host':'')):'');
      html += `<div class="bit ${bit==='1'?'one':'zero'} ${cls}">${bit}</div>`;
      if((i+1)%8===0&&i<31) html += '<div class="bv-sep">.</div>';
    });
    html += '</div></div>';
  });
  html += '<div class="info-box" style="margin-top:12px"><strong>Broadcast Rule:</strong> Network Address bitwise OR with wildcard mask (NOT subnet mask) = all host bits set to 1</div></div>';
  document.getElementById('bcWalkthrough').innerHTML = html;
}

// ===== HOST RANGE =====
function calcHostRange() {
  let ip = document.getElementById('hrIP').value.trim();
  let cidr = document.getElementById('hrCIDR').value.trim();
  let prefix;
  if(cidr.startsWith('/')) prefix = parseInt(cidr.substring(1));
  else if(cidr.includes('.')) prefix = maskToPrefix(cidr);
  else prefix = parseInt(cidr);
  if(isNaN(prefix)||prefix<0||prefix>32){alert('Invalid prefix');return;}

  const maskNum = ipToNum(cidrToMask(prefix));
  const ipNum = ipToNum(ip);
  const network = (ipNum & maskNum)>>>0;
  const broadcast = (network|(~maskNum>>>0))>>>0;
  const first = network+1;
  const last = broadcast-1;
  const hosts = Math.max(0,Math.pow(2,32-prefix)-2);

  const div = document.getElementById('hrResult');
  div.style.display='grid';
  div.innerHTML = [
    {label:'Network Address',value:numToIp(network)},
    {label:'First Host',value:numToIp(first)},
    {label:'Last Host',value:numToIp(last)},
    {label:'Broadcast',value:numToIp(broadcast),red:true},
    {label:'Subnet Mask',value:cidrToMask(prefix)},
    {label:'CIDR',value:'/'+prefix},
    {label:'Total Addresses',value:Math.pow(2,32-prefix).toLocaleString()},
    {label:'Usable Hosts',value:hosts.toLocaleString(),red:true},
  ].map(r=>`<div class="result-item ${r.red?'red':''}"><div class="result-label">${r.label}</div><div class="result-value">${r.value}</div></div>`).join('');
}

// ===== CIDR CONVERTER =====
function convertCIDR() {
  const mask = document.getElementById('cidrMaskIn').value.trim();
  if(!mask.includes('.')){return;}
  try{
    const prefix = maskToPrefix(mask);
    const wildcard = numToIp((~ipToNum(mask))>>>0);
    document.getElementById('cidrPrefixIn').value='/'+prefix;
    document.getElementById('cidrConvResult').innerHTML = `Mask: <strong>${mask}</strong> ‚Üí CIDR: <strong>/${prefix}</strong> | Wildcard: <strong>${wildcard}</strong> | Host bits: <strong>${32-prefix}</strong> | Usable hosts: <strong>${Math.max(0,Math.pow(2,32-prefix)-2).toLocaleString()}</strong>`;
  }catch(e){}
}

function convertCIDRFromPrefix() {
  const val = document.getElementById('cidrPrefixIn').value.trim();
  const prefix = parseInt(val.replace('/',''));
  if(isNaN(prefix)||prefix<0||prefix>32) return;
  const mask = cidrToMask(prefix);
  const wildcard = numToIp((~ipToNum(mask))>>>0);
  document.getElementById('cidrMaskIn').value = mask;
  document.getElementById('cidrConvResult').innerHTML = `CIDR: <strong>/${prefix}</strong> ‚Üí Mask: <strong>${mask}</strong> | Wildcard: <strong>${wildcard}</strong> | Host bits: <strong>${32-prefix}</strong> | Usable hosts: <strong>${Math.max(0,Math.pow(2,32-prefix)-2).toLocaleString()}</strong>`;
}

// ===== QUIZ =====
const quizQuestions = [
  {q:"How many bits are in an IPv4 address?",opts:["16","32","64","128"],a:1,exp:"IPv4 uses 32-bit addresses, written as 4 octets (8 bits each)."},
  {q:"What is the broadcast address for the network 192.168.1.0/24?",opts:["192.168.1.0","192.168.1.1","192.168.1.255","192.168.255.255"],a:2,exp:"The last address in any subnet is the broadcast ‚Äî all host bits set to 1. For /24, that's .255."},
  {q:"Which subnet mask corresponds to /26?",opts:["255.255.255.128","255.255.255.192","255.255.255.224","255.255.255.240"],a:1,exp:"/26 means 26 network bits. Last octet = 11000000 = 128+64 = 192. ‚Üí 255.255.255.192"},
  {q:"How many usable host addresses are in a /28 subnet?",opts:["12","14","16","30"],a:1,exp:"2^(32-28) = 2^4 = 16 total. Minus 2 (network + broadcast) = 14 usable hosts."},
  {q:"What is the default subnet mask for a Class B network?",opts:["255.0.0.0","255.255.0.0","255.255.255.0","255.255.255.128"],a:1,exp:"Class B networks use the first 16 bits for the network, giving a default mask of 255.255.0.0 (/16)."},
  {q:"What address range is reserved for Class A private networks?",opts:["10.0.0.0 ‚Äì 10.255.255.255","172.16.0.0 ‚Äì 172.31.255.255","192.168.0.0 ‚Äì 192.168.255.255","169.254.0.0 ‚Äì 169.254.255.255"],a:0,exp:"RFC 1918 defines 10.0.0.0/8 as the private Class A range."},
  {q:"What does TTL stand for in an IPv4 header?",opts:["Total Transmission Length","Time To Live","Transfer Traffic Layer","Transmission Type Limit"],a:1,exp:"TTL (Time To Live) is decremented by each router. When it reaches 0, the packet is discarded to prevent routing loops."},
  {q:"What type of NAT allows multiple internal hosts to share a single public IP using port numbers?",opts:["Static NAT","Dynamic NAT","PAT / NAT Overload","Bidirectional NAT"],a:2,exp:"PAT (Port Address Translation) / NAT Overload uses unique port numbers to track sessions, enabling many-to-one address translation."},
  {q:"What is the loopback address in IPv4?",opts:["0.0.0.0","192.168.0.1","127.0.0.1","255.255.255.255"],a:2,exp:"127.0.0.1 is the loopback/localhost address, used to test the TCP/IP stack locally without sending packets on the network."},
  {q:"In CIDR notation, what does the '/24' in 10.0.0.0/24 represent?",opts:["24 host bits","24 network bits","24 usable hosts","Subnet mask 255.255.0.0"],a:1,exp:"The number after the slash in CIDR notation indicates how many bits (from left) are the network prefix."},
  {q:"Which IP address class covers the range 128.0.0.0 ‚Äì 191.255.255.255?",opts:["Class A","Class B","Class C","Class D"],a:1,exp:"Class B addresses start with binary '10', giving a first-octet range of 128‚Äì191."},
  {q:"What is the network address for host 172.16.50.100 with mask 255.255.0.0?",opts:["172.16.0.0","172.16.50.0","172.0.0.0","172.16.255.255"],a:0,exp:"172.16.50.100 AND 255.255.0.0 = 172.16.0.0. The last two octets are zeroed out."},
  {q:"Which protocol number identifies TCP in an IPv4 header?",opts:["1","6","17","41"],a:1,exp:"Protocol 6 = TCP. Protocol 17 = UDP. Protocol 1 = ICMP. Protocol 41 = IPv6 in IPv4 (tunneling)."},
  {q:"What is the purpose of the wildcard mask?",opts:["Identifies the network portion","Inverts the subnet mask; used in ACLs","Calculates the broadcast","Defines the host range"],a:1,exp:"The wildcard mask is the bitwise inverse of the subnet mask. It's used in Cisco ACLs and OSPF to specify matching criteria."},
  {q:"How many usable hosts are possible in a /30 subnet?",opts:["2","4","6","30"],a:0,exp:"2^(32-30) = 4 total addresses. Minus network and broadcast = 2 usable hosts. Ideal for point-to-point WAN links."},
  {q:"What RFC introduced private IPv4 address space?",opts:["RFC 791","RFC 1918","RFC 3022","RFC 4632"],a:1,exp:"RFC 1918 (1996) defines three ranges of private addresses: 10/8, 172.16/12, and 192.168/16."},
  {q:"What is APIPA and which range does it use?",opts:["Auto Private IP Addressing; 169.254.0.0/16","Advanced Protocol IP Allocation; 172.31.0.0/16","Automatic Private Internet Access; 10.0.0.0/8","Assigned Private IP Addressing; 192.168.0.0/16"],a:0,exp:"APIPA (Automatic Private IP Addressing) assigns 169.254.x.x addresses when DHCP is unavailable. Range: 169.254.0.0/16."},
  {q:"What is the maximum possible value for any single octet in an IPv4 address?",opts:["127","128","255","256"],a:2,exp:"An octet is 8 bits. Maximum is 11111111 in binary = 255 decimal. Zero (00000000) is minimum."},
  {q:"Which CIDR prefix provides exactly 254 usable host addresses?",opts:["/23","/24","/25","/26"],a:1,exp:"A /24 subnet has 2^8 = 256 total addresses minus 2 = 254 usable hosts."},
  {q:"What is the primary benefit of CIDR over classful addressing?",opts:["Faster routing","Flexible prefix lengths reduce address waste","More security","Support for IPv6"],a:1,exp:"CIDR allows variable-length subnet masks (VLSM), enabling efficient address allocation and route aggregation to combat IPv4 exhaustion."}
];

let quizState = {};

function buildQuiz() {
  const container = document.getElementById('quizContainer');
  container.innerHTML = quizQuestions.map((q,i)=>`
    <div class="quiz-card" id="qcard${i}">
      <div class="question">Q${i+1}. ${q.q}</div>
      <div class="quiz-options">
        ${q.opts.map((o,j)=>`<button class="quiz-option" onclick="answerQuiz(${i},${j})" id="qopt${i}_${j}">${String.fromCharCode(65+j)}. ${o}</button>`).join('')}
      </div>
      <div class="quiz-feedback" id="qfb${i}"></div>
    </div>`).join('');
  quizState = {answered:0, correct:0, done:new Set()};
}

function answerQuiz(qi, chosen) {
  if(quizState.done.has(qi)) return;
  quizState.done.add(qi);
  const q = quizQuestions[qi];
  const isCorrect = chosen === q.a;
  if(isCorrect) quizState.correct++;
  quizState.answered++;

  q.opts.forEach((_,j)=>{
    const btn = document.getElementById(`qopt${qi}_${j}`);
    btn.disabled = true;
    if(j===q.a) btn.classList.add('correct');
    else if(j===chosen && !isCorrect) btn.classList.add('incorrect');
  });

  const fb = document.getElementById(`qfb${qi}`);
  fb.className = `quiz-feedback show ${isCorrect?'correct':'incorrect'}`;
  fb.innerHTML = (isCorrect ? '‚úÖ Correct! ' : '‚ùå Incorrect. ') + q.exp;

  const pct = Math.round((quizState.correct/quizState.answered)*100);
  document.getElementById('quizScore').textContent = quizState.correct;
  document.getElementById('quizTotal').textContent = quizState.answered;
  document.getElementById('quizPct').textContent = pct+'%';
  document.getElementById('quizProgress').style.width = (quizState.answered/quizQuestions.length*100)+'%';
}

function resetQuiz() {
  buildQuiz();
  document.getElementById('quizScore').textContent='0';
  document.getElementById('quizTotal').textContent='0';
  document.getElementById('quizPct').textContent='0%';
  document.getElementById('quizProgress').style.width='0%';
}

// ===== CLASS TABS =====
function switchClassTab(id, btn) {
  document.querySelectorAll('#classes .tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('#classes .tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('classtab-' + id).classList.add('active');
  btn.classList.add('active');
  if(id === 'identifier' && cgState.currentIP === null) nextClassQuestion();
}

// ===== CLASS IDENTIFICATION GAME =====
const cgState = {
  correct: 0, wrong: 0, streak: 0, total: 0,
  currentIP: null, currentClass: null,
  answered: false, history: [],
  difficulty: 'all' // 'all' | 'abc' | 'de'
};

const classColors = {
  A: '#0d2d6b', B: '#1a4fa0', C: '#2563c7', D: '#c0152a', E: '#8b0e1e'
};

const classInfo = {
  A: { range: '1 ‚Äì 126', mask: '255.0.0.0 (/8)', bits: '0xxxxxxx', desc: 'Large enterprise networks' },
  B: { range: '128 ‚Äì 191', mask: '255.255.0.0 (/16)', bits: '10xxxxxx', desc: 'Medium-sized networks' },
  C: { range: '192 ‚Äì 223', mask: '255.255.255.0 (/24)', bits: '110xxxxx', desc: 'Small networks / LANs' },
  D: { range: '224 ‚Äì 239', mask: 'N/A (Multicast)', bits: '1110xxxx', desc: 'Multicast groups' },
  E: { range: '240 ‚Äì 255', mask: 'N/A (Reserved)', bits: '11110xxx', desc: 'Experimental / Research' }
};

function getIPClass(firstOctet) {
  if(firstOctet >= 1   && firstOctet <= 126) return 'A';
  if(firstOctet >= 128 && firstOctet <= 191) return 'B';
  if(firstOctet >= 192 && firstOctet <= 223) return 'C';
  if(firstOctet >= 224 && firstOctet <= 239) return 'D';
  if(firstOctet >= 240 && firstOctet <= 255) return 'E';
  return null; // 0 or 127 ‚Äî skip
}

function generateRandomIP(difficulty) {
  let firstOctet;
  // Weight distribution: more A/B/C, occasional D/E
  const r = Math.random();
  if(difficulty === 'abc') {
    const pick = Math.floor(Math.random() * 3);
    if(pick === 0) firstOctet = 1  + Math.floor(Math.random() * 126);  // A
    else if(pick === 1) firstOctet = 128 + Math.floor(Math.random() * 64);   // B
    else firstOctet = 192 + Math.floor(Math.random() * 32);  // C
  } else if(difficulty === 'de') {
    firstOctet = r < 0.5
      ? 224 + Math.floor(Math.random() * 16)   // D
      : 240 + Math.floor(Math.random() * 15);  // E
  } else {
    // All classes weighted: A 35%, B 25%, C 25%, D 8%, E 7%
    if(r < 0.35)      firstOctet = 1  + Math.floor(Math.random() * 126);
    else if(r < 0.60) firstOctet = 128 + Math.floor(Math.random() * 64);
    else if(r < 0.85) firstOctet = 192 + Math.floor(Math.random() * 32);
    else if(r < 0.93) firstOctet = 224 + Math.floor(Math.random() * 16);
    else              firstOctet = 240 + Math.floor(Math.random() * 15);
  }
  const o2 = Math.floor(Math.random() * 256);
  const o3 = Math.floor(Math.random() * 256);
  const o4 = Math.floor(Math.random() * 255) + 1;
  return `${firstOctet}.${o2}.${o3}.${o4}`;
}

function nextClassQuestion() {
  cgState.answered = false;
  document.getElementById('cg-next-btn').style.display = 'none';
  document.getElementById('cg-feedback').style.display = 'none';
  document.getElementById('cg-hint-box').style.display = 'none';

  // Re-enable buttons, reset styles
  document.querySelectorAll('.cg-class-btn').forEach(b => {
    b.disabled = false;
    b.className = 'cg-class-btn';
  });

  const ip = generateRandomIP(cgState.difficulty);
  const parts = ip.split('.').map(Number);
  const cls = getIPClass(parts[0]);
  cgState.currentIP = ip;
  cgState.currentClass = cls;

  // Display IP with animation
  const ipEl = document.getElementById('cg-ip-text');
  ipEl.style.animation = 'none';
  ipEl.offsetHeight; // reflow
  ipEl.style.animation = 'ip-appear 0.35s ease';
  ipEl.textContent = ip;

  // Octet pills
  const pillsEl = document.getElementById('cg-octet-pills');
  pillsEl.innerHTML = parts.map((p,i) =>
    `<span style="display:inline-flex;align-items:center;gap:4px">
      ${i>0?'<span style="color:var(--gray-400);font-weight:700;font-size:1.1rem">.</span>':''}
      <span style="
        display:inline-block;padding:${i===0?'5px 16px':'4px 12px'};border-radius:20px;
        font-family:var(--font-mono);font-size:${i===0?'1rem':'0.82rem'};font-weight:700;
        background:${i===0?'var(--blue-dark)':'var(--gray-200)'};
        color:${i===0?'white':'var(--gray-600)'};
        ${i===0?'box-shadow:0 2px 8px rgba(13,45,107,0.4)':''}
      ">${p}${i===0?'&nbsp;<span style="font-size:0.65rem;opacity:0.7">‚Üê key!</span>':''}</span>
    </span>`
  ).join('');

  // Binary hint for first octet (hidden initially)
  const binFirst = decToBin(parts[0]);
  document.getElementById('cg-binary-hint').innerHTML =
    `<span style="font-family:var(--font-mono);color:var(--gray-600)">First octet binary: </span>
     <span style="font-family:var(--font-mono);font-weight:700;color:var(--blue-dark)">${binFirst}</span>`;

  // Update hint box content
  document.getElementById('cg-hint-box').innerHTML =
    `üîë <strong>Hint:</strong> First octet = <strong style="font-family:var(--font-mono)">${parts[0]}</strong> (binary: <strong style="font-family:var(--font-mono)">${binFirst}</strong>)<br>
     Check the ranges: 1‚Äì126 = A &nbsp;|&nbsp; 128‚Äì191 = B &nbsp;|&nbsp; 192‚Äì223 = C &nbsp;|&nbsp; 224‚Äì239 = D &nbsp;|&nbsp; 240‚Äì255 = E`;
}

function submitClassAnswer(chosen) {
  if(cgState.answered) return;
  cgState.answered = true;
  cgState.total++;
  const correct = cgState.currentClass;
  const isCorrect = chosen === correct;
  const parts = cgState.currentIP.split('.').map(Number);

  // Update counts
  if(isCorrect) { cgState.correct++; cgState.streak++; }
  else { cgState.wrong++; cgState.streak = 0; }

  // Style buttons
  document.querySelectorAll('.cg-class-btn').forEach(b => {
    b.disabled = true;
    if(b.dataset.class === correct) b.classList.add('correct-ans');
    if(b.dataset.class === chosen && !isCorrect) b.classList.add('wrong-ans');
  });

  // Feedback
  const fb = document.getElementById('cg-feedback');
  fb.style.display = 'block';
  const info = classInfo[correct];
  fb.style.cssText = `display:block;border-radius:10px;padding:16px 20px;margin-bottom:16px;text-align:left;
    background:${isCorrect ? '#dcfce7' : 'var(--red-light)'};
    border:1px solid ${isCorrect ? '#86efac' : '#fca5a5'};
    color:${isCorrect ? '#14532d' : 'var(--red-dark)'}`;

  fb.innerHTML = `
    <div style="font-size:1.1rem;font-weight:800;margin-bottom:8px">
      ${isCorrect ? '‚úÖ Correct!' : `‚ùå Incorrect ‚Äî the answer is Class ${correct}`}
      ${isCorrect && cgState.streak > 1 ? `<span style="margin-left:10px;font-size:0.85rem;background:#15803d;color:white;padding:2px 10px;border-radius:20px">üî• ${cgState.streak} streak!</span>` : ''}
    </div>
    <div style="font-size:0.9rem;line-height:1.8">
      <strong>${cgState.currentIP}</strong> ‚Üí First octet: <strong style="font-family:var(--font-mono)">${parts[0]}</strong>
      (binary: <strong style="font-family:var(--font-mono)">${decToBin(parts[0])}</strong>)<br>
      üìç Class <strong>${correct}</strong> range: <strong>${info.range}</strong> &nbsp;|&nbsp;
      Bit pattern: <strong style="font-family:var(--font-mono)">${info.bits}</strong><br>
      üñ•Ô∏è Default mask: <strong>${info.mask}</strong> &nbsp;|&nbsp; Use: ${info.desc}
    </div>`;

  // Scoreboard
  document.getElementById('cg-correct').textContent = cgState.correct;
  document.getElementById('cg-wrong').textContent = cgState.wrong;
  document.getElementById('cg-streak').textContent = cgState.streak;
  const pct = Math.round((cgState.correct / cgState.total) * 100);
  document.getElementById('cg-pct').textContent = pct + '%';

  // History
  addHistoryRow(cgState.currentIP, correct, chosen, isCorrect);

  document.getElementById('cg-next-btn').style.display = 'inline-block';
}

function addHistoryRow(ip, correct, chosen, isCorrect) {
  cgState.history.unshift({ ip, correct, chosen, isCorrect });
  const hEl = document.getElementById('cg-history');
  if(cgState.history.length === 1) hEl.innerHTML = '';
  const row = document.createElement('div');
  row.className = 'cg-history-row';
  row.innerHTML = `
    <span class="cg-hist-result ${isCorrect ? 'ok' : 'bad'}">${isCorrect ? '‚úÖ' : '‚ùå'}</span>
    <span class="cg-hist-ip">${ip}</span>
    <span class="cg-hist-label">1st octet: <strong>${ip.split('.')[0]}</strong></span>
    <span style="font-size:0.8rem;font-weight:700;padding:2px 10px;border-radius:20px;background:${classColors[correct]};color:white">Class ${correct}</span>
    ${!isCorrect ? `<span style="font-size:0.75rem;color:var(--gray-600)">You said: <strong>Class ${chosen}</strong></span>` : ''}`;
  hEl.insertBefore(row, hEl.firstChild);
  document.getElementById('cg-history-count').textContent = cgState.history.length + ' question' + (cgState.history.length !== 1 ? 's' : '');
}

function toggleHint() {
  const h = document.getElementById('cg-hint-box');
  h.style.display = h.style.display === 'none' ? 'block' : 'none';
}

function resetClassGame() {
  cgState.correct = 0; cgState.wrong = 0; cgState.streak = 0; cgState.total = 0;
  cgState.history = []; cgState.currentIP = null; cgState.answered = false;
  document.getElementById('cg-correct').textContent = '0';
  document.getElementById('cg-wrong').textContent = '0';
  document.getElementById('cg-streak').textContent = '0';
  document.getElementById('cg-pct').textContent = '‚Äî';
  document.getElementById('cg-history').innerHTML = '<p style="color:var(--gray-400);font-size:0.88rem;text-align:center;padding:20px">Your answer history will appear here.</p>';
  document.getElementById('cg-history-count').textContent = '0 questions';
  nextClassQuestion();
}

function toggleDifficulty() {
  const modes = ['all', 'abc', 'de'];
  const labels = { all: 'All Classes', abc: 'A / B / C Only', de: 'D / E Only' };
  const idx = modes.indexOf(cgState.difficulty);
  cgState.difficulty = modes[(idx + 1) % modes.length];
  document.getElementById('cg-diff-label').textContent = labels[cgState.difficulty];
  nextClassQuestion();
}

// ===== INIT =====
document.addEventListener('DOMContentLoaded', ()=>{
  updateBinaryDisplay();
  updateDecToBin();
  buildSubnetTable();
  buildCIDRTable();
  buildQuiz();
  convertCIDR();
});
</script>
</body>
</html>
