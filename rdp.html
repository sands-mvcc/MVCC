<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Remote Desktop Protocol (RDP) ‚Äî Interactive Learning Module</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=Sora:wght@300;400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f5f3ee;
    --bg2: #edeae2;
    --card: #ffffff;
    --accent: #1a4a8a;
    --accent2: #c0392b;
    --accent3: #27ae60;
    --accent4: #e67e22;
    --text: #1c1c1e;
    --text-muted: #5a5a6a;
    --border: #d4cfc4;
    --mono: 'IBM Plex Mono', monospace;
    --sans: 'Sora', sans-serif;
    --display: 'Playfair Display', serif;
    --shadow: 0 4px 24px rgba(0,0,0,0.08);
    --shadow-lg: 0 8px 40px rgba(0,0,0,0.13);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--sans);
    background: var(--bg);
    color: var(--text);
    line-height: 1.7;
  }

  /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
  nav {
    position: sticky; top: 0; z-index: 100;
    background: rgba(245,243,238,0.95);
    backdrop-filter: blur(8px);
    border-bottom: 2px solid var(--border);
    padding: 0 2rem;
    display: flex; align-items: center; gap: 0;
    overflow-x: auto;
    scrollbar-width: none;
  }
  nav::-webkit-scrollbar { display: none; }
  .nav-brand {
    font-family: var(--mono); font-weight: 600; font-size: .85rem;
    color: var(--accent); white-space: nowrap; padding: 1rem 1.5rem 1rem 0;
    border-right: 2px solid var(--border); margin-right: 1rem;
    letter-spacing: .05em;
  }
  nav a {
    text-decoration: none; color: var(--text-muted); font-size: .82rem;
    font-weight: 600; padding: 1.1rem .9rem; white-space: nowrap;
    border-bottom: 3px solid transparent; transition: all .2s;
    letter-spacing: .03em; text-transform: uppercase;
  }
  nav a:hover, nav a.active {
    color: var(--accent); border-bottom-color: var(--accent);
  }

  /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
  .hero {
    background: linear-gradient(135deg, #1a4a8a 0%, #0d2d5e 60%, #1a3a6a 100%);
    color: white; padding: 5rem 2rem 4rem;
    text-align: center; position: relative; overflow: hidden;
  }
  .hero::before {
    content: '';
    position: absolute; inset: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.04'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  }
  .hero-badge {
    display: inline-block;
    background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,.3);
    border-radius: 20px; padding: .35rem 1.1rem;
    font-family: var(--mono); font-size: .78rem; letter-spacing: .1em;
    margin-bottom: 1.5rem; text-transform: uppercase;
  }
  .hero h1 {
    font-family: var(--display); font-size: clamp(2.2rem,5vw,3.8rem);
    font-weight: 700; line-height: 1.15; margin-bottom: 1rem;
  }
  .hero h1 span { color: #7eb8ff; }
  .hero p {
    font-size: 1.1rem; opacity: .85; max-width: 640px; margin: 0 auto 2rem;
  }
  .hero-stats {
    display: flex; justify-content: center; gap: 3rem; flex-wrap: wrap;
  }
  .hero-stat { text-align: center; }
  .hero-stat strong { display: block; font-size: 1.8rem; font-family: var(--mono); }
  .hero-stat span { font-size: .8rem; opacity: .7; text-transform: uppercase; letter-spacing: .08em; }

  /* ‚îÄ‚îÄ SECTIONS ‚îÄ‚îÄ */
  section { padding: 4rem 2rem; max-width: 1100px; margin: 0 auto; }
  .section-header {
    display: flex; align-items: center; gap: 1rem; margin-bottom: 2.5rem;
  }
  .section-number {
    font-family: var(--mono); font-size: .78rem; font-weight: 600;
    color: var(--accent); background: #e8eef7; border-radius: 4px;
    padding: .25rem .6rem; letter-spacing: .08em;
  }
  .section-header h2 {
    font-family: var(--display); font-size: 1.9rem; font-weight: 700;
  }

  /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
  .card {
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 12px; padding: 1.8rem;
    box-shadow: var(--shadow); margin-bottom: 1.5rem;
    transition: transform .2s, box-shadow .2s;
  }
  .card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
  .card h3 { font-size: 1.1rem; font-weight: 700; margin-bottom: .75rem; color: var(--accent); }

  .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px,1fr)); gap: 1.5rem; }
  .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); gap: 1.5rem; }

  /* ‚îÄ‚îÄ OSI LAYERS ‚îÄ‚îÄ */
  .osi-stack { display: flex; flex-direction: column; gap: .5rem; }
  .osi-layer {
    display: flex; align-items: stretch; border-radius: 10px; overflow: hidden;
    border: 1.5px solid var(--border); cursor: pointer;
    transition: transform .15s, box-shadow .15s;
  }
  .osi-layer:hover { transform: translateX(4px); box-shadow: var(--shadow); }
  .osi-layer.active { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(26,74,138,.15); }
  .layer-num {
    width: 52px; min-width: 52px;
    display: flex; align-items: center; justify-content: center;
    font-family: var(--mono); font-weight: 600; font-size: 1.1rem; color: white;
  }
  .layer-body { flex: 1; padding: .8rem 1.1rem; background: var(--card); }
  .layer-name { font-weight: 700; font-size: .95rem; }
  .layer-sub { font-size: .8rem; color: var(--text-muted); }
  .layer-detail {
    display: none; padding: 1rem 1.1rem 1rem 1.4rem;
    background: #f0f4fa; border-top: 1px solid var(--border);
    font-size: .88rem; line-height: 1.6;
  }
  .layer-detail.show { display: block; }
  .rdp-badge {
    display: inline-block; background: var(--accent); color: white;
    border-radius: 4px; padding: .15rem .5rem; font-size: .72rem;
    font-family: var(--mono); margin-left: .5rem; vertical-align: middle;
  }

  /* Layer colors */
  .l7 .layer-num { background: #8e44ad; }
  .l6 .layer-num { background: #2980b9; }
  .l5 .layer-num { background: #1abc9c; }
  .l4 .layer-num { background: #27ae60; }
  .l3 .layer-num { background: #e67e22; }
  .l2 .layer-num { background: #c0392b; }
  .l1 .layer-num { background: #7f8c8d; }

  /* ‚îÄ‚îÄ PACKET FLOW ‚îÄ‚îÄ */
  .packet-flow {
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 12px; padding: 2rem; margin-bottom: 1.5rem;
  }
  .flow-steps {
    display: flex; align-items: center; flex-wrap: wrap; gap: .5rem;
    margin: 1.5rem 0;
  }
  .flow-step {
    background: var(--bg2); border: 1.5px solid var(--border);
    border-radius: 8px; padding: .6rem 1rem; font-size: .85rem;
    font-weight: 600; text-align: center; cursor: pointer;
    transition: all .2s; position: relative;
  }
  .flow-step:hover, .flow-step.active {
    background: var(--accent); color: white; border-color: var(--accent);
  }
  .flow-arrow { color: var(--text-muted); font-size: 1.2rem; }
  .flow-detail {
    background: #f0f4fa; border-radius: 8px; padding: 1.2rem;
    min-height: 80px; font-size: .9rem; line-height: 1.6;
    border-left: 4px solid var(--accent);
  }

  /* ‚îÄ‚îÄ HEADER BUILDER ‚îÄ‚îÄ */
  .builder-wrap {
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 12px; overflow: hidden; margin-bottom: 1.5rem;
  }
  .builder-toolbar {
    background: #1a4a8a; color: white; padding: .9rem 1.5rem;
    display: flex; align-items: center; justify-content: space-between;
    flex-wrap: wrap; gap: .5rem;
  }
  .builder-toolbar h3 { font-family: var(--mono); font-size: .95rem; }
  .btn {
    display: inline-flex; align-items: center; gap: .4rem;
    padding: .5rem 1.1rem; border-radius: 6px; border: none;
    cursor: pointer; font-family: var(--sans); font-weight: 600;
    font-size: .82rem; transition: all .2s; text-decoration: none;
  }
  .btn-primary { background: var(--accent); color: white; }
  .btn-primary:hover { background: #0d2d5e; }
  .btn-success { background: var(--accent3); color: white; }
  .btn-success:hover { background: #1e8449; }
  .btn-warning { background: var(--accent4); color: white; }
  .btn-warning:hover { background: #ca6f1e; }
  .btn-danger { background: var(--accent2); color: white; }
  .btn-danger:hover { background: #922b21; }
  .btn-light { background: rgba(255,255,255,.15); color: white; border: 1px solid rgba(255,255,255,.3); }
  .btn-light:hover { background: rgba(255,255,255,.25); }

  .builder-body { padding: 1.8rem; }
  .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap: 1.2rem; margin-bottom: 1.5rem; }
  .form-group label {
    display: block; font-size: .8rem; font-weight: 700; text-transform: uppercase;
    letter-spacing: .06em; color: var(--text-muted); margin-bottom: .4rem;
  }
  .form-group input, .form-group select {
    width: 100%; padding: .6rem .9rem; border: 1.5px solid var(--border);
    border-radius: 7px; font-family: var(--mono); font-size: .88rem;
    background: var(--bg); color: var(--text); transition: border .2s;
  }
  .form-group input:focus, .form-group select:focus {
    outline: none; border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(26,74,138,.1);
  }

  /* Packet visual */
  .packet-visual { margin: 1.5rem 0; }
  .packet-visual h4 { font-family: var(--mono); font-size: .85rem; color: var(--text-muted); margin-bottom: .75rem; }
  .packet-bytes {
    display: flex; flex-wrap: wrap; gap: 2px;
    background: #1c1c1e; border-radius: 8px; padding: 1rem;
    font-family: var(--mono); font-size: .8rem; line-height: 1.8;
  }
  .byte-group { display: flex; gap: 2px; }
  .byte {
    padding: .2rem .35rem; border-radius: 3px; cursor: pointer;
    transition: transform .15s; color: white;
  }
  .byte:hover { transform: scale(1.2); z-index: 1; position: relative; }
  .byte.field-version { background: #8e44ad; }
  .byte.field-flags { background: #2980b9; }
  .byte.field-channel { background: #27ae60; }
  .byte.field-length { background: #e67e22; }
  .byte.field-security { background: #c0392b; }
  .byte.field-pdu { background: #16a085; }
  .byte.field-mcs { background: #f39c12; }
  .byte.field-data { background: #555; }

  .legend { display: flex; flex-wrap: wrap; gap: .6rem; margin-top: .75rem; }
  .legend-item {
    display: flex; align-items: center; gap: .4rem; font-size: .78rem;
  }
  .legend-dot { width: 12px; height: 12px; border-radius: 3px; }

  /* Field description */
  .field-info {
    background: #f0f4fa; border-radius: 8px; padding: 1rem 1.2rem;
    min-height: 60px; font-size: .88rem; border-left: 4px solid var(--accent);
    margin-top: 1rem;
  }

  /* Hex output */
  .hex-output {
    background: #1c1c1e; color: #7eb8ff; border-radius: 8px;
    padding: 1.2rem; font-family: var(--mono); font-size: .82rem;
    word-break: break-all; line-height: 2; margin-top: 1rem;
  }
  .hex-label {
    font-size: .75rem; text-transform: uppercase; letter-spacing: .08em;
    color: var(--text-muted); margin-bottom: .4rem; font-family: var(--mono);
  }

  /* ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ */
  .quiz-card {
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 12px; padding: 2rem; margin-bottom: 1.5rem;
  }
  .quiz-q {
    font-size: 1rem; font-weight: 600; margin-bottom: 1.2rem;
    padding-bottom: 1rem; border-bottom: 1px solid var(--border);
  }
  .quiz-q .q-num {
    font-family: var(--mono); font-size: .75rem; color: var(--accent);
    background: #e8eef7; padding: .2rem .5rem; border-radius: 4px;
    margin-right: .6rem;
  }
  .options { display: flex; flex-direction: column; gap: .6rem; }
  .option {
    display: flex; align-items: center; gap: .75rem;
    padding: .75rem 1rem; border-radius: 8px;
    border: 1.5px solid var(--border); cursor: pointer;
    transition: all .15s; font-size: .92rem;
  }
  .option:hover:not(.disabled) { border-color: var(--accent); background: #e8eef7; }
  .option.correct { background: #e9f7ef; border-color: #27ae60; color: #1e8449; }
  .option.incorrect { background: #fdf2f0; border-color: #c0392b; color: #922b21; }
  .option.disabled { cursor: not-allowed; opacity: .7; }
  .option-letter {
    width: 28px; min-width: 28px; height: 28px;
    background: var(--bg2); border-radius: 6px;
    display: flex; align-items: center; justify-content: center;
    font-family: var(--mono); font-size: .8rem; font-weight: 700;
  }
  .option.correct .option-letter { background: #27ae60; color: white; }
  .option.incorrect .option-letter { background: #c0392b; color: white; }
  .feedback {
    margin-top: 1rem; padding: .9rem 1.2rem; border-radius: 8px;
    font-size: .88rem; display: none;
  }
  .feedback.show { display: block; }
  .feedback.correct { background: #e9f7ef; color: #1e8449; border-left: 4px solid #27ae60; }
  .feedback.incorrect { background: #fdf2f0; color: #922b21; border-left: 4px solid #c0392b; }
  .score-bar {
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 12px; padding: 1.5rem 2rem;
    display: flex; align-items: center; gap: 1.5rem; flex-wrap: wrap;
  }
  .score-num { font-family: var(--display); font-size: 2.5rem; color: var(--accent); }
  .score-label { font-size: .85rem; color: var(--text-muted); }
  .progress-track {
    flex: 1; min-width: 200px; height: 10px; background: var(--bg2);
    border-radius: 999px; overflow: hidden;
  }
  .progress-fill {
    height: 100%; background: linear-gradient(90deg, var(--accent), #2980b9);
    border-radius: 999px; transition: width .4s ease;
  }

  /* ‚îÄ‚îÄ GLOSSARY ‚îÄ‚îÄ */
  .glossary-search {
    display: flex; gap: .75rem; margin-bottom: 1.5rem;
  }
  .glossary-search input {
    flex: 1; padding: .7rem 1.1rem; border: 1.5px solid var(--border);
    border-radius: 8px; font-family: var(--sans); font-size: .92rem;
    background: var(--card);
  }
  .glossary-search input:focus { outline: none; border-color: var(--accent); }
  .term-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px,1fr)); gap: 1rem; }
  .term-card {
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 10px; padding: 1.1rem 1.3rem; transition: all .2s;
  }
  .term-card:hover { border-color: var(--accent); box-shadow: var(--shadow); }
  .term-card.hidden { display: none; }
  .term-name {
    font-family: var(--mono); font-weight: 600; color: var(--accent);
    font-size: .9rem; margin-bottom: .4rem;
  }
  .term-def { font-size: .85rem; color: var(--text-muted); line-height: 1.5; }

  /* ‚îÄ‚îÄ PORT TABLE ‚îÄ‚îÄ */
  table { width: 100%; border-collapse: collapse; font-size: .9rem; }
  th {
    background: var(--accent); color: white; text-align: left;
    padding: .75rem 1rem; font-size: .8rem; text-transform: uppercase;
    letter-spacing: .06em;
  }
  td { padding: .7rem 1rem; border-bottom: 1px solid var(--border); }
  tr:last-child td { border-bottom: none; }
  tr:nth-child(even) td { background: var(--bg2); }
  .port-badge {
    font-family: var(--mono); background: #e8eef7; color: var(--accent);
    padding: .2rem .5rem; border-radius: 4px; font-size: .82rem;
  }

  /* ‚îÄ‚îÄ SECURITY ‚îÄ‚îÄ */
  .threat-card {
    border-radius: 10px; padding: 1.3rem 1.5rem; margin-bottom: 1rem;
    border-left: 5px solid;
  }
  .threat-critical { background: #fdf2f0; border-color: #c0392b; }
  .threat-high { background: #fef9e7; border-color: #e67e22; }
  .threat-medium { background: #eaf4fb; border-color: #2980b9; }
  .threat-card h4 { font-weight: 700; margin-bottom: .4rem; font-size: .95rem; }
  .severity {
    display: inline-block; padding: .15rem .55rem; border-radius: 4px;
    font-size: .72rem; font-weight: 700; text-transform: uppercase;
    font-family: var(--mono); margin-bottom: .5rem; letter-spacing: .05em;
  }
  .sev-critical { background: #c0392b; color: white; }
  .sev-high { background: #e67e22; color: white; }
  .sev-medium { background: #2980b9; color: white; }

  /* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
  .tabs { display: flex; gap: 0; border-bottom: 2px solid var(--border); margin-bottom: 1.5rem; flex-wrap: wrap; }
  .tab-btn {
    padding: .7rem 1.4rem; border: none; background: transparent;
    cursor: pointer; font-family: var(--sans); font-size: .88rem;
    font-weight: 600; color: var(--text-muted); border-bottom: 3px solid transparent;
    margin-bottom: -2px; transition: all .2s; text-transform: uppercase;
    letter-spacing: .05em;
  }
  .tab-btn:hover { color: var(--accent); }
  .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }
  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  /* ‚îÄ‚îÄ TOOLTIP ‚îÄ‚îÄ */
  [data-tip] { position: relative; cursor: help; }
  [data-tip]::after {
    content: attr(data-tip);
    position: absolute; bottom: calc(100% + 6px); left: 50%; transform: translateX(-50%);
    background: #1c1c1e; color: white; padding: .4rem .8rem; border-radius: 6px;
    font-size: .78rem; white-space: nowrap; pointer-events: none;
    opacity: 0; transition: opacity .2s; z-index: 999;
    font-family: var(--sans); font-weight: 400;
  }
  [data-tip]:hover::after { opacity: 1; }

  /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
  footer {
    background: #1c1c1e; color: #aaa; text-align: center;
    padding: 2rem; font-size: .82rem; margin-top: 4rem;
  }
  footer strong { color: white; }

  /* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
  @keyframes slideIn { from { opacity:0; transform: translateY(16px); } to { opacity:1; transform: translateY(0); } }
  .animate-in { animation: slideIn .4s ease both; }

  @media (max-width: 600px) {
    section { padding: 2.5rem 1rem; }
    .hero { padding: 3rem 1rem 2.5rem; }
    .hero h1 { font-size: 2rem; }
  }
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="nav-brand">RDP // TCP 3389</div>
  <a href="#overview" class="active" onclick="setActive(this)">Overview</a>
  <a href="#osi" onclick="setActive(this)">OSI Model</a>
  <a href="#architecture" onclick="setActive(this)">Architecture</a>
  <a href="#header-builder" onclick="setActive(this)">Header Builder</a>
  <a href="#security" onclick="setActive(this)">Security</a>
  <a href="#glossary" onclick="setActive(this)">Glossary</a>
  <a href="#quiz" onclick="setActive(this)">Quiz</a>
</nav>

<!-- HERO -->
<div class="hero">
  <div class="hero-badge">üì° Network Administration ‚Äî Interactive Lesson</div>
  <h1>Remote Desktop <span>Protocol</span></h1>
  <p>A comprehensive exploration of RDP ‚Äî from OSI layer mapping to packet structure, security vulnerabilities, and hands-on header construction.</p>
  <div class="hero-stats">
    <div class="hero-stat"><strong>TCP/3389</strong><span>Default Port</span></div>
    <div class="hero-stat"><strong>7 Layers</strong><span>OSI Mapping</span></div>
    <div class="hero-stat"><strong>TLS 1.3</strong><span>Encryption</span></div>
    <div class="hero-stat"><strong>CredSSP</strong><span>Auth Protocol</span></div>
  </div>
</div>

<!-- ‚îÄ‚îÄ SECTION 1: OVERVIEW ‚îÄ‚îÄ -->
<section id="overview">
  <div class="section-header">
    <span class="section-number">01</span>
    <h2>Protocol Overview</h2>
  </div>

  <div class="grid-2">
    <div class="card">
      <h3>üñ•Ô∏è What is RDP?</h3>
      <p>Remote Desktop Protocol (RDP) is a proprietary protocol developed by Microsoft that provides a user with a graphical interface to connect to another computer over a network connection. It transmits the display output from the remote computer and sends keyboard/mouse input from the client.</p>
      <p style="margin-top:.8rem">RDP operates primarily on <strong>TCP port 3389</strong> (and optionally UDP 3389 for enhanced performance) and supports features like clipboard sharing, file transfer, audio redirection, and multi-monitor support.</p>
    </div>
    <div class="card">
      <h3>üìÖ History & Evolution</h3>
      <ul style="list-style:none;display:flex;flex-direction:column;gap:.6rem">
        <li style="display:flex;gap:.8rem"><span style="background:#e8eef7;border-radius:4px;padding:.1rem .5rem;font-family:var(--mono);font-size:.78rem;color:var(--accent);white-space:nowrap">1998</span> <span>RDP 4.0 introduced with Windows NT 4.0 Terminal Server Edition</span></li>
        <li style="display:flex;gap:.8rem"><span style="background:#e8eef7;border-radius:4px;padding:.1rem .5rem;font-family:var(--mono);font-size:.78rem;color:var(--accent);white-space:nowrap">2002</span> <span>RDP 5.2 ‚Äî Windows Server 2003, introduced NLA precursors</span></li>
        <li style="display:flex;gap:.8rem"><span style="background:#e8eef7;border-radius:4px;padding:.1rem .5rem;font-family:var(--mono);font-size:.78rem;color:var(--accent);white-space:nowrap">2008</span> <span>RDP 6.1 ‚Äî Remote Apps, NLA, CredSSP introduced</span></li>
        <li style="display:flex;gap:.8rem"><span style="background:#e8eef7;border-radius:4px;padding:.1rem .5rem;font-family:var(--mono);font-size:.78rem;color:var(--accent);white-space:nowrap">2012</span> <span>RDP 8.0 ‚Äî RemoteFX vGPU, adaptive graphics</span></li>
        <li style="display:flex;gap:.8rem"><span style="background:#e8eef7;border-radius:4px;padding:.1rem .5rem;font-family:var(--mono);font-size:.78rem;color:var(--accent);white-space:nowrap">2022+</span> <span>RDP 10.x ‚Äî TLS 1.3, improved compression, Azure Virtual Desktop</span></li>
      </ul>
    </div>
  </div>

  <div class="grid-3">
    <div class="card" style="border-top:4px solid #8e44ad">
      <h3>üîë Key Features</h3>
      <p style="font-size:.88rem">Graphical remote access ‚Ä¢ Clipboard sync ‚Ä¢ File transfer ‚Ä¢ Audio/video redirection ‚Ä¢ Printer redirection ‚Ä¢ Smart card auth ‚Ä¢ Multi-monitor ‚Ä¢ RemoteApp</p>
    </div>
    <div class="card" style="border-top:4px solid var(--accent)">
      <h3>‚öôÔ∏è Core Components</h3>
      <p style="font-size:.88rem">RDP Client (mstsc.exe) ‚Ä¢ Remote Desktop Services (RDS) ‚Ä¢ Connection Broker ‚Ä¢ Session Host ‚Ä¢ Virtual Channel Manager ‚Ä¢ MCS Transport Layer</p>
    </div>
    <div class="card" style="border-top:4px solid var(--accent3)">
      <h3>üìã Admin Skills Required</h3>
      <p style="font-size:.88rem">Port configuration & firewall rules ‚Ä¢ NLA enforcement ‚Ä¢ Group Policy for RDP ‚Ä¢ Certificate management ‚Ä¢ Network Level Authentication ‚Ä¢ Session monitoring</p>
    </div>
  </div>

  <div class="card" style="background:#f5f9ff;border-color:#b8d0ed">
    <h3>üìä Port Reference Table</h3>
    <div style="overflow-x:auto;margin-top:.75rem">
      <table>
        <thead><tr><th>Port</th><th>Protocol</th><th>Service</th><th>Description</th><th>Status</th></tr></thead>
        <tbody>
          <tr><td><span class="port-badge">3389</span></td><td>TCP</td><td>RDP</td><td>Primary remote desktop connection</td><td>‚úÖ Required</td></tr>
          <tr><td><span class="port-badge">3389</span></td><td>UDP</td><td>RDP</td><td>Enhanced performance, optional</td><td>‚ö™ Optional</td></tr>
          <tr><td><span class="port-badge">443</span></td><td>TCP</td><td>RD Gateway</td><td>HTTPS tunneling of RDP traffic</td><td>üîí Secure</td></tr>
          <tr><td><span class="port-badge">3391</span></td><td>UDP</td><td>RD Gateway</td><td>UDP transport for RD Gateway</td><td>‚ö™ Optional</td></tr>
          <tr><td><span class="port-badge">3388</span></td><td>TCP</td><td>Legacy RDP</td><td>Older alternate port (deprecated)</td><td>‚ö†Ô∏è Legacy</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- ‚îÄ‚îÄ SECTION 2: OSI MODEL ‚îÄ‚îÄ -->
<section id="osi">
  <div class="section-header">
    <span class="section-number">02</span>
    <h2>RDP &amp; the OSI Model</h2>
  </div>
  <p style="margin-bottom:1.5rem;color:var(--text-muted)">RDP operates across multiple OSI layers. Click each layer to explore how RDP interacts with it.</p>

  <div class="grid-2" style="align-items:start">
    <div>
      <div class="osi-stack" id="osiStack">
        <!-- Layers injected by JS -->
      </div>
    </div>
    <div>
      <div class="card" style="background:#f0f4fa;border-color:#b8d0ed;position:sticky;top:80px">
        <h3 id="osiDetailTitle" style="margin-bottom:.75rem">üëÜ Select a Layer</h3>
        <div id="osiDetailBody" style="font-size:.9rem;line-height:1.7">
          Click any OSI layer on the left to see how RDP interacts with it and what concepts network administrators must understand.
        </div>
        <div id="osiDetailPdus" style="margin-top:1rem;display:none">
          <div style="font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:var(--text-muted);margin-bottom:.5rem">PDU at this layer</div>
          <div id="osiPduValue" style="font-family:var(--mono);background:var(--accent);color:white;display:inline-block;padding:.3rem .8rem;border-radius:5px;font-size:.85rem"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ‚îÄ‚îÄ SECTION 3: ARCHITECTURE ‚îÄ‚îÄ -->
<section id="architecture">
  <div class="section-header">
    <span class="section-number">03</span>
    <h2>Protocol Architecture &amp; Packet Flow</h2>
  </div>

  <div class="grid-2" style="margin-bottom:1.5rem">
    <div class="card">
      <h3>üèóÔ∏è RDP Protocol Stack</h3>
      <div style="display:flex;flex-direction:column;gap:.4rem;margin-top:.5rem;font-family:var(--mono);font-size:.82rem">
        <div style="background:#8e44ad;color:white;padding:.5rem 1rem;border-radius:6px;text-align:center">RDP Application Data (Graphics, Input, Audio)</div>
        <div style="background:#2980b9;color:white;padding:.5rem 1rem;border-radius:6px;text-align:center">Virtual Channel Manager</div>
        <div style="background:#1abc9c;color:white;padding:.5rem 1rem;border-radius:6px;text-align:center">MCS (Multipoint Communication Service)</div>
        <div style="background:#27ae60;color:white;padding:.5rem 1rem;border-radius:6px;text-align:center">T.125 / T.123 Transport</div>
        <div style="background:#e67e22;color:white;padding:.5rem 1rem;border-radius:6px;text-align:center">TLS / CredSSP Security Layer</div>
        <div style="background:#c0392b;color:white;padding:.5rem 1rem;border-radius:6px;text-align:center">TCP (Port 3389)</div>
        <div style="background:#7f8c8d;color:white;padding:.5rem 1rem;border-radius:6px;text-align:center">Physical / Data Link</div>
      </div>
    </div>

    <div class="card">
      <h3>ü§ù Connection Sequence</h3>
      <div class="flow-steps" id="flowSteps"></div>
      <div class="flow-detail" id="flowDetail">Click a step above to see details.</div>
    </div>
  </div>

  <div class="card">
    <h3>üì∫ Virtual Channels</h3>
    <p style="margin-bottom:1rem;font-size:.9rem">RDP multiplexes multiple data streams over a single connection using <strong>Virtual Channels (VCs)</strong>. Each channel handles a specific type of data.</p>
    <div class="grid-3">
      <div style="background:var(--bg2);border-radius:8px;padding:1rem">
        <div style="font-family:var(--mono);font-size:.78rem;color:var(--accent);font-weight:700">rdpdr</div>
        <div style="font-size:.83rem;margin-top:.3rem">Drive, printer, port, and smart card redirection</div>
      </div>
      <div style="background:var(--bg2);border-radius:8px;padding:1rem">
        <div style="font-family:var(--mono);font-size:.78rem;color:var(--accent);font-weight:700">cliprdr</div>
        <div style="font-size:.83rem;margin-top:.3rem">Clipboard synchronization between client and server</div>
      </div>
      <div style="background:var(--bg2);border-radius:8px;padding:1rem">
        <div style="font-family:var(--mono);font-size:.78rem;color:var(--accent);font-weight:700">rdpsnd</div>
        <div style="font-size:.83rem;margin-top:.3rem">Audio output redirection to the client device</div>
      </div>
      <div style="background:var(--bg2);border-radius:8px;padding:1rem">
        <div style="font-family:var(--mono);font-size:.78rem;color:var(--accent);font-weight:700">drdynvc</div>
        <div style="font-size:.83rem;margin-top:.3rem">Dynamic virtual channels ‚Äî USB, camera, multimedia</div>
      </div>
      <div style="background:var(--bg2);border-radius:8px;padding:1rem">
        <div style="font-family:var(--mono);font-size:.78rem;color:var(--accent);font-weight:700">MS_T120</div>
        <div style="font-size:.83rem;margin-top:.3rem">Core graphics and input channel (always present)</div>
      </div>
      <div style="background:var(--bg2);border-radius:8px;padding:1rem">
        <div style="font-family:var(--mono);font-size:.78rem;color:var(--accent);font-weight:700">echo</div>
        <div style="font-size:.83rem;margin-top:.3rem">Latency measurement / keep-alive channel</div>
      </div>
    </div>
  </div>
</section>

<!-- ‚îÄ‚îÄ SECTION 4: HEADER BUILDER ‚îÄ‚îÄ -->
<section id="header-builder">
  <div class="section-header">
    <span class="section-number">04</span>
    <h2>RDP Header Builder</h2>
  </div>
  <p style="margin-bottom:1.5rem;color:var(--text-muted)">Construct an RDP protocol data unit interactively. Adjust the fields below and watch the packet visualization update in real time.</p>

  <div class="builder-wrap">
    <div class="builder-toolbar">
      <h3>üîß RDP PDU Constructor</h3>
      <div style="display:flex;gap:.5rem;flex-wrap:wrap">
        <button class="btn btn-light" onclick="loadPreset('standard')">üìã Standard Session</button>
        <button class="btn btn-light" onclick="loadPreset('nla')">üîí NLA Auth</button>
        <button class="btn btn-light" onclick="loadPreset('admin')">‚öôÔ∏è Admin Session</button>
        <button class="btn btn-success" onclick="buildPacket()">‚ñ∂ Build Packet</button>
        <button class="btn btn-warning" onclick="resetBuilder()">‚Ü∫ Reset</button>
      </div>
    </div>

    <div class="builder-body">
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab(this,'tpkt')">TPKT Header</button>
        <button class="tab-btn" onclick="switchTab(this,'mcs')">MCS Layer</button>
        <button class="tab-btn" onclick="switchTab(this,'security')">Security</button>
        <button class="tab-btn" onclick="switchTab(this,'share')">Share Header</button>
      </div>

      <div id="tab-tpkt" class="tab-panel active">
        <div class="form-grid">
          <div class="form-group">
            <label data-tip="RDP version identifier (0x03 = version 3)">TPKT Version</label>
            <select id="f_tpktVersion"><option value="03">0x03 (RFC 1006 ‚Äî Standard)</option></select>
          </div>
          <div class="form-group">
            <label data-tip="Reserved byte, always 0x00">Reserved</label>
            <select id="f_reserved"><option value="00">0x00 (Reserved)</option></select>
          </div>
          <div class="form-group">
            <label data-tip="Total packet length including all headers in bytes">Packet Length (bytes)</label>
            <input type="number" id="f_length" value="122" min="12" max="65535">
          </div>
          <div class="form-group">
            <label data-tip="X.224 connection type indicator">X.224 Type</label>
            <select id="f_x224type">
              <option value="e0">0xE0 ‚Äì Connection Request</option>
              <option value="d0" selected>0xD0 ‚Äì Connection Confirm</option>
              <option value="f0">0xF0 ‚Äì Data TPDU</option>
              <option value="80">0x80 ‚Äì Disconnect Request</option>
            </select>
          </div>
        </div>
      </div>

      <div id="tab-mcs" class="tab-panel">
        <div class="form-grid">
          <div class="form-group">
            <label data-tip="MCS PDU type determines the operation">MCS PDU Type</label>
            <select id="f_mcsPDU">
              <option value="01">Connect-Initial (0x01)</option>
              <option value="02" selected>Connect-Response (0x02)</option>
              <option value="28">ErectDomainRequest (0x28)</option>
              <option value="38">AttachUserRequest (0x38)</option>
              <option value="3c">ChannelJoin Request (0x3C)</option>
              <option value="64">SendDataRequest (0x64)</option>
              <option value="68">SendDataIndication (0x68)</option>
            </select>
          </div>
          <div class="form-group">
            <label data-tip="Logical channel ID for this virtual channel">Channel ID</label>
            <input type="number" id="f_channelID" value="1003" min="1001" max="1007">
          </div>
          <div class="form-group">
            <label data-tip="MCS User ID assigned during attach phase">User ID</label>
            <input type="number" id="f_userID" value="1001" min="1001" max="1999">
          </div>
          <div class="form-group">
            <label data-tip="Priority and segmentation flags">Datagram Flags</label>
            <select id="f_datagramFlags">
              <option value="70">0x70 ‚Äì High Priority, No Seg</option>
              <option value="30" selected>0x30 ‚Äì Medium Priority</option>
              <option value="10">0x10 ‚Äì Low Priority</option>
            </select>
          </div>
        </div>
      </div>

      <div id="tab-security" class="tab-panel">
        <div class="form-grid">
          <div class="form-group">
            <label data-tip="Security protocol negotiated for this session">Security Protocol</label>
            <select id="f_secProtocol">
              <option value="00">0x00 ‚Äì RDP Security (RC4)</option>
              <option value="01" selected>0x01 ‚Äì TLS (Certificate)</option>
              <option value="02">0x02 ‚Äì CredSSP / NLA</option>
              <option value="03">0x03 ‚Äì RDSTLS</option>
            </select>
          </div>
          <div class="form-group">
            <label data-tip="Encryption level for the RDP session">Encryption Level</label>
            <select id="f_encLevel">
              <option value="00">None (0x00)</option>
              <option value="01">Low (0x01) ‚Äì Client‚ÜíServer only</option>
              <option value="02" selected>Client Compatible (0x02)</option>
              <option value="03">High (0x03) ‚Äì Both directions 128-bit</option>
              <option value="10">FIPS (0x10)</option>
            </select>
          </div>
          <div class="form-group">
            <label data-tip="Security header flags indicating encryption state">Security Flags</label>
            <select id="f_secFlags">
              <option value="0000">0x0000 ‚Äì No Flags</option>
              <option value="0001">0x0001 ‚Äì SEC_ENCRYPT</option>
              <option value="0002">0x0002 ‚Äì SEC_RESET_SEQNO</option>
              <option value="0008" selected>0x0008 ‚Äì SEC_LICENSE_PKT</option>
              <option value="0010">0x0010 ‚Äì SEC_SECURE_CHECKSUM</option>
            </select>
          </div>
          <div class="form-group">
            <label data-tip="NLA pre-auth required before RDP layer negotiation">NLA Required</label>
            <select id="f_nla">
              <option value="01" selected>Yes (Recommended)</option>
              <option value="00">No (Legacy/Vulnerable)</option>
            </select>
          </div>
        </div>
      </div>

      <div id="tab-share" class="tab-panel">
        <div class="form-grid">
          <div class="form-group">
            <label data-tip="Identifies the type of Share Control PDU">PDU Type</label>
            <select id="f_pduType">
              <option value="01">0x01 ‚Äì Demand Active</option>
              <option value="02">0x02 ‚Äì Confirm Active</option>
              <option value="06" selected>0x06 ‚Äì Data PDU</option>
              <option value="09">0x09 ‚Äì Deactivate All</option>
              <option value="0A">0x0A ‚Äì Server Redirect</option>
            </select>
          </div>
          <div class="form-group">
            <label data-tip="Unique share ID established during active phase">Share ID</label>
            <input type="number" id="f_shareID" value="66538" min="1">
          </div>
          <div class="form-group">
            <label data-tip="PDU subtype for Data PDUs">PDU Subtype</label>
            <select id="f_pduSubtype">
              <option value="02" selected>0x02 ‚Äì Synchronize</option>
              <option value="17">0x17 ‚Äì Keyboard Input</option>
              <option value="15">0x15 ‚Äì Mouse Input</option>
              <option value="28">0x28 ‚Äì Bitmap Update</option>
              <option value="1f">0x1F ‚Äì Suppress Output</option>
            </select>
          </div>
          <div class="form-group">
            <label data-tip="Compression type applied to PDU payload">Compression</label>
            <select id="f_compression">
              <option value="00">None (0x00)</option>
              <option value="20" selected>RDP4 (0x20)</option>
              <option value="40">RDP5 (0x40)</option>
              <option value="80">RDP6 (0x80) ‚Äì RDP6.0 Bulk Compression</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Packet Visualization -->
      <div class="packet-visual">
        <h4>üì¶ PACKET VISUALIZATION (click a byte for details)</h4>
        <div class="packet-bytes" id="packetBytes">
          <em style="color:#888">Click "Build Packet" to generate visualization</em>
        </div>
        <div class="legend" id="byteLegend" style="display:none">
          <div class="legend-item"><div class="legend-dot" style="background:#8e44ad"></div><span>TPKT/Version</span></div>
          <div class="legend-item"><div class="legend-dot" style="background:#2980b9"></div><span>X.224/Flags</span></div>
          <div class="legend-item"><div class="legend-dot" style="background:#e67e22"></div><span>Length</span></div>
          <div class="legend-item"><div class="legend-dot" style="background:#c0392b"></div><span>Security</span></div>
          <div class="legend-item"><div class="legend-dot" style="background:#16a085"></div><span>PDU Type</span></div>
          <div class="legend-item"><div class="legend-dot" style="background:#f39c12"></div><span>MCS</span></div>
          <div class="legend-item"><div class="legend-dot" style="background:#27ae60"></div><span>Channel</span></div>
          <div class="legend-item"><div class="legend-dot" style="background:#555"></div><span>Payload</span></div>
        </div>
        <div class="field-info" id="fieldInfo">Click any byte in the packet visualization to see detailed field information.</div>
      </div>

      <!-- Hex / Analysis Output -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:1rem">
        <div>
          <div class="hex-label">Hex Representation</div>
          <div class="hex-output" id="hexOutput">-- Build packet to see hex --</div>
        </div>
        <div>
          <div class="hex-label">Protocol Analysis</div>
          <div class="hex-output" id="analysisOutput" style="color:#7effc0">-- Build packet to see analysis --</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ‚îÄ‚îÄ SECTION 5: SECURITY ‚îÄ‚îÄ -->
<section id="security">
  <div class="section-header">
    <span class="section-number">05</span>
    <h2>Security, Threats &amp; Hardening</h2>
  </div>

  <div class="grid-2" style="margin-bottom:1.5rem">
    <div>
      <div class="threat-card threat-critical">
        <span class="severity sev-critical">Critical</span>
        <h4>üî¥ BlueKeep (CVE-2019-0708)</h4>
        <p style="font-size:.88rem">Pre-authentication RCE vulnerability affecting Windows XP through Server 2008 R2. Allows unauthenticated attackers to execute code. Wormable ‚Äî no user interaction required. Patched May 2019 ‚Äî systems must be updated.</p>
      </div>
      <div class="threat-card threat-critical">
        <span class="severity sev-critical">Critical</span>
        <h4>üî¥ DejaBlue (CVE-2019-1181/1182)</h4>
        <p style="font-size:.88rem">Similar pre-auth RCE vulnerabilities affecting Windows 7‚Äì10 and Server 2008‚Äì2019. Part of the same BlueKeep family. Heap-based buffer overflow in RDP decompression routines.</p>
      </div>
      <div class="threat-card threat-high">
        <span class="severity sev-high">High</span>
        <h4>üü† Brute Force / Credential Stuffing</h4>
        <p style="font-size:.88rem">RDP exposed on port 3389 is a prime target for automated brute-force attacks. Attackers use tools like Hydra, Crowbar. Account lockout policies and NLA significantly mitigate this risk.</p>
      </div>
      <div class="threat-card threat-high">
        <span class="severity sev-high">High</span>
        <h4>üü† Man-in-the-Middle (MITM)</h4>
        <p style="font-size:.88rem">Without proper certificate validation, RDP sessions can be intercepted. Self-signed certificates accepted by default. Enforce TLS with validated certificates to prevent credential interception.</p>
      </div>
      <div class="threat-card threat-medium">
        <span class="severity sev-medium">Medium</span>
        <h4>üîµ Pass-the-Hash Attacks</h4>
        <p style="font-size:.88rem">NTLM credentials captured from one system can be replayed to authenticate RDP sessions on other hosts. Restricted Admin Mode and Protected Users group mitigate this attack vector.</p>
      </div>
    </div>

    <div>
      <div class="card" style="border-top:4px solid var(--accent3)">
        <h3>üõ°Ô∏è Hardening Checklist</h3>
        <div id="hardeningList" style="display:flex;flex-direction:column;gap:.5rem;margin-top:.5rem">
        </div>
      </div>
      <div class="card" style="margin-top:1.5rem;border-top:4px solid var(--accent)">
        <h3>üîê Authentication Methods</h3>
        <div style="display:flex;flex-direction:column;gap:.8rem;margin-top:.5rem;font-size:.88rem">
          <div style="background:var(--bg2);border-radius:8px;padding:.8rem 1rem">
            <strong>Network Level Authentication (NLA)</strong> ‚Äî Authenticates the user before a full RDP session is established. Uses CredSSP (TLS + NTLM/Kerberos). <span style="color:var(--accent3);font-weight:700">‚úÖ Recommended</span>
          </div>
          <div style="background:var(--bg2);border-radius:8px;padding:.8rem 1rem">
            <strong>Smart Card Authentication</strong> ‚Äî Certificate-based auth using PKI. Eliminates password brute-force risk. Requires smart card infrastructure deployment.
          </div>
          <div style="background:var(--bg2);border-radius:8px;padding:.8rem 1rem">
            <strong>Multi-Factor Authentication</strong> ‚Äî Azure AD Conditional Access, Duo Security, or RADIUS integration with TOTP adds a second factor to RDP logins.
          </div>
          <div style="background:#fdf2f0;border-radius:8px;padding:.8rem 1rem">
            <strong>Classic RDP Authentication</strong> ‚Äî Password only, no pre-auth. <span style="color:var(--accent2);font-weight:700">‚ö†Ô∏è Avoid in production</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ‚îÄ‚îÄ SECTION 6: GLOSSARY ‚îÄ‚îÄ -->
<section id="glossary">
  <div class="section-header">
    <span class="section-number">06</span>
    <h2>Glossary of Key Terms</h2>
  </div>
  <div class="glossary-search">
    <input type="text" id="glossSearch" placeholder="üîç  Search terms..." oninput="filterGlossary(this.value)">
  </div>
  <div class="term-grid" id="termGrid"></div>
</section>

<!-- ‚îÄ‚îÄ SECTION 7: QUIZ ‚îÄ‚îÄ -->
<section id="quiz">
  <div class="section-header">
    <span class="section-number">07</span>
    <h2>Knowledge Check</h2>
  </div>

  <div class="score-bar" style="margin-bottom:2rem">
    <div>
      <div class="score-num" id="scoreDisplay">0/10</div>
      <div class="score-label">Correct Answers</div>
    </div>
    <div class="progress-track">
      <div class="progress-fill" id="scoreProgress" style="width:0%"></div>
    </div>
    <button class="btn btn-primary" onclick="resetQuiz()">‚Ü∫ Reset Quiz</button>
  </div>

  <div id="quizContainer"></div>
</section>

<!-- FOOTER -->
<footer>
  <strong>Remote Desktop Protocol ‚Äî Interactive Learning Module</strong><br>
  Network Administration &amp; Cybersecurity Education ‚Ä¢ TCP/IP Protocol Suite<br>
  <span style="color:#555;font-size:.78rem;margin-top:.5rem;display:block">Built for classroom instruction. RDP specification references: MS-RDPBCGR | T.125 ITU-T | RFC 1006</span>
</footer>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// OSI DATA
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const osiLayers = [
  {
    num:7, name:'Application', sub:'HTTP, RDP, SMB, DNS', color:'#8e44ad', pdu:'Data',
    detail:`<strong>RDP operates primarily at the Application Layer.</strong> The RDP protocol defines the graphical interface, virtual channels, keyboard/mouse input handling, clipboard operations, and all user-facing features.<br><br>
    <span class="rdp-badge">RDP</span> Key concepts: PDU types (Demand Active, Confirm Active, Data PDUs), virtual channel negotiation, capability sets, GDI drawing orders, RemoteFX codec.<br><br>
    <strong>Admin skills:</strong> Configure allowed capabilities via Group Policy, manage virtual channel permissions, troubleshoot display rendering issues.`
  },
  {
    num:6, name:'Presentation', sub:'SSL/TLS, Encryption, Encoding', color:'#2980b9', pdu:'Data',
    detail:`<strong>TLS handles encryption at the Presentation Layer.</strong> RDP negotiates TLS 1.2/1.3 or CredSSP for encrypting data in transit. Bitmap compression (RDP4, RDP5, RDP6) and RemoteFX video encoding also occur here.<br><br>
    <span class="rdp-badge">RDP</span> Encryption: RC4 (legacy), TLS (modern). Compression codecs reduce bandwidth. Certificate management is critical.<br><br>
    <strong>Admin skills:</strong> Deploy machine certificates for RDP TLS, configure encryption levels via Group Policy (Computer ‚Üí Windows Settings ‚Üí Security Settings ‚Üí RDP), verify TLS version with Wireshark.`
  },
  {
    num:5, name:'Session', sub:'RDP Session Management, CredSSP', color:'#1abc9c', pdu:'Data',
    detail:`<strong>RDP session establishment and management occurs at the Session Layer.</strong> CredSSP (Credential Security Support Provider) performs pre-authentication. Session IDs, reconnection tokens, and session cookies are managed here.<br><br>
    <span class="rdp-badge">RDP</span> Connection phases: Connection Initiation ‚Üí Basic Exchange ‚Üí Channel Setup ‚Üí Security ‚Üí Functional. Session reconnect after network drop via SavedSessionKey.<br><br>
    <strong>Admin skills:</strong> Configure session timeout and reconnection policies, enforce NLA (requires CredSSP), monitor active sessions with qwinsta/quser commands.`
  },
  {
    num:4, name:'Transport', sub:'TCP Port 3389, UDP 3389', color:'#27ae60', pdu:'Segment',
    detail:`<strong>RDP uses TCP port 3389 as its primary transport.</strong> TCP provides reliable, ordered, connection-oriented delivery essential for guaranteed screen updates and input. UDP 3389 is used optionally for performance enhancements in modern RDP (lossy transport for video/audio).<br><br>
    <span class="rdp-badge">RDP</span> TCP 3389: All session data. UDP 3389: Enhanced multimedia transport (RDP 8.0+). TPKT (RFC 1006) wraps RDP PDUs over TCP.<br><br>
    <strong>Admin skills:</strong> Configure firewall rules for TCP/UDP 3389, network QoS for RDP traffic, RD Gateway for HTTPS tunneling (port 443), diagnose with netstat/ss commands.`
  },
  {
    num:3, name:'Network', sub:'IP Routing, NAT, VPN', color:'#e67e22', pdu:'Packet',
    detail:`<strong>IP routing determines path of RDP traffic.</strong> RDP connections traverse routers and may pass through NAT gateways. VPNs (IPSec, SSL VPN) add a secure tunnel at this layer before RDP connects.<br><br>
    <span class="rdp-badge">RDP</span> MTU considerations affect RDP performance. Fragmentation can cause session delays. DSCP/QoS marking helps prioritize RDP packets in enterprise networks.<br><br>
    <strong>Admin skills:</strong> Configure static routes for Remote Desktop Services subnets, set up NAT port forwarding, implement VPN-before-RDP security policy, use traceroute to diagnose routing issues.`
  },
  {
    num:2, name:'Data Link', sub:'Ethernet Frames, MAC Addressing', color:'#c0392b', pdu:'Frame',
    detail:`<strong>Ethernet frames carry RDP packets across local segments.</strong> MAC addressing, VLAN tagging, and switching occur here. RDP traffic can be segmented into VLANs for security isolation of remote desktop servers.<br><br>
    <span class="rdp-badge">RDP</span> Network segmentation: Place RD Session Hosts on dedicated VLAN. 802.1Q tagging. Spanning Tree Protocol affects reconnection timing.<br><br>
    <strong>Admin skills:</strong> Configure switch port VLANs for RDS servers, use 802.1Q trunk ports for RDS infrastructure, monitor for ARP spoofing (potential MITM vector for RDP).`
  },
  {
    num:1, name:'Physical', sub:'Cables, NICs, Wireless', color:'#7f8c8d', pdu:'Bits',
    detail:`<strong>Physical infrastructure affects RDP user experience.</strong> Latency (round-trip time) is the most critical physical layer factor for RDP. High latency makes RDP sessions sluggish. Bandwidth affects quality of graphics and video redirection.<br><br>
    <span class="rdp-badge">RDP</span> Recommended: &lt;150ms RTT for acceptable experience. RDP adaptive graphics reduce bandwidth on slow links. WAN optimization appliances can improve remote RDP performance.<br><br>
    <strong>Admin skills:</strong> Measure RTT with ping, configure RDP experience settings based on connection speed, implement WAN QoS for RDP, use RemoteFX on high-bandwidth connections.`
  }
];

function buildOSI() {
  const stack = document.getElementById('osiStack');
  osiLayers.forEach(layer => {
    const el = document.createElement('div');
    el.className = `osi-layer l${layer.num}`;
    el.innerHTML = `
      <div class="layer-num">${layer.num}</div>
      <div class="layer-body">
        <div class="layer-name">${layer.name} Layer ${layer.num === 7 || layer.num === 4 ? '<span class="rdp-badge">RDP</span>' : ''}</div>
        <div class="layer-sub">${layer.sub}</div>
      </div>`;
    el.addEventListener('click', () => showOSIDetail(layer, el));
    stack.appendChild(el);
  });
}

function showOSIDetail(layer, el) {
  document.querySelectorAll('.osi-layer').forEach(l => l.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('osiDetailTitle').innerHTML = `Layer ${layer.num}: ${layer.name}`;
  document.getElementById('osiDetailTitle').style.color = layer.color;
  document.getElementById('osiDetailBody').innerHTML = layer.detail;
  document.getElementById('osiDetailPdus').style.display = 'block';
  document.getElementById('osiPduValue').textContent = layer.pdu;
  document.getElementById('osiPduValue').style.background = layer.color;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// PACKET FLOW
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const flowData = [
  { label: '1. TCP Handshake', detail: '<strong>TCP Three-Way Handshake (Layer 4)</strong><br>Client sends SYN to server on TCP port 3389. Server replies SYN-ACK. Client sends ACK. A reliable, full-duplex connection is now established before any RDP data is exchanged.' },
  { label: '2. Connection Initiation', detail: '<strong>X.224 Connection Request (TPKT)</strong><br>Client sends a TPKT-wrapped X.224 Connection Request PDU. This includes the RDP protocol negotiation request specifying supported security protocols (TLS, CredSSP, RDSTLS).' },
  { label: '3. Protocol Negotiation', detail: '<strong>Security Protocol Selection</strong><br>Server responds with X.224 Connection Confirm, selecting the security protocol. If CredSSP/NLA is chosen, TLS handshake begins immediately before any RDP layer negotiation.' },
  { label: '4. TLS/CredSSP', detail: '<strong>TLS Handshake + CredSSP (NLA)</strong><br>TLS session established. CredSSP protocol performs pre-authentication: client proves identity via NTLM/Kerberos before RDP session is allocated on the server. Prevents denial-of-service from unauthenticated connections.' },
  { label: '5. MCS Connect', detail: '<strong>MCS (T.125) Connection</strong><br>Client sends MCS Connect-Initial PDU containing GCC Conference Create Request with client capability sets: core data, security data, network data, cluster data. Server responds with MCS Connect-Response.' },
  { label: '6. Channel Join', detail: '<strong>MCS Erect Domain + Attach User + Channel Join</strong><br>Client erects the MCS domain, attaches as a user (receiving a UserID), then joins each virtual channel (I/O channel, cliprdr, rdpdr, etc.) one by one using ChannelJoin Request/Confirm.' },
  { label: '7. Active Phase', detail: '<strong>Demand Active / Confirm Active PDUs</strong><br>Server sends Demand Active PDU advertising its capability sets. Client responds with Confirm Active PDU. Both sides now know each other\'s supported capabilities (compression, bitmap coding, virtual channels).' },
  { label: '8. Running Session', detail: '<strong>Data Exchange (Share Data PDUs)</strong><br>Session is active. Graphics updates sent as Bitmap Update PDUs. Keyboard/mouse sent as Input PDUs. Virtual channel data (clipboard, drives) multiplexed over MCS. Session continues until disconnect.' }
];

function buildFlow() {
  const stepsEl = document.getElementById('flowSteps');
  flowData.forEach((step, i) => {
    const btn = document.createElement('div');
    btn.className = 'flow-step';
    btn.textContent = step.label;
    btn.onclick = () => {
      document.querySelectorAll('.flow-step').forEach(s => s.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('flowDetail').innerHTML = step.detail;
    };
    stepsEl.appendChild(btn);
    if (i < flowData.length - 1) {
      const arr = document.createElement('span');
      arr.className = 'flow-arrow'; arr.textContent = '‚Üí';
      stepsEl.appendChild(arr);
    }
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// HEADER BUILDER
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const fieldDescriptions = {
  version: '<strong>TPKT Version (0x03)</strong> ‚Äî Indicates RFC 1006 TPKT format. This field is always 0x03 for standard RDP over TCP. Part of the outermost TPKT envelope that wraps all RDP PDUs.',
  reserved: '<strong>Reserved (0x00)</strong> ‚Äî Always set to zero. Reserved for future use per RFC 1006 specification. Must be 0x00 in all valid RDP packets.',
  length_hi: '<strong>Packet Length (High Byte)</strong> ‚Äî High-order byte of the 16-bit total packet length in network byte order (big-endian). Includes TPKT header (4 bytes) + all encapsulated data.',
  length_lo: '<strong>Packet Length (Low Byte)</strong> ‚Äî Low-order byte of the 16-bit total packet length. Combined with high byte to form the complete 2-byte length field.',
  x224type: '<strong>X.224 TPDU Type</strong> ‚Äî Connection type indicator. 0xE0=CR (Connection Request), 0xD0=CC (Connection Confirm), 0xF0=DT (Data Transfer), 0x80=DR (Disconnect Request).',
  x224len: '<strong>X.224 Header Length</strong> ‚Äî Length of the X.224 TPDU header minus the 1-byte length field itself. For DT TPDUs this is 0x02.',
  mcsPDU: '<strong>MCS PDU Type</strong> ‚Äî Identifies the Multipoint Communication Service PDU type per T.125. Controls domain management: 0x64=SendDataRequest (client‚Üíserver), 0x68=SendDataIndication (server‚Üíclient).',
  channelID: '<strong>MCS Channel ID</strong> ‚Äî 16-bit identifier for the virtual channel. 0x03EB (1003) = I/O channel (main data), 0x03EC = cliprdr, 0x03ED = rdpdr, 0x03EE = rdpsnd.',
  secFlags: '<strong>Security Flags</strong> ‚Äî Bitmask indicating security processing. SEC_ENCRYPT (0x0008): payload is encrypted. SEC_SECURE_CHECKSUM (0x0010): MAC over plaintext. SEC_LICENSE_PKT (0x0004): licensing PDU.',
  secProto: '<strong>Security Protocol</strong> ‚Äî Selected security method: 0x00=RDP Security (RC4, legacy), 0x01=TLS (X.509 certificate), 0x02=CredSSP/NLA, 0x03=RDSTLS (Remote Desktop TLS).',
  pduType: '<strong>Share Control Header: PDU Type</strong> ‚Äî Identifies Share-level PDU. 0x0001=Demand Active (server caps), 0x0002=Confirm Active (client caps), 0x0006=Data PDU (normal session data), 0x0009=Deactivate All.',
  shareID: '<strong>Share ID</strong> ‚Äî 32-bit identifier established during the active phase. Uniquely identifies this RDP session\'s share context. Same value used in all subsequent Data PDUs.',
  compression: '<strong>Compression Type</strong> ‚Äî Compression codec applied to the PDU payload. 0x00=none, 0x20=RDP4 (MPPC), 0x40=RDP5 (MPPC with improved history), 0x80=RDP6 (Bulk Compression with XCR/RPDEGDI).',
  data: '<strong>Payload Data</strong> ‚Äî Actual PDU content after all headers. For Data PDUs this contains the update type (bitmap, pointer, palette) or input event (keyboard scan codes, mouse coordinates/buttons).'
};

function getVal(id) { return document.getElementById(id)?.value || '00'; }

function buildPacket() {
  const length = parseInt(getVal('f_length'));
  const lenHi = ((length >> 8) & 0xFF).toString(16).padStart(2,'0');
  const lenLo = (length & 0xFF).toString(16).padStart(2,'0');
  const x224 = getVal('f_x224type');
  const mcsPDU = getVal('f_mcsPDU');
  const chanID = parseInt(getVal('f_channelID'));
  const chanHi = ((chanID >> 8) & 0xFF).toString(16).padStart(2,'0');
  const chanLo = (chanID & 0xFF).toString(16).padStart(2,'0');
  const secFlags = getVal('f_secFlags');
  const secProto = getVal('f_secProtocol');
  const pduType = getVal('f_pduType');
  const shareID = parseInt(getVal('f_shareID'));
  const shareBytes = [(shareID >> 24)&0xFF,(shareID>>16)&0xFF,(shareID>>8)&0xFF,shareID&0xFF].map(b=>b.toString(16).padStart(2,'0'));
  const comp = getVal('f_compression');

  const fields = [
    { bytes: ['03'], cls: 'field-version', key: 'version' },
    { bytes: ['00'], cls: 'field-flags', key: 'reserved' },
    { bytes: [lenHi], cls: 'field-length', key: 'length_hi' },
    { bytes: [lenLo], cls: 'field-length', key: 'length_lo' },
    { bytes: [x224], cls: 'field-flags', key: 'x224type' },
    { bytes: ['02'], cls: 'field-flags', key: 'x224len' },
    { bytes: [mcsPDU], cls: 'field-mcs', key: 'mcsPDU' },
    { bytes: [chanHi, chanLo], cls: 'field-channel', key: 'channelID' },
    { bytes: [secFlags.substring(0,2), secFlags.substring(2,4)], cls: 'field-security', key: 'secFlags' },
    { bytes: ['00', secProto], cls: 'field-security', key: 'secProto' },
    { bytes: ['00', pduType], cls: 'field-pdu', key: 'pduType' },
    { bytes: shareBytes, cls: 'field-pdu', key: 'shareID' },
    { bytes: [comp, '00'], cls: 'field-pdu', key: 'compression' },
    { bytes: ['f0','3d','a2','c1','88','4e','7b','21'], cls: 'field-data', key: 'data' }
  ];

  const container = document.getElementById('packetBytes');
  container.innerHTML = '';
  let hexStr = '';
  let offset = 0;

  fields.forEach(f => {
    const group = document.createElement('div');
    group.className = 'byte-group';
    f.bytes.forEach(b => {
      const span = document.createElement('span');
      span.className = `byte ${f.cls}`;
      span.textContent = b.toUpperCase();
      span.title = `Offset: 0x${offset.toString(16).toUpperCase().padStart(2,'0')} (${offset})`;
      span.onclick = () => {
        document.getElementById('fieldInfo').innerHTML = fieldDescriptions[f.key] || 'Field information unavailable.';
        document.querySelectorAll('.byte').forEach(x => x.style.outline = 'none');
        span.style.outline = '2px solid white';
      };
      group.appendChild(span);
      hexStr += b.toUpperCase() + ' ';
      offset++;
    });
    container.appendChild(group);
    // Add space every 4 bytes visually
    const spacer = document.createElement('span');
    spacer.style.cssText = 'width:6px;display:inline-block';
    container.appendChild(spacer);
  });

  document.getElementById('byteLegend').style.display = 'flex';
  document.getElementById('hexOutput').textContent = hexStr.trim();

  // Analysis
  const nla = getVal('f_nla');
  const secLvl = document.getElementById('f_encLevel');
  const secLvlTxt = secLvl.options[secLvl.selectedIndex].text;
  document.getElementById('analysisOutput').innerHTML =
    `Protocol: RDP/TCP:3389\n` +
    `Security: ${secProto==='02'?'CredSSP/NLA ‚úì':secProto==='01'?'TLS ‚úì':'RDP Security ‚ö†'}\n` +
    `NLA Pre-Auth: ${nla==='01'?'Enabled ‚úì':'Disabled ‚ö†'}\n` +
    `Encryption: ${secLvlTxt}\n` +
    `MCS Channel: 0x${chanHi.toUpperCase()}${chanLo.toUpperCase()} (${chanID})\n` +
    `Share ID: 0x${shareID.toString(16).toUpperCase()}\n` +
    `PDU Type: 0x${pduType.toUpperCase()}\n` +
    `Compression: ${comp==='00'?'None':'Enabled ('+comp+')'}\n` +
    `Total Length: ${length} bytes`;
}

function loadPreset(name) {
  const presets = {
    standard: { version:'03', reserved:'00', length:122, x224type:'f0', mcsPDU:'68', channelID:1003, secProtocol:'01', encLevel:'02', secFlags:'0000', nla:'01', pduType:'06', shareID:66538, compression:'20' },
    nla: { version:'03', reserved:'00', length:84, x224type:'d0', mcsPDU:'02', channelID:1001, secProtocol:'02', encLevel:'03', secFlags:'0008', nla:'01', pduType:'01', shareID:66538, compression:'00' },
    admin: { version:'03', reserved:'00', length:256, x224type:'f0', mcsPDU:'64', channelID:1003, secProtocol:'01', encLevel:'10', secFlags:'0010', nla:'01', pduType:'06', shareID:99999, compression:'80' }
  };
  const p = presets[name];
  if (!p) return;
  document.getElementById('f_tpktVersion').value = p.version;
  document.getElementById('f_length').value = p.length;
  document.getElementById('f_x224type').value = p.x224type;
  document.getElementById('f_mcsPDU').value = p.mcsPDU;
  document.getElementById('f_channelID').value = p.channelID;
  document.getElementById('f_secProtocol').value = p.secProtocol;
  document.getElementById('f_encLevel').value = p.encLevel;
  document.getElementById('f_secFlags').value = p.secFlags;
  document.getElementById('f_nla').value = p.nla;
  document.getElementById('f_pduType').value = p.pduType;
  document.getElementById('f_shareID').value = p.shareID;
  document.getElementById('f_compression').value = p.compression;
  buildPacket();
}

function resetBuilder() {
  document.getElementById('packetBytes').innerHTML = '<em style="color:#888">Click "Build Packet" to generate visualization</em>';
  document.getElementById('hexOutput').textContent = '-- Build packet to see hex --';
  document.getElementById('analysisOutput').textContent = '-- Build packet to see analysis --';
  document.getElementById('fieldInfo').textContent = 'Click any byte in the packet visualization to see detailed field information.';
  document.getElementById('byteLegend').style.display = 'none';
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// HARDENING CHECKLIST
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const hardeningItems = [
  'Enable Network Level Authentication (NLA)',
  'Use RD Gateway with HTTPS (port 443)',
  'Change default port from 3389',
  'Enable Windows Firewall RDP rules with IP restrictions',
  'Enforce TLS 1.2/1.3 (disable SSL 3.0, TLS 1.0/1.1)',
  'Implement account lockout after failed attempts',
  'Enable MFA for all RDP accounts',
  'Restrict RDP access via Group Policy (Remote Desktop Users group only)',
  'Keep Windows fully patched (BlueKeep/DejaBlue)',
  'Enable RDP logging and SIEM alerting',
  'Disable clipboard/drive redirection where not needed',
  'Use VPN-before-RDP policy for external access'
];

function buildHardening() {
  const el = document.getElementById('hardeningList');
  hardeningItems.forEach(item => {
    const div = document.createElement('div');
    div.style.cssText = 'display:flex;align-items:center;gap:.6rem;padding:.5rem .75rem;background:var(--bg2);border-radius:6px;font-size:.85rem;cursor:pointer;transition:all .15s';
    const chk = document.createElement('input');
    chk.type = 'checkbox';
    chk.style.cssText = 'cursor:pointer;width:16px;height:16px;accent-color:var(--accent3)';
    chk.onchange = () => {
      div.style.background = chk.checked ? '#e9f7ef' : 'var(--bg2)';
      div.style.color = chk.checked ? '#1e8449' : 'inherit';
      div.style.textDecoration = chk.checked ? 'line-through' : 'none';
    };
    div.appendChild(chk);
    div.appendChild(document.createTextNode(item));
    div.onclick = (e) => { if(e.target !== chk){ chk.checked=!chk.checked; chk.onchange(); } };
    el.appendChild(div);
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// GLOSSARY
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const glossaryTerms = [
  { term:'RDP', def:'Remote Desktop Protocol ‚Äî Microsoft proprietary protocol for remote graphical desktop access over a network.' },
  { term:'NLA', def:'Network Level Authentication ‚Äî Pre-authenticates users before the full RDP session is established, using CredSSP.' },
  { term:'CredSSP', def:'Credential Security Support Provider ‚Äî Combines TLS with NTLM or Kerberos to securely delegate credentials during NLA.' },
  { term:'TPKT', def:'Transport Protocol (RFC 1006) ‚Äî Wraps X.224 data for transport over TCP. All RDP PDUs are encapsulated in TPKT.' },
  { term:'MCS', def:'Multipoint Communication Service (T.125) ‚Äî Provides multi-channel multiplexing over a single TCP connection for RDP.' },
  { term:'PDU', def:'Protocol Data Unit ‚Äî A unit of data specified in a protocol at each layer of the OSI model.' },
  { term:'Virtual Channel', def:'Logical subdivision of an RDP connection for separate data streams (clipboard, drive redirection, audio, etc.).' },
  { term:'GCC', def:'Generic Conference Control ‚Äî Part of T.124 ITU standard used during MCS Connect-Initial for capability exchange.' },
  { term:'RemoteFX', def:'Microsoft technology enabling GPU-accelerated graphics rendering for RDP sessions, reducing bandwidth for rich content.' },
  { term:'RD Gateway', def:'Remote Desktop Gateway ‚Äî Tunnels RDP traffic over HTTPS (port 443) for secure Internet access to internal resources.' },
  { term:'Bitmap Update', def:'RDP PDU type that carries screen bitmap data from server to client using raw or compressed pixel data.' },
  { term:'BlueKeep', def:'CVE-2019-0708 ‚Äî Critical wormable pre-auth RCE in RDP affecting Windows XP through Server 2008 R2.' },
  { term:'CredSSP Pre-Auth', def:'Authentication step where client proves identity to server before a session is created, preventing resource exhaustion attacks.' },
  { term:'SEC_ENCRYPT', def:'Security flag (0x0008) in the RDP security header indicating the payload portion of the PDU is encrypted.' },
  { term:'Share Control Header', def:'Per-PDU header containing the PDU type, total length, and PDU source at the RDP share (session) level.' },
  { term:'Session Host', def:'The server component in RDS that hosts remote desktop sessions. Formerly called Terminal Server.' },
  { term:'Restricted Admin Mode', def:'RDP mode where credentials are not sent to the remote server, mitigating pass-the-hash attacks.' },
  { term:'UDP Transport', def:'RDP 8.0+ feature using UDP 3389 for lossy real-time media transport, improving audio/video performance.' },
  { term:'GDI Order', def:'Drawing commands sent by RDP server to recreate screen content using geometric primitives instead of raw bitmaps.' },
  { term:'X.224', def:'ITU-T standard for Connection-Oriented Transport Protocol used in the TPKT/X.224 header layer of RDP.' }
];

function buildGlossary() {
  const grid = document.getElementById('termGrid');
  glossaryTerms.forEach(t => {
    const card = document.createElement('div');
    card.className = 'term-card';
    card.innerHTML = `<div class="term-name">${t.term}</div><div class="term-def">${t.def}</div>`;
    card.dataset.search = (t.term + ' ' + t.def).toLowerCase();
    grid.appendChild(card);
  });
}

function filterGlossary(q) {
  const lq = q.toLowerCase();
  document.querySelectorAll('.term-card').forEach(c => {
    c.classList.toggle('hidden', !c.dataset.search.includes(lq));
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// QUIZ
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const quizData = [
  { q:'What is the default TCP port used by RDP?', opts:['A. 22','B. 443','C. 3389','D. 5900'], ans:2, exp:'RDP uses TCP port 3389 by default. UDP 3389 is also used in modern implementations for enhanced media performance.' },
  { q:'What does NLA stand for and what is its primary security benefit?', opts:['A. Network Layer Authentication ‚Äî encrypts the channel','B. Network Level Authentication ‚Äî authenticates before session creation','C. Node Link Access ‚Äî filters by MAC address','D. Null Level Authorization ‚Äî disables legacy auth'], ans:1, exp:'NLA (Network Level Authentication) uses CredSSP to authenticate the user BEFORE a full RDP session is established, preventing resource exhaustion and unauthorized session creation.' },
  { q:'Which OSI layer does RDP primarily operate at?', opts:['A. Layer 3 (Network)','B. Layer 4 (Transport)','C. Layer 6 (Presentation)','D. Layer 7 (Application)'], ans:3, exp:'RDP is an Application Layer (Layer 7) protocol. It defines the graphical interface, virtual channels, and user interaction. TLS encryption occurs at Layer 6 (Presentation).' },
  { q:'What protocol wraps RDP PDUs for transmission over TCP?', opts:['A. GCC','B. TPKT (RFC 1006)','C. T.125','D. CredSSP'], ans:1, exp:'TPKT (RFC 1006) is the outermost wrapper. It provides a 4-byte header (version, reserved, 2-byte length) that encloses X.224 data, which in turn carries MCS/RDP PDUs.' },
  { q:'CVE-2019-0708 (BlueKeep) is dangerous primarily because it is:', opts:['A. Post-authentication only','B. Limited to Windows 10','C. Pre-auth and wormable (no user interaction required)','D. Requires physical access'], ans:2, exp:'BlueKeep is critical because it requires NO authentication and NO user interaction. A single vulnerable system on a network could allow worm propagation across all vulnerable hosts.' },
  { q:'Which security flag in the RDP security header indicates that the PDU payload is encrypted?', opts:['A. SEC_RESET_SEQNO (0x0002)','B. SEC_ENCRYPT (0x0008)','C. SEC_LICENSE_PKT (0x0004)','D. SEC_SECURE_CHECKSUM (0x0010)'], ans:1, exp:'SEC_ENCRYPT (0x0008) in the RDP Security Header flags field indicates that the PDU body/payload has been encrypted using the negotiated encryption method (RC4 for RDP Security, or TLS wrapping for modern sessions).' },
  { q:'What is the purpose of the MCS Channel ID in an RDP PDU?', opts:['A. Identifies the encryption algorithm','B. Specifies the server IP address','C. Identifies the virtual channel (clipboard, drive, I/O)','D. Sets the session timeout value'], ans:2, exp:'MCS Channel IDs identify which virtual channel the data belongs to. The I/O channel uses 0x03EB (1003). Each additional virtual channel (cliprdr, rdpdr, rdpsnd) gets its own channel ID assigned during the Channel Join phase.' },
  { q:'Which command shows currently active RDP sessions on a Windows Server?', opts:['A. netstat -an | find "3389"','B. qwinsta or quser','C. ipconfig /all','D. rdpclip.exe /list'], ans:1, exp:'qwinsta (Query WINdows STAtion) or quser shows all logged-on users and their session states, session IDs, and idle times. Use "rwinsta <session_id>" to reset a session.' },
  { q:'RD Gateway tunnels RDP over which port to bypass firewall restrictions?', opts:['A. Port 3389 (TCP)','B. Port 8080 (HTTP)','C. Port 443 (HTTPS)','D. Port 1194 (OpenVPN)'], ans:2, exp:'Remote Desktop Gateway encapsulates RDP within HTTPS (port 443), allowing RDP connections to traverse firewalls and NAT devices that only allow HTTPS outbound. This avoids exposing TCP 3389 directly to the Internet.' },
  { q:'Restricted Admin Mode for RDP mitigates which attack type?', opts:['A. BlueKeep buffer overflow','B. Pass-the-Hash (PtH) attacks','C. Man-in-the-middle via self-signed certs','D. Denial of Service via SYN flood'], ans:1, exp:'Restricted Admin Mode prevents the client\'s credentials from being sent to and stored on the remote server. This directly mitigates Pass-the-Hash attacks where captured NTLM hashes can be replayed to authenticate to other hosts.' }
];

let score = 0;
let answered = new Array(quizData.length).fill(false);

function buildQuiz() {
  const container = document.getElementById('quizContainer');
  quizData.forEach((q, qi) => {
    const card = document.createElement('div');
    card.className = 'quiz-card';
    card.id = `quiz-${qi}`;
    let optsHTML = q.opts.map((o, oi) =>
      `<div class="option" onclick="checkAnswer(${qi},${oi})">
        <span class="option-letter">${String.fromCharCode(65+oi)}</span>
        <span>${o.substring(3)}</span>
      </div>`
    ).join('');
    card.innerHTML = `
      <div class="quiz-q"><span class="q-num">Q${qi+1}</span>${q.q}</div>
      <div class="options">${optsHTML}</div>
      <div class="feedback" id="fb-${qi}"></div>`;
    container.appendChild(card);
  });
}

function checkAnswer(qi, chosen) {
  if (answered[qi]) return;
  answered[qi] = true;
  const q = quizData[qi];
  const card = document.getElementById(`quiz-${qi}`);
  const opts = card.querySelectorAll('.option');
  opts.forEach((o, i) => {
    o.classList.add('disabled');
    if (i === q.ans) o.classList.add('correct');
    else if (i === chosen) o.classList.add('incorrect');
  });
  const fb = document.getElementById(`fb-${qi}`);
  if (chosen === q.ans) {
    score++;
    fb.className = 'feedback correct show';
    fb.textContent = '‚úÖ Correct! ' + q.exp;
  } else {
    fb.className = 'feedback incorrect show';
    fb.textContent = '‚ùå Incorrect. ' + q.exp;
  }
  updateScore();
}

function updateScore() {
  const total = answered.filter(Boolean).length;
  document.getElementById('scoreDisplay').textContent = `${score}/${total}`;
  document.getElementById('scoreProgress').style.width = (score / quizData.length * 100) + '%';
}

function resetQuiz() {
  score = 0;
  answered = new Array(quizData.length).fill(false);
  document.getElementById('quizContainer').innerHTML = '';
  updateScore();
  buildQuiz();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// TABS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(btn, id) {
  btn.closest('.builder-wrap, section').querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.closest('.builder-wrap, section').querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('tab-' + id).classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// NAV
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setActive(link) {
  document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
  link.classList.add('active');
}

// Scroll spy
window.addEventListener('scroll', () => {
  const sections = document.querySelectorAll('section[id]');
  let current = '';
  sections.forEach(s => {
    if (window.scrollY >= s.offsetTop - 120) current = s.id;
  });
  document.querySelectorAll('nav a').forEach(a => {
    a.classList.toggle('active', a.getAttribute('href') === '#' + current);
  });
});

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// INIT
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', () => {
  buildOSI();
  buildFlow();
  buildHardening();
  buildGlossary();
  buildQuiz();
});
</script>
</body>
</html>
