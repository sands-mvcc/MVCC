<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TCP Protocol ‚Äì Interactive Learning Module</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f4f1eb;
    --surface: #ffffff;
    --surface2: #eef0f8;
    --accent: #1a3a8f;
    --accent2: #e63946;
    --accent3: #2a9d8f;
    --accent4: #f4a261;
    --text: #1c1c2e;
    --muted: #6b7280;
    --border: #d1d5db;
    --highlight: #fef3c7;
    --success: #10b981;
    --warning: #f59e0b;
    --code-bg: #1e2235;
    --code-text: #e2e8f0;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.7;
    min-height: 100vh;
  }

  /* NAV */
  nav {
    position: sticky;
    top: 0;
    z-index: 100;
    background: var(--accent);
    color: white;
    display: flex;
    align-items: center;
    gap: 0;
    padding: 0 2rem;
    height: 56px;
    box-shadow: 0 2px 12px rgba(26,58,143,0.25);
  }

  nav .logo {
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 1.15rem;
    letter-spacing: -0.01em;
    margin-right: auto;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  nav .logo span {
    background: var(--accent2);
    color: white;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
  }

  nav a {
    color: rgba(255,255,255,0.82);
    text-decoration: none;
    font-size: 0.82rem;
    font-weight: 500;
    padding: 0 0.9rem;
    height: 56px;
    display: flex;
    align-items: center;
    transition: color 0.2s, background 0.2s;
    border-bottom: 3px solid transparent;
    white-space: nowrap;
  }

  nav a:hover, nav a.active {
    color: white;
    background: rgba(255,255,255,0.12);
    border-bottom-color: var(--accent4);
  }

  /* HERO */
  .hero {
    background: linear-gradient(135deg, #1a3a8f 0%, #0f2260 60%, #1a3a8f 100%);
    color: white;
    padding: 5rem 2rem 4rem;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.04'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  }

  .hero h1 {
    font-family: 'Syne', sans-serif;
    font-size: clamp(2.2rem, 5vw, 3.8rem);
    font-weight: 800;
    letter-spacing: -0.02em;
    position: relative;
    margin-bottom: 1rem;
  }

  .hero h1 em {
    font-style: normal;
    color: var(--accent4);
  }

  .hero p {
    font-size: 1.15rem;
    color: rgba(255,255,255,0.8);
    max-width: 640px;
    margin: 0 auto 2rem;
    position: relative;
  }

  .hero-badges {
    display: flex;
    gap: 0.75rem;
    justify-content: center;
    flex-wrap: wrap;
    position: relative;
  }

  .badge {
    background: rgba(255,255,255,0.12);
    border: 1px solid rgba(255,255,255,0.2);
    color: white;
    padding: 0.35rem 0.85rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
  }

  /* SECTION */
  section {
    max-width: 1100px;
    margin: 0 auto;
    padding: 4rem 2rem;
    scroll-margin-top: 64px;
  }

  .section-title {
    font-family: 'Syne', sans-serif;
    font-size: 1.9rem;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 0.4rem;
  }

  .section-sub {
    color: var(--muted);
    margin-bottom: 2.5rem;
    font-size: 0.97rem;
  }

  .divider {
    width: 48px;
    height: 4px;
    background: var(--accent4);
    border-radius: 2px;
    margin: 0.6rem 0 2rem;
  }

  /* CARDS */
  .card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.25rem;
  }

  .card {
    background: var(--surface);
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid var(--border);
    transition: transform 0.2s, box-shadow 0.2s;
    position: relative;
    overflow: hidden;
  }

  .card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: var(--card-color, var(--accent));
  }

  .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 32px rgba(26,58,143,0.12);
  }

  .card-icon {
    font-size: 2rem;
    margin-bottom: 0.75rem;
    display: block;
  }

  .card h3 {
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 1.05rem;
    margin-bottom: 0.5rem;
    color: var(--text);
  }

  .card p {
    font-size: 0.9rem;
    color: var(--muted);
  }

  /* TABS */
  .tabs {
    display: flex;
    gap: 0;
    border-bottom: 2px solid var(--border);
    margin-bottom: 2rem;
    overflow-x: auto;
  }

  .tab-btn {
    padding: 0.75rem 1.25rem;
    border: none;
    background: none;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--muted);
    border-bottom: 3px solid transparent;
    margin-bottom: -2px;
    transition: color 0.2s, border-color 0.2s;
    white-space: nowrap;
  }

  .tab-btn.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
    font-weight: 600;
  }

  .tab-panel { display: none; }
  .tab-panel.active { display: block; animation: fadeIn 0.3s ease; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

  /* THREE-WAY HANDSHAKE */
  .handshake-viz {
    background: var(--surface);
    border-radius: 16px;
    padding: 2.5rem 2rem;
    border: 1px solid var(--border);
    position: relative;
    overflow: hidden;
  }

  .hs-row {
    display: grid;
    grid-template-columns: 1fr 2fr 1fr;
    align-items: center;
    margin-bottom: 1.5rem;
    gap: 1rem;
  }

  .hs-endpoint {
    background: var(--accent);
    color: white;
    border-radius: 10px;
    padding: 0.75rem;
    text-align: center;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 0.9rem;
  }

  .hs-endpoint.server { background: var(--accent3); }

  .hs-arrow-area {
    position: relative;
    height: 48px;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .hs-step {
    display: flex;
    align-items: center;
    margin-bottom: 2.5rem;
    gap: 1rem;
    opacity: 0;
    transform: translateX(-20px);
    transition: opacity 0.5s, transform 0.5s;
  }

  .hs-step.show { opacity: 1; transform: translateX(0); }

  .hs-step-num {
    width: 36px; height: 36px;
    border-radius: 50%;
    background: var(--accent);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    flex-shrink: 0;
  }

  .hs-arrow {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .hs-line {
    flex: 1;
    height: 2px;
    background: currentColor;
    position: relative;
  }

  .hs-label {
    background: var(--accent);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-family: 'JetBrains Mono', monospace;
    font-weight: 600;
    white-space: nowrap;
  }

  .hs-label.ack { background: var(--accent3); }
  .hs-label.synack { background: var(--accent2); }

  .arrow-right::after {
    content: '‚ñ∂';
    font-size: 0.7rem;
    color: var(--accent);
  }

  .arrow-left::before {
    content: '‚óÄ';
    font-size: 0.7rem;
    color: var(--accent2);
  }

  /* TCP HEADER BUILDER */
  .header-builder {
    background: var(--surface);
    border-radius: 16px;
    border: 1px solid var(--border);
    overflow: hidden;
  }

  .hb-title {
    background: var(--accent);
    color: white;
    padding: 1rem 1.5rem;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .hb-form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
  }

  .hb-field {
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--border);
    border-right: 1px solid var(--border);
  }

  .hb-field:nth-child(even) { border-right: none; }

  .hb-field label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 0.35rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }

  .hb-field label .info-icon {
    width: 16px; height: 16px;
    border-radius: 50%;
    background: var(--border);
    color: var(--muted);
    font-size: 0.7rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: help;
    font-style: normal;
    font-weight: 700;
    position: relative;
  }

  .hb-field label .info-icon:hover::after {
    content: attr(data-tip);
    position: absolute;
    bottom: 120%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--text);
    color: white;
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    font-size: 0.75rem;
    white-space: nowrap;
    z-index: 10;
    font-weight: 400;
    text-transform: none;
    letter-spacing: 0;
    max-width: 220px;
    white-space: normal;
    width: 200px;
  }

  .hb-field input, .hb-field select {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1.5px solid var(--border);
    border-radius: 7px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.9rem;
    background: var(--bg);
    color: var(--text);
    transition: border-color 0.2s;
  }

  .hb-field input:focus, .hb-field select:focus {
    outline: none;
    border-color: var(--accent);
    background: white;
  }

  .flags-row {
    grid-column: 1 / -1;
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--border);
  }

  .flags-row label {
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.04em;
    display: block;
    margin-bottom: 0.75rem;
  }

  .flags-grid {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .flag-toggle {
    position: relative;
  }

  .flag-toggle input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    width: 0; height: 0;
  }

  .flag-toggle label {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    cursor: pointer;
    padding: 0.4rem 0.85rem;
    border-radius: 20px;
    border: 2px solid var(--border);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--muted);
    transition: all 0.2s;
    text-transform: none;
    letter-spacing: 0;
    background: var(--bg);
    user-select: none;
  }

  .flag-toggle input:checked + label {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
  }

  .flag-toggle input:checked + label.ack { background: var(--accent3); border-color: var(--accent3); }
  .flag-toggle input:checked + label.rst { background: var(--accent2); border-color: var(--accent2); }
  .flag-toggle input:checked + label.fin { background: var(--accent4); border-color: var(--accent4); color: var(--text); }
  .flag-toggle input:checked + label.psh { background: #8b5cf6; border-color: #8b5cf6; }
  .flag-toggle input:checked + label.urg { background: #ef4444; border-color: #ef4444; }

  .hb-output {
    grid-column: 1 / -1;
    padding: 1.5rem;
    background: var(--code-bg);
    color: var(--code-text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.82rem;
  }

  .hb-output-title {
    color: #64748b;
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 1rem;
  }

  .hex-display {
    display: flex;
    flex-wrap: wrap;
    gap: 0.35rem;
    margin-bottom: 1rem;
  }

  .hex-byte {
    padding: 0.25rem 0.4rem;
    border-radius: 4px;
    background: rgba(255,255,255,0.05);
    font-size: 0.78rem;
    transition: background 0.2s;
  }

  .hex-byte.field-src { background: rgba(26,58,143,0.4); }
  .hex-byte.field-dst { background: rgba(42,157,143,0.4); }
  .hex-byte.field-seq { background: rgba(244,162,97,0.3); }
  .hex-byte.field-ack { background: rgba(230,57,70,0.3); }
  .hex-byte.field-flags { background: rgba(139,92,246,0.4); }
  .hex-byte.field-win { background: rgba(16,185,129,0.3); }
  .hex-byte.field-chk { background: rgba(245,158,11,0.3); }
  .hex-byte.field-urg2 { background: rgba(239,68,68,0.3); }

  .visual-header {
    margin-top: 1rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2px;
  }

  .vh-cell {
    background: rgba(255,255,255,0.05);
    padding: 0.4rem 0.5rem;
    font-size: 0.72rem;
    border-radius: 3px;
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
  }

  .vh-cell.wide { grid-column: 1 / -1; }

  .vh-label {
    color: #94a3b8;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }

  .vh-value { color: #f1f5f9; font-weight: 600; }

  /* FLAGS visualization */
  .flags-viz {
    display: flex;
    gap: 2px;
    font-size: 0.7rem;
    font-family: 'JetBrains Mono', monospace;
  }

  .fv-bit {
    width: 28px;
    height: 28px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border-radius: 3px;
    background: rgba(255,255,255,0.05);
    transition: background 0.2s;
    font-size: 0.62rem;
  }

  .fv-bit.on { background: rgba(139,92,246,0.5); color: white; }
  .fv-name { font-size: 0.55rem; color: #94a3b8; }

  /* ACCORDION */
  .accordion { border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }

  .acc-item { border-bottom: 1px solid var(--border); }
  .acc-item:last-child { border-bottom: none; }

  .acc-header {
    width: 100%;
    padding: 1rem 1.25rem;
    background: var(--surface);
    border: none;
    cursor: pointer;
    text-align: left;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.97rem;
    font-weight: 600;
    color: var(--text);
    transition: background 0.2s;
    gap: 1rem;
  }

  .acc-header:hover { background: var(--surface2); }

  .acc-icon {
    width: 24px; height: 24px;
    border-radius: 50%;
    background: var(--accent);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    flex-shrink: 0;
    transition: transform 0.3s;
  }

  .acc-item.open .acc-icon { transform: rotate(180deg); }

  .acc-body {
    display: none;
    padding: 1.25rem;
    background: var(--surface);
    border-top: 1px solid var(--border);
    font-size: 0.92rem;
    color: var(--muted);
    line-height: 1.8;
  }

  .acc-item.open .acc-body { display: block; animation: fadeIn 0.25s ease; }

  /* QUIZ */
  .quiz-card {
    background: var(--surface);
    border-radius: 12px;
    border: 1px solid var(--border);
    padding: 1.75rem;
    margin-bottom: 1.25rem;
  }

  .quiz-q {
    font-weight: 600;
    margin-bottom: 1rem;
    font-size: 0.97rem;
  }

  .quiz-options {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
  }

  .quiz-opt {
    padding: 0.65rem 1rem;
    border: 2px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.2s;
    background: var(--bg);
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .quiz-opt:hover { border-color: var(--accent); background: white; }
  .quiz-opt.correct { border-color: var(--success); background: #f0fdf4; color: #065f46; }
  .quiz-opt.wrong { border-color: var(--accent2); background: #fff5f5; color: #9b1c1c; }
  .quiz-opt.selected { font-weight: 600; }

  .quiz-opt-letter {
    width: 26px; height: 26px;
    border-radius: 50%;
    background: var(--border);
    color: var(--muted);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: 700;
    flex-shrink: 0;
    transition: all 0.2s;
  }

  .quiz-opt.correct .quiz-opt-letter { background: var(--success); color: white; }
  .quiz-opt.wrong .quiz-opt-letter { background: var(--accent2); color: white; }

  .quiz-feedback {
    margin-top: 1rem;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    font-size: 0.88rem;
    display: none;
  }

  .quiz-feedback.show { display: block; animation: fadeIn 0.3s; }
  .quiz-feedback.correct { background: #f0fdf4; color: #065f46; border-left: 4px solid var(--success); }
  .quiz-feedback.wrong { background: #fff5f5; color: #9b1c1c; border-left: 4px solid var(--accent2); }

  .quiz-score {
    text-align: center;
    font-family: 'Syne', sans-serif;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent);
    padding: 1rem;
    display: none;
  }

  /* STATE MACHINE */
  .states-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1rem;
  }

  .state-card {
    background: var(--surface);
    border: 2px solid var(--border);
    border-radius: 10px;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
  }

  .state-card:hover, .state-card.active {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(26,58,143,0.1);
  }

  .state-card h4 {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--accent);
    margin-bottom: 0.35rem;
  }

  .state-card p {
    font-size: 0.8rem;
    color: var(--muted);
  }

  .state-detail {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 1.5rem;
    margin-top: 1rem;
    display: none;
    animation: fadeIn 0.3s;
  }

  .state-detail.show { display: block; }
  .state-detail h3 { font-family: 'Syne', sans-serif; color: var(--accent); margin-bottom: 0.5rem; }
  .state-detail p { color: var(--muted); font-size: 0.92rem; }

  /* flow control */
  .slider-container {
    background: var(--surface);
    border-radius: 12px;
    padding: 2rem;
    border: 1px solid var(--border);
  }

  .slider-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .slider-row label {
    min-width: 140px;
    font-size: 0.88rem;
    font-weight: 600;
  }

  .slider-row input[type=range] {
    flex: 1;
    accent-color: var(--accent);
  }

  .slider-val {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 600;
    font-size: 0.9rem;
    min-width: 80px;
    color: var(--accent);
  }

  .win-viz {
    margin-top: 1.5rem;
    background: var(--code-bg);
    border-radius: 10px;
    padding: 1.5rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.82rem;
    color: var(--code-text);
  }

  .segment-bar {
    display: flex;
    gap: 2px;
    margin-top: 1rem;
    height: 36px;
    align-items: stretch;
  }

  .seg {
    border-radius: 4px;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.65rem;
    font-weight: 600;
    transition: all 0.4s;
  }

  .seg.sent { background: rgba(26,58,143,0.5); }
  .seg.acked { background: rgba(16,185,129,0.5); }
  .seg.window { background: rgba(244,162,97,0.5); }
  .seg.future { background: rgba(255,255,255,0.05); }

  /* Footer */
  footer {
    background: var(--accent);
    color: rgba(255,255,255,0.7);
    text-align: center;
    padding: 2rem;
    font-size: 0.85rem;
    margin-top: 4rem;
  }

  footer strong { color: white; }

  /* Utility */
  .note {
    background: var(--highlight);
    border-left: 4px solid var(--accent4);
    border-radius: 0 8px 8px 0;
    padding: 1rem 1.25rem;
    margin: 1.5rem 0;
    font-size: 0.9rem;
  }

  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
  @media (max-width: 700px) { .two-col { grid-template-columns: 1fr; } .hb-form { grid-template-columns: 1fr; } .hb-field { border-right: none; } nav a { padding: 0 0.5rem; font-size: 0.75rem; } }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.88rem;
    background: var(--surface);
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid var(--border);
  }

  th {
    background: var(--accent);
    color: white;
    padding: 0.75rem 1rem;
    text-align: left;
    font-family: 'Syne', sans-serif;
    font-weight: 600;
    font-size: 0.82rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }

  td { padding: 0.65rem 1rem; border-bottom: 1px solid var(--border); }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: var(--surface2); }

  .tag {
    display: inline-block;
    padding: 0.15rem 0.6rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    font-family: 'JetBrains Mono', monospace;
  }

  .tag-blue { background: #dbeafe; color: #1e40af; }
  .tag-green { background: #d1fae5; color: #065f46; }
  .tag-red { background: #fee2e2; color: #991b1b; }
  .tag-orange { background: #ffedd5; color: #9a3412; }
  .tag-purple { background: #ede9fe; color: #5b21b6; }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1.25rem;
    border-radius: 8px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
  }

  .btn-primary { background: var(--accent); color: white; }
  .btn-primary:hover { background: #0f2260; transform: translateY(-1px); }
  .btn-outline { background: transparent; color: var(--accent); border: 2px solid var(--accent); }
  .btn-outline:hover { background: var(--accent); color: white; }

  code {
    font-family: 'JetBrains Mono', monospace;
    background: var(--code-bg);
    color: #a5f3fc;
    padding: 0.2em 0.45em;
    border-radius: 4px;
    font-size: 0.85em;
  }

  .wireshark-box {
    background: var(--code-bg);
    border-radius: 10px;
    padding: 1.5rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    line-height: 1.9;
    overflow-x: auto;
  }

  .ws-green { color: #4ade80; }
  .ws-blue { color: #60a5fa; }
  .ws-yellow { color: #fbbf24; }
  .ws-orange { color: #fb923c; }
  .ws-purple { color: #c084fc; }
  .ws-white { color: #f1f5f9; }
  .ws-gray { color: #64748b; }

  .progress-bar-wrap {
    background: var(--border);
    border-radius: 8px;
    height: 6px;
    margin: 0.5rem 0 2rem;
  }
  .progress-bar-fill {
    height: 100%;
    background: var(--accent);
    border-radius: 8px;
    transition: width 0.4s;
  }

  #quiz-progress { font-size: 0.82rem; color: var(--muted); margin-bottom: 0.25rem; }
</style>
</head>
<body>

<!-- NAV -->
<nav id="main-nav">
  <div class="logo">
    üåê TCP Protocol <span>LESSON</span>
  </div>
  <a href="#overview" onclick="scrollTo('overview')">Overview</a>
  <a href="#header" onclick="scrollTo('header')">Header</a>
  <a href="#handshake" onclick="scrollTo('handshake')">Handshake</a>
  <a href="#states" onclick="scrollTo('states')">States</a>
  <a href="#flow" onclick="scrollTo('flow')">Flow Control</a>
  <a href="#builder" onclick="scrollTo('builder')">Builder</a>
  <a href="#compare" onclick="scrollTo('compare')">TCP vs UDP</a>
  <a href="#quiz" onclick="scrollTo('quiz')">Quiz</a>
</nav>

<!-- HERO -->
<div class="hero">
  <h1>Transmission Control <em>Protocol</em></h1>
  <p>A comprehensive, interactive lesson covering TCP architecture, header anatomy, connection management, flow control, and network administrator skills.</p>
  <div class="hero-badges">
    <span class="badge">üìö RFC 793 / RFC 9293</span>
    <span class="badge">üéì CompTIA Network+</span>
    <span class="badge">üîê CISSP Domain 4</span>
    <span class="badge">‚öôÔ∏è Transport Layer (OSI Layer 4)</span>
    <span class="badge">üõ†Ô∏è Wireshark Analysis</span>
  </div>
</div>

<!-- OVERVIEW -->
<section id="overview">
  <p class="section-title">1 ¬∑ What is TCP?</p>
  <div class="divider"></div>
  <p class="section-sub">TCP (Transmission Control Protocol) is a connection-oriented, reliable transport-layer protocol defined in RFC 793 (1981) and updated by RFC 9293 (2022).</p>

  <div class="tabs">
    <button class="tab-btn active" onclick="showTab('core-tab', this)">Core Concepts</button>
    <button class="tab-btn" onclick="showTab('char-tab', this)">Characteristics</button>
    <button class="tab-btn" onclick="showTab('use-tab', this)">Real-World Use</button>
    <button class="tab-btn" onclick="showTab('adm-tab', this)">Admin Skills</button>
  </div>

  <div id="core-tab" class="tab-panel active">
    <div class="card-grid">
      <div class="card" style="--card-color:#1a3a8f">
        <span class="card-icon">üîó</span>
        <h3>Connection-Oriented</h3>
        <p>TCP requires a logical connection to be established between endpoints before any data transfer begins ‚Äî via the three-way handshake (SYN ‚Üí SYN-ACK ‚Üí ACK).</p>
      </div>
      <div class="card" style="--card-color:#2a9d8f">
        <span class="card-icon">‚úÖ</span>
        <h3>Reliable Delivery</h3>
        <p>Every segment is acknowledged. Unacknowledged segments are retransmitted. Sequence numbers ensure in-order delivery and detect lost or duplicate packets.</p>
      </div>
      <div class="card" style="--card-color:#f4a261">
        <span class="card-icon">üö¶</span>
        <h3>Flow Control</h3>
        <p>The receiver advertises a window size, telling the sender how much data can be buffered at any one time ‚Äî preventing buffer overflow at the receiver.</p>
      </div>
      <div class="card" style="--card-color:#e63946">
        <span class="card-icon">üåê</span>
        <h3>Congestion Control</h3>
        <p>TCP dynamically adjusts the sending rate using algorithms like CUBIC, BBR, and Reno to avoid overwhelming intermediate network devices.</p>
      </div>
      <div class="card" style="--card-color:#8b5cf6">
        <span class="card-icon">üì¶</span>
        <h3>Full-Duplex</h3>
        <p>Data can flow in both directions simultaneously. Each direction has its own sequence number space and acknowledgment mechanism.</p>
      </div>
      <div class="card" style="--card-color:#10b981">
        <span class="card-icon">üî¢</span>
        <h3>Byte-Stream Service</h3>
        <p>TCP treats data as a continuous byte stream, not as individual messages. Application boundaries are not preserved ‚Äî the application must delimit its own messages.</p>
      </div>
    </div>
  </div>

  <div id="char-tab" class="tab-panel">
    <table>
      <thead><tr><th>Characteristic</th><th>TCP Behavior</th><th>Relevance</th></tr></thead>
      <tbody>
        <tr><td>Protocol Number</td><td><span class="tag tag-blue">IP Protocol 6</span></td><td>Identifies TCP within IP packets</td></tr>
        <tr><td>Connection Setup</td><td>3-Way Handshake (SYN, SYN-ACK, ACK)</td><td>Adds ~1 RTT before data transfer</td></tr>
        <tr><td>Teardown</td><td>4-Way Handshake (FIN, ACK, FIN, ACK) or RST</td><td>Graceful vs abrupt close</td></tr>
        <tr><td>Header Size</td><td>20 bytes minimum, up to 60 bytes with options</td><td>More overhead than UDP (8 bytes)</td></tr>
        <tr><td>Sequencing</td><td>32-bit sequence & acknowledgment numbers</td><td>Order and reliability assurance</td></tr>
        <tr><td>Error Detection</td><td>16-bit checksum (header + data + pseudo-header)</td><td>Detects corruption in transit</td></tr>
        <tr><td>Window Size</td><td>16-bit field (up to 65,535 bytes; scaled with options)</td><td>Enables flow control</td></tr>
        <tr><td>Common Ports</td><td>HTTP:80, HTTPS:443, SSH:22, FTP:21, SMTP:25</td><td>Port-based multiplexing</td></tr>
        <tr><td>MSS</td><td>Maximum Segment Size negotiated in SYN options</td><td>Avoids IP fragmentation</td></tr>
        <tr><td>TIME_WAIT</td><td>2 √ó MSL (typically 60‚Äì240 sec) after close</td><td>Prevents stale packets entering new connections</td></tr>
      </tbody>
    </table>
  </div>

  <div id="use-tab" class="tab-panel">
    <div class="card-grid">
      <div class="card" style="--card-color:#1a3a8f">
        <span class="card-icon">üåç</span>
        <h3>Web Browsing (HTTP/HTTPS)</h3>
        <p>Every webpage request uses TCP. HTTP/1.1 uses persistent connections; HTTP/2 multiplexes streams over a single TCP connection.</p>
      </div>
      <div class="card" style="--card-color:#2a9d8f">
        <span class="card-icon">üìß</span>
        <h3>Email (SMTP / IMAP / POP3)</h3>
        <p>All major email protocols rely on TCP for guaranteed delivery of messages between mail servers and clients.</p>
      </div>
      <div class="card" style="--card-color:#f4a261">
        <span class="card-icon">üñ•Ô∏è</span>
        <h3>Remote Administration (SSH / RDP)</h3>
        <p>TCP ensures that remote shell commands are delivered in order ‚Äî critical when sequence matters for configuration changes.</p>
      </div>
      <div class="card" style="--card-color:#e63946">
        <span class="card-icon">üìÅ</span>
        <h3>File Transfers (FTP / SFTP / SCP)</h3>
        <p>File integrity depends on TCP's reliability ‚Äî a single bit error in a database file could be catastrophic.</p>
      </div>
      <div class="card" style="--card-color:#8b5cf6">
        <span class="card-icon">üóÑÔ∏è</span>
        <h3>Databases (MySQL / PostgreSQL)</h3>
        <p>Database queries and transactions require ordered, reliable delivery. Most RDBMS clients use TCP natively.</p>
      </div>
      <div class="card" style="--card-color:#10b981">
        <span class="card-icon">üì°</span>
        <h3>VPN Tunnels (OpenVPN / WireGuard)</h3>
        <p>Many VPN implementations encapsulate tunneled traffic over TCP for firewall traversal, though UDP is often preferred for performance.</p>
      </div>
    </div>
  </div>

  <div id="adm-tab" class="tab-panel">
    <div class="accordion">
      <div class="acc-item">
        <button class="acc-header" onclick="toggleAcc(this)">
          üîç Capturing and Analyzing TCP Traffic with Wireshark
          <span class="acc-icon">‚ñº</span>
        </button>
        <div class="acc-body">
          <p>Network administrators use Wireshark to capture, dissect, and troubleshoot TCP sessions. Key filters include:<br><br>
          <code>tcp.flags.syn == 1</code> ‚Äî Show SYN packets only<br>
          <code>tcp.flags.reset == 1</code> ‚Äî Find RST resets (abnormal closes)<br>
          <code>tcp.analysis.retransmission</code> ‚Äî Identify retransmissions<br>
          <code>tcp.stream eq 0</code> ‚Äî Follow a specific TCP stream<br>
          <code>tcp.port == 443</code> ‚Äî Filter HTTPS traffic<br><br>
          The "TCP Stream" follow feature reconstructs the raw byte stream for deeper analysis of application data.</p>
        </div>
      </div>
      <div class="acc-item">
        <button class="acc-header" onclick="toggleAcc(this)">
          üõ°Ô∏è TCP in Firewall Rules and ACLs
          <span class="acc-icon">‚ñº</span>
        </button>
        <div class="acc-body">
          <p>Stateful firewalls track TCP connection state. Admins must understand:<br><br>
          ‚Ä¢ <strong>Established sessions</strong> ‚Äî allow return traffic without explicit inbound rules<br>
          ‚Ä¢ <strong>SYN floods</strong> ‚Äî DoS attack using half-open connections (SYN_RCVD state)<br>
          ‚Ä¢ <strong>RST injection attacks</strong> ‚Äî adversarial TCP resets disrupting legitimate sessions<br>
          ‚Ä¢ <strong>Port-based ACLs</strong> ‚Äî matching on source/destination port, flags<br>
          ‚Ä¢ <strong>TCP state inspection</strong> ‚Äî only permit packets matching known-good connection state</p>
        </div>
      </div>
      <div class="acc-item">
        <button class="acc-header" onclick="toggleAcc(this)">
          ‚ö° Tuning TCP for Performance
          <span class="acc-icon">‚ñº</span>
        </button>
        <div class="acc-body">
          <p>Linux/Windows admins tune TCP kernel parameters for high-throughput networks:<br><br>
          <code>net.core.rmem_max</code> ‚Äî Maximum receive socket buffer<br>
          <code>net.ipv4.tcp_window_scaling</code> ‚Äî Enable Window Scaling option<br>
          <code>net.ipv4.tcp_congestion_control</code> ‚Äî Algorithm: cubic, bbr, reno<br>
          <code>net.ipv4.tcp_tw_reuse</code> ‚Äî Reuse TIME_WAIT sockets<br>
          <code>net.ipv4.tcp_syn_backlog</code> ‚Äî Queue size for half-open connections<br><br>
          For high-bandwidth, long-delay links (BDP = Bandwidth √ó RTT), increasing the window size is critical to fill the "pipe."</p>
        </div>
      </div>
      <div class="acc-item">
        <button class="acc-header" onclick="toggleAcc(this)">
          üö® Common TCP Security Attacks
          <span class="acc-icon">‚ñº</span>
        </button>
        <div class="acc-body">
          <p><strong>SYN Flood:</strong> Attacker sends many SYN packets with spoofed IPs. Server fills its backlog with SYN_RCVD entries. Mitigation: SYN cookies, rate limiting.<br><br>
          <strong>Session Hijacking:</strong> Attacker predicts sequence numbers and injects segments into an established session.<br><br>
          <strong>RST Attack:</strong> Injecting forged RST packets to terminate legitimate connections (used in censorship and DoS).<br><br>
          <strong>Land Attack:</strong> SYN packet with source IP = destination IP, causing OS confusion.<br><br>
          <strong>Teardrop Attack:</strong> Overlapping IP/TCP fragments that crash vulnerable stacks on reassembly.</p>
        </div>
      </div>
      <div class="acc-item">
        <button class="acc-header" onclick="toggleAcc(this)">
          üß∞ Essential netstat / ss Commands
          <span class="acc-icon">‚ñº</span>
        </button>
        <div class="acc-body">
          <p><code>ss -tnp</code> ‚Äî Show all TCP sockets, numeric, with process info<br>
          <code>ss -tnlp</code> ‚Äî Show listening TCP ports<br>
          <code>ss state established</code> ‚Äî Show only ESTABLISHED connections<br>
          <code>netstat -an | grep TIME_WAIT</code> ‚Äî Count TIME_WAIT sockets<br>
          <code>ss -s</code> ‚Äî Socket summary statistics<br>
          <code>tcpdump -i eth0 tcp port 80</code> ‚Äî Capture HTTP TCP traffic<br><br>
          Monitoring TCP connection counts and states is critical for diagnosing server overload, SYN flood attacks, or application bugs causing connection leaks.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- HEADER ANATOMY -->
<section id="header" style="background:var(--surface2); max-width:100%; padding:4rem 2rem;">
  <div style="max-width:1100px;margin:0 auto;">
    <p class="section-title">2 ¬∑ TCP Header Anatomy</p>
    <div class="divider"></div>
    <p class="section-sub">The TCP header is a minimum of 20 bytes (160 bits). Each field serves a specific role in reliable, ordered delivery.</p>

    <div style="background:var(--code-bg);border-radius:14px;padding:2rem;font-family:'JetBrains Mono',monospace;font-size:0.78rem;color:var(--code-text);overflow-x:auto;margin-bottom:2rem;">
      <div style="color:#64748b;margin-bottom:1rem;font-size:0.7rem;letter-spacing:0.1em;">BIT LAYOUT (32 bits per row)</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:2px;min-width:600px;">
        <div style="background:#1a3a8f55;padding:0.5rem;border-radius:4px;text-align:center;"><span style="color:#93c5fd">Source Port</span><div style="color:#475569;font-size:0.65rem">bits 0‚Äì15</div></div>
        <div style="background:#1a3a8f55;padding:0.5rem;border-radius:4px;text-align:center;"><span style="color:#93c5fd">Destination Port</span><div style="color:#475569;font-size:0.65rem">bits 16‚Äì31</div></div>
        <div style="grid-column:1/-1;background:#f4a26155;padding:0.5rem;border-radius:4px;text-align:center;"><span style="color:#fdba74">Sequence Number</span><div style="color:#475569;font-size:0.65rem">bits 32‚Äì63</div></div>
        <div style="grid-column:1/-1;background:#e6394655;padding:0.5rem;border-radius:4px;text-align:center;"><span style="color:#fca5a5">Acknowledgment Number</span><div style="color:#475569;font-size:0.65rem">bits 64‚Äì95</div></div>
        <div style="background:#8b5cf655;padding:0.5rem;border-radius:4px;text-align:center;font-size:0.7rem;"><span style="color:#c4b5fd">Data<br>Offset</span><div style="color:#475569;font-size:0.6rem">4 bits</div></div>
        <div style="background:#8b5cf655;padding:0.5rem;border-radius:4px;text-align:center;"><span style="color:#c4b5fd">Flags (CWR ECE URG ACK PSH RST SYN FIN)</span><div style="color:#475569;font-size:0.6rem">9 control bits</div></div>
        <div style="background:#10b98155;padding:0.5rem;border-radius:4px;text-align:center;"><span style="color:#6ee7b7">Window Size</span><div style="color:#475569;font-size:0.65rem">bits 112‚Äì127</div></div>
        <div style="background:#f59e0b55;padding:0.5rem;border-radius:4px;text-align:center;"><span style="color:#fde68a">Checksum</span><div style="color:#475569;font-size:0.65rem">bits 128‚Äì143</div></div>
        <div style="grid-column:1/-1;background:#ef444455;padding:0.5rem;border-radius:4px;text-align:center;"><span style="color:#fca5a5">Urgent Pointer</span><div style="color:#475569;font-size:0.65rem">bits 144‚Äì159 (only meaningful if URG=1)</div></div>
        <div style="grid-column:1/-1;background:rgba(255,255,255,0.04);padding:0.5rem;border-radius:4px;text-align:center;color:#475569;font-style:italic;font-size:0.72rem;">Options (variable, padded to 32-bit boundary) ‚Äî present only if Data Offset &gt; 5</div>
        <div style="grid-column:1/-1;background:rgba(255,255,255,0.04);padding:0.5rem;border-radius:4px;text-align:center;color:#475569;font-style:italic;font-size:0.72rem;">Data payload (variable)</div>
      </div>
    </div>

    <div class="accordion">
      <div class="acc-item">
        <button class="acc-header" onclick="toggleAcc(this)">üìå Source Port (16 bits) & Destination Port (16 bits)</button>
        <div class="acc-body">
          Ports identify the sending and receiving application processes. Together with IP addresses they form a <em>socket</em> (4-tuple). Well-known ports are 0‚Äì1023, registered ports 1024‚Äì49151, and ephemeral (dynamic) ports 49152‚Äì65535. The OS assigns ephemeral ports to outbound connections. Admins monitor ports to detect unauthorized services.
        </div>
      </div>
      <div class="acc-item">
        <button class="acc-header" onclick="toggleAcc(this)">üî¢ Sequence Number (32 bits)</button>
        <div class="acc-body">
          Identifies the byte-stream position of the first byte of data in this segment. At connection setup, the initial sequence number (ISN) is chosen randomly to prevent session hijacking. ISN = pseudo-random to make it hard for attackers to guess. After connection, the sequence number increments by the number of bytes sent in each segment. Sequence numbers allow the receiver to reassemble out-of-order segments and detect gaps.
        </div>
      </div>
      <div class="acc-item">
        <button class="acc-header" onclick="toggleAcc(this)">‚úÖ Acknowledgment Number (32 bits)</button>
        <div class="acc-body">
          When the ACK flag is set, this field contains the next sequence number the sender of this segment is expecting to receive (i.e., the byte after the last successfully received byte). This uses a "cumulative acknowledgment" scheme. Selective acknowledgment (SACK) options extend this for non-contiguous data.
        </div>
      </div>
      <div class="acc-item">
        <button class="acc-header" onclick="toggleAcc(this)">üìê Data Offset (4 bits)</button>
        <div class="acc-body">
          Specifies the length of the TCP header in 32-bit words, indicating where the data begins. Minimum value is 5 (20 bytes, no options); maximum is 15 (60 bytes, 40 bytes of options). If an admin sees a Data Offset greater than 5, options are present (e.g., MSS, Window Scale, SACK Permitted, Timestamps).
        </div>
      </div>
      <div class="acc-item">
        <button class="acc-header" onclick="toggleAcc(this)">üö© Control Flags (9 bits)</button>
        <div class="acc-body">
          <strong>NS</strong> (Nonce Sum) ‚Äî ECN nonce concealment protection<br>
          <strong>CWR</strong> (Congestion Window Reduced) ‚Äî sender reduced its window after receiving ECE<br>
          <strong>ECE</strong> (ECN-Echo) ‚Äî ECN-capable; signals congestion from the network<br>
          <strong>URG</strong> ‚Äî Urgent pointer field is significant<br>
          <strong>ACK</strong> ‚Äî Acknowledgment field is significant (set in all packets after initial SYN)<br>
          <strong>PSH</strong> ‚Äî Push: flush data to the receiving application immediately<br>
          <strong>RST</strong> ‚Äî Reset the connection abruptly<br>
          <strong>SYN</strong> ‚Äî Synchronize sequence numbers (set only in handshake)<br>
          <strong>FIN</strong> ‚Äî No more data from sender (graceful close initiation)
        </div>
      </div>
      <div class="acc-item">
        <button class="acc-header" onclick="toggleAcc(this)">ü™ü Window Size (16 bits)</button>
        <div class="acc-body">
          Advertised by the receiver to tell the sender the amount of data (in bytes) that can be buffered at the receiver right now. This is the foundation of flow control. With the Window Scale TCP option, the effective window can be multiplied by powers of 2 (up to 2^30 bytes), enabling high-performance networks (satellite, 10 Gbps+). A window of 0 means "stop sending ‚Äî I'm full."
        </div>
      </div>
      <div class="acc-item">
        <button class="acc-header" onclick="toggleAcc(this)">üîç Checksum (16 bits)</button>
        <div class="acc-body">
          A 16-bit one's complement checksum computed over a "pseudo-header" (source IP, dest IP, protocol number, TCP segment length) plus the TCP header and data. Detects accidental corruption. If the checksum fails at the receiver, the segment is silently discarded and a retransmission is triggered. Note: the checksum does NOT detect intentional tampering ‚Äî use TLS for integrity protection.
        </div>
      </div>
      <div class="acc-item">
        <button class="acc-header" onclick="toggleAcc(this)">‚ö° Urgent Pointer (16 bits)</button>
        <div class="acc-body">
          When URG=1, this value is added to the sequence number to indicate the byte position of the last urgent data byte. Urgent data (sometimes called "out-of-band" data) bypasses normal buffering. Rarely used today; historically used by Telnet and rsh. Most firewalls scrutinize URG segments as they can be used in evasion attacks.
        </div>
      </div>
      <div class="acc-item">
        <button class="acc-header" onclick="toggleAcc(this)">üîß TCP Options (variable, 0‚Äì40 bytes)</button>
        <div class="acc-body">
          <strong>MSS (Kind=2):</strong> Maximum Segment Size ‚Äî largest segment sender can accept<br>
          <strong>Window Scale (Kind=3):</strong> Shifts window size left by N bits (2^N multiplier)<br>
          <strong>SACK Permitted (Kind=4):</strong> Announces SACK support<br>
          <strong>SACK (Kind=5):</strong> Selective acknowledgment of non-contiguous blocks<br>
          <strong>Timestamps (Kind=8):</strong> RTT measurement and PAWS (Protection Against Wrapped Sequences)<br>
          <strong>NOP (Kind=1):</strong> Padding / alignment<br>
          <strong>End of Option List (Kind=0):</strong> Marks end of options
        </div>
      </div>
    </div>
  </div>
</section>

<!-- THREE-WAY HANDSHAKE -->
<section id="handshake">
  <p class="section-title">3 ¬∑ TCP Connection Lifecycle</p>
  <div class="divider"></div>
  <p class="section-sub">TCP connections go through a structured setup, data transfer, and teardown process.</p>

  <div class="tabs">
    <button class="tab-btn active" onclick="showTab('syn-tab', this)">3-Way Handshake</button>
    <button class="tab-btn" onclick="showTab('tear-tab', this)">4-Way Teardown</button>
    <button class="tab-btn" onclick="showTab('wire-tab', this)">Wireshark View</button>
  </div>

  <div id="syn-tab" class="tab-panel active">
    <div class="handshake-viz">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:2rem;">
        <div class="hs-endpoint">üíª CLIENT<div style="font-size:0.75rem;font-weight:400;opacity:0.8;">192.168.1.10:54321</div></div>
        <div class="hs-endpoint server">üñ•Ô∏è SERVER<div style="font-size:0.75rem;font-weight:400;opacity:0.8;">10.0.0.1:443</div></div>
      </div>

      <div id="hs-steps">
        <div class="hs-step" id="hs1">
          <div class="hs-step-num">1</div>
          <div style="flex:1">
            <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem;">
              <span class="hs-label">SYN</span>
              <span style="flex:1;height:2px;background:var(--accent);"></span>
              <span>‚Üí</span>
            </div>
            <p style="font-size:0.85rem;color:var(--muted)"><strong>Client ‚Üí Server:</strong> SYN=1, Seq=100 (ISN). "I want to connect. My starting sequence number is 100."</p>
          </div>
        </div>

        <div class="hs-step" id="hs2">
          <div class="hs-step-num" style="background:var(--accent2)">2</div>
          <div style="flex:1">
            <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem;">
              <span>‚Üê</span>
              <span style="flex:1;height:2px;background:var(--accent2);"></span>
              <span class="hs-label synack">SYN-ACK</span>
            </div>
            <p style="font-size:0.85rem;color:var(--muted)"><strong>Server ‚Üí Client:</strong> SYN=1, ACK=1, Seq=300 (server ISN), Ack=101. "Got it. My starting sequence is 300. I acknowledge byte 101."</p>
          </div>
        </div>

        <div class="hs-step" id="hs3">
          <div class="hs-step-num" style="background:var(--accent3)">3</div>
          <div style="flex:1">
            <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem;">
              <span class="hs-label ack">ACK</span>
              <span style="flex:1;height:2px;background:var(--accent3);"></span>
              <span>‚Üí</span>
            </div>
            <p style="font-size:0.85rem;color:var(--muted)"><strong>Client ‚Üí Server:</strong> ACK=1, Seq=101, Ack=301. "Acknowledged! Connection established. Data transfer may now begin."</p>
          </div>
        </div>
      </div>

      <div style="text-align:center;margin-top:1.5rem;">
        <button class="btn btn-primary" onclick="animateHandshake()">‚ñ∂ Animate Handshake</button>
        <button class="btn btn-outline" style="margin-left:0.75rem" onclick="resetHandshake()">‚Ü∫ Reset</button>
      </div>

      <div class="note" style="margin-top:1.5rem">
        <strong>üìù Admin Note:</strong> A high ratio of SYN packets to SYN-ACK packets (half-open connections) may indicate a SYN flood attack. Monitor with <code>ss -s</code> and look for large numbers of connections in the <code>SYN_RCVD</code> state.
      </div>
    </div>
  </div>

  <div id="tear-tab" class="tab-panel">
    <div class="handshake-viz">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:2rem;">
        <div class="hs-endpoint">üíª CLIENT</div>
        <div class="hs-endpoint server">üñ•Ô∏è SERVER</div>
      </div>

      <div class="hs-step show">
        <div class="hs-step-num">1</div>
        <div style="flex:1">
          <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem;">
            <span class="hs-label">FIN</span>
            <span style="flex:1;height:2px;background:var(--accent);"></span><span>‚Üí</span>
          </div>
          <p style="font-size:0.85rem;color:var(--muted)"><strong>Client ‚Üí Server:</strong> FIN=1, Seq=X. "I have no more data to send. Initiating graceful close."</p>
        </div>
      </div>
      <div class="hs-step show">
        <div class="hs-step-num" style="background:var(--accent2)">2</div>
        <div style="flex:1">
          <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem;">
            <span>‚Üê</span><span style="flex:1;height:2px;background:var(--accent2);"></span>
            <span class="hs-label synack">ACK</span>
          </div>
          <p style="font-size:0.85rem;color:var(--muted)"><strong>Server ‚Üí Client:</strong> ACK=1, Ack=X+1. "Got your FIN. I may still have data to send ‚Äî half-close state."</p>
        </div>
      </div>
      <div class="hs-step show">
        <div class="hs-step-num" style="background:var(--accent3)">3</div>
        <div style="flex:1">
          <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem;">
            <span>‚Üê</span><span style="flex:1;height:2px;background:var(--accent2);"></span>
            <span class="hs-label synack">FIN</span>
          </div>
          <p style="font-size:0.85rem;color:var(--muted)"><strong>Server ‚Üí Client:</strong> FIN=1, Seq=Y. "Now I'm done too. Closing my side."</p>
        </div>
      </div>
      <div class="hs-step show">
        <div class="hs-step-num" style="background:#8b5cf6">4</div>
        <div style="flex:1">
          <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem;">
            <span class="hs-label" style="background:#8b5cf6">ACK</span>
            <span style="flex:1;height:2px;background:#8b5cf6;"></span><span>‚Üí</span>
          </div>
          <p style="font-size:0.85rem;color:var(--muted)"><strong>Client ‚Üí Server:</strong> ACK=1, Ack=Y+1. "Received. Client enters TIME_WAIT for 2√óMSL before fully closing."</p>
        </div>
      </div>

      <div class="note">
        <strong>üïê TIME_WAIT State:</strong> After sending the final ACK, the active closer waits 2 √ó MSL (Maximum Segment Lifetime, typically 60s) before closing. This ensures the final ACK reaches the server (in case it was lost and the server resent its FIN). Admins may see many TIME_WAIT sockets on busy web servers ‚Äî this is normal but can exhaust port ranges under high connection rates.
      </div>
    </div>
  </div>

  <div id="wire-tab" class="tab-panel">
    <p style="color:var(--muted);margin-bottom:1rem;font-size:0.9rem;">Simulated Wireshark packet list showing a complete TCP connection to port 80:</p>
    <div class="wireshark-box">
      <span class="ws-gray">No.   Time      Src IP          Dst IP          Proto  Info</span><br>
      <span class="ws-blue"> 1    0.000000  192.168.1.10    10.0.0.1        TCP    54321 ‚Üí 80 [SYN] Seq=0 Win=65535 Len=0 MSS=1460 WS=128 SACK_PERM</span><br>
      <span class="ws-green"> 2    0.012341  10.0.0.1        192.168.1.10    TCP    80 ‚Üí 54321 [SYN, ACK] Seq=0 Ack=1 Win=28960 Len=0 MSS=1460</span><br>
      <span class="ws-blue"> 3    0.012890  192.168.1.10    10.0.0.1        TCP    54321 ‚Üí 80 [ACK] Seq=1 Ack=1 Win=65535 Len=0</span><br>
      <span class="ws-yellow"> 4    0.013001  192.168.1.10    10.0.0.1        HTTP   GET / HTTP/1.1</span><br>
      <span class="ws-green"> 5    0.025441  10.0.0.1        192.168.1.10    TCP    80 ‚Üí 54321 [ACK] Seq=1 Ack=78 Win=29056 Len=0</span><br>
      <span class="ws-orange"> 6    0.026100  10.0.0.1        192.168.1.10    HTTP   HTTP/1.1 200 OK  (text/html) [TCP segment 1]</span><br>
      <span class="ws-orange"> 7    0.026200  10.0.0.1        192.168.1.10    TCP    [TCP segment 2] Seq=1461 Len=1460</span><br>
      <span class="ws-blue"> 8    0.026900  192.168.1.10    10.0.0.1        TCP    [ACK] Seq=78 Ack=2921 Win=64576 Len=0</span><br>
      <span class="ws-purple"> 9    0.140000  192.168.1.10    10.0.0.1        TCP    54321 ‚Üí 80 [FIN, ACK] Seq=78 Ack=4381 Win=64576 Len=0</span><br>
      <span class="ws-green">10    0.152341  10.0.0.1        192.168.1.10    TCP    80 ‚Üí 54321 [FIN, ACK] Seq=4381 Ack=79 Win=29056 Len=0</span><br>
      <span class="ws-blue">11    0.152900  192.168.1.10    10.0.0.1        TCP    54321 ‚Üí 80 [ACK] Seq=79 Ack=4382 Win=64575 Len=0</span>
    </div>
    <div style="margin-top:1rem;display:flex;gap:1rem;flex-wrap:wrap;font-size:0.83rem;">
      <span style="color:var(--ws-blue,#60a5fa)">üîµ Client ‚Üí Server</span>
      <span style="color:var(--ws-green,#4ade80)">üü¢ Server ‚Üí Client</span>
      <span style="color:#fbbf24">üü° HTTP Data</span>
      <span style="color:#fb923c">üü† Response Segments</span>
      <span style="color:#c084fc">üü£ Connection Close</span>
    </div>
  </div>
</section>

<!-- STATES -->
<section id="states" style="background:var(--surface2);max-width:100%;padding:4rem 2rem;">
  <div style="max-width:1100px;margin:0 auto;">
    <p class="section-title">4 ¬∑ TCP State Machine</p>
    <div class="divider"></div>
    <p class="section-sub">TCP maintains connection state using a finite state machine. Click any state to learn more.</p>

    <div class="states-grid">
      <div class="state-card" onclick="showState('CLOSED')"><h4>CLOSED</h4><p>No connection exists</p></div>
      <div class="state-card" onclick="showState('LISTEN')"><h4>LISTEN</h4><p>Waiting for connection</p></div>
      <div class="state-card" onclick="showState('SYN_SENT')"><h4>SYN_SENT</h4><p>SYN sent, awaiting SYN-ACK</p></div>
      <div class="state-card" onclick="showState('SYN_RECEIVED')"><h4>SYN_RECEIVED</h4><p>SYN received, sent SYN-ACK</p></div>
      <div class="state-card" onclick="showState('ESTABLISHED')"><h4>ESTABLISHED</h4><p>Connection open, data flows</p></div>
      <div class="state-card" onclick="showState('FIN_WAIT_1')"><h4>FIN_WAIT_1</h4><p>FIN sent, awaiting ACK</p></div>
      <div class="state-card" onclick="showState('FIN_WAIT_2')"><h4>FIN_WAIT_2</h4><p>Our FIN ACKed, wait for peer FIN</p></div>
      <div class="state-card" onclick="showState('CLOSE_WAIT')"><h4>CLOSE_WAIT</h4><p>Peer FIN received, waiting to close</p></div>
      <div class="state-card" onclick="showState('CLOSING')"><h4>CLOSING</h4><p>Both sides sent FIN simultaneously</p></div>
      <div class="state-card" onclick="showState('LAST_ACK')"><h4>LAST_ACK</h4><p>Waiting for our FIN to be ACKed</p></div>
      <div class="state-card" onclick="showState('TIME_WAIT')"><h4>TIME_WAIT</h4><p>Waiting 2√óMSL before CLOSED</p></div>
    </div>

    <div id="state-detail" class="state-detail"></div>
  </div>
</section>

<!-- FLOW CONTROL -->
<section id="flow">
  <p class="section-title">5 ¬∑ Flow Control & Congestion Control</p>
  <div class="divider"></div>
  <p class="section-sub">TCP dynamically adapts to receiver capacity and network conditions to maximize throughput without causing harm.</p>

  <div class="tabs">
    <button class="tab-btn active" onclick="showTab('flow-tab', this)">Sliding Window</button>
    <button class="tab-btn" onclick="showTab('cong-tab', this)">Congestion Control</button>
    <button class="tab-btn" onclick="showTab('calc-tab', this)">BDP Calculator</button>
  </div>

  <div id="flow-tab" class="tab-panel active">
    <div class="slider-container">
      <h3 style="font-family:'Syne',sans-serif;margin-bottom:1.5rem;">Sliding Window Simulator</h3>

      <div class="slider-row">
        <label>Window Size</label>
        <input type="range" min="1" max="8" value="4" id="win-size" oninput="updateWindow()">
        <span class="slider-val" id="win-val">4 segments</span>
      </div>
      <div class="slider-row">
        <label>Segments Acknowledged</label>
        <input type="range" min="0" max="8" value="2" id="ack-pos" oninput="updateWindow()">
        <span class="slider-val" id="ack-val">2 acked</span>
      </div>

      <div class="win-viz">
        <div id="win-status" style="margin-bottom:0.75rem;color:#94a3b8;"></div>
        <div class="segment-bar" id="seg-bar"></div>
        <div style="display:flex;gap:1.5rem;margin-top:1rem;font-size:0.75rem;flex-wrap:wrap;">
          <span><span style="display:inline-block;width:12px;height:12px;background:rgba(16,185,129,0.5);border-radius:2px;margin-right:4px;"></span>Acknowledged</span>
          <span><span style="display:inline-block;width:12px;height:12px;background:rgba(26,58,143,0.5);border-radius:2px;margin-right:4px;"></span>Sent, not yet ACKed</span>
          <span><span style="display:inline-block;width:12px;height:12px;background:rgba(244,162,97,0.5);border-radius:2px;margin-right:4px;"></span>Window (can send now)</span>
          <span><span style="display:inline-block;width:12px;height:12px;background:rgba(255,255,255,0.05);border-radius:2px;margin-right:4px;"></span>Future (outside window)</span>
        </div>
      </div>
    </div>
  </div>

  <div id="cong-tab" class="tab-panel">
    <div class="card-grid">
      <div class="card" style="--card-color:#1a3a8f">
        <span class="card-icon">üöÄ</span>
        <h3>Slow Start</h3>
        <p>Begins with a congestion window (cwnd) of 1 MSS. cwnd doubles each RTT until it reaches the slow-start threshold (ssthresh) or packet loss occurs. Despite the name, exponential growth is fast.</p>
      </div>
      <div class="card" style="--card-color:#2a9d8f">
        <span class="card-icon">üìà</span>
        <h3>Congestion Avoidance</h3>
        <p>Once cwnd reaches ssthresh, it grows linearly (additive increase) ‚Äî by 1 MSS per RTT ‚Äî until congestion is detected. This is the AIMD (Additive Increase, Multiplicative Decrease) phase.</p>
      </div>
      <div class="card" style="--card-color:#e63946">
        <span class="card-icon">üìâ</span>
        <h3>Multiplicative Decrease</h3>
        <p>On packet loss (timeout): ssthresh = cwnd/2, cwnd = 1 MSS. On triple duplicate ACK (fast retransmit): ssthresh = cwnd/2, cwnd = ssthresh. Less aggressive than timeout response.</p>
      </div>
      <div class="card" style="--card-color:#f4a261">
        <span class="card-icon">‚ö°</span>
        <h3>Fast Retransmit</h3>
        <p>When 3 duplicate ACKs are received for the same sequence number, TCP retransmits the missing segment immediately ‚Äî without waiting for the retransmission timer to expire.</p>
      </div>
      <div class="card" style="--card-color:#8b5cf6">
        <span class="card-icon">üß†</span>
        <h3>CUBIC (Linux Default)</h3>
        <p>Grows cwnd as a cubic function of time since last congestion event. Better for high-bandwidth, high-latency networks (long fat networks). Less aggressive on short RTT paths.</p>
      </div>
      <div class="card" style="--card-color:#10b981">
        <span class="card-icon">üåä</span>
        <h3>BBR (Google)</h3>
        <p>Bottleneck Bandwidth and Round-trip propagation time. Models the network path to estimate available bandwidth ‚Äî doesn't rely on packet loss as signal. Widely used in YouTube/Google services.</p>
      </div>
    </div>
  </div>

  <div id="calc-tab" class="tab-panel">
    <div class="slider-container">
      <h3 style="font-family:'Syne',sans-serif;margin-bottom:0.5rem;">Bandwidth-Delay Product Calculator</h3>
      <p style="color:var(--muted);font-size:0.88rem;margin-bottom:1.5rem;">The BDP tells you how many bytes need to be "in flight" to saturate a link. Your TCP window must be at least this large.</p>

      <div class="slider-row">
        <label>Bandwidth</label>
        <input type="range" min="1" max="10000" value="100" id="bw-slider" oninput="calcBDP()">
        <span class="slider-val" id="bw-val">100 Mbps</span>
      </div>
      <div class="slider-row">
        <label>RTT (Round-Trip Time)</label>
        <input type="range" min="1" max="500" value="50" id="rtt-slider" oninput="calcBDP()">
        <span class="slider-val" id="rtt-val">50 ms</span>
      </div>

      <div class="win-viz" id="bdp-result">
        <div style="color:#94a3b8;font-size:0.7rem;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:0.75rem">BDP Analysis</div>
        <div id="bdp-output"></div>
      </div>
    </div>
  </div>
</section>

<!-- TCP HEADER BUILDER -->
<section id="builder" style="background:var(--surface2);max-width:100%;padding:4rem 2rem;">
  <div style="max-width:1100px;margin:0 auto;">
    <p class="section-title">6 ¬∑ TCP Header Builder</p>
    <div class="divider"></div>
    <p class="section-sub">Construct a TCP segment header. As you modify fields, the hex output and visual representation update in real time.</p>

    <div class="header-builder">
      <div class="hb-title">
        üõ†Ô∏è TCP Header Constructor
        <span style="margin-left:auto;font-size:0.8rem;font-weight:400;opacity:0.7">All values update in real time</span>
      </div>
      <div class="hb-form">
        <div class="hb-field">
          <label>Source Port <i class="info-icon" data-tip="Originating process port (0-65535). Ephemeral ports: 49152-65535">i</i></label>
          <input type="number" id="src-port" min="0" max="65535" value="54321" oninput="buildHeader()">
        </div>
        <div class="hb-field">
          <label>Destination Port <i class="info-icon" data-tip="Target service port. Well-known: 0-1023. e.g., 80=HTTP, 443=HTTPS, 22=SSH">i</i></label>
          <input type="number" id="dst-port" min="0" max="65535" value="443" oninput="buildHeader()">
        </div>
        <div class="hb-field">
          <label>Sequence Number <i class="info-icon" data-tip="Byte-stream position of first byte in this segment. Randomly chosen at connection start (ISN) to prevent hijacking.">i</i></label>
          <input type="number" id="seq-num" min="0" max="4294967295" value="1000" oninput="buildHeader()">
        </div>
        <div class="hb-field">
          <label>Acknowledgment Number <i class="info-icon" data-tip="Next expected byte from peer (only meaningful when ACK flag is set).">i</i></label>
          <input type="number" id="ack-num" min="0" max="4294967295" value="0" oninput="buildHeader()">
        </div>
        <div class="hb-field">
          <label>Data Offset <i class="info-icon" data-tip="Header length in 32-bit words. Min=5 (20 bytes). Max=15 (60 bytes with options).">i</i></label>
          <select id="data-offset" onchange="buildHeader()">
            <option value="5">5 (20 bytes - no options)</option>
            <option value="6">6 (24 bytes)</option>
            <option value="7">7 (28 bytes)</option>
            <option value="8">8 (32 bytes)</option>
            <option value="15">15 (60 bytes - max options)</option>
          </select>
        </div>
        <div class="hb-field">
          <label>Window Size <i class="info-icon" data-tip="Receiver advertises available buffer space. Controls flow. Max 65535 bytes (or more with Window Scale option).">i</i></label>
          <input type="number" id="win-size-hb" min="0" max="65535" value="65535" oninput="buildHeader()">
        </div>
        <div class="hb-field">
          <label>Checksum <i class="info-icon" data-tip="Auto-computed over pseudo-header + header + data. Shown as 0x0000 (to be computed).">i</i></label>
          <input type="text" id="checksum" value="0x0000" readonly style="background:#f0f0f0;color:var(--muted)">
        </div>
        <div class="hb-field">
          <label>Urgent Pointer <i class="info-icon" data-tip="Only meaningful if URG flag is set. Points to last byte of urgent data relative to Sequence Number.">i</i></label>
          <input type="number" id="urg-ptr" min="0" max="65535" value="0" oninput="buildHeader()">
        </div>

        <div class="flags-row">
          <label>üö© Control Flags</label>
          <div class="flags-grid">
            <div class="flag-toggle"><input type="checkbox" id="f-syn" onchange="buildHeader()"><label for="f-syn" class="syn">SYN</label></div>
            <div class="flag-toggle"><input type="checkbox" id="f-ack" onchange="buildHeader()"><label for="f-ack" class="ack">ACK</label></div>
            <div class="flag-toggle"><input type="checkbox" id="f-fin" onchange="buildHeader()"><label for="f-fin" class="fin">FIN</label></div>
            <div class="flag-toggle"><input type="checkbox" id="f-rst" onchange="buildHeader()"><label for="f-rst" class="rst">RST</label></div>
            <div class="flag-toggle"><input type="checkbox" id="f-psh" onchange="buildHeader()"><label for="f-psh" class="psh">PSH</label></div>
            <div class="flag-toggle"><input type="checkbox" id="f-urg" onchange="buildHeader()"><label for="f-urg" class="urg">URG</label></div>
            <div class="flag-toggle"><input type="checkbox" id="f-ece" onchange="buildHeader()"><label for="f-ece">ECE</label></div>
            <div class="flag-toggle"><input type="checkbox" id="f-cwr" onchange="buildHeader()"><label for="f-cwr">CWR</label></div>
          </div>
          <div style="margin-top:1rem;">
            <p style="font-size:0.8rem;color:var(--muted);margin-bottom:0.5rem;">Common flag presets:</p>
            <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
              <button class="btn btn-outline" style="font-size:0.78rem;padding:0.35rem 0.75rem" onclick="setPreset('syn')">SYN (connect)</button>
              <button class="btn btn-outline" style="font-size:0.78rem;padding:0.35rem 0.75rem" onclick="setPreset('synack')">SYN-ACK</button>
              <button class="btn btn-outline" style="font-size:0.78rem;padding:0.35rem 0.75rem" onclick="setPreset('ack')">ACK (data)</button>
              <button class="btn btn-outline" style="font-size:0.78rem;padding:0.35rem 0.75rem" onclick="setPreset('pshack')">PSH+ACK</button>
              <button class="btn btn-outline" style="font-size:0.78rem;padding:0.35rem 0.75rem" onclick="setPreset('finack')">FIN+ACK</button>
              <button class="btn btn-outline" style="font-size:0.78rem;padding:0.35rem 0.75rem" onclick="setPreset('rst')">RST (reset)</button>
            </div>
          </div>
        </div>

        <div class="hb-output" style="grid-column:1/-1">
          <div class="hb-output-title">üì¶ Generated TCP Header ‚Äî Hexadecimal Representation</div>
          <div class="hex-display" id="hex-out"></div>
          <div class="hb-output-title" style="margin-top:1rem;">üìã Field Summary</div>
          <div class="visual-header" id="vh-out"></div>
          <div class="hb-output-title" style="margin-top:1rem;">üö© Flags Bit Map (CWR ECE URG ACK PSH RST SYN FIN)</div>
          <div class="flags-viz" id="flags-viz-out"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- TCP vs UDP -->
<section id="compare">
  <p class="section-title">7 ¬∑ TCP vs UDP</p>
  <div class="divider"></div>
  <p class="section-sub">Understanding when to use TCP versus UDP is a critical skill for network administrators and application developers.</p>

  <div class="two-col" style="margin-bottom:2rem;">
    <div>
      <table>
        <thead><tr><th colspan="2">TCP ‚Äî Transmission Control Protocol</th></tr></thead>
        <tbody>
          <tr><td>Connection</td><td><span class="tag tag-blue">Connection-oriented</span></td></tr>
          <tr><td>Reliability</td><td><span class="tag tag-green">Guaranteed delivery</span></td></tr>
          <tr><td>Ordering</td><td><span class="tag tag-green">In-order delivery</span></td></tr>
          <tr><td>Header</td><td>20‚Äì60 bytes</td></tr>
          <tr><td>Speed</td><td>Lower (overhead)</td></tr>
          <tr><td>Flow Control</td><td>Yes (sliding window)</td></tr>
          <tr><td>Congestion Control</td><td>Yes (CUBIC, BBR)</td></tr>
          <tr><td>Use Cases</td><td>HTTP, SSH, FTP, SMTP, DB</td></tr>
        </tbody>
      </table>
    </div>
    <div>
      <table>
        <thead><tr><th colspan="2">UDP ‚Äî User Datagram Protocol</th></tr></thead>
        <tbody>
          <tr><td>Connection</td><td><span class="tag tag-orange">Connectionless</span></td></tr>
          <tr><td>Reliability</td><td><span class="tag tag-red">Best-effort</span></td></tr>
          <tr><td>Ordering</td><td><span class="tag tag-red">Not guaranteed</span></td></tr>
          <tr><td>Header</td><td>8 bytes only</td></tr>
          <tr><td>Speed</td><td>Higher (minimal overhead)</td></tr>
          <tr><td>Flow Control</td><td>No</td></tr>
          <tr><td>Congestion Control</td><td>No (app responsibility)</td></tr>
          <tr><td>Use Cases</td><td>DNS, VoIP, Gaming, QUIC, Video</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="note">
    <strong>‚ö° Modern Note:</strong> HTTP/3 uses <strong>QUIC</strong> ‚Äî a UDP-based protocol developed by Google that implements reliability, ordering, and multiplexing at the application layer. It avoids TCP's head-of-line blocking and achieves faster connection setup (0-RTT). TCP is still dominant but QUIC is rapidly growing.
  </div>
</section>

<!-- QUIZ -->
<section id="quiz" style="background:var(--surface2);max-width:100%;padding:4rem 2rem;">
  <div style="max-width:900px;margin:0 auto;">
    <p class="section-title">8 ¬∑ Knowledge Check</p>
    <div class="divider"></div>
    <p class="section-sub">Test your understanding of TCP concepts. Click an answer to see instant feedback.</p>

    <div id="quiz-progress"></div>
    <div class="progress-bar-wrap"><div class="progress-bar-fill" id="quiz-progress-bar" style="width:0%"></div></div>

    <div id="quiz-container"></div>
    <div class="quiz-score" id="quiz-score"></div>
    <div style="text-align:center;margin-top:1.5rem;">
      <button class="btn btn-primary" onclick="resetQuiz()" id="quiz-reset" style="display:none">‚Ü∫ Retake Quiz</button>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer>
  <strong>TCP Protocol ‚Äì Interactive Learning Module</strong><br>
  Aligned with CompTIA Network+, CISSP Domain 4, and RFC 9293 | Moraine Valley Community College<br>
  <span style="font-size:0.78rem;opacity:0.6;display:block;margin-top:0.5rem">Based on RFC 793 (1981) and RFC 9293 (2022) ‚Äî the official TCP standard</span>
</footer>

<script>
// ‚îÄ‚îÄ‚îÄ NAV ACTIVE STATE ‚îÄ‚îÄ‚îÄ
function scrollTo(id) {
  document.getElementById(id)?.scrollIntoView({behavior:'smooth'});
}

window.addEventListener('scroll', () => {
  const sections = ['overview','header','handshake','states','flow','builder','compare','quiz'];
  let current = '';
  for (const id of sections) {
    const el = document.getElementById(id);
    if (el && window.scrollY >= el.offsetTop - 80) current = id;
  }
  document.querySelectorAll('nav a').forEach(a => {
    a.classList.toggle('active', a.getAttribute('href') === '#' + current);
  });
});

// ‚îÄ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ
function showTab(id, btn) {
  const panel = document.getElementById(id);
  if (!panel) return;
  const container = panel.parentElement;
  container.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  panel.classList.add('active');
  btn.parentElement.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ ACCORDION ‚îÄ‚îÄ‚îÄ
function toggleAcc(btn) {
  const item = btn.closest('.acc-item');
  item.classList.toggle('open');
}

// ‚îÄ‚îÄ‚îÄ HANDSHAKE ANIMATION ‚îÄ‚îÄ‚îÄ
function animateHandshake() {
  resetHandshake();
  const steps = document.querySelectorAll('.hs-step');
  steps.forEach((s, i) => {
    setTimeout(() => s.classList.add('show'), (i + 1) * 700);
  });
}

function resetHandshake() {
  document.querySelectorAll('#hs-steps .hs-step').forEach(s => s.classList.remove('show'));
}

// ‚îÄ‚îÄ‚îÄ STATE MACHINE ‚îÄ‚îÄ‚îÄ
const stateData = {
  CLOSED: { title: 'CLOSED', desc: 'No connection state at all. This is the default state before any connection is initiated or after a connection is fully terminated. A server socket transitions to LISTEN from here. A client transitions to SYN_SENT.', admin: 'A port showing CLOSED means no service is bound to it. netstat -an | grep CLOSED' },
  LISTEN: { title: 'LISTEN', desc: 'The server is waiting for an incoming connection request from any remote TCP endpoint. The socket is bound and listening on a port. Transition: receive SYN ‚Üí send SYN-ACK ‚Üí move to SYN_RECEIVED.', admin: 'Verify with: ss -tlnp. LISTEN sockets are your open services.' },
  SYN_SENT: { title: 'SYN_SENT', desc: 'The client has sent a SYN segment and is waiting for a matching SYN from the remote end. If no response: retransmit SYN (up to tcp_syn_retries times, default 6). Transition: receive SYN-ACK ‚Üí send ACK ‚Üí ESTABLISHED.', admin: 'Stuck SYN_SENT connections often indicate firewall blocking or server unreachable.' },
  SYN_RECEIVED: { title: 'SYN_RECEIVED', desc: 'The server has received a SYN and sent its own SYN-ACK. Waiting for ACK from client. If overloaded with SYN_RECEIVED entries = SYN flood attack. Mitigation: SYN cookies. Transition: receive ACK ‚Üí ESTABLISHED.', admin: 'Monitor: ss | grep SYN-RECV. High counts = possible SYN flood.' },
  ESTABLISHED: { title: 'ESTABLISHED', desc: 'The connection is open. Full-duplex data transfer is occurring. This is the normal operational state of an active TCP connection. Both sides can send and receive data.', admin: 'Normal state for active connections. ss state established src :80 shows HTTP connections.' },
  FIN_WAIT_1: { title: 'FIN_WAIT_1', desc: 'The local application called close(). A FIN segment was sent. Waiting for ACK from remote. The remote can still send data (half-close). Transition: receive ACK ‚Üí FIN_WAIT_2; receive FIN ‚Üí CLOSING.', admin: 'Transient state. Persistent FIN_WAIT_1 indicates peer not ACKing the FIN.' },
  FIN_WAIT_2: { title: 'FIN_WAIT_2', desc: 'Our FIN was acknowledged. Waiting for the remote to send its own FIN. The remote is still in CLOSE_WAIT and may send remaining data. Transition: receive FIN ‚Üí send ACK ‚Üí TIME_WAIT.', admin: 'Lingering FIN_WAIT_2 connections indicate the peer has not closed its side. Can exhaust file descriptors.' },
  CLOSE_WAIT: { title: 'CLOSE_WAIT', desc: 'The remote has sent a FIN. We acknowledged it. Now waiting for the local application to call close(). If the application never calls close(), this state persists ‚Äî a connection leak.', admin: 'High CLOSE_WAIT count = application bug (not calling close()). Critical to identify and fix.' },
  CLOSING: { title: 'CLOSING', desc: 'Rare state. Both sides sent FIN simultaneously before either ACKed the other\'s FIN. Waiting for the remote\'s ACK of our FIN. Transition: receive ACK ‚Üí TIME_WAIT.', admin: 'Very rare in practice. Seen in simultaneous close scenarios.' },
  LAST_ACK: { title: 'LAST_ACK', desc: 'The passive closer sent its FIN and is waiting for the final ACK. Once received, the connection moves to CLOSED. Transition: receive ACK ‚Üí CLOSED.', admin: 'Transient. Persistence indicates packet loss of the final ACK.' },
  TIME_WAIT: { title: 'TIME_WAIT', desc: 'After sending the final ACK, the active closer waits 2√óMSL (typically 60‚Äì240 seconds) before fully closing. Purpose: (1) ensure final ACK reached peer, (2) prevent old duplicate segments from confusing a new connection on the same 4-tuple.', admin: 'Large TIME_WAIT counts are NORMAL on busy servers. Can be reduced with tcp_tw_reuse=1. Do NOT set tcp_tw_recycle (deprecated, breaks NAT).' }
};

function showState(name) {
  document.querySelectorAll('.state-card').forEach(c => c.classList.remove('active'));
  event.currentTarget.classList.add('active');
  const d = stateData[name];
  const el = document.getElementById('state-detail');
  el.innerHTML = `<h3>${d.title}</h3><p style="margin-bottom:0.75rem">${d.desc}</p><p style="background:var(--highlight);padding:0.75rem;border-radius:6px;font-size:0.85rem"><strong>üõ†Ô∏è Admin Note:</strong> ${d.admin}</p>`;
  el.classList.add('show');
}

// ‚îÄ‚îÄ‚îÄ SLIDING WINDOW ‚îÄ‚îÄ‚îÄ
function updateWindow() {
  const win = parseInt(document.getElementById('win-size').value);
  const acked = parseInt(document.getElementById('ack-pos').value);
  document.getElementById('win-val').textContent = win + ' segment' + (win !== 1 ? 's' : '');
  document.getElementById('ack-val').textContent = acked + ' acked';

  const total = 12;
  const bar = document.getElementById('seg-bar');
  bar.innerHTML = '';

  for (let i = 0; i < total; i++) {
    const seg = document.createElement('div');
    seg.className = 'seg';
    if (i < acked) { seg.classList.add('acked'); seg.textContent = '‚úì'; }
    else if (i < acked + 2) { seg.classList.add('sent'); seg.textContent = i + 1; }
    else if (i < acked + win) { seg.classList.add('window'); seg.textContent = i + 1; }
    else { seg.classList.add('future'); }
    bar.appendChild(seg);
  }

  const usable = Math.max(0, win - 2);
  document.getElementById('win-status').textContent =
    `SND.UNA=${acked+1}  SND.NXT=${acked+3}  SND.WND=${win}  Usable window: ${usable} segment(s) available to send`;
}

// ‚îÄ‚îÄ‚îÄ BDP CALCULATOR ‚îÄ‚îÄ‚îÄ
function calcBDP() {
  const bw = parseInt(document.getElementById('bw-slider').value);
  const rtt = parseInt(document.getElementById('rtt-slider').value);
  document.getElementById('bw-val').textContent = bw >= 1000 ? (bw/1000) + ' Gbps' : bw + ' Mbps';
  document.getElementById('rtt-val').textContent = rtt + ' ms';

  const bdpBits = bw * 1e6 * (rtt / 1000);
  const bdpBytes = bdpBits / 8;
  const bdpKB = (bdpBytes / 1024).toFixed(1);
  const bdpMB = (bdpBytes / 1048576).toFixed(3);

  const needsScaling = bdpBytes > 65535;
  const scaleNeeded = needsScaling ? Math.ceil(Math.log2(bdpBytes / 65535)) : 0;

  document.getElementById('bdp-output').innerHTML = `
    <span style="color:#4ade80">BDP</span> = ${bw} Mbps √ó ${rtt} ms<br>
    <span style="color:#fbbf24">     = ${bdpBytes.toLocaleString()} bytes (${bdpKB} KB = ${bdpMB} MB)</span><br><br>
    <span style="color:#94a3b8">Default TCP Window:</span>  65,535 bytes<br>
    <span style="color:${needsScaling ? '#fb923c' : '#4ade80'}">${needsScaling ? '‚ö†Ô∏è  Window too small! Need Window Scale option.' : '‚úÖ  Default window is sufficient.'}</span>
    ${needsScaling ? `<br><span style="color:#c084fc">Required Window Scale: ${scaleNeeded} (multiplier: ${Math.pow(2,scaleNeeded).toLocaleString()}x)</span>` : ''}
    <br><br><span style="color:#94a3b8">To fully utilize this link, ${bdpBytes.toLocaleString()} bytes must be in-flight at all times.</span>
  `;
}

// ‚îÄ‚îÄ‚îÄ HEADER BUILDER ‚îÄ‚îÄ‚îÄ
function toHex(val, bytes) {
  return val.toString(16).toUpperCase().padStart(bytes * 2, '0');
}

function buildHeader() {
  const src = parseInt(document.getElementById('src-port').value) || 0;
  const dst = parseInt(document.getElementById('dst-port').value) || 0;
  const seq = parseInt(document.getElementById('seq-num').value) || 0;
  const ack = parseInt(document.getElementById('ack-num').value) || 0;
  const offset = parseInt(document.getElementById('data-offset').value) || 5;
  const win = parseInt(document.getElementById('win-size-hb').value) || 0;
  const urg = parseInt(document.getElementById('urg-ptr').value) || 0;

  const syn = document.getElementById('f-syn').checked;
  const ackF = document.getElementById('f-ack').checked;
  const fin = document.getElementById('f-fin').checked;
  const rst = document.getElementById('f-rst').checked;
  const psh = document.getElementById('f-psh').checked;
  const urgF = document.getElementById('f-urg').checked;
  const ece = document.getElementById('f-ece').checked;
  const cwr = document.getElementById('f-cwr').checked;

  const flags = (cwr ? 128 : 0) | (ece ? 64 : 0) | (urgF ? 32 : 0) | (ackF ? 16 : 0) | (psh ? 8 : 0) | (rst ? 4 : 0) | (syn ? 2 : 0) | (fin ? 1 : 0);
  const dataOffset = (offset << 4);

  // Build bytes
  const bytes = [
    ...[(src >> 8) & 0xFF, src & 0xFF],           // src port
    ...[(dst >> 8) & 0xFF, dst & 0xFF],           // dst port
    ...[(seq >> 24) & 0xFF, (seq >> 16) & 0xFF, (seq >> 8) & 0xFF, seq & 0xFF], // seq
    ...[(ack >> 24) & 0xFF, (ack >> 16) & 0xFF, (ack >> 8) & 0xFF, ack & 0xFF], // ack
    dataOffset, flags,                             // data offset + flags
    ...[(win >> 8) & 0xFF, win & 0xFF],            // window
    0x00, 0x00,                                    // checksum (placeholder)
    ...[(urg >> 8) & 0xFF, urg & 0xFF],            // urgent
  ];

  // Hex display
  const hexOut = document.getElementById('hex-out');
  hexOut.innerHTML = '';
  const fieldClasses = ['field-src','field-src','field-dst','field-dst','field-seq','field-seq','field-seq','field-seq','field-ack','field-ack','field-ack','field-ack','field-flags','field-flags','field-win','field-win','field-chk','field-chk','field-urg2','field-urg2'];
  bytes.forEach((b, i) => {
    const span = document.createElement('span');
    span.className = 'hex-byte ' + (fieldClasses[i] || '');
    span.textContent = toHex(b, 1);
    hexOut.appendChild(span);
  });

  // Visual header
  const flagNames = [];
  if (cwr) flagNames.push('CWR'); if (ece) flagNames.push('ECE'); if (urgF) flagNames.push('URG');
  if (ackF) flagNames.push('ACK'); if (psh) flagNames.push('PSH'); if (rst) flagNames.push('RST');
  if (syn) flagNames.push('SYN'); if (fin) flagNames.push('FIN');

  document.getElementById('vh-out').innerHTML = `
    <div class="vh-cell"><span class="vh-label">Source Port</span><span class="vh-value">${src} (0x${toHex(src,2)})</span></div>
    <div class="vh-cell"><span class="vh-label">Destination Port</span><span class="vh-value">${dst} (0x${toHex(dst,2)})</span></div>
    <div class="vh-cell wide"><span class="vh-label">Sequence Number</span><span class="vh-value">${seq} (0x${toHex(seq,4)})</span></div>
    <div class="vh-cell wide"><span class="vh-label">Acknowledgment Number</span><span class="vh-value">${ack} (0x${toHex(ack,4)})</span></div>
    <div class="vh-cell"><span class="vh-label">Data Offset</span><span class="vh-value">${offset} words = ${offset*4} bytes</span></div>
    <div class="vh-cell"><span class="vh-label">Flags Byte</span><span class="vh-value">0x${toHex(flags,1)} = ${flagNames.join(', ') || 'none'}</span></div>
    <div class="vh-cell"><span class="vh-label">Window Size</span><span class="vh-value">${win} bytes (0x${toHex(win,2)})</span></div>
    <div class="vh-cell"><span class="vh-label">Checksum</span><span class="vh-value">0x0000 (compute)</span></div>
    <div class="vh-cell wide"><span class="vh-label">Urgent Pointer</span><span class="vh-value">${urg}${urgF ? ' (URG set ‚Äî active)' : ' (URG not set ‚Äî ignored)'}</span></div>
  `;

  // Flags bitmask viz
  const flagBits = [
    {name:'CWR', on: cwr},{name:'ECE', on: ece},{name:'URG', on: urgF},{name:'ACK', on: ackF},
    {name:'PSH', on: psh},{name:'RST', on: rst},{name:'SYN', on: syn},{name:'FIN', on: fin}
  ];
  document.getElementById('flags-viz-out').innerHTML = flagBits.map(f =>
    `<div class="fv-bit ${f.on ? 'on' : ''}"><div>${f.on ? '1' : '0'}</div><div class="fv-name">${f.name}</div></div>`
  ).join('');
}

function setPreset(type) {
  // Clear all
  ['f-syn','f-ack','f-fin','f-rst','f-psh','f-urg','f-ece','f-cwr'].forEach(id => document.getElementById(id).checked = false);
  const presets = {
    syn: ['f-syn'],
    synack: ['f-syn','f-ack'],
    ack: ['f-ack'],
    pshack: ['f-psh','f-ack'],
    finack: ['f-fin','f-ack'],
    rst: ['f-rst']
  };
  (presets[type] || []).forEach(id => document.getElementById(id).checked = true);
  buildHeader();
}

// ‚îÄ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ‚îÄ
const questions = [
  { q: "What is the minimum size of a TCP header?", opts: ["8 bytes","16 bytes","20 bytes","60 bytes"], ans: 2, exp: "The minimum TCP header is 20 bytes (5 √ó 32-bit words, Data Offset=5). It can grow to 60 bytes with options." },
  { q: "Which TCP flag combination is used to initiate a connection?", opts: ["ACK only","SYN only","SYN + ACK","FIN + ACK"], ans: 1, exp: "A connection is initiated with SYN only (step 1 of the handshake). The server responds with SYN+ACK, then the client sends ACK." },
  { q: "The TCP Window Size field is used to implement:", opts: ["Error detection","Congestion control","Flow control","Encryption"], ans: 2, exp: "The Window Size field advertises the receiver's buffer space, implementing flow control to prevent buffer overflow at the receiver." },
  { q: "An administrator sees many connections in TIME_WAIT state. This typically indicates:", opts: ["A SYN flood attack is occurring","Normal behavior after connections close","The server is unreachable","A routing loop"], ans: 1, exp: "TIME_WAIT is normal! After actively closing a connection, TCP waits 2√óMSL to ensure the final ACK was received. Busy servers will have many TIME_WAIT connections." },
  { q: "What TCP option is negotiated during the SYN handshake to avoid IP fragmentation?", opts: ["Window Scale","SACK","MSS (Maximum Segment Size)","Timestamps"], ans: 2, exp: "MSS (Kind=2) is advertised in the SYN segment to inform the peer of the largest segment it can accept, avoiding fragmentation at the IP layer." },
  { q: "Which sequence of packets represents a complete TCP three-way handshake?", opts: ["SYN ‚Üí ACK ‚Üí SYN-ACK","SYN ‚Üí SYN-ACK ‚Üí ACK","FIN ‚Üí FIN-ACK ‚Üí ACK","ACK ‚Üí SYN ‚Üí SYN-ACK"], ans: 1, exp: "The three-way handshake is: (1) Client sends SYN, (2) Server responds with SYN-ACK, (3) Client acknowledges with ACK. Connection is then ESTABLISHED." },
  { q: "A TCP RST (Reset) segment is used to:", opts: ["Slow down the sender","Acknowledge received data","Abruptly terminate a connection","Request retransmission"], ans: 2, exp: "RST abruptly terminates a connection without the graceful 4-way FIN exchange. It's used when the connection is invalid, when a process crashes, or as a DoS attack (RST injection)." },
  { q: "The Bandwidth-Delay Product (BDP) determines:", opts: ["The maximum packet size on a link","How many bytes must be in-flight to saturate a link","The number of hops to a destination","The TTL value for packets"], ans: 1, exp: "BDP = Bandwidth √ó RTT. This is the amount of data that needs to be in transit (unacknowledged) at any given moment to fully utilize the link capacity." },
  { q: "Which TCP state indicates an application bug (failing to call close())?", opts: ["TIME_WAIT","FIN_WAIT_2","CLOSE_WAIT","SYN_RECEIVED"], ans: 2, exp: "CLOSE_WAIT means TCP received a FIN from the remote peer but the local application has not called close(). Persistent CLOSE_WAIT connections indicate a connection leak in the application." },
  { q: "In TCP, 'fast retransmit' is triggered by:", opts: ["A retransmission timeout (RTO)","Three consecutive duplicate ACKs","A window size of zero","Receiving a RST segment"], ans: 1, exp: "When TCP receives 3 duplicate ACKs for the same sequence number, it infers a single packet was lost (without a full timeout) and immediately retransmits that segment." }
];

let answered = [];

function renderQuiz() {
  const container = document.getElementById('quiz-container');
  container.innerHTML = '';
  questions.forEach((q, qi) => {
    const card = document.createElement('div');
    card.className = 'quiz-card';
    card.id = 'q' + qi;
    card.innerHTML = `
      <div class="quiz-q">Q${qi+1}. ${q.q}</div>
      <div class="quiz-options">
        ${q.opts.map((o, oi) => `
          <div class="quiz-opt" onclick="selectAnswer(${qi}, ${oi})">
            <span class="quiz-opt-letter">${String.fromCharCode(65+oi)}</span>
            ${o}
          </div>
        `).join('')}
      </div>
      <div class="quiz-feedback" id="fb${qi}"></div>
    `;
    container.appendChild(card);
  });
  updateProgress();
}

function selectAnswer(qi, oi) {
  if (answered.includes(qi)) return;
  answered.push(qi);

  const q = questions[qi];
  const opts = document.querySelectorAll(`#q${qi} .quiz-opt`);
  opts.forEach((opt, i) => {
    if (i === q.ans) opt.classList.add('correct');
    else if (i === oi) opt.classList.add('wrong');
    opt.style.cursor = 'default';
  });

  const fb = document.getElementById('fb' + qi);
  fb.className = 'quiz-feedback show ' + (oi === q.ans ? 'correct' : 'wrong');
  fb.innerHTML = (oi === q.ans ? '‚úÖ Correct! ' : '‚ùå Incorrect. ') + q.exp;

  updateProgress();

  if (answered.length === questions.length) {
    const score = answered.filter((qi, i) => {
      const opt = document.querySelector(`#q${qi} .quiz-opt.correct.selected, #q${qi} .quiz-opt.correct`);
      return document.querySelectorAll(`#q${qi} .quiz-opt.wrong`).length === 0;
    }).length;

    // Count correct answers
    let correct = 0;
    questions.forEach((q, qi) => {
      if (!document.querySelectorAll(`#q${qi} .quiz-opt.wrong`).length) correct++;
      // actually count by checking if the selected wrong exists
    });

    // Better count
    correct = questions.filter((q, qi) => {
      return document.querySelectorAll(`#q${qi} .quiz-opt.wrong`).length === 0;
    }).length;

    setTimeout(() => {
      const scoreEl = document.getElementById('quiz-score');
      scoreEl.style.display = 'block';
      scoreEl.innerHTML = `üéì Score: ${correct} / ${questions.length} &nbsp;(${Math.round(correct/questions.length*100)}%)`;
      document.getElementById('quiz-reset').style.display = 'inline-flex';
    }, 500);
  }
}

function updateProgress() {
  const done = answered.length;
  const total = questions.length;
  document.getElementById('quiz-progress').textContent = `${done} of ${total} answered`;
  document.getElementById('quiz-progress-bar').style.width = (done/total*100) + '%';
}

function resetQuiz() {
  answered = [];
  document.getElementById('quiz-score').style.display = 'none';
  document.getElementById('quiz-reset').style.display = 'none';
  renderQuiz();
}

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ
window.addEventListener('DOMContentLoaded', () => {
  buildHeader();
  updateWindow();
  calcBDP();
  renderQuiz();
});
</script>
</body>
</html>
