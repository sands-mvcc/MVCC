<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fire Extinguisher Challenge: Race to Safety</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap');
        
        :root {
            --primary-color: #e63946;
            --secondary-color: #1d3557;
            --accent-color: #f1faee;
            --light-blue: #a8dadc;
            --medium-blue: #457b9d;
            --dark-blue: #1d3557;
            --correct-color: #6a994e;
            --incorrect-color: #e63946;
            --background-color: #f5f7fa;
            --border-radius: 12px;
            --box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }
        
        * {
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            background-image: linear-gradient(120deg, #f5f7fa 0%, #e4eff9 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: var(--dark-blue);
        }
        
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 1200px;
            width: 100%;
            padding: 20px;
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 5px;
            font-size: 2.5rem;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        h1::after {
            content: "üßØ";
            font-size: 1.5rem;
            position: absolute;
            top: 0;
            margin-left: 10px;
        }
        
        .subtitle {
            color: var(--secondary-color);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
            font-size: 1.2rem;
            position: relative;
        }
        
        .subtitle::after {
            content: "";
            display: block;
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--medium-blue));
            margin: 10px auto 0;
            border-radius: 3px;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        
        .board-container {
            position: relative;
            width: 600px;
            height: 600px;
            margin-bottom: 30px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            box-shadow: var(--box-shadow);
            padding: 20px;
        }
        
        .board {
            position: absolute;
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.1));
        }
        
        .space {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: var(--accent-color);
            border: 3px solid var(--light-blue);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            z-index: 1;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
            color: var(--dark-blue);
        }
        
        .space.start {
            background-color: var(--light-blue);
            width: 55px;
            height: 55px;
            border: 4px solid var(--medium-blue);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
            font-size: 1.2rem;
        }
        
        .player {
            position: absolute;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid white;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        
        .player-1 {
            background: linear-gradient(45deg, #e63946, #ff6b6b);
        }
        
        .player-2 {
            background: linear-gradient(45deg, #457b9d, #6bb5ff);
        }
        
        .player-3 {
            background: linear-gradient(45deg, #6a994e, #a7df8a);
        }
        
        .player-4 {
            background: linear-gradient(45deg, #bc6c25, #ffb347);
        }
        
        .question-panel {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            width: 90%;
            max-width: 600px;
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
            display: none;
            position: relative;
            overflow: hidden;
        }
        
        .question-panel::before {
            content: "?";
            position: absolute;
            right: -10px;
            top: -20px;
            font-size: 150px;
            font-weight: bold;
            color: rgba(240, 240, 240, 0.5);
            z-index: 0;
        }
        
        .question-timer {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            padding: 8px 12px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            border-radius: 20px;
            display: inline-block;
            position: relative;
            z-index: 1;
        }
        
        .question-text {
            font-size: 20px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
            font-weight: 600;
            line-height: 1.4;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        .option {
            padding: 14px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            background-color: rgba(255, 255, 255, 0.8);
        }
        
        .option:hover {
            border-color: var(--medium-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .control-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 90%;
            max-width: 600px;
        }
        
        .players-setup {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 10px;
        }
        
        .player-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        
        .player-controls label {
            font-weight: 600;
            font-size: 17px;
        }
        
        select, button {
            font-family: 'Montserrat', sans-serif;
        }
        
        select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 2px solid var(--light-blue);
            background-color: white;
            color: var(--dark-blue);
            font-size: 16px;
            cursor: pointer;
            outline: none;
        }
        
        select:focus {
            border-color: var(--medium-blue);
            box-shadow: 0 0 0 3px rgba(168, 218, 220, 0.3);
        }
        
        button {
            padding: 12px 24px;
            background: linear-gradient(45deg, var(--medium-blue), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        button::after {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        button:hover::after {
            left: 100%;
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        button#startGame {
            background: linear-gradient(45deg, var(--primary-color), #ff6b6b);
        }
        
        button#submitAnswer {
            margin-top: 5px;
            width: 100%;
        }
        
        .result-message {
            font-size: 18px;
            font-weight: bold;
            margin-top: 15px;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            position: relative;
            z-index: 1;
        }
        
        .timer {
            font-size: 22px;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 20px;
            padding: 12px 25px;
            background-color: white;
            border-radius: 30px;
            display: inline-block;
            box-shadow: var(--box-shadow);
            position: relative;
        }
        
        .timer::before {
            content: "‚è±Ô∏è";
            margin-right: 10px;
        }
        
        .score-board {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 20px;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--box-shadow);
        }
        
        .player-score {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            color: white;
            min-width: 120px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .player-score div:first-child {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .current-player-indicator {
            border: 3px solid #ffd700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 215, 0, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 215, 0, 0);
            }
        }
        
        .instructions {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            width: 90%;
            max-width: 600px;
            box-shadow: var(--box-shadow);
            margin-top: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .instructions::before {
            content: "üìù";
            position: absolute;
            right: 10px;
            top: 10px;
            font-size: 40px;
            opacity: 0.2;
        }
        
        .instructions h2 {
            color: var(--primary-color);
            margin-top: 0;
            font-size: 1.5rem;
            position: relative;
            display: inline-block;
        }
        
        .instructions h2::after {
            content: "";
            display: block;
            width: 100%;
            height: 3px;
            background-color: var(--primary-color);
            position: absolute;
            bottom: -5px;
            left: 0;
            border-radius: 3px;
        }
        
        .instructions ul {
            padding-left: 20px;
            margin: 20px 0 10px;
        }
        
        .instructions li {
            margin-bottom: 12px;
            position: relative;
            padding-left: 10px;
            list-style-type: none;
        }
        
        .instructions li::before {
            content: "üî•";
            position: absolute;
            left: -25px;
            top: 0;
        }
        
        .correct {
            background: linear-gradient(45deg, var(--correct-color), #8bc34a);
            color: white;
            border: none !important;
        }
        
        .incorrect {
            background: linear-gradient(45deg, var(--incorrect-color), #ff6b6b);
            color: white;
            border: none !important;
        }
        
        .game-over-panel {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            display: none;
            text-align: center;
            position: relative;
            overflow: hidden;
            z-index: 10;
        }
        
        .game-over-panel h2 {
            color: var(--primary-color);
            font-size: 2rem;
            margin: 0 0 20px;
            position: relative;
            display: inline-block;
        }
        
        .game-over-panel h2::after {
            content: "";
            display: block;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--medium-blue));
            position: absolute;
            bottom: -8px;
            left: 0;
            border-radius: 3px;
        }
        
        .game-over-panel::before {
            content: "üèÅ";
            position: absolute;
            right: -20px;
            top: -20px;
            font-size: 100px;
            opacity: 0.1;
            transform: rotate(15deg);
        }
        
        #gameOverMessage {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 20px 0;
            color: var(--dark-blue);
        }
        
        .final-scores {
            margin: 30px 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .final-scores h3 {
            margin: 0 0 15px;
            position: relative;
            display: inline-block;
            color: var(--dark-blue);
        }
        
        .final-scores h3::after {
            content: "";
            display: block;
            width: 80px;
            height: 2px;
            background-color: var(--medium-blue);
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 2px;
        }
        
        #restartGame {
            margin-top: 20px;
            padding: 15px 30px;
            font-size: 1.1rem;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .board-container {
                width: 90vw;
                height: 90vw;
                max-width: 500px;
                max-height: 500px;
            }
            
            .space {
                width: 30px;
                height: 30px;
                font-size: 0.8rem;
            }
            
            .space.start {
                width: 45px;
                height: 45px;
            }
            
            .player {
                width: 25px;
                height: 25px;
                font-size: 0.8rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .question-text {
                font-size: 18px;
            }
            
            .timer {
                font-size: 18px;
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fire Extinguisher Challenge</h1>
        <div class="subtitle">Race to Safety</div>
        
        <div class="game-area">
            <div class="board-container">
                <svg class="board" viewBox="0 0 600 600">
                    <!-- Circle path will be drawn here by JavaScript -->
                    <path id="track-path" d="M" fill="none" stroke="#a8dadc" stroke-width="40" stroke-linecap="round" />
                </svg>
                <!-- Spaces will be added here by JavaScript -->
            </div>
            
            <div class="timer" id="gameTimer">Time Remaining: 60s</div>
            
            <div class="question-panel" id="questionPanel">
                <div class="question-timer" id="questionTimer">Time to answer: 5s</div>
                <div class="question-text" id="questionText"></div>
                <div class="options" id="options"></div>
                <button id="submitAnswer">Submit Answer</button>
                <div class="result-message" id="resultMessage"></div>
            </div>
            
            <div class="game-over-panel" id="gameOverPanel">
                <h2>Game Over!</h2>
                <div id="gameOverMessage"></div>
                <div class="final-scores" id="finalScores"></div>
                <button id="restartGame">Play Again</button>
            </div>
            
            <div class="control-panel">
                <div class="players-setup">
                    <div class="player-controls">
                        <label for="playerCount">Number of Players:</label>
                        <select id="playerCount">
                            <option value="1">1 Player</option>
                            <option value="2">2 Players</option>
                            <option value="3">3 Players</option>
                            <option value="4">4 Players</option>
                        </select>
                    </div>
                </div>
                
                <button id="startGame">Start Game</button>
                <button id="nextTurn" disabled>Next Turn</button>
                
                <div class="score-board" id="scoreBoard">
                    <!-- Player scores will be added here by JavaScript -->
                </div>
            </div>-controls">
                        <label for="playerCount">Number of Players:</label>
                        <select id="playerCount">
                            <option value="1">1 Player</option>
                            <option value="2">2 Players</option>
                            <option value="3">3 Players</option>
                            <option value="4">4 Players</option>
                        </select>
                    </div>
                </div>
                
                <button id="startGame">Start Game</button>
                <button id="nextTurn" disabled>Next Turn</button>
                
                <div class="score-board" id="scoreBoard">
                    <!-- Player scores will be added here by JavaScript -->
                </div>
            </div>
            
            <div class="instructions">
                <h2>How to Play</h2>
                <ul>
                    <li>Select the number of players and click "Start Game".</li>
                    <li>Players take turns answering fire safety questions.</li>
                    <li>Correct answers: Move forward 2 spaces.</li>
                    <li>Incorrect answers: Move back 1 space.</li>
                    <li>First player to complete the circle wins!</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Game questions
        const questions = [
            {
                type: "mc",
                question: "Which fire extinguisher is designed for ordinary combustibles like paper or wood?",
                options: ["Class B", "Class C", "Class A", "Class D"],
                correctAnswer: "Class A"
            },
            {
                type: "mc",
                question: "Which fire class involves flammable liquids like gasoline or oil?",
                options: ["Class A", "Class B", "Class C", "Class K"],
                correctAnswer: "Class B"
            },
            {
                type: "mc",
                question: "What does the 'P' in the PASS method stand for?",
                options: ["Press", "Pull", "Pump", "Push"],
                correctAnswer: "Pull"
            },
            {
                type: "mc",
                question: "Which extinguisher is most appropriate for an electrical fire?",
                options: ["Class A", "Class B", "Class C", "Class K"],
                correctAnswer: "Class C"
            },
            {
                type: "mc",
                question: "The 'K' class fire extinguisher is mainly used in what environment?",
                options: ["Laboratories", "Industrial plants", "Commercial kitchens", "Offices"],
                correctAnswer: "Commercial kitchens"
            },
            {
                type: "mc",
                question: "What is the correct order of the PASS steps?",
                options: ["Pull, Sweep, Aim, Squeeze", "Pull, Aim, Squeeze, Sweep", "Squeeze, Pull, Aim, Sweep", "Aim, Pull, Sweep, Squeeze"],
                correctAnswer: "Pull, Aim, Squeeze, Sweep"
            },
            {
                type: "mc",
                question: "What's the first thing you should do before using a fire extinguisher?",
                options: ["Squeeze the handle", "Spray in the air", "Pull the pin", "Shake the canister"],
                correctAnswer: "Pull the pin"
            },
            {
                type: "tf",
                question: "The PASS method includes Pull, Aim, Squeeze, and Sweep.",
                options: ["True", "False"],
                correctAnswer: "True"
            },
            {
                type: "tf",
                question: "Class K extinguishers are used on metal fires.",
                options: ["True", "False"],
                correctAnswer: "False"
            },
            {
                type: "tf",
                question: "You should aim the extinguisher at the top of the flames.",
                options: ["True", "False"],
                correctAnswer: "False"
            },
            {
                type: "tf",
                question: "All fire extinguishers are safe to use on electrical fires.",
                options: ["True", "False"],
                correctAnswer: "False"
            },
            {
                type: "tf",
                question: "Fire extinguishers expire and need to be replaced or recharged.",
                options: ["True", "False"],
                correctAnswer: "True"
            }
        ];

        // Game variables
        let players = [];
        let currentPlayerIndex = 0;
        let spacesCount = 12; // Number of spaces on the board
        let gameStarted = false;
        let spaces = [];
        let selectedAnswer = null;
        let gameTimer = null;
        let questionTimer = null;
        let gameTimeRemaining = 60; // 60 seconds total game time
        let questionTimeRemaining = 5; // 5 seconds per question

        // DOM elements
        const boardContainer = document.querySelector('.board-container');
        const board = document.querySelector('.board');
        const startGameBtn = document.getElementById('startGame');
        const nextTurnBtn = document.getElementById('nextTurn');
        const playerCountSelect = document.getElementById('playerCount');
        const questionPanel = document.getElementById('questionPanel');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('options');
        const submitAnswerBtn = document.getElementById('submitAnswer');
        const resultMessage = document.getElementById('resultMessage');
        const scoreBoard = document.getElementById('scoreBoard');
        const trackPath = document.getElementById('track-path');
        const gameTimerEl = document.getElementById('gameTimer');
        const questionTimerEl = document.getElementById('questionTimer');
        const gameOverPanel = document.getElementById('gameOverPanel');
        const gameOverMessage = document.getElementById('gameOverMessage');
        const finalScores = document.getElementById('finalScores');
        const restartGameBtn = document.getElementById('restartGame');

        // Create circular path for the board
        function createBoardPath() {
            const centerX = 300;
            const centerY = 300;
            const radius = 250; // Radius of the circle
            
            // Create circle path
            const path = `M ${centerX - radius},${centerY} a ${radius},${radius} 0 1,1 ${radius * 2},0 a ${radius},${radius} 0 1,1 -${radius * 2},0`;
            trackPath.setAttribute('d', path);
        }

        // Create spaces on the board
        function createSpaces() {
            // Clear existing spaces
            const existingSpaces = document.querySelectorAll('.space');
            existingSpaces.forEach(space => space.remove());
            
            spaces = [];
            
            const centerX = 300;
            const centerY = 300;
            const radius = 250; // Radius of the circle
            
            for (let i = 0; i < spacesCount; i++) {
                // Calculate angle and position
                const angle = (i / spacesCount) * 2 * Math.PI;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                
                // Create space element
                const space = document.createElement('div');
                space.className = i === 0 ? 'space start' : 'space';
                space.textContent = i + 1;
                space.style.left = `${x}px`;
                space.style.top = `${y}px`;
                boardContainer.appendChild(space);
                
                // Store space position
                spaces.push({ x, y });
            }
        }

        // Create player tokens
        function createPlayers(count) {
            // Clear existing players
            const existingPlayers = document.querySelectorAll('.player');
            existingPlayers.forEach(player => player.remove());
            
            players = [];
            
            for (let i = 0; i < count; i++) {
                const player = {
                    id: i + 1,
                    position: 0,
                    score: 0
                };
                
                // Create player element
                const playerEl = document.createElement('div');
                playerEl.className = `player player-${i + 1}`;
                playerEl.textContent = i + 1;
                boardContainer.appendChild(playerEl);
                
                // Position player at start
                updatePlayerPosition(player, playerEl);
                
                players.push({ ...player, element: playerEl });
            }
            
            updateScoreBoard();
        }

        // Update player position on the board
        function updatePlayerPosition(player, playerEl) {
            const position = player.position;
            const space = spaces[position];
            
            // Add slight offset based on player ID to prevent overlapping
            const offsetX = (player.id - 1) * 10 - 15;
            const offsetY = (player.id - 1) * 10 - 15;
            
            playerEl.style.left = `${space.x + offsetX}px`;
            playerEl.style.top = `${space.y + offsetY}px`;
        }

        // Update the score board
        function updateScoreBoard() {
            scoreBoard.innerHTML = '';
            
            players.forEach(player => {
                const scoreEl = document.createElement('div');
                scoreEl.className = `player-score player-${player.id}`;
                if (player.id - 1 === currentPlayerIndex) {
                    scoreEl.classList.add('current-player-indicator');
                }
                scoreEl.innerHTML = `
                    <div>Player ${player.id}</div>
                    <div>Space: ${player.position + 1}</div>
                    <div>Score: ${player.score}</div>
                `;
                scoreBoard.appendChild(scoreEl);
            });
        }

        // Show question for current player
        function showQuestion() {
            // Get random question
            const currentQuestion = questions[Math.floor(Math.random() * questions.length)];
            
            // Set question text
            questionText.textContent = currentQuestion.question;
            
            // Create options
            optionsContainer.innerHTML = '';
            currentQuestion.options.forEach(option => {
                const optionEl = document.createElement('div');
                optionEl.className = 'option';
                optionEl.textContent = option;
                optionEl.addEventListener('click', () => {
                    // Remove selection from all options
                    document.querySelectorAll('.option').forEach(el => {
                        el.style.backgroundColor = '';
                    });
                    
                    // Mark this option as selected
                    optionEl.style.backgroundColor = '#a8dadc';
                    selectedAnswer = option;
                });
                optionsContainer.appendChild(optionEl);
            });
            
            // Reset selected answer
            selectedAnswer = null;
            resultMessage.textContent = '';
            
            // Show question panel
            questionPanel.style.display = 'block';
            
            // Store current question for checking
            questionPanel.dataset.correctAnswer = currentQuestion.correctAnswer;
        }

        // Check answer and update player position
        function checkAnswer() {
            // Clear question timer
            clearInterval(questionTimer);
            
            if (!selectedAnswer) {
                resultMessage.textContent = 'Please select an answer!';
                return;
            }
            
            const correctAnswer = questionPanel.dataset.correctAnswer;
            const isCorrect = selectedAnswer === correctAnswer;
            const currentPlayer = players[currentPlayerIndex];
            
            // Mark selected option
            document.querySelectorAll('.option').forEach(option => {
                if (option.textContent === selectedAnswer) {
                    option.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
            });
            
            // Update player position and score
            if (isCorrect) {
                resultMessage.textContent = '‚úÖ Correct! Move forward 2 spaces.';
                currentPlayer.position = Math.min(spacesCount - 1, currentPlayer.position + 2);
                currentPlayer.score += 2;
            } else {
                resultMessage.textContent = '‚ùå Incorrect! Move back 1 space. The correct answer is: ' + correctAnswer;
                currentPlayer.position = Math.max(0, currentPlayer.position - 1);
            }
            
            // Update player position on board
            updatePlayerPosition(currentPlayer, currentPlayer.element);
            updateScoreBoard();
            
            // Disable submit button and enable next turn button
            submitAnswerBtn.disabled = true;
            nextTurnBtn.disabled = false;
            
            // Check if player has won
            if (currentPlayer.position >= spacesCount - 1) {
                endGame(`üéâ Player ${currentPlayer.id} reached the finish line!`);
            }
        }

        // Move to next player's turn
        function nextTurn() {
            // Move to next player
            currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
            
            // Hide question panel
            questionPanel.style.display = 'none';
            
            // Reset buttons
            submitAnswerBtn.disabled = false;
            nextTurnBtn.disabled = true;
            
            // Update score board to highlight current player
            updateScoreBoard();
            
            // Show question for next player
            showQuestion();
            
            // Start question timer
            startQuestionTimer();
        }

        // Reset game
        function resetGame() {
            // Clear timers
            clearInterval(gameTimer);
            clearInterval(questionTimer);
            
            // Reset game state
            gameStarted = false;
            
            // Hide question panel and game over panel
            questionPanel.style.display = 'none';
            gameOverPanel.style.display = 'none';
            
            // Show start game button and player setup
            startGameBtn.disabled = false;
            playerCountSelect.disabled = false;
            nextTurnBtn.textContent = 'Next Turn';
            nextTurnBtn.disabled = true;
            
            // Clear score board
            scoreBoard.innerHTML = '';
            
            // Reset timers
            gameTimeRemaining = 60;
            questionTimeRemaining = 5;
            gameTimerEl.textContent = `Time Remaining: ${gameTimeRemaining}s`;
            gameTimerEl.style.color = '#e63946';
        }

        // Start game
        function startGame() {
            const playerCount = parseInt(playerCountSelect.value);
            
            // Set game started
            gameStarted = true;
            
            // Create board
            createBoardPath();
            createSpaces();
            
            // Create players
            createPlayers(playerCount);
            
            // Reset current player
            currentPlayerIndex = 0;
            
            // Show question for first player
            showQuestion();
            
            // Disable start game button and player setup
            startGameBtn.disabled = true;
            playerCountSelect.disabled = true;
            nextTurnBtn.disabled = true;
            
            // Reset timers
            gameTimeRemaining = 60;
            questionTimeRemaining = 5;
            
            // Update timer displays
            gameTimerEl.textContent = `Time Remaining: ${gameTimeRemaining}s`;
            questionTimerEl.textContent = `Time to answer: ${questionTimeRemaining}s`;
            
            // Start game timer
            startGameTimer();
            
            // Start question timer
            startQuestionTimer();
            
            // Hide game over panel if visible
            gameOverPanel.style.display = 'none';
        }
        
        // Start game timer
        function startGameTimer() {
            // Clear existing timer if any
            if (gameTimer) {
                clearInterval(gameTimer);
            }
            
            gameTimer = setInterval(() => {
                gameTimeRemaining--;
                gameTimerEl.textContent = `Time Remaining: ${gameTimeRemaining}s`;
                
                // Check if game time is up
                if (gameTimeRemaining <= 0) {
                    endGame("Time is up!");
                }
                
                // Change color when time is running out
                if (gameTimeRemaining <= 10) {
                    gameTimerEl.style.color = '#e63946';
                }
            }, 1000);
        }
        
        // Start question timer
        function startQuestionTimer() {
            // Clear existing timer if any
            if (questionTimer) {
                clearInterval(questionTimer);
            }
            
            // Reset question time
            questionTimeRemaining = 5;
            questionTimerEl.textContent = `Time to answer: ${questionTimeRemaining}s`;
            questionTimerEl.style.color = '#457b9d';
            
            questionTimer = setInterval(() => {
                questionTimeRemaining--;
                questionTimerEl.textContent = `Time to answer: ${questionTimeRemaining}s`;
                
                // Change color when time is running out
                if (questionTimeRemaining <= 2) {
                    questionTimerEl.style.color = '#e63946';
                }
                
                // Auto-submit when time is up
                if (questionTimeRemaining <= 0) {
                    clearInterval(questionTimer);
                    
                    // If no answer selected, count as incorrect
                    if (!selectedAnswer) {
                        resultMessage.textContent = '‚è∞ Time is up! You did not select an answer.';
                        const currentPlayer = players[currentPlayerIndex];
                        currentPlayer.position = Math.max(0, currentPlayer.position - 1);
                        
                        // Update player position on board
                        updatePlayerPosition(currentPlayer, currentPlayer.element);
                        updateScoreBoard();
                        
                        // Disable submit button and enable next turn button
                        submitAnswerBtn.disabled = true;
                        nextTurnBtn.disabled = false;
                    } else {
                        // If answer selected, check it
                        checkAnswer();
                    }
                }
            }, 1000);
        }
        
        // End game
        function endGame(reason) {
            // Clear timers
            clearInterval(gameTimer);
            clearInterval(questionTimer);
            
            // Hide question panel
            questionPanel.style.display = 'none';
            
            // Display game over panel
            gameOverPanel.style.display = 'block';
            
            // Set game over message
            gameOverMessage.textContent = reason;
            
            // Find winner
            let winner = null;
            let highestScore = -1;
            let winnersByScore = [];
            
            // Find player with highest score
            players.forEach(player => {
                if (player.score > highestScore) {
                    highestScore = player.score;
                    winnersByScore = [player];
                } else if (player.score === highestScore) {
                    winnersByScore.push(player);
                }
            });
            
            // Find player who made it furthest
            let furthestPosition = -1;
            let winnersByPosition = [];
            
            players.forEach(player => {
                if (player.position > furthestPosition) {
                    furthestPosition = player.position;
                    winnersByPosition = [player];
                } else if (player.position === furthestPosition) {
                    winnersByPosition.push(player);
                }
            });
            
            // Determine winner based on position first, then score
            if (winnersByPosition.length === 1) {
                winner = winnersByPosition[0];
            } else if (winnersByPosition.length > 1) {
                // If tie in position, use score
                let highestScoreAmongFurthest = -1;
                
                winnersByPosition.forEach(player => {
                    if (player.score > highestScoreAmongFurthest) {
                        highestScoreAmongFurthest = player.score;
                        winner = player;
                    }
                });
            }
            
            // Display final scores
            finalScores.innerHTML = '<h3>Final Scores</h3>';
            
            // Sort players by position first, then score
            const sortedPlayers = [...players].sort((a, b) => {
                if (a.position !== b.position) {
                    return b.position - a.position;
                }
                return b.score - a.score;
            });
            
            sortedPlayers.forEach(player => {
                const playerScoreEl = document.createElement('div');
                playerScoreEl.className = `player-score player-${player.id}`;
                
                if (winner && player.id === winner.id) {
                    playerScoreEl.style.border = '3px solid #ffd700';
                }
                
                playerScoreEl.innerHTML = `
                    <div>Player ${player.id}</div>
                    <div>Space: ${player.position + 1}</div>
                    <div>Score: ${player.score}</div>
                `;
                
                finalScores.appendChild(playerScoreEl);
            });
            
            // Add winner message if there is one
            if (winner) {
                const winnerMessage = document.createElement('div');
                winnerMessage.innerHTML = `<h3>üèÜ Player ${winner.id} wins!</h3>`;
                finalScores.appendChild(winnerMessage);
            } else {
                const tieMessage = document.createElement('div');
                tieMessage.innerHTML = `<h3>It's a tie!</h3>`;
                finalScores.appendChild(tieMessage);
            }
            
            // Game is no longer started
            gameStarted = false;
        }

        // Event listeners
        startGameBtn.addEventListener('click', startGame);
        nextTurnBtn.addEventListener('click', nextTurn);
        submitAnswerBtn.addEventListener('click', checkAnswer);
        restartGameBtn.addEventListener('click', resetGame);

        // Initialize game board
        createBoardPath();
        createSpaces();
    </script>
</body>
</html>
