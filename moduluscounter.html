<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Counter with Modulus Reset Simulator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        h1, h2, h3 {
            color: #2c3e50;
        }
        
        .flex-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            flex: 1;
            min-width: 300px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: #f9f9f9;
        }
        
        .control-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #eaeaea;
            border-radius: 5px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .bit {
            display: inline-block;
            width: 50px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            margin: 5px;
            border: 2px solid #3498db;
            border-radius: 5px;
            font-size: 24px;
            font-weight: bold;
            background-color: white;
            user-select: none;
            cursor: pointer;
        }
        
        .bit.highlight {
            background-color: #f1c40f;
            border-color: #f39c12;
            animation: pulse 1s;
        }
        
        .counter-display {
            text-align: center;
            font-size: 20px;
            margin: 20px 0;
        }
        
        .modulus-selector {
            margin-bottom: 15px;
        }
        
        .modulus-option {
            display: inline-block;
            margin-right: 10px;
            cursor: pointer;
        }
        
        .or-gate {
            margin: 20px auto;
            text-align: center;
        }
        
        .or-gate svg {
            max-width: 100%;
            height: auto;
        }
        
        .gate-inputs {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }
        
        .gate-output {
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .binary-inputs {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .binary-input {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .binary-toggle {
            width: 60px;
            height: 34px;
            position: relative;
            margin: 10px 0;
        }
        
        .binary-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #2196F3;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .simulator-container {
            position: relative;
        }
        
        .log-panel {
            height: 150px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 20px;
            background-color: #f8f9fa;
            font-family: monospace;
        }
        
        .log-entry {
            margin-bottom: 5px;
            border-bottom: 1px dotted #eee;
            padding-bottom: 3px;
        }
        
        .log-entry.reset {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .binary-input-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .binary-value {
            font-size: 18px;
            margin-top: 5px;
        }
        
        .circuit-diagram {
            margin-top: 30px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: white;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .gate-active {
            fill: #f1c40f;
            transition: fill 0.3s;
        }
        
        .wire-active {
            stroke: #e74c3c;
            stroke-width: 3;
            transition: stroke 0.3s;
        }
        
        #circuit-svg {
            max-width: 100%;
            height: auto;
        }
        
        .tooltip {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Digital Counter with Modulus Reset Simulator</h1>
        <p>This simulator demonstrates how OR gates can be used to create a modulus counter that resets at specific counts (10, 12, 24, or 30). You can also set custom reset conditions.</p>
        
        <div class="flex-container">
            <div class="panel">
                <h2>Counter Settings</h2>
                <div class="modulus-selector">
                    <h3>Select Counter Modulus</h3>
                    <div>
                        <label class="modulus-option">
                            <input type="radio" name="modulus" value="10" checked> MOD-10 (Resets at 10)
                        </label>
                    </div>
                    <div>
                        <label class="modulus-option">
                            <input type="radio" name="modulus" value="12"> MOD-12 (Resets at 12)
                        </label>
                    </div>
                    <div>
                        <label class="modulus-option">
                            <input type="radio" name="modulus" value="24"> MOD-24 (Resets at 24)
                        </label>
                    </div>
                    <div>
                        <label class="modulus-option">
                            <input type="radio" name="modulus" value="30"> MOD-30 (Resets at 30)
                        </label>
                    </div>
                    <div>
                        <label class="modulus-option">
                            <input type="radio" name="modulus" value="custom"> Custom Reset Logic
                        </label>
                    </div>
                </div>
                
                <div id="custom-logic-panel" style="display: none;">
                    <h3>Custom Reset Logic</h3>
                    <p>Set your own reset conditions by toggling the binary inputs:</p>
                    
                    <div class="binary-inputs">
                        <div class="binary-input">
                            <div class="binary-input-label">Q4</div>
                            <label class="binary-toggle">
                                <input type="checkbox" id="custom-bit4">
                                <span class="slider"></span>
                            </label>
                            <div class="binary-value">0</div>
                        </div>
                        <div class="binary-input">
                            <div class="binary-input-label">Q3</div>
                            <label class="binary-toggle">
                                <input type="checkbox" id="custom-bit3">
                                <span class="slider"></span>
                            </label>
                            <div class="binary-value">0</div>
                        </div>
                        <div class="binary-input">
                            <div class="binary-input-label">Q2</div>
                            <label class="binary-toggle">
                                <input type="checkbox" id="custom-bit2">
                                <span class="slider"></span>
                            </label>
                            <div class="binary-value">0</div>
                        </div>
                        <div class="binary-input">
                            <div class="binary-input-label">Q1</div>
                            <label class="binary-toggle">
                                <input type="checkbox" id="custom-bit1">
                                <span class="slider"></span>
                            </label>
                            <div class="binary-value">0</div>
                        </div>
                        <div class="binary-input">
                            <div class="binary-input-label">Q0</div>
                            <label class="binary-toggle">
                                <input type="checkbox" id="custom-bit0">
                                <span class="slider"></span>
                            </label>
                            <div class="binary-value">0</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h2>Counter Control</h2>
                <div class="control-panel">
                    <button id="btn-step">Step</button>
                    <button id="btn-auto">Auto Count</button>
                    <button id="btn-stop" disabled>Stop</button>
                    <button id="btn-reset">Reset</button>
                    <div style="margin-left: auto;">
                        Speed: <input type="range" id="speed-control" min="100" max="1000" step="100" value="500">
                    </div>
                </div>
                
                <div class="counter-display">
                    <div>
                        <div class="bit" id="bit4">0</div>
                        <div class="bit" id="bit3">0</div>
                        <div class="bit" id="bit2">0</div>
                        <div class="bit" id="bit1">0</div>
                        <div class="bit" id="bit0">0</div>
                    </div>
                    <div style="margin-top: 10px;">
                        <span>Binary: </span>
                        <span id="binary-value">00000</span>
                        <span style="margin-left: 20px;">Decimal: </span>
                        <span id="decimal-value">0</span>
                    </div>
                </div>
                
                <div class="log-panel" id="log-panel"></div>
            </div>
        </div>
        
        <div class="circuit-diagram">
            <h2>Circuit Diagram</h2>
            <p>This diagram shows how the 5-bit counter is connected to the 7432 OR gates for reset detection. The active logic paths are highlighted.</p>
            
            <svg id="circuit-svg" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
                <!-- Counter Flip-Flops -->
                <g id="counter-bits">
                    <rect x="50" y="50" width="60" height="180" fill="#f9f9f9" stroke="#333" stroke-width="2" rx="5" ry="5"/>
                    <text x="80" y="30" font-size="14" text-anchor="middle">5-Bit Counter</text>
                    
                    <rect x="60" y="70" width="40" height="25" fill="white" stroke="#333" rx="3" ry="3" id="ff4-rect"/>
                    <text x="80" y="87" font-size="14" text-anchor="middle" id="ff4-text">Q4: 0</text>
                    
                    <rect x="60" y="105" width="40" height="25" fill="white" stroke="#333" rx="3" ry="3" id="ff3-rect"/>
                    <text x="80" y="122" font-size="14" text-anchor="middle" id="ff3-text">Q3: 0</text>
                    
                    <rect x="60" y="140" width="40" height="25" fill="white" stroke="#333" rx="3" ry="3" id="ff2-rect"/>
                    <text x="80" y="157" font-size="14" text-anchor="middle" id="ff2-text">Q2: 0</text>
                    
                    <rect x="60" y="175" width="40" height="25" fill="white" stroke="#333" rx="3" ry="3" id="ff1-rect"/>
                    <text x="80" y="192" font-size="14" text-anchor="middle" id="ff1-text">Q1: 0</text>
                    
                    <rect x="60" y="210" width="40" height="25" fill="white" stroke="#333" rx="3" ry="3" id="ff0-rect"/>
                    <text x="80" y="227" font-size="14" text-anchor="middle" id="ff0-text">Q0: 0</text>
                </g>
                
                <!-- Mod-10 Detection -->
                <g id="mod10-detector" class="detector">
                    <rect x="180" y="30" width="120" height="60" fill="#f9f9f9" stroke="#333" stroke-width="2" rx="5" ry="5"/>
                    <text x="240" y="55" font-size="12" text-anchor="middle">Mod-10 Detection</text>
                    <text x="240" y="75" font-size="10" text-anchor="middle">(01010)</text>
                    
                    <!-- Wires from Counter to Detector -->
                    <line x1="110" y1="82.5" x2="180" y2="60" stroke="#333" stroke-width="1.5" id="wire-q4-mod10" class="wire"/>
                    <line x1="110" y1="117.5" x2="180" y2="60" stroke="#333" stroke-width="1.5" id="wire-q3-mod10" class="wire"/>
                    <line x1="110" y1="152.5" x2="180" y2="60" stroke="#333" stroke-width="1.5" id="wire-q2-mod10" class="wire"/>
                    <line x1="110" y1="187.5" x2="180" y2="60" stroke="#333" stroke-width="1.5" id="wire-q1-mod10" class="wire"/>
                    <line x1="110" y1="222.5" x2="180" y2="60" stroke="#333" stroke-width="1.5" id="wire-q0-mod10" class="wire"/>
                </g>
                
                <!-- Mod-12 Detection -->
                <g id="mod12-detector" class="detector">
                    <rect x="180" y="110" width="120" height="60" fill="#f9f9f9" stroke="#333" stroke-width="2" rx="5" ry="5"/>
                    <text x="240" y="135" font-size="12" text-anchor="middle">Mod-12 Detection</text>
                    <text x="240" y="155" font-size="10" text-anchor="middle">(01100)</text>
                    
                    <!-- Wires from Counter to Detector -->
                    <line x1="110" y1="82.5" x2="180" y2="140" stroke="#333" stroke-width="1.5" id="wire-q4-mod12" class="wire"/>
                    <line x1="110" y1="117.5" x2="180" y2="140" stroke="#333" stroke-width="1.5" id="wire-q3-mod12" class="wire"/>
                    <line x1="110" y1="152.5" x2="180" y2="140" stroke="#333" stroke-width="1.5" id="wire-q2-mod12" class="wire"/>
                    <line x1="110" y1="187.5" x2="180" y2="140" stroke="#333" stroke-width="1.5" id="wire-q1-mod12" class="wire"/>
                    <line x1="110" y1="222.5" x2="180" y2="140" stroke="#333" stroke-width="1.5" id="wire-q0-mod12" class="wire"/>
                </g>
                
                <!-- Mod-24 Detection -->
                <g id="mod24-detector" class="detector">
                    <rect x="180" y="190" width="120" height="60" fill="#f9f9f9" stroke="#333" stroke-width="2" rx="5" ry="5"/>
                    <text x="240" y="215" font-size="12" text-anchor="middle">Mod-24 Detection</text>
                    <text x="240" y="235" font-size="10" text-anchor="middle">(11000)</text>
                    
                    <!-- Wires from Counter to Detector -->
                    <line x1="110" y1="82.5" x2="180" y2="220" stroke="#333" stroke-width="1.5" id="wire-q4-mod24" class="wire"/>
                    <line x1="110" y1="117.5" x2="180" y2="220" stroke="#333" stroke-width="1.5" id="wire-q3-mod24" class="wire"/>
                    <line x1="110" y1="152.5" x2="180" y2="220" stroke="#333" stroke-width="1.5" id="wire-q2-mod24" class="wire"/>
                    <line x1="110" y1="187.5" x2="180" y2="220" stroke="#333" stroke-width="1.5" id="wire-q1-mod24" class="wire"/>
                    <line x1="110" y1="222.5" x2="180" y2="220" stroke="#333" stroke-width="1.5" id="wire-q0-mod24" class="wire"/>
                </g>
                
                <!-- Mod-30 Detection -->
                <g id="mod30-detector" class="detector">
                    <rect x="180" y="270" width="120" height="60" fill="#f9f9f9" stroke="#333" stroke-width="2" rx="5" ry="5"/>
                    <text x="240" y="295" font-size="12" text-anchor="middle">Mod-30 Detection</text>
                    <text x="240" y="315" font-size="10" text-anchor="middle">(11110)</text>
                    
                    <!-- Wires from Counter to Detector -->
                    <line x1="110" y1="82.5" x2="180" y2="300" stroke="#333" stroke-width="1.5" id="wire-q4-mod30" class="wire"/>
                    <line x1="110" y1="117.5" x2="180" y2="300" stroke="#333" stroke-width="1.5" id="wire-q3-mod30" class="wire"/>
                    <line x1="110" y1="152.5" x2="180" y2="300" stroke="#333" stroke-width="1.5" id="wire-q2-mod30" class="wire"/>
                    <line x1="110" y1="187.5" x2="180" y2="300" stroke="#333" stroke-width="1.5" id="wire-q1-mod30" class="wire"/>
                    <line x1="110" y1="222.5" x2="180" y2="300" stroke="#333" stroke-width="1.5" id="wire-q0-mod30" class="wire"/>
                </g>
                
                <!-- Custom Detection -->
                <g id="custom-detector" class="detector">
                    <rect x="180" y="350" width="120" height="60" fill="#f9f9f9" stroke="#333" stroke-width="2" rx="5" ry="5"/>
                    <text x="240" y="375" font-size="12" text-anchor="middle">Custom Detection</text>
                    <text x="240" y="395" font-size="10" text-anchor="middle" id="custom-pattern">(00000)</text>
                    
                    <!-- Wires from Counter to Detector -->
                    <line x1="110" y1="82.5" x2="180" y2="380" stroke="#333" stroke-width="1.5" id="wire-q4-custom" class="wire"/>
                    <line x1="110" y1="117.5" x2="180" y2="380" stroke="#333" stroke-width="1.5" id="wire-q3-custom" class="wire"/>
                    <line x1="110" y1="152.5" x2="180" y2="380" stroke="#333" stroke-width="1.5" id="wire-q2-custom" class="wire"/>
                    <line x1="110" y1="187.5" x2="180" y2="380" stroke="#333" stroke-width="1.5" id="wire-q1-custom" class="wire"/>
                    <line x1="110" y1="222.5" x2="180" y2="380" stroke="#333" stroke-width="1.5" id="wire-q0-custom" class="wire"/>
                </g>
                
                <!-- 7432 OR Gates -->
                <g id="or-gates">
                    <rect x="400" y="120" width="160" height="160" fill="#f0f0f0" stroke="#333" stroke-width="2" rx="5" ry="5"/>
                    <text x="480" y="140" font-size="14" text-anchor="middle" font-weight="bold">7432 OR Gates</text>
                    
                    <!-- First OR gate -->
                    <g id="or-gate1">
                        <path d="M420,180 Q440,170 440,160 Q440,150 420,140 L410,140 L410,180 Z" fill="white" stroke="#333" stroke-width="2" id="or1-path"/>
                        <text x="425" y="165" font-size="12" text-anchor="middle">OR</text>
                        
                        <!-- Input wires -->
                        <line x1="300" y1="60" x2="410" y2="150" stroke="#333" stroke-width="1.5" id="wire-mod10-or1" class="wire"/>
                        <line x1="300" y1="140" x2="410" y2="170" stroke="#333" stroke-width="1.5" id="wire-mod12-or1" class="wire"/>
                        
                        <!-- Output wire -->
                        <line x1="440" y1="160" x2="470" y2="160" stroke="#333" stroke-width="1.5" id="wire-or1-or3" class="wire"/>
                    </g>
                    
                    <!-- Second OR gate -->
                    <g id="or-gate2">
                        <path d="M420,240 Q440,230 440,220 Q440,210 420,200 L410,200 L410,240 Z" fill="white" stroke="#333" stroke-width="2" id="or2-path"/>
                        <text x="425" y="225" font-size="12" text-anchor="middle">OR</text>
                        
                        <!-- Input wires -->
                        <line x1="300" y1="220" x2="410" y2="210" stroke="#333" stroke-width="1.5" id="wire-mod24-or2" class="wire"/>
                        <line x1="300" y1="300" x2="410" y2="230" stroke="#333" stroke-width="1.5" id="wire-mod30-or2" class="wire"/>
                        
                        <!-- Output wire -->
                        <line x1="440" y1="220" x2="470" y2="220" stroke="#333" stroke-width="1.5" id="wire-or2-or3" class="wire"/>
                    </g>
                    
                    <!-- Custom OR gate -->
                    <g id="or-gate-custom">
                        <line x1="300" y1="380" x2="510" y2="250" stroke="#333" stroke-width="1.5" id="wire-custom-or3" class="wire"/>
                    </g>
                    
                    <!-- Final OR gate -->
                    <g id="or-gate3">
                        <path d="M530,210 Q550,200 550,190 Q550,180 530,170 L520,170 L520,210 Z" fill="white" stroke="#333" stroke-width="2" id="or3-path"/>
                        <text x="535" y="195" font-size="12" text-anchor="middle">OR</text>
                        
                        <!-- Input wires -->
                        <line x1="470" y1="160" x2="520" y2="180" stroke="#333" stroke-width="1.5" class="wire"/>
                        <line x1="470" y1="220" x2="520" y2="200" stroke="#333" stroke-width="1.5" class="wire"/>
                        
                        <!-- Output wire (Reset) -->
                        <line x1="550" y1="190" x2="600" y2="190" stroke="#e74c3c" stroke-width="2" id="wire-reset" class="wire"/>
                        <text x="580" y="185" font-size="12">Reset</text>
                    </g>
                </g>
                
                <!-- Reset Connection -->
                <g id="reset-connection">
                    <line x1="600" y1="190" x2="650" y2="190" stroke="#333" stroke-width="1.5" class="wire"/>
                    <line x1="650" y1="190" x2="650" y2="140" stroke="#333" stroke-width="1.5" class="wire"/>
                    <line x1="650" y1="140" x2="80" y2="140" stroke="#333" stroke-width="1.5" id="wire-to-counter" class="wire"/>
                    <circle cx="80" cy="140" r="5" fill="red" id="reset-indicator" opacity="0"/>
                </g>
                
                <!-- TTL 7432 Chip -->
                <g id="ttl-chip" transform="translate(600, 270)">
                    <rect x="0" y="0" width="100" height="120" fill="#d1d1d1" stroke="#333" stroke-width="2" rx="5" ry="5"/>
                    <text x="50" y="20" font-size="12" font-weight="bold" text-anchor="middle">TTL 7432</text>
                    <text x="50" y="40" font-size="10" text-anchor="middle">Quad 2-input</text>
                    <text x="50" y="55" font-size="10" text-anchor="middle">OR Gate</text>
                    
                    <line x1="0" y1="70" x2="100" y2="70" stroke="#333" stroke-width="1" stroke-dasharray="4,2"/>
                    <text x="50" y="85" font-size="8" text-anchor="middle">Pin 1-7: Top Side</text>
                    <text x="50" y="100" font-size="8" text-anchor="middle">Pin 8-14: Bottom Side</text>
                    <text x="50" y="115" font-size="8" text-anchor="middle">VCC: Pin 14, GND: Pin 7</text>
                </g>
            </svg>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        // Debug flag to help identify issues
        const DEBUG = true;
        
        // Function to log debug messages when DEBUG is true
        function debug(message) {
            if (DEBUG) {
                console.log(`[DEBUG] ${message}`);
            }
        }
        
        // Wait for the DOM to fully load before initializing the simulator
        document.addEventListener('DOMContentLoaded', function() {
            debug("DOM loaded - initializing simulator");
            
            // DOM Elements - Counter display
            const bitElements = [];
            for (let i = 0; i <= 4; i++) {
                bitElements[i] = document.getElementById(`bit${i}`);
                if (!bitElements[i]) {
                    console.error(`Could not find bit element with ID bit${i}`);
                }
            }
            
            const binaryValueElement = document.getElementById('binary-value');
            const decimalValueElement = document.getElementById('decimal-value');
            const logPanel = document.getElementById('log-panel');
            const customLogicPanel = document.getElementById('custom-logic-panel');
            
            // DOM Elements - Control buttons
            const stepButton = document.getElementById('btn-step');
            const autoButton = document.getElementById('btn-auto');
            const stopButton = document.getElementById('btn-stop');
            const resetButton = document.getElementById('btn-reset');
            const speedControl = document.getElementById('speed-control');
            
            // DOM Elements - Custom inputs
            const customBitInputs = [];
            for (let i = 0; i <= 4; i++) {
                customBitInputs[i] = document.getElementById(`custom-bit${i}`);
                if (!customBitInputs[i]) {
                    console.error(`Could not find custom bit input with ID custom-bit${i}`);
                }
            }
            
            // SVG Elements - Flip-flop displays
            const ffTextElements = [];
            const ffRectElements = [];
            for (let i = 0; i <= 4; i++) {
                ffTextElements[i] = document.getElementById(`ff${i}-text`);
                ffRectElements[i] = document.getElementById(`ff${i}-rect`);
                if (!ffTextElements[i] || !ffRectElements[i]) {
                    console.error(`Could not find flip-flop elements for bit ${i}`);
                }
            }
            
            // SVG Elements - Other visual elements
            const customPatternElement = document.getElementById('custom-pattern');
            const resetIndicator = document.getElementById('reset-indicator');
            const modulusRadios = document.querySelectorAll('input[name="modulus"]');
            
            // Counter state variables
            let counterValue = 0;
            let counterBits = [0, 0, 0, 0, 0]; // Q4, Q3, Q2, Q1, Q0 (MSB to LSB)
            let autoCountInterval = null;
            let autoCountSpeed = speedControl ? parseInt(speedControl.value) : 500;
            let selectedModulus = 10; // Default modulus
            let customResetPattern = [0, 0, 0, 0, 0];
            
            // Pre-defined reset patterns for each modulus (binary representation)
            const resetPatterns = {
                10: [0, 1, 0, 1, 0], // 01010 (binary for 10)
                12: [0, 1, 1, 0, 0], // 01100 (binary for 12)
                24: [1, 1, 0, 0, 0], // 11000 (binary for 24)
                30: [1, 1, 1, 1, 0]  // 11110 (binary for 30)
            };
            
            // Initialize the simulator
            function initialize() {
                debug("Initializing simulator");
                updateDisplay();
                updateCircuitHighlighting();
                addLogEntry("Simulator initialized with MOD-10 counter");
                
                // Set up event listeners for buttons
                if (stepButton) {
                    stepButton.addEventListener('click', function() {
                        debug("Step button clicked");
                        step();
                    });
                }
                
                if (autoButton) {
                    autoButton.addEventListener('click', function() {
                        debug("Auto button clicked");
                        startAutoCount();
                    });
                }
                
                if (stopButton) {
                    stopButton.addEventListener('click', function() {
                        debug("Stop button clicked");
                        stopAutoCount();
                    });
                }
                
                if (resetButton) {
                    resetButton.addEventListener('click', function() {
                        debug("Reset button clicked");
                        resetCounter();
                    });
                }
                
                if (speedControl) {
                    speedControl.addEventListener('input', function() {
                        updateSpeed();
                    });
                }
                
                // Set up modulus radio buttons
                modulusRadios.forEach(radio => {
                    radio.addEventListener('change', function() {
                        debug(`Modulus changed to ${this.value}`);
                        
                        if (this.value === 'custom') {
                            customLogicPanel.style.display = 'block';
                            selectedModulus = 'custom';
                        } else {
                            customLogicPanel.style.display = 'none';
                            selectedModulus = parseInt(this.value);
                        }
                        
                        updateCircuitHighlighting();
                        addLogEntry(`Modulus changed to ${this.value}`);
                    });
                });
                
                // Set up custom bit toggles
                customBitInputs.forEach((input, index) => {
                    if (input) {
                        input.addEventListener('change', function() {
                            customResetPattern[index] = this.checked ? 1 : 0;
                            updateCustomPattern();
                            updateCircuitHighlighting();
                            
                            const displayElement = this.parentElement.nextElementSibling;
                            if (displayElement) {
                                displayElement.textContent = this.checked ? '1' : '0';
                            }
                        });
                    }
                });
                
                // Setup tooltips for circuit elements
                setupTooltips();
            }
            
            // Counter Functions
            function step() {
                // Increment counter
                counterValue = (counterValue + 1) % 32;
                updateCounterBits();
                updateDisplay();
                
                // Check if we need to reset
                if (shouldReset()) {
                    addLogEntry(`Counter reset at ${counterValue} based on modulus ${selectedModulus}`, true);
                    resetCounter();
                    showResetAnimation();
                } else {
                    addLogEntry(`Count: ${counterValue} (${counterBits.join('')})`);
                }
                
                updateCircuitHighlighting();
            }
            
            function startAutoCount() {
                if (autoCountInterval) {
                    debug("Auto count already running");
                    return;
                }
                
                debug(`Starting auto count with speed: ${autoCountSpeed}ms`);
                
                if (autoButton) autoButton.disabled = true;
                if (stopButton) stopButton.disabled = false;
                
                autoCountInterval = setInterval(() => {
                    step();
                }, autoCountSpeed);
                
                addLogEntry('Auto count started');
            }
            
            function stopAutoCount() {
                if (!autoCountInterval) {
                    debug("No auto count running to stop");
                    return;
                }
                
                debug("Stopping auto count");
                clearInterval(autoCountInterval);
                autoCountInterval = null;
                
                if (autoButton) autoButton.disabled = false;
                if (stopButton) stopButton.disabled = true;
                
                addLogEntry('Auto count stopped');
            }
            
            function resetCounter() {
                debug("Resetting counter to 0");
                counterValue = 0;
                updateCounterBits();
                updateDisplay();
                addLogEntry('Counter reset to 0');
                updateCircuitHighlighting();
            }
            
            function updateSpeed() {
                if (!speedControl) return;
                
                autoCountSpeed = parseInt(speedControl.value);
                debug(`Speed updated to ${autoCountSpeed}ms`);
                
                if (autoCountInterval) {
                    stopAutoCount();
                    startAutoCount();
                }
            }
            
            function updateCounterBits() {
                // Convert decimal to 5-bit binary (MSB to LSB)
                let tempValue = counterValue;
                
                // Initialize all bits to 0
                for (let i = 0; i < 5; i++) {
                    counterBits[i] = 0;
                }
                
                // Fill in the bits from right to left (LSB to MSB)
                let index = 4; // Start with LSB (index 4 = Q0)
                while (tempValue > 0 && index >= 0) {
                    counterBits[index] = tempValue % 2;
                    tempValue = Math.floor(tempValue / 2);
                    index--;
                }
                
                debug(`Counter bits updated: ${counterBits.join('')} (decimal: ${counterValue})`);
            }
            
            function updateDisplay() {
                // Update bit display elements
                for (let i = 0; i < 5; i++) {
                    if (bitElements[i]) {
                        bitElements[i].textContent = counterBits[i];
                    }
                    
                    if (ffTextElements[i]) {
                        ffTextElements[i].textContent = `Q${4-i}: ${counterBits[i]}`;
                    }
                }
                
                // Update binary and decimal display
                if (binaryValueElement) {
                    binaryValueElement.textContent = counterBits.join('');
                }
                
                if (decimalValueElement) {
                    decimalValueElement.textContent = counterValue;
                }
            }
            
            function shouldReset() {
                if (selectedModulus === 'custom') {
                    // Compare current counter bits with custom pattern
                    return arraysEqual(counterBits, customResetPattern);
                } else {
                    // Compare with decimal value
                    return counterValue === selectedModulus;
                }
            }
            
            function updateCustomPattern() {
                if (customPatternElement) {
                    customPatternElement.textContent = `(${customResetPattern.join('')})`;
                }
            }
            
            function addLogEntry(message, isReset = false) {
                if (!logPanel) return;
                
                const entry = document.createElement('div');
                entry.className = 'log-entry' + (isReset ? ' reset' : '');
                entry.textContent = message;
                
                logPanel.appendChild(entry);
                logPanel.scrollTop = logPanel.scrollHeight;
                
                // Keep log size manageable
                while (logPanel.children.length > 50) {
                    logPanel.removeChild(logPanel.firstChild);
                }
                
                debug(`Log: ${message}`);
            }
            
            function showResetAnimation() {
                // Highlight reset indicator
                if (resetIndicator) {
                    resetIndicator.setAttribute('opacity', '1');
                    setTimeout(() => {
                        resetIndicator.setAttribute('opacity', '0');
                    }, 300);
                }
                
                // Pulse bit elements
                bitElements.forEach(el => {
                    if (el) {
                        el.classList.add('highlight');
                        setTimeout(() => {
                            el.classList.remove('highlight');
                        }, 500);
                    }
                });
            }
            
            function updateCircuitHighlighting() {
                // Reset all highlighting
                document.querySelectorAll('.wire-active').forEach(el => {
                    el.classList.remove('wire-active');
                });
                
                document.querySelectorAll('.gate-active').forEach(el => {
                    el.classList.remove('gate-active');
                });
                
                // Update flip-flop display
                for (let i = 0; i < 5; i++) {
                    if (ffRectElements[i]) {
                        ffRectElements[i].setAttribute('fill', counterBits[i] === 1 ? '#d4f0fc' : 'white');
                    }
                }
                
                // Detector highlighting based on selected modulus
                if (selectedModulus === 'custom') {
                    highlightDetector('custom');
                    
                    if (arraysEqual(counterBits, customResetPattern)) {
                        highlightResetPath('custom');
                    }
                } else {
                    const modString = `mod${selectedModulus}`;
                    highlightDetector(modString);
                    
                    if (counterValue === selectedModulus) {
                        highlightResetPath(modString);
                    }
                }
            }
            
            function highlightDetector(detectorId) {
                // Highlight detector box
                const detector = document.getElementById(`${detectorId}-detector`);
                if (detector && detector.querySelector('rect')) {
                    detector.querySelector('rect').setAttribute('stroke', '#3498db');
                    detector.querySelector('rect').setAttribute('stroke-width', '3');
                }
                
                // Highlight wires from counter to detector
                for (let i = 0; i < 5; i++) {
                    const wireId = `wire-q${i}-${detectorId}`;
                    const wire = document.getElementById(wireId);
                    if (wire) {
                        wire.classList.add('wire-active');
                    }
                }
            }
            
            function highlightResetPath(detectorId) {
                let wireToOr;
                let orGate;
                
                switch (detectorId) {
                    case 'mod10':
                        wireToOr = document.getElementById('wire-mod10-or1');
                        orGate = document.getElementById('or1-path');
                        if (document.getElementById('wire-or1-or3')) {
                            document.getElementById('wire-or1-or3').classList.add('wire-active');
                        }
                        break;
                    case 'mod12':
                        wireToOr = document.getElementById('wire-mod12-or1');
                        orGate = document.getElementById('or1-path');
                        if (document.getElementById('wire-or1-or3')) {
                            document.getElementById('wire-or1-or3').classList.add('wire-active');
                        }
                        break;
                    case 'mod24':
                        wireToOr = document.getElementById('wire-mod24-or2');
                        orGate = document.getElementById('or2-path');
                        if (document.getElementById('wire-or2-or3')) {
                            document.getElementById('wire-or2-or3').classList.add('wire-active');
                        }
                        break;
                    case 'mod30':
                        wireToOr = document.getElementById('wire-mod30-or2');
                        orGate = document.getElementById('or2-path');
                        if (document.getElementById('wire-or2-or3')) {
                            document.getElementById('wire-or2-or3').classList.add('wire-active');
                        }
                        break;
                    case 'custom':
                        wireToOr = document.getElementById('wire-custom-or3');
                        break;
                }
                
                if (wireToOr) {
                    wireToOr.classList.add('wire-active');
                }
                
                if (orGate) {
                    orGate.classList.add('gate-active');
                }
                
                // Final OR gate and reset wire
                const or3Path = document.getElementById('or3-path');
                const wireReset = document.getElementById('wire-reset');
                const wireToCounter = document.getElementById('wire-to-counter');
                
                if (or3Path) or3Path.classList.add('gate-active');
                if (wireReset) wireReset.classList.add('wire-active');
                if (wireToCounter) wireToCounter.classList.add('wire-active');
                
                if (resetIndicator) {
                    resetIndicator.setAttribute('opacity', '1');
                    
                    // Reset indicator will be hidden after a delay
                    setTimeout(() => {
                        resetIndicator.setAttribute('opacity', '0');
                    }, 300);
                }
            }
            
            function setupTooltips() {
                const circuitElements = [
                    { id: 'counter-bits', text: '5-bit binary counter (0-31)' },
                    { id: 'mod10-detector', text: 'Detects when counter reaches 10 (01010)' },
                    { id: 'mod12-detector', text: 'Detects when counter reaches 12 (01100)' },
                    { id: 'mod24-detector', text: 'Detects when counter reaches 24 (11000)' },
                    { id: 'mod30-detector', text: 'Detects when counter reaches 30 (11110)' },
                    { id: 'custom-detector', text: 'Detects when counter matches custom pattern' },
                    { id: 'or-gate1', text: 'OR gate for MOD-10/MOD-12 detection' },
                    { id: 'or-gate2', text: 'OR gate for MOD-24/MOD-30 detection' },
                    { id: 'or-gate3', text: 'Final OR gate that outputs reset signal' },
                    { id: 'ttl-chip', text: 'TTL 7432 Quad 2-Input OR Gate IC' }
                ];
                
                const tooltip = document.getElementById('tooltip');
                if (!tooltip) return;
                
                circuitElements.forEach(element => {
                    const el = document.getElementById(element.id);
                    if (el) {
                        el.addEventListener('mouseover', function(e) {
                            tooltip.textContent = element.text;
                            tooltip.style.opacity = '1';
                            tooltip.style.left = (e.pageX + 10) + 'px';
                            tooltip.style.top = (e.pageY + 10) + 'px';
                        });
                        
                        el.addEventListener('mousemove', function(e) {
                            tooltip.style.left = (e.pageX + 10) + 'px';
                            tooltip.style.top = (e.pageY + 10) + 'px';
                        });
                        
                        el.addEventListener('mouseout', function() {
                            tooltip.style.opacity = '0';
                        });
                    }
                });
            }
            
            function arraysEqual(a, b) {
                return Array.isArray(a) && 
                       Array.isArray(b) && 
                       a.length === b.length && 
                       a.every((val, index) => val === b[index]);
            }
            
            // Initialize the simulator when the page loads
            initialize();
        });
    </script>
