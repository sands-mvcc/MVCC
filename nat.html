<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NAT/PAT Interactive Lesson | Network Administration</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #ffffff;
    --surface: #f8f9fb;
    --surface2: #eef0f5;
    --border: #dde1ea;
    --text: #1a1d26;
    --text-muted: #6b7280;
    --primary: #1e40af;
    --primary-light: #3b82f6;
    --primary-bg: #eff6ff;
    --accent: #0ea5e9;
    --success: #059669;
    --success-bg: #ecfdf5;
    --warning: #d97706;
    --warning-bg: #fffbeb;
    --danger: #dc2626;
    --danger-bg: #fef2f2;
    --mono: 'Space Mono', monospace;
    --sans: 'DM Sans', sans-serif;
    --serif: 'DM Serif Display', serif;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  
  body {
    font-family: var(--sans);
    background: var(--bg);
    color: var(--text);
    line-height: 1.65;
    font-size: 15px;
  }

  /* NAV */
  nav {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    padding: 0 2rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    height: 56px;
  }

  .nav-brand {
    font-family: var(--mono);
    font-size: 13px;
    font-weight: 700;
    color: var(--primary);
    letter-spacing: 0.05em;
    white-space: nowrap;
    margin-right: 1rem;
  }

  .nav-links {
    display: flex;
    gap: 0.25rem;
    overflow-x: auto;
    scrollbar-width: none;
    flex: 1;
  }

  .nav-links::-webkit-scrollbar { display: none; }

  .nav-link {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-muted);
    text-decoration: none;
    padding: 0.35rem 0.65rem;
    border-radius: 6px;
    white-space: nowrap;
    transition: all 0.2s;
    cursor: pointer;
    border: none;
    background: none;
    font-family: var(--sans);
  }

  .nav-link:hover, .nav-link.active {
    background: var(--primary-bg);
    color: var(--primary);
  }

  /* HERO */
  .hero {
    background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #1e40af 100%);
    padding: 5rem 2rem 4rem;
    text-align: center;
    color: white;
    position: relative;
    overflow: hidden;
  }

  .hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at 30% 50%, rgba(59,130,246,0.2) 0%, transparent 70%),
                radial-gradient(ellipse at 70% 50%, rgba(14,165,233,0.15) 0%, transparent 70%);
  }

  .hero-grid {
    position: absolute;
    inset: 0;
    background-image: linear-gradient(rgba(255,255,255,0.04) 1px, transparent 1px),
                      linear-gradient(90deg, rgba(255,255,255,0.04) 1px, transparent 1px);
    background-size: 40px 40px;
  }

  .hero-content { position: relative; z-index: 1; max-width: 800px; margin: 0 auto; }

  .hero-badge {
    display: inline-block;
    background: rgba(59,130,246,0.3);
    border: 1px solid rgba(59,130,246,0.5);
    color: #93c5fd;
    font-family: var(--mono);
    font-size: 11px;
    letter-spacing: 0.1em;
    padding: 0.3rem 0.9rem;
    border-radius: 20px;
    margin-bottom: 1.5rem;
    text-transform: uppercase;
  }

  .hero h1 {
    font-family: var(--serif);
    font-size: clamp(2.2rem, 5vw, 3.5rem);
    color: white;
    line-height: 1.15;
    margin-bottom: 1rem;
  }

  .hero p {
    font-size: 1.1rem;
    color: #94a3b8;
    max-width: 600px;
    margin: 0 auto 2.5rem;
  }

  .hero-stats {
    display: flex;
    justify-content: center;
    gap: 3rem;
    flex-wrap: wrap;
  }

  .hero-stat { text-align: center; }
  .hero-stat .num { font-family: var(--mono); font-size: 2rem; font-weight: 700; color: #60a5fa; }
  .hero-stat .lbl { font-size: 11px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.08em; }

  /* MAIN LAYOUT */
  .container { max-width: 1000px; margin: 0 auto; padding: 0 2rem; }

  section { padding: 4rem 0; }
  section + section { border-top: 1px solid var(--border); }

  .section-label {
    font-family: var(--mono);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--primary-light);
    margin-bottom: 0.5rem;
  }

  .section-title {
    font-family: var(--serif);
    font-size: clamp(1.6rem, 3vw, 2.2rem);
    color: var(--text);
    margin-bottom: 0.75rem;
    line-height: 1.25;
  }

  .section-intro {
    color: var(--text-muted);
    max-width: 680px;
    margin-bottom: 2.5rem;
    font-size: 1rem;
    line-height: 1.7;
  }

  /* CARDS */
  .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.25rem; }

  .card {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem;
    transition: all 0.25s;
  }

  .card:hover { border-color: var(--primary-light); box-shadow: 0 4px 20px rgba(59,130,246,0.1); transform: translateY(-2px); }

  .card-icon {
    width: 44px; height: 44px;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.3rem;
    margin-bottom: 1rem;
  }

  .card-icon.blue { background: var(--primary-bg); }
  .card-icon.green { background: var(--success-bg); }
  .card-icon.orange { background: var(--warning-bg); }
  .card-icon.red { background: var(--danger-bg); }

  .card h3 { font-size: 0.95rem; font-weight: 700; margin-bottom: 0.5rem; }
  .card p { font-size: 0.88rem; color: var(--text-muted); line-height: 1.6; }

  /* INFO BOX */
  .info-box {
    border-left: 3px solid;
    padding: 1rem 1.25rem;
    border-radius: 0 8px 8px 0;
    margin: 1.5rem 0;
    font-size: 0.9rem;
  }

  .info-box.blue { border-color: var(--primary-light); background: var(--primary-bg); }
  .info-box.green { border-color: var(--success); background: var(--success-bg); }
  .info-box.orange { border-color: var(--warning); background: var(--warning-bg); }
  .info-box strong { display: block; margin-bottom: 0.25rem; }

  /* TABS */
  .tab-bar {
    display: flex;
    gap: 0.5rem;
    border-bottom: 2px solid var(--border);
    margin-bottom: 2rem;
    overflow-x: auto;
    scrollbar-width: none;
  }

  .tab-bar::-webkit-scrollbar { display: none; }

  .tab-btn {
    font-family: var(--sans);
    font-size: 13px;
    font-weight: 600;
    color: var(--text-muted);
    background: none;
    border: none;
    padding: 0.65rem 1.1rem;
    cursor: pointer;
    position: relative;
    white-space: nowrap;
    transition: color 0.2s;
  }

  .tab-btn::after {
    content: '';
    position: absolute;
    bottom: -2px; left: 0; right: 0;
    height: 2px;
    background: var(--primary);
    transform: scaleX(0);
    transition: transform 0.2s;
  }

  .tab-btn.active { color: var(--primary); }
  .tab-btn.active::after { transform: scaleX(1); }

  .tab-panel { display: none; animation: fadeIn 0.3s ease; }
  .tab-panel.active { display: block; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

  /* NAT ANIMATION */
  .nat-diagram {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 2rem;
    margin: 2rem 0;
  }

  .packet-flow {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content: center;
    margin: 1.5rem 0;
  }

  .pf-node {
    text-align: center;
    min-width: 100px;
  }

  .pf-box {
    border: 2px solid;
    border-radius: 10px;
    padding: 0.6rem 1rem;
    font-family: var(--mono);
    font-size: 11px;
    font-weight: 700;
    position: relative;
  }

  .pf-box.client { border-color: var(--success); background: var(--success-bg); color: var(--success); }
  .pf-box.router { border-color: var(--primary); background: var(--primary-bg); color: var(--primary); }
  .pf-box.server { border-color: var(--warning); background: var(--warning-bg); color: var(--warning); }

  .pf-label { font-size: 10px; color: var(--text-muted); margin-top: 0.4rem; }

  .pf-arrow {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    flex: 1;
    min-width: 80px;
  }

  .arrow-line {
    width: 100%;
    height: 2px;
    position: relative;
    overflow: visible;
  }

  .arrow-packet {
    position: absolute;
    top: -8px;
    height: 16px;
    padding: 0 6px;
    border-radius: 4px;
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 700;
    white-space: nowrap;
    display: flex;
    align-items: center;
    transition: none;
  }

  .arrow-packet.before { background: #fee2e2; color: var(--danger); border: 1px solid #fca5a5; }
  .arrow-packet.after { background: #dbeafe; color: var(--primary); border: 1px solid #93c5fd; }

  .arrow-desc { font-size: 10px; color: var(--text-muted); text-align: center; }

  /* TABLE */
  .styled-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
  }

  .styled-table th {
    background: var(--surface);
    font-family: var(--mono);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    padding: 0.75rem 1rem;
    text-align: left;
    border-bottom: 1px solid var(--border);
  }

  .styled-table td {
    padding: 0.7rem 1rem;
    border-bottom: 1px solid var(--border);
    font-family: var(--mono);
    font-size: 12px;
  }

  .styled-table tr:last-child td { border-bottom: none; }
  .styled-table tr:hover td { background: var(--surface); }

  .badge {
    display: inline-block;
    font-size: 10px;
    font-weight: 700;
    font-family: var(--mono);
    padding: 2px 8px;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .badge-blue { background: var(--primary-bg); color: var(--primary); }
  .badge-green { background: var(--success-bg); color: var(--success); }
  .badge-orange { background: var(--warning-bg); color: var(--warning); }

  /* HEADER BUILDER */
  .builder-wrap {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 2rem;
  }

  .builder-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
  }

  @media (max-width: 700px) { .builder-grid { grid-template-columns: 1fr; } }

  .builder-form label {
    display: block;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-bottom: 0.3rem;
    margin-top: 1rem;
  }

  .builder-form label:first-child { margin-top: 0; }

  .builder-form input, .builder-form select {
    width: 100%;
    padding: 0.6rem 0.75rem;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    font-family: var(--mono);
    font-size: 13px;
    color: var(--text);
    background: white;
    transition: border-color 0.2s;
  }

  .builder-form input:focus, .builder-form select:focus {
    outline: none;
    border-color: var(--primary-light);
    box-shadow: 0 0 0 3px rgba(59,130,246,0.1);
  }

  .builder-form select { cursor: pointer; }

  .build-btn {
    width: 100%;
    margin-top: 1.5rem;
    padding: 0.75rem;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    font-family: var(--sans);
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.02em;
  }

  .build-btn:hover { background: #1d4ed8; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(30,64,175,0.3); }

  .header-output {
    background: #0f172a;
    border-radius: 12px;
    padding: 1.5rem;
    font-family: var(--mono);
    font-size: 12px;
    overflow-x: auto;
    min-height: 200px;
  }

  .header-section { margin-bottom: 1.25rem; }
  .header-section-title { color: #64748b; font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.5rem; }
  .header-field { display: flex; gap: 0.75rem; margin: 0.2rem 0; align-items: flex-start; }
  .hf-name { color: #94a3b8; min-width: 140px; flex-shrink: 0; }
  .hf-val { color: #34d399; }
  .hf-bits { color: #f59e0b; font-size: 10px; margin-left: auto; }
  .hf-changed { color: #f87171; }

  .output-placeholder { color: #475569; text-align: center; padding-top: 4rem; font-size: 13px; }

  /* TRANSLATION TABLE */
  .trans-table-wrap {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 1.5rem;
    margin-top: 1.5rem;
  }

  .trans-table-title {
    font-family: var(--mono);
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--primary);
    margin-bottom: 1rem;
  }

  /* QUIZ */
  .quiz-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 1.75rem;
    margin-bottom: 1.25rem;
    transition: all 0.25s;
  }

  .quiz-question {
    font-weight: 600;
    margin-bottom: 1.25rem;
    font-size: 0.95rem;
  }

  .quiz-q-num {
    font-family: var(--mono);
    color: var(--primary);
    font-size: 12px;
    margin-bottom: 0.4rem;
  }

  .quiz-options { display: grid; grid-template-columns: 1fr 1fr; gap: 0.6rem; }

  @media (max-width: 600px) { .quiz-options { grid-template-columns: 1fr; } }

  .quiz-option {
    background: white;
    border: 2px solid var(--border);
    border-radius: 8px;
    padding: 0.65rem 1rem;
    font-size: 0.87rem;
    cursor: pointer;
    transition: all 0.18s;
    text-align: left;
    font-family: var(--sans);
    color: var(--text);
  }

  .quiz-option:hover:not(:disabled) { border-color: var(--primary-light); background: var(--primary-bg); }

  .quiz-option.correct { border-color: var(--success); background: var(--success-bg); color: var(--success); font-weight: 600; }
  .quiz-option.incorrect { border-color: var(--danger); background: var(--danger-bg); color: var(--danger); }
  .quiz-option.reveal { border-color: var(--success); background: var(--success-bg); color: var(--success); font-weight: 600; }
  .quiz-option:disabled { cursor: default; }

  .quiz-feedback {
    margin-top: 1rem;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    font-size: 0.87rem;
    display: none;
  }

  .quiz-feedback.show { display: block; }
  .quiz-feedback.good { background: var(--success-bg); color: #065f46; border: 1px solid #a7f3d0; }
  .quiz-feedback.bad { background: var(--danger-bg); color: #7f1d1d; border: 1px solid #fca5a5; }

  .quiz-score-bar {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem 2rem;
    display: flex;
    align-items: center;
    gap: 2rem;
    margin-top: 1.5rem;
    flex-wrap: wrap;
  }

  .score-circle {
    width: 72px; height: 72px;
    border-radius: 50%;
    border: 3px solid var(--primary);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .score-num { font-family: var(--mono); font-size: 1.3rem; font-weight: 700; color: var(--primary); line-height: 1; }
  .score-of { font-size: 10px; color: var(--text-muted); }

  .score-label { font-size: 0.85rem; color: var(--text-muted); }
  .score-label strong { display: block; font-size: 1rem; color: var(--text); }

  /* GLOSSARY */
  .glossary-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem; }

  .glossary-item {
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 1rem 1.25rem;
    background: white;
    transition: all 0.2s;
  }

  .glossary-item:hover { border-color: var(--primary-light); box-shadow: 0 2px 10px rgba(59,130,246,0.08); }
  .glossary-term { font-family: var(--mono); font-size: 12px; font-weight: 700; color: var(--primary); margin-bottom: 0.35rem; }
  .glossary-def { font-size: 0.85rem; color: var(--text-muted); line-height: 1.55; }

  /* SCENARIO ANIMATOR */
  .scenario-wrap {
    background: #0f172a;
    border-radius: 16px;
    padding: 2rem;
    color: white;
    font-family: var(--mono);
    font-size: 13px;
  }

  .scenario-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }

  .scenario-title { color: #60a5fa; font-size: 14px; font-weight: 700; }

  .scenario-controls { display: flex; gap: 0.5rem; }

  .scn-btn {
    padding: 0.4rem 0.85rem;
    border-radius: 6px;
    font-family: var(--mono);
    font-size: 12px;
    cursor: pointer;
    border: 1px solid;
    transition: all 0.2s;
  }

  .scn-btn.play { background: #059669; border-color: #059669; color: white; }
  .scn-btn.play:hover { background: #047857; }
  .scn-btn.reset { background: transparent; border-color: #475569; color: #94a3b8; }
  .scn-btn.reset:hover { border-color: #94a3b8; color: white; }

  .scenario-log {
    background: #1e293b;
    border-radius: 10px;
    padding: 1.25rem;
    min-height: 180px;
    overflow-y: auto;
    max-height: 280px;
  }

  .log-entry { margin: 0.3rem 0; font-size: 12px; animation: slideIn 0.3s ease; }
  .log-entry.info { color: #94a3b8; }
  .log-entry.tx { color: #34d399; }
  .log-entry.nat { color: #fbbf24; }
  .log-entry.rx { color: #60a5fa; }
  .log-entry.step { color: #c084fc; font-weight: 700; }
  .log-entry.table { color: #f87171; }

  @keyframes slideIn { from { opacity: 0; transform: translateX(-8px); } to { opacity: 1; transform: translateX(0); } }

  .scenario-nat-table {
    margin-top: 1.25rem;
  }

  .nat-table-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.5rem;
    padding: 0.35rem 0;
    border-bottom: 1px solid #1e293b;
    font-size: 11px;
  }

  .nat-table-row.header { color: #64748b; font-weight: 700; border-bottom: 1px solid #334155; }
  .nat-table-row.data { color: #e2e8f0; }
  .nat-table-row.data:hover { background: #1e293b; border-radius: 4px; }

  .nat-col-inside { color: #f87171; }
  .nat-col-outside { color: #34d399; }
  .nat-col-proto { color: #a78bfa; }
  .nat-col-state { color: #fbbf24; }

  /* RESPONSIVE */
  @media (max-width: 768px) {
    nav { padding: 0 1rem; }
    .container { padding: 0 1rem; }
    .hero { padding: 3rem 1rem; }
    section { padding: 2.5rem 0; }
  }

  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
  @media (max-width: 700px) { .two-col { grid-template-columns: 1fr; } }

  .prose p { margin-bottom: 1rem; line-height: 1.75; }
  .prose h4 { font-size: 1rem; font-weight: 700; margin: 1.5rem 0 0.5rem; color: var(--text); }
  .prose ul { padding-left: 1.25rem; }
  .prose li { margin-bottom: 0.4rem; }
  .prose code { background: var(--surface2); font-family: var(--mono); font-size: 12px; padding: 2px 6px; border-radius: 4px; color: var(--primary); }

  .timeline { position: relative; padding-left: 2rem; }
  .timeline::before { content: ''; position: absolute; left: 8px; top: 0; bottom: 0; width: 2px; background: var(--border); }
  .tl-item { position: relative; margin-bottom: 1.5rem; }
  .tl-dot { position: absolute; left: -1.75rem; top: 4px; width: 12px; height: 12px; border-radius: 50%; background: var(--primary); border: 2px solid white; box-shadow: 0 0 0 2px var(--primary); }
  .tl-content { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 1rem 1.25rem; }
  .tl-title { font-weight: 700; font-size: 0.9rem; margin-bottom: 0.25rem; }
  .tl-body { font-size: 0.85rem; color: var(--text-muted); }

  .highlight-box {
    background: linear-gradient(135deg, var(--primary-bg), #f0f9ff);
    border: 1px solid #bfdbfe;
    border-radius: 12px;
    padding: 1.5rem;
    margin: 1.5rem 0;
  }

  .highlight-box h4 { color: var(--primary); font-size: 0.9rem; margin-bottom: 0.5rem; }
  .highlight-box p, .highlight-box li { font-size: 0.88rem; color: #1e3a5f; }
  .highlight-box ul { padding-left: 1.2rem; }
  .highlight-box li { margin-bottom: 0.3rem; }
</style>
</head>
<body>

<!-- NAVIGATION -->
<nav>
  <div class="nav-brand">üîÑ NAT/PAT</div>
  <div class="nav-links">
    <button class="nav-link active" onclick="scrollToSection('overview')">Overview</button>
    <button class="nav-link" onclick="scrollToSection('concepts')">Core Concepts</button>
    <button class="nav-link" onclick="scrollToSection('types')">Types of NAT</button>
    <button class="nav-link" onclick="scrollToSection('simulator')">Live Simulator</button>
    <button class="nav-link" onclick="scrollToSection('builder')">Header Builder</button>
    <button class="nav-link" onclick="scrollToSection('config')">Configuration</button>
    <button class="nav-link" onclick="scrollToSection('glossary')">Glossary</button>
    <button class="nav-link" onclick="scrollToSection('quiz')">Quiz</button>
  </div>
</nav>

<!-- HERO -->
<div class="hero">
  <div class="hero-grid"></div>
  <div class="hero-content">
    <div class="hero-badge">Network Administration ¬∑ IT 2450</div>
    <h1>Network Address Translation<br>&amp; Port Address Translation</h1>
    <p>Master NAT and PAT ‚Äî the technologies that connect billions of private devices to the public internet through address reuse, port multiplexing, and dynamic translation tables.</p>
    <div class="hero-stats">
      <div class="hero-stat"><div class="num">4.3B</div><div class="lbl">IPv4 Addresses Total</div></div>
      <div class="hero-stat"><div class="num">65,535</div><div class="lbl">Available Ports</div></div>
      <div class="hero-stat"><div class="num">3</div><div class="lbl">NAT Types</div></div>
      <div class="hero-stat"><div class="num">RFC&nbsp;3022</div><div class="lbl">Standard</div></div>
    </div>
  </div>
</div>

<div class="container">

<!-- OVERVIEW -->
<section id="overview">
  <div class="section-label">Module 1</div>
  <div class="section-title">Why NAT/PAT Exists</div>
  <p class="section-intro">The internet uses IPv4 addresses ‚Äî and there aren't enough to go around. NAT and PAT are engineering solutions that allow organizations to use private (non-routable) addresses internally while sharing a small pool of public addresses for internet access.</p>

  <div class="card-grid">
    <div class="card">
      <div class="card-icon blue">üåê</div>
      <h3>IPv4 Exhaustion</h3>
      <p>IPv4 provides only ~4.3 billion addresses. With billions of devices online, NAT extends the effective address space by allowing multiple private devices to share a single public IP.</p>
    </div>
    <div class="card">
      <div class="card-icon green">üîí</div>
      <h3>Security by Obscurity</h3>
      <p>NAT hides internal IP addresses from external networks, adding a layer of protection against direct targeting of internal hosts and reducing the attack surface.</p>
    </div>
    <div class="card">
      <div class="card-icon orange">‚öôÔ∏è</div>
      <h3>Address Flexibility</h3>
      <p>Organizations can change ISPs without renumbering internal devices. The internal network remains stable; only the external (public) address changes at the NAT boundary.</p>
    </div>
    <div class="card">
      <div class="card-icon red">üí°</div>
      <h3>Cost Reduction</h3>
      <p>Fewer public IP addresses are needed ‚Äî and registered IP addresses cost money. PAT allows thousands of hosts to share a single public IP, dramatically reducing costs.</p>
    </div>
  </div>

  <div class="info-box blue" style="margin-top:2rem">
    <strong>üìå RFC 1918 ‚Äî Private Address Ranges</strong>
    Three blocks are reserved for private use and are non-routable on the public internet: <strong>10.0.0.0/8</strong> (Class A), <strong>172.16.0.0/12</strong> (Class B range), and <strong>192.168.0.0/16</strong> (Class C). These never appear as source addresses in packets routed on the public internet without NAT translation.
  </div>

  <div class="two-col" style="margin-top:2rem">
    <div>
      <h4 style="font-size:1rem;font-weight:700;margin-bottom:0.75rem">Without NAT</h4>
      <div class="timeline">
        <div class="tl-item"><div class="tl-dot"></div><div class="tl-content"><div class="tl-title">Every device needs a public IP</div><div class="tl-body">Each host requires a globally unique routable address ‚Äî quickly depleting the IPv4 pool.</div></div></div>
        <div class="tl-item"><div class="tl-dot"></div><div class="tl-content"><div class="tl-title">Internal topology exposed</div><div class="tl-body">External hosts can directly see and target internal machines by IP address.</div></div></div>
        <div class="tl-item"><div class="tl-dot"></div><div class="tl-content"><div class="tl-title">ISP changes require renumbering</div><div class="tl-body">Switching providers means reassigning all public IPs and updating all DNS records.</div></div></div>
      </div>
    </div>
    <div>
      <h4 style="font-size:1rem;font-weight:700;margin-bottom:0.75rem">With NAT/PAT</h4>
      <div class="timeline">
        <div class="tl-item"><div class="tl-dot" style="background:var(--success)"></div><div class="tl-content"><div class="tl-title">Thousands of devices, one public IP</div><div class="tl-body">PAT distinguishes sessions by unique port numbers, multiplexing many hosts through one address.</div></div></div>
        <div class="tl-item"><div class="tl-dot" style="background:var(--success)"></div><div class="tl-content"><div class="tl-title">Private addressing inside</div><div class="tl-body">RFC 1918 addresses are used internally. External parties see only the NAT router's public IP.</div></div></div>
        <div class="tl-item"><div class="tl-dot" style="background:var(--success)"></div><div class="tl-content"><div class="tl-title">ISP independence</div><div class="tl-body">Internal addressing stays constant. Only the NAT pool changes when switching providers.</div></div></div>
      </div>
    </div>
  </div>
</section>

<!-- CORE CONCEPTS -->
<section id="concepts">
  <div class="section-label">Module 2</div>
  <div class="section-title">Core Concepts &amp; Terminology</div>
  <p class="section-intro">Understanding NAT requires precise vocabulary. Cisco's implementation distinguishes four address types and three operational directions.</p>

  <div class="tab-bar">
    <button class="tab-btn active" onclick="showTab('addr-types', this)">Address Types</button>
    <button class="tab-btn" onclick="showTab('translation', this)">Translation Process</button>
    <button class="tab-btn" onclick="showTab('nat-table', this)">NAT Table</button>
    <button class="tab-btn" onclick="showTab('pat-detail', this)">PAT Deep Dive</button>
  </div>

  <!-- Address Types -->
  <div id="addr-types" class="tab-panel active">
    <table class="styled-table">
      <thead>
        <tr>
          <th>Term</th>
          <th>Location</th>
          <th>Type</th>
          <th>Example</th>
          <th>Routable?</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Inside Local</strong></td>
          <td>Inside network</td>
          <td><span class="badge badge-blue">Private</span></td>
          <td>192.168.1.10</td>
          <td>‚ùå No</td>
        </tr>
        <tr>
          <td><strong>Inside Global</strong></td>
          <td>Outside perspective of inside host</td>
          <td><span class="badge badge-green">Public</span></td>
          <td>203.0.113.1</td>
          <td>‚úÖ Yes</td>
        </tr>
        <tr>
          <td><strong>Outside Local</strong></td>
          <td>Inside perspective of outside host</td>
          <td><span class="badge badge-orange">Usually Public</span></td>
          <td>8.8.8.8</td>
          <td>‚úÖ Yes</td>
        </tr>
        <tr>
          <td><strong>Outside Global</strong></td>
          <td>Outside network</td>
          <td><span class="badge badge-green">Public</span></td>
          <td>8.8.8.8</td>
          <td>‚úÖ Yes</td>
        </tr>
      </tbody>
    </table>
    <div class="info-box orange" style="margin-top:1.5rem">
      <strong>‚ö° Memory Trick</strong>
      <em>Inside/Outside</em> refers to the <strong>location</strong> relative to NAT. <em>Local/Global</em> refers to the <strong>type</strong> of address. "Inside Local" = private address of internal host as seen from inside. "Inside Global" = public address assigned to that same internal host as seen from outside.
    </div>
  </div>

  <!-- Translation Process -->
  <div id="translation" class="tab-panel">
    <div class="prose">
      <h4>Step-by-Step Outbound Translation (Inside ‚Üí Outside)</h4>
      <p>When an inside host initiates a session to an outside server, the NAT router intercepts the packet and performs translation:</p>
    </div>

    <div class="nat-diagram">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;flex-wrap:wrap;gap:0.5rem">
        <strong style="font-size:14px">Packet Translation Flow</strong>
        <button class="scn-btn play" onclick="animateFlow()">‚ñ∂ Animate Packet</button>
      </div>

      <div class="packet-flow">
        <div class="pf-node">
          <div class="pf-box client">192.168.1.10<br>Port: 1024</div>
          <div class="pf-label">Inside Host<br>(Inside Local)</div>
        </div>

        <div class="pf-arrow">
          <div style="position:relative;width:100%">
            <svg width="100%" height="4"><line x1="0" y1="2" x2="100%" y2="2" stroke="#e2e8f0" stroke-width="2" marker-end="url(#arrow)"/></svg>
            <div id="pkt-out" class="arrow-packet before" style="left:5%;display:none">SRC: 192.168.1.10:1024</div>
          </div>
          <div class="arrow-desc">Original Packet</div>
        </div>

        <div class="pf-node">
          <div class="pf-box router">NAT Router<br>203.0.113.1</div>
          <div class="pf-label">Border Router<br>(Translates Here)</div>
        </div>

        <div class="pf-arrow">
          <div style="position:relative;width:100%">
            <svg width="100%" height="4"><line x1="0" y1="2" x2="100%" y2="2" stroke="#e2e8f0" stroke-width="2"/></svg>
            <div id="pkt-in" class="arrow-packet after" style="right:5%;display:none">SRC: 203.0.113.1:49152</div>
          </div>
          <div class="arrow-desc">Translated Packet</div>
        </div>

        <div class="pf-node">
          <div class="pf-box server">8.8.8.8<br>Port: 53</div>
          <div class="pf-label">Outside Server<br>(Outside Global)</div>
        </div>
      </div>

      <div id="flow-steps" style="font-size:12px;color:var(--text-muted);min-height:40px;font-family:var(--mono);text-align:center"></div>
    </div>

    <div class="highlight-box">
      <h4>üîÑ Return Traffic (Inbound Translation)</h4>
      <p>When the outside server replies, it sends to <code>203.0.113.1:49152</code>. The NAT router looks up this <em>Inside Global</em> address and port in its translation table, finds the mapping to <code>192.168.1.10:1024</code>, replaces the destination with the Inside Local address, and forwards the packet to the internal host.</p>
    </div>
  </div>

  <!-- NAT Table -->
  <div id="nat-table" class="tab-panel">
    <p class="section-intro" style="margin-bottom:1.5rem">The NAT translation table (maintained in router memory) is the heart of NAT. Each entry maps an inside session to an outside representation.</p>

    <table class="styled-table">
      <thead>
        <tr>
          <th>Protocol</th>
          <th>Inside Local (Src)</th>
          <th>Inside Global (Translated)</th>
          <th>Outside Global (Dest)</th>
          <th>State</th>
          <th>Timeout</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><span class="badge badge-blue">TCP</span></td>
          <td>192.168.1.10:1024</td>
          <td>203.0.113.1:49152</td>
          <td>93.184.216.34:80</td>
          <td><span class="badge badge-green">ESTABLISHED</span></td>
          <td>86400s</td>
        </tr>
        <tr>
          <td><span class="badge badge-blue">TCP</span></td>
          <td>192.168.1.11:2048</td>
          <td>203.0.113.1:49153</td>
          <td>93.184.216.34:443</td>
          <td><span class="badge badge-green">ESTABLISHED</span></td>
          <td>86400s</td>
        </tr>
        <tr>
          <td><span class="badge badge-orange">UDP</span></td>
          <td>192.168.1.12:1025</td>
          <td>203.0.113.1:49154</td>
          <td>8.8.8.8:53</td>
          <td><span class="badge badge-orange">TRANSIENT</span></td>
          <td>300s</td>
        </tr>
        <tr>
          <td><span class="badge badge-blue">TCP</span></td>
          <td>192.168.1.10:3000</td>
          <td>203.0.113.1:49155</td>
          <td>151.101.1.140:443</td>
          <td><span class="badge badge-orange">SYN_SENT</span></td>
          <td>120s</td>
        </tr>
      </tbody>
    </table>

    <div class="info-box green" style="margin-top:1.5rem">
      <strong>‚úÖ Key Point: Stateful Operation</strong>
      NAT is stateful ‚Äî the router must maintain this table for the lifetime of each session. Entries are created when an inside host initiates a connection and removed when the session ends or times out. This is why NAT does not natively support unsolicited inbound connections (a firewall benefit).
    </div>
  </div>

  <!-- PAT Deep Dive -->
  <div id="pat-detail" class="tab-panel">
    <div class="prose">
      <h4>Port Address Translation (PAT) ‚Äî Also Called NAT Overload</h4>
      <p>PAT is the most common form of NAT in home and enterprise networks. It maps multiple Inside Local addresses to a <em>single</em> Inside Global address by using unique source port numbers to distinguish sessions.</p>
      <p>TCP and UDP support 65,535 ports each. A single public IP can theoretically support over 65,000 simultaneous PAT sessions ‚Äî enough for any typical network.</p>
    </div>

    <div class="nat-diagram">
      <strong style="font-size:14px;display:block;margin-bottom:1.25rem">PAT: Many-to-One Mapping</strong>
      <table class="styled-table">
        <thead>
          <tr><th>Inside Local IP</th><th>Local Port</th><th>‚Üí</th><th>Inside Global IP</th><th>Global Port</th></tr>
        </thead>
        <tbody>
          <tr><td>192.168.1.10</td><td>1024</td><td style="text-align:center;font-size:1.2rem">‚Üí</td><td>203.0.113.1</td><td style="color:var(--primary);font-weight:700">49152</td></tr>
          <tr><td>192.168.1.11</td><td>1025</td><td style="text-align:center;font-size:1.2rem">‚Üí</td><td>203.0.113.1</td><td style="color:var(--primary);font-weight:700">49153</td></tr>
          <tr><td>192.168.1.12</td><td>1026</td><td style="text-align:center;font-size:1.2rem">‚Üí</td><td>203.0.113.1</td><td style="color:var(--primary);font-weight:700">49154</td></tr>
          <tr><td>192.168.1.13</td><td>2048</td><td style="text-align:center;font-size:1.2rem">‚Üí</td><td>203.0.113.1</td><td style="color:var(--primary);font-weight:700">49155</td></tr>
          <tr style="background:var(--primary-bg)"><td colspan="5" style="text-align:center;font-style:italic;color:var(--primary)">All use the SAME public IP ‚Äî differentiated by unique port number</td></tr>
        </tbody>
      </table>
    </div>

    <div class="highlight-box">
      <h4>‚ö†Ô∏è PAT Port Selection Algorithm</h4>
      <ul>
        <li>The router first tries to preserve the original source port if it is available and &gt; 1024</li>
        <li>If unavailable, it allocates the next available port in the ephemeral range (1024‚Äì65535)</li>
        <li>Port numbers below 1024 (well-known ports) are generally not used as PAT ports</li>
        <li>Cisco IOS allocates ports sequentially starting from 1024 within each protocol block</li>
      </ul>
    </div>
  </div>
</section>

<!-- TYPES -->
<section id="types">
  <div class="section-label">Module 3</div>
  <div class="section-title">Types of NAT</div>
  <p class="section-intro">NAT operates in three distinct modes, each suited to different network requirements and administrative goals.</p>

  <div class="tab-bar">
    <button class="tab-btn active" onclick="showTab('static-nat', this)">Static NAT</button>
    <button class="tab-btn" onclick="showTab('dynamic-nat', this)">Dynamic NAT</button>
    <button class="tab-btn" onclick="showTab('pat-nat', this)">PAT (Overload)</button>
    <button class="tab-btn" onclick="showTab('comparison', this)">Comparison</button>
  </div>

  <div id="static-nat" class="tab-panel active">
    <div class="two-col">
      <div class="prose">
        <h4>Static NAT: One-to-One Permanent Mapping</h4>
        <p>Static NAT creates a permanent, fixed mapping between one Inside Local address and one Inside Global address. The mapping exists whether or not any traffic is flowing.</p>
        <p><strong>Primary Use Case:</strong> Hosting servers that must be reachable from the internet ‚Äî web servers, mail servers, VPN concentrators, FTP servers.</p>
        <h4>Characteristics</h4>
        <ul>
          <li>Mapping is administratively configured (not automatic)</li>
          <li>Bidirectional ‚Äî inbound connections are supported</li>
          <li>Requires one public IP per internal server</li>
          <li>Entry persists until manually removed</li>
          <li>DNS records can reliably point to the static Inside Global address</li>
        </ul>
      </div>
      <div>
        <div class="nat-diagram">
          <div class="trans-table-title">Static NAT Table</div>
          <table class="styled-table">
            <thead><tr><th>Inside Local</th><th>Inside Global</th></tr></thead>
            <tbody>
              <tr><td>10.0.0.10</td><td>203.0.113.10</td></tr>
              <tr><td>10.0.0.11</td><td>203.0.113.11</td></tr>
              <tr><td>10.0.0.12</td><td>203.0.113.12</td></tr>
            </tbody>
          </table>
        </div>
        <div class="info-box orange">
          <strong>üìã Cisco IOS Command</strong>
          <code>ip nat inside source static 10.0.0.10 203.0.113.10</code>
        </div>
      </div>
    </div>
  </div>

  <div id="dynamic-nat" class="tab-panel">
    <div class="two-col">
      <div class="prose">
        <h4>Dynamic NAT: Pool-Based Assignment</h4>
        <p>Dynamic NAT maps Inside Local addresses to Inside Global addresses from a configured address pool. Mappings are created on-demand when a host initiates traffic and removed after a timeout period.</p>
        <p><strong>Primary Use Case:</strong> Environments where internal hosts need occasional internet access and the pool is large enough to accommodate simultaneous users.</p>
        <h4>Characteristics</h4>
        <ul>
          <li>Requires a pool of public IP addresses</li>
          <li>One-to-one mapping (no port multiplexing)</li>
          <li>If pool is exhausted, new connections are denied</li>
          <li>Mappings age out after configurable timeout</li>
          <li>Does not support unsolicited inbound connections</li>
        </ul>
      </div>
      <div>
        <div class="nat-diagram">
          <div class="trans-table-title">Dynamic NAT Pool + Bindings</div>
          <div style="font-size:12px;color:var(--text-muted);margin-bottom:0.75rem">Pool: 203.0.113.20 ‚Äì 203.0.113.24 (5 addresses)</div>
          <table class="styled-table">
            <thead><tr><th>Inside Local</th><th>Inside Global</th><th>Status</th></tr></thead>
            <tbody>
              <tr><td>192.168.10.1</td><td>203.0.113.20</td><td><span class="badge badge-green">IN USE</span></td></tr>
              <tr><td>192.168.10.5</td><td>203.0.113.21</td><td><span class="badge badge-green">IN USE</span></td></tr>
              <tr><td>‚Äî</td><td>203.0.113.22</td><td><span class="badge badge-orange">AVAILABLE</span></td></tr>
              <tr><td>‚Äî</td><td>203.0.113.23</td><td><span class="badge badge-orange">AVAILABLE</span></td></tr>
              <tr><td>‚Äî</td><td>203.0.113.24</td><td><span class="badge badge-orange">AVAILABLE</span></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div id="pat-nat" class="tab-panel">
    <div class="two-col">
      <div class="prose">
        <h4>PAT (NAT Overload): Many-to-One with Ports</h4>
        <p>PAT extends dynamic NAT by using port numbers to differentiate sessions, allowing hundreds or thousands of internal hosts to share a single public IP address simultaneously.</p>
        <p><strong>Primary Use Case:</strong> Home routers, small business networks, enterprise access networks ‚Äî essentially every network that connects multiple devices through one ISP-assigned IP.</p>
        <h4>Characteristics</h4>
        <ul>
          <li>Uses source port number as a differentiator</li>
          <li>Supports 65,535+ simultaneous sessions per IP</li>
          <li>Most memory- and resource-efficient NAT form</li>
          <li>Outbound only (no unsolicited inbound)</li>
          <li>Tracks: protocol + src IP + src port + dest IP + dest port</li>
        </ul>
      </div>
      <div>
        <div class="nat-diagram">
          <div class="trans-table-title">PAT Translation Table (Abridged)</div>
          <table class="styled-table">
            <thead><tr><th>Inside Local:Port</th><th>Inside Global:Port</th></tr></thead>
            <tbody>
              <tr><td>192.168.1.10:<span style="color:var(--danger)">1500</span></td><td>203.0.113.1:<span style="color:var(--primary)">49152</span></td></tr>
              <tr><td>192.168.1.11:<span style="color:var(--danger)">1500</span></td><td>203.0.113.1:<span style="color:var(--primary)">49153</span></td></tr>
              <tr><td>192.168.1.10:<span style="color:var(--danger)">2000</span></td><td>203.0.113.1:<span style="color:var(--primary)">49154</span></td></tr>
              <tr><td>192.168.1.12:<span style="color:var(--danger)">1500</span></td><td>203.0.113.1:<span style="color:var(--primary)">49155</span></td></tr>
            </tbody>
          </table>
        </div>
        <div class="info-box blue">
          <strong>üìã Cisco IOS Command (PAT using interface)</strong>
          <code>ip nat inside source list 1 interface g0/0 overload</code>
        </div>
      </div>
    </div>
  </div>

  <div id="comparison" class="tab-panel">
    <table class="styled-table">
      <thead>
        <tr>
          <th>Feature</th>
          <th>Static NAT</th>
          <th>Dynamic NAT</th>
          <th>PAT (Overload)</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>Mapping Type</td><td>1:1 Fixed</td><td>1:1 From Pool</td><td>Many:1 With Ports</td></tr>
        <tr><td>Public IPs Required</td><td>1 per host</td><td>1 per concurrent host</td><td>1 total (minimum)</td></tr>
        <tr><td>Inbound Connections</td><td>‚úÖ Supported</td><td>‚ùå Not supported</td><td>‚ùå Not supported</td></tr>
        <tr><td>Port Translation</td><td>No</td><td>No</td><td>Yes</td></tr>
        <tr><td>Mapping Persistence</td><td>Permanent</td><td>Dynamic (timeout)</td><td>Dynamic (session)</td></tr>
        <tr><td>Best For</td><td>Servers</td><td>Medium-size orgs</td><td>Home/SMB/Enterprise</td></tr>
        <tr><td>Cisco IOS Keyword</td><td><code>static</code></td><td><code>pool</code></td><td><code>overload</code></td></tr>
        <tr><td>RFC Reference</td><td>RFC 3022</td><td>RFC 3022</td><td>RFC 3022 / RFC 4787</td></tr>
      </tbody>
    </table>
  </div>
</section>

<!-- SIMULATOR -->
<section id="simulator">
  <div class="section-label">Module 4</div>
  <div class="section-title">Live NAT/PAT Simulator</div>
  <p class="section-intro">Watch a live simulation of NAT/PAT in action. The simulator shows packet translation events, builds the translation table in real time, and illustrates the difference between outbound and inbound translation.</p>

  <div class="scenario-wrap">
    <div class="scenario-header">
      <span class="scenario-title">‚ö° PAT Simulation ‚Äî 3 Internal Hosts, 1 Public IP</span>
      <div class="scenario-controls">
        <button class="scn-btn reset" onclick="resetSim()">‚Ü∫ Reset</button>
        <button class="scn-btn play" id="simPlayBtn" onclick="runSim()">‚ñ∂ Start Simulation</button>
      </div>
    </div>

    <div class="scenario-log" id="simLog">
      <div class="log-entry info">‚Üí Press "Start Simulation" to begin...</div>
      <div class="log-entry info">‚Üí Network: 192.168.1.0/24  |  NAT Router: 203.0.113.1  |  Mode: PAT</div>
    </div>

    <div class="scenario-nat-table" id="simTable">
      <div class="nat-table-row header">
        <div>INSIDE LOCAL</div>
        <div>INSIDE GLOBAL</div>
        <div>DESTINATION</div>
        <div>STATE</div>
      </div>
      <div id="simTableBody"></div>
    </div>
  </div>
</section>

<!-- HEADER BUILDER -->
<section id="builder">
  <div class="section-label">Module 5</div>
  <div class="section-title">NAT/PAT Header Builder</div>
  <p class="section-intro">Construct a realistic NAT/PAT translation record by filling in the fields below. The builder generates both the <em>original</em> (pre-translation) and <em>translated</em> (post-translation) packet headers, highlighting what changes during NAT processing.</p>

  <div class="builder-wrap">
    <div class="builder-grid">
      <div class="builder-form">
        <div style="font-family:var(--mono);font-size:11px;text-transform:uppercase;letter-spacing:0.1em;color:var(--primary);margin-bottom:1.25rem">üìã Original (Inside) Packet</div>

        <label>Source IP (Inside Local)</label>
        <input type="text" id="b-src-ip" value="192.168.1.50" placeholder="e.g. 192.168.1.50" />

        <label>Source Port</label>
        <input type="number" id="b-src-port" value="3200" min="1024" max="65535" />

        <label>Destination IP (Outside Global)</label>
        <input type="text" id="b-dst-ip" value="142.250.80.46" placeholder="e.g. 8.8.8.8" />

        <label>Destination Port</label>
        <input type="number" id="b-dst-port" value="443" min="1" max="65535" />

        <label>Protocol</label>
        <select id="b-proto">
          <option value="TCP">TCP (6)</option>
          <option value="UDP">UDP (17)</option>
          <option value="ICMP">ICMP (1)</option>
        </select>

        <label>TTL</label>
        <input type="number" id="b-ttl" value="64" min="1" max="255" />

        <div style="font-family:var(--mono);font-size:11px;text-transform:uppercase;letter-spacing:0.1em;color:var(--primary);margin:1.75rem 0 1.25rem">üîÑ NAT Configuration</div>

        <label>NAT Type</label>
        <select id="b-nat-type">
          <option value="pat">PAT (Overload)</option>
          <option value="static">Static NAT</option>
          <option value="dynamic">Dynamic NAT</option>
        </select>

        <label>Inside Global IP (Public)</label>
        <input type="text" id="b-global-ip" value="203.0.113.1" placeholder="e.g. 203.0.113.1" />

        <label>Assigned Global Port (PAT)</label>
        <input type="number" id="b-global-port" value="49152" min="1024" max="65535" />

        <label>New TTL (decremented by router)</label>
        <input type="number" id="b-new-ttl" value="63" min="1" max="255" />

        <button class="build-btn" onclick="buildHeader()">‚öôÔ∏è Generate NAT Headers</button>
      </div>

      <div>
        <div style="font-family:var(--mono);font-size:11px;text-transform:uppercase;letter-spacing:0.1em;color:#94a3b8;margin-bottom:1rem">üì¶ Generated Header Output</div>
        <div class="header-output" id="headerOutput">
          <div class="output-placeholder">Fill in the fields and click<br>"Generate NAT Headers"<br>to see the output</div>
        </div>
        <div style="margin-top:1rem;font-size:11px;color:var(--text-muted);font-family:var(--mono)">
          <span style="background:#fee2e2;color:var(--danger);padding:2px 6px;border-radius:3px;margin-right:6px">ORIGINAL</span>
          <span style="background:#dbeafe;color:var(--primary);padding:2px 6px;border-radius:3px;margin-right:6px">TRANSLATED</span>
          <span style="background:#fef3c7;color:var(--warning);padding:2px 6px;border-radius:3px">CHANGED FIELD</span>
        </div>
      </div>
    </div>
  </div>

  <!-- IP Header Diagram -->
  <div style="margin-top:2.5rem">
    <h4 style="font-size:1rem;font-weight:700;margin-bottom:1rem">IPv4 Header ‚Äî Fields Affected by NAT</h4>
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:1.5rem;overflow-x:auto">
      <table style="width:100%;border-collapse:collapse;font-family:var(--mono);font-size:11px;text-align:center;min-width:600px">
        <tr>
          <td colspan="4" style="background:#dbeafe;border:1px solid #93c5fd;padding:6px 4px;color:var(--primary)">Version (4)</td>
          <td colspan="4" style="background:#f1f5f9;border:1px solid var(--border);padding:6px 4px;">IHL</td>
          <td colspan="8" style="background:#f1f5f9;border:1px solid var(--border);padding:6px 4px;">DSCP/ECN</td>
          <td colspan="16" style="background:#f1f5f9;border:1px solid var(--border);padding:6px 4px;">Total Length</td>
        </tr>
        <tr>
          <td colspan="16" style="background:#f1f5f9;border:1px solid var(--border);padding:6px 4px;">Identification</td>
          <td colspan="3" style="background:#f1f5f9;border:1px solid var(--border);padding:6px 4px;">Flags</td>
          <td colspan="13" style="background:#f1f5f9;border:1px solid var(--border);padding:6px 4px;">Fragment Offset</td>
        </tr>
        <tr>
          <td colspan="8" style="background:#fee2e2;border:1px solid #fca5a5;padding:6px 4px;color:var(--danger)">TTL ‚ö°</td>
          <td colspan="8" style="background:#f1f5f9;border:1px solid var(--border);padding:6px 4px;">Protocol</td>
          <td colspan="16" style="background:#fef3c7;border:1px solid #fcd34d;padding:6px 4px;color:var(--warning)">Header Checksum üîÑ</td>
        </tr>
        <tr>
          <td colspan="32" style="background:#fef3c7;border:1px solid #fcd34d;padding:6px 4px;color:var(--warning);font-weight:700">Source IP Address ‚Äî CHANGED by NAT üîÑ</td>
        </tr>
        <tr>
          <td colspan="32" style="background:#dbeafe;border:1px solid #93c5fd;padding:6px 4px;color:var(--primary)">Destination IP Address (unchanged for outbound)</td>
        </tr>
        <tr>
          <td colspan="16" style="background:#fef3c7;border:1px solid #fcd34d;padding:6px 4px;color:var(--warning);font-weight:700">Source Port ‚Äî CHANGED by PAT üîÑ</td>
          <td colspan="16" style="background:#dbeafe;border:1px solid #93c5fd;padding:6px 4px;color:var(--primary)">Destination Port (unchanged)</td>
        </tr>
      </table>
      <div style="margin-top:0.75rem;font-size:11px;color:var(--text-muted);font-family:var(--mono)">
        <span style="background:#fef3c7;color:var(--warning);padding:2px 6px;border-radius:3px;margin-right:8px">üîÑ MODIFIED</span>
        <span style="background:#fee2e2;color:var(--danger);padding:2px 6px;border-radius:3px;margin-right:8px">‚ö° DECREMENTED</span>
        <span style="background:#dbeafe;color:var(--primary);padding:2px 6px;border-radius:3px">UNCHANGED</span>
      </div>
    </div>
  </div>
</section>

<!-- CONFIGURATION -->
<section id="config">
  <div class="section-label">Module 6</div>
  <div class="section-title">Cisco IOS Configuration</div>
  <p class="section-intro">Network administrators must be proficient in configuring NAT on Cisco routers. The following examples cover the three primary NAT configurations used in production environments.</p>

  <div class="tab-bar">
    <button class="tab-btn active" onclick="showTab('cfg-static', this)">Static NAT</button>
    <button class="tab-btn" onclick="showTab('cfg-dynamic', this)">Dynamic NAT</button>
    <button class="tab-btn" onclick="showTab('cfg-pat', this)">PAT Config</button>
    <button class="tab-btn" onclick="showTab('cfg-verify', this)">Verification</button>
    <button class="tab-btn" onclick="showTab('cfg-trouble', this)">Troubleshooting</button>
  </div>

  <div id="cfg-static" class="tab-panel active">
    <div class="two-col">
      <div>
        <div style="background:#0f172a;border-radius:12px;padding:1.5rem;font-family:var(--mono);font-size:12px;line-height:1.8;overflow-x:auto">
          <div style="color:#64748b;margin-bottom:0.75rem">! ‚îÄ‚îÄ STATIC NAT CONFIGURATION ‚îÄ‚îÄ</div>
          <div><span style="color:#60a5fa">interface</span> <span style="color:#34d399">GigabitEthernet0/0</span></div>
          <div style="padding-left:1.5rem"><span style="color:#fbbf24">ip address</span> <span style="color:#e2e8f0">10.0.0.1 255.255.255.0</span></div>
          <div style="padding-left:1.5rem"><span style="color:#f87171">ip nat inside</span></div>
          <div><span style="color:#60a5fa">interface</span> <span style="color:#34d399">GigabitEthernet0/1</span></div>
          <div style="padding-left:1.5rem"><span style="color:#fbbf24">ip address</span> <span style="color:#e2e8f0">203.0.113.1 255.255.255.0</span></div>
          <div style="padding-left:1.5rem"><span style="color:#a78bfa">ip nat outside</span></div>
          <div>&nbsp;</div>
          <div><span style="color:#64748b">! Map inside host to public IP</span></div>
          <div><span style="color:#60a5fa">ip nat inside source static</span> <span style="color:#f87171">10.0.0.10</span> <span style="color:#a78bfa">203.0.113.10</span></div>
          <div><span style="color:#60a5fa">ip nat inside source static</span> <span style="color:#f87171">10.0.0.11</span> <span style="color:#a78bfa">203.0.113.11</span></div>
        </div>
      </div>
      <div class="prose">
        <h4>Configuration Steps</h4>
        <ul>
          <li>Identify the inside interface (LAN-facing) with <code>ip nat inside</code></li>
          <li>Identify the outside interface (WAN-facing) with <code>ip nat outside</code></li>
          <li>Create static entries mapping Inside Local to Inside Global addresses</li>
          <li>For port-forwarding (Static PAT): add <code>tcp</code> or <code>udp</code> and port numbers</li>
        </ul>
        <div class="info-box blue" style="margin-top:1rem">
          <strong>Port Forwarding (Static PAT Example)</strong>
          <code>ip nat inside source static tcp 10.0.0.10 80 203.0.113.10 80</code>
        </div>
      </div>
    </div>
  </div>

  <div id="cfg-dynamic" class="tab-panel">
    <div style="background:#0f172a;border-radius:12px;padding:1.5rem;font-family:var(--mono);font-size:12px;line-height:1.8;overflow-x:auto">
      <div style="color:#64748b">! ‚îÄ‚îÄ DYNAMIC NAT CONFIGURATION ‚îÄ‚îÄ</div>
      <div>&nbsp;</div>
      <div><span style="color:#64748b">! Step 1: Define the pool of public addresses</span></div>
      <div><span style="color:#60a5fa">ip nat pool</span> <span style="color:#34d399">PUBLIC_POOL</span> <span style="color:#fbbf24">203.0.113.20</span> <span style="color:#fbbf24">203.0.113.24</span> <span style="color:#e2e8f0">netmask 255.255.255.0</span></div>
      <div>&nbsp;</div>
      <div><span style="color:#64748b">! Step 2: Define which inside hosts are permitted</span></div>
      <div><span style="color:#60a5fa">access-list</span> <span style="color:#f87171">10</span> <span style="color:#e2e8f0">permit 192.168.10.0 0.0.0.255</span></div>
      <div>&nbsp;</div>
      <div><span style="color:#64748b">! Step 3: Link ACL to NAT pool</span></div>
      <div><span style="color:#60a5fa">ip nat inside source list</span> <span style="color:#f87171">10</span> <span style="color:#e2e8f0">pool</span> <span style="color:#34d399">PUBLIC_POOL</span></div>
      <div>&nbsp;</div>
      <div><span style="color:#64748b">! Step 4: Mark interfaces</span></div>
      <div><span style="color:#60a5fa">interface</span> <span style="color:#34d399">GigabitEthernet0/0</span></div>
      <div style="padding-left:1.5rem"><span style="color:#f87171">ip nat inside</span></div>
      <div><span style="color:#60a5fa">interface</span> <span style="color:#34d399">GigabitEthernet0/1</span></div>
      <div style="padding-left:1.5rem"><span style="color:#a78bfa">ip nat outside</span></div>
    </div>
  </div>

  <div id="cfg-pat" class="tab-panel">
    <div style="background:#0f172a;border-radius:12px;padding:1.5rem;font-family:var(--mono);font-size:12px;line-height:1.8;overflow-x:auto">
      <div style="color:#64748b">! ‚îÄ‚îÄ PAT (NAT OVERLOAD) ‚Äî Using Interface Address ‚îÄ‚îÄ</div>
      <div>&nbsp;</div>
      <div><span style="color:#60a5fa">access-list</span> <span style="color:#f87171">1</span> <span style="color:#e2e8f0">permit 192.168.1.0 0.0.0.255</span></div>
      <div>&nbsp;</div>
      <div><span style="color:#60a5fa">ip nat inside source list</span> <span style="color:#f87171">1</span> <span style="color:#e2e8f0">interface</span> <span style="color:#34d399">GigabitEthernet0/1</span> <span style="color:#fbbf24">overload</span></div>
      <div>&nbsp;</div>
      <div><span style="color:#60a5fa">interface</span> <span style="color:#34d399">GigabitEthernet0/0</span></div>
      <div style="padding-left:1.5rem"><span style="color:#f87171">ip nat inside</span></div>
      <div><span style="color:#60a5fa">interface</span> <span style="color:#34d399">GigabitEthernet0/1</span></div>
      <div style="padding-left:1.5rem"><span style="color:#a78bfa">ip nat outside</span></div>
      <div>&nbsp;</div>
      <div style="color:#64748b">! ‚îÄ‚îÄ PAT ‚Äî Using Address Pool (Multiple IPs) ‚îÄ‚îÄ</div>
      <div>&nbsp;</div>
      <div><span style="color:#60a5fa">ip nat pool</span> <span style="color:#34d399">PAT_POOL</span> <span style="color:#fbbf24">203.0.113.1</span> <span style="color:#fbbf24">203.0.113.5</span> <span style="color:#e2e8f0">netmask 255.255.255.0</span></div>
      <div><span style="color:#60a5fa">ip nat inside source list</span> <span style="color:#f87171">1</span> <span style="color:#e2e8f0">pool</span> <span style="color:#34d399">PAT_POOL</span> <span style="color:#fbbf24">overload</span></div>
    </div>
    <div class="info-box green" style="margin-top:1rem">
      <strong>‚úÖ Key: The "overload" keyword</strong>
      Adding <code>overload</code> to the NAT source command enables PAT. Without it, dynamic NAT is configured (one-to-one from pool).
    </div>
  </div>

  <div id="cfg-verify" class="tab-panel">
    <div style="background:#0f172a;border-radius:12px;padding:1.5rem;font-family:var(--mono);font-size:12px;line-height:1.8;overflow-x:auto">
      <div style="color:#64748b">! ‚îÄ‚îÄ VERIFICATION COMMANDS ‚îÄ‚îÄ</div>
      <div>&nbsp;</div>
      <div><span style="color:#fbbf24">show ip nat translations</span></div>
      <div style="color:#94a3b8;padding-left:1.5rem">! Displays the NAT translation table (all active entries)</div>
      <div>&nbsp;</div>
      <div><span style="color:#fbbf24">show ip nat translations verbose</span></div>
      <div style="color:#94a3b8;padding-left:1.5rem">! Shows timers, create time, use count per entry</div>
      <div>&nbsp;</div>
      <div><span style="color:#fbbf24">show ip nat statistics</span></div>
      <div style="color:#94a3b8;padding-left:1.5rem">! Translations: total, active, missed; hit counts</div>
      <div>&nbsp;</div>
      <div><span style="color:#fbbf24">debug ip nat</span></div>
      <div style="color:#94a3b8;padding-left:1.5rem">! Real-time translation events (caution: CPU intensive)</div>
      <div>&nbsp;</div>
      <div><span style="color:#fbbf24">debug ip nat detailed</span></div>
      <div style="color:#94a3b8;padding-left:1.5rem">! Includes packets that fail to translate</div>
      <div>&nbsp;</div>
      <div><span style="color:#fbbf24">clear ip nat translation *</span></div>
      <div style="color:#94a3b8;padding-left:1.5rem">! Clears all dynamic NAT entries (‚ö†Ô∏è drops active sessions)</div>
      <div>&nbsp;</div>
      <div><span style="color:#fbbf24">clear ip nat translation inside</span> <span style="color:#f87171">192.168.1.10</span> <span style="color:#34d399">203.0.113.1</span></div>
      <div style="color:#94a3b8;padding-left:1.5rem">! Clears specific translation entry</div>
    </div>
  </div>

  <div id="cfg-trouble" class="tab-panel">
    <div class="card-grid">
      <div class="card">
        <div class="card-icon red">‚ö†Ô∏è</div>
        <h3>NAT Not Translating</h3>
        <p>Verify inside/outside interface designations. Check the ACL permits the source subnet. Confirm the route to the destination exists out the outside interface.</p>
      </div>
      <div class="card">
        <div class="card-icon orange">üîç</div>
        <h3>Pool Exhaustion</h3>
        <p>Dynamic NAT fails when the pool is full. Use <code>show ip nat statistics</code> to check "miss" count. Switch to PAT (overload) to fix the problem without adding IPs.</p>
      </div>
      <div class="card">
        <div class="card-icon blue">üîÑ</div>
        <h3>Stale Entries</h3>
        <p>Old NAT entries can block new connections using the same port. Use <code>clear ip nat translation *</code> to flush the table. Tune timeout values with <code>ip nat translation timeout</code>.</p>
      </div>
      <div class="card">
        <div class="card-icon green">üì°</div>
        <h3>ALG Issues</h3>
        <p>Protocols like FTP, SIP, and H.323 embed IP addresses in the payload. NAT Application Layer Gateways (ALGs) must be enabled to handle these protocols correctly.</p>
      </div>
    </div>
    <div class="info-box blue" style="margin-top:1.5rem">
      <strong>üîß Systematic Troubleshooting Approach</strong>
      1) Verify interface NAT directionality (<code>show ip interface brief</code>) ‚Üí 2) Check ACL matches (<code>show access-lists</code>) ‚Üí 3) Inspect translation table (<code>show ip nat translations</code>) ‚Üí 4) Use debug (<code>debug ip nat</code>) ‚Üí 5) Check routing (<code>show ip route</code>)
    </div>
  </div>
</section>

<!-- GLOSSARY -->
<section id="glossary">
  <div class="section-label">Reference</div>
  <div class="section-title">Key Terms &amp; Glossary</div>
  <p class="section-intro">A comprehensive reference of NAT/PAT terminology for certification exam preparation and professional reference.</p>

  <div class="glossary-grid">
    <div class="glossary-item"><div class="glossary-term">NAT (Network Address Translation)</div><div class="glossary-def">The process of modifying IP address information in packet headers while in transit, allowing private addresses to communicate on the public internet.</div></div>
    <div class="glossary-item"><div class="glossary-term">PAT (Port Address Translation)</div><div class="glossary-def">An extension of NAT that uses port numbers to allow multiple inside hosts to share a single public IP address. Also called NAT Overload.</div></div>
    <div class="glossary-item"><div class="glossary-term">Inside Local Address</div><div class="glossary-def">The actual private IP address of an internal host as configured on its NIC. Typically an RFC 1918 address.</div></div>
    <div class="glossary-item"><div class="glossary-term">Inside Global Address</div><div class="glossary-def">The public IP address that the NAT router assigns to represent an internal host to the outside world.</div></div>
    <div class="glossary-item"><div class="glossary-term">Outside Local Address</div><div class="glossary-def">The IP address of an external host as seen from inside the network. Usually the same as the Outside Global address unless NAT is also applied to the destination.</div></div>
    <div class="glossary-item"><div class="glossary-term">Outside Global Address</div><div class="glossary-def">The actual public IP address of an external host as it exists on the internet.</div></div>
    <div class="glossary-item"><div class="glossary-term">NAT Table / Translation Table</div><div class="glossary-def">A stateful lookup table maintained by the router containing all current NAT/PAT bindings, including protocol, ports, and IP address mappings.</div></div>
    <div class="glossary-item"><div class="glossary-term">RFC 1918</div><div class="glossary-def">IETF standard defining three blocks of non-routable private address space: 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16.</div></div>
    <div class="glossary-item"><div class="glossary-term">Static NAT</div><div class="glossary-def">A permanently configured one-to-one mapping between an inside local and inside global address. Supports inbound connections.</div></div>
    <div class="glossary-item"><div class="glossary-term">Dynamic NAT</div><div class="glossary-def">Automatically assigns Inside Global addresses from a pool to Inside Local addresses on demand. Entries expire after timeout.</div></div>
    <div class="glossary-item"><div class="glossary-term">NAT Overload</div><div class="glossary-def">Cisco term for PAT ‚Äî enabling multiple hosts to share a single public IP by tracking unique source port numbers. Enabled with the <code>overload</code> keyword.</div></div>
    <div class="glossary-item"><div class="glossary-term">Ephemeral Port</div><div class="glossary-def">A temporary port number (typically 1024‚Äì65535) assigned by the OS or NAT router for a session. Released when the connection ends.</div></div>
    <div class="glossary-item"><div class="glossary-term">ALG (Application Layer Gateway)</div><div class="glossary-def">A NAT component that inspects and modifies application-layer protocols (FTP, SIP, H.323) that embed IP addresses in their payloads.</div></div>
    <div class="glossary-item"><div class="glossary-term">NAT Traversal</div><div class="glossary-def">Techniques allowing protocols like IPSec and VoIP to function through NAT devices, which would otherwise block or corrupt their headers.</div></div>
    <div class="glossary-item"><div class="glossary-term">ip nat inside</div><div class="glossary-def">Cisco IOS interface command designating the LAN-facing (private) side of NAT operation.</div></div>
    <div class="glossary-item"><div class="glossary-term">ip nat outside</div><div class="glossary-def">Cisco IOS interface command designating the WAN-facing (public) side of NAT operation.</div></div>
  </div>
</section>

<!-- QUIZ -->
<section id="quiz">
  <div class="section-label">Assessment</div>
  <div class="section-title">Knowledge Check</div>
  <p class="section-intro">Test your understanding of NAT and PAT concepts. Select the best answer for each question.</p>

  <div id="quiz-container"></div>

  <div class="quiz-score-bar" id="scoreBar" style="display:none">
    <div class="score-circle">
      <div class="score-num" id="scoreNum">0</div>
      <div class="score-of" id="scoreOf">/ 8</div>
    </div>
    <div>
      <div class="score-label"><strong id="scoreMsg">Quiz Complete!</strong>Review the sections above for any missed concepts.</div>
    </div>
    <button onclick="resetQuiz()" style="margin-left:auto;padding:0.5rem 1.25rem;background:var(--primary);color:white;border:none;border-radius:8px;font-family:var(--sans);font-size:13px;font-weight:600;cursor:pointer">‚Ü∫ Retake Quiz</button>
  </div>
</section>

</div><!-- /container -->

<footer style="background:var(--surface);border-top:1px solid var(--border);padding:2rem;text-align:center;margin-top:3rem">
  <div style="font-family:var(--mono);font-size:11px;color:var(--text-muted)">
    NAT/PAT Interactive Lesson ¬∑ Network Administration ¬∑ IT Department<br>
    Based on RFC 3022, RFC 4787 | Cisco IOS Reference | CompTIA Network+ ¬∑ CCNA Objectives
  </div>
</footer>

<script>
// ‚îÄ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function scrollToSection(id) {
  document.getElementById(id).scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// Update active nav on scroll
const sections = ['overview','concepts','types','simulator','builder','config','glossary','quiz'];
window.addEventListener('scroll', () => {
  const pos = window.scrollY + 100;
  sections.forEach((id, i) => {
    const el = document.getElementById(id);
    if (!el) return;
    const top = el.offsetTop;
    const bot = i + 1 < sections.length ? document.getElementById(sections[i+1]).offsetTop : Infinity;
    const links = document.querySelectorAll('.nav-link');
    if (pos >= top && pos < bot) links[i] && links[i].classList.add('active');
    else links[i] && links[i].classList.remove('active');
  });
});

// ‚îÄ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showTab(id, btn) {
  const parent = btn.closest('section') || document.body;
  parent.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  parent.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  const panel = document.getElementById(id);
  if (panel) panel.classList.add('active');
  btn.classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ PACKET FLOW ANIMATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function animateFlow() {
  const pktOut = document.getElementById('pkt-out');
  const pktIn = document.getElementById('pkt-in');
  const steps = document.getElementById('flow-steps');

  pktOut.style.display = 'none';
  pktIn.style.display = 'none';
  steps.textContent = '';

  const messages = [
    '‚ë† Inside host 192.168.1.10:1024 sends packet to 8.8.8.8:53...',
    '‚ë° NAT router receives packet on inside interface...',
    '‚ë¢ Router checks NAT table ‚Äî no existing entry for this flow...',
    '‚ë£ Router translates SRC: 192.168.1.10:1024 ‚Üí 203.0.113.1:49152...',
    '‚ë§ Router creates new NAT table entry and forwards packet...',
    '‚ë• Outside server sees packet from 203.0.113.1:49152 only ‚úì'
  ];

  pktOut.style.display = 'flex';
  pktOut.style.left = '5%';
  pktOut.style.transition = 'left 1.5s linear';

  setTimeout(() => { pktOut.style.left = '45%'; }, 50);

  messages.forEach((msg, i) => {
    setTimeout(() => { steps.textContent = msg; }, i * 700);
  });

  setTimeout(() => {
    pktIn.style.display = 'flex';
    pktIn.style.right = '5%';
    pktIn.style.transition = 'right 0s';
    setTimeout(() => {
      pktIn.style.transition = 'right 1.5s linear';
      pktIn.style.right = '45%';
    }, 50);
  }, 2500);
}

// ‚îÄ‚îÄ‚îÄ SIMULATOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const simEvents = [
  { delay: 300, type: 'step', text: '‚ïê‚ïê‚ïê SIMULATION START ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê' },
  { delay: 600, type: 'info', text: 'Network: 192.168.1.0/24 | NAT Router: 203.0.113.1 | Mode: PAT (Overload)' },
  { delay: 1000, type: 'step', text: '‚îÄ‚îÄ Packet 1: Host A initiates HTTP session ‚îÄ‚îÄ' },
  { delay: 1400, type: 'tx', text: '‚Üí TX: 192.168.1.10:3200  ‚Üí  93.184.216.34:80  [TCP SYN]' },
  { delay: 1800, type: 'nat', text: '‚ö° NAT: 192.168.1.10:3200  ‚Üî  203.0.113.1:49152  [NEW ENTRY]' },
  { delay: 2200, type: 'table', text: 'üìã Table Entry #1 created: IN 192.168.1.10:3200 | OUT 203.0.113.1:49152' },
  { delay: 2800, type: 'step', text: '‚îÄ‚îÄ Packet 2: Host B initiates HTTPS session ‚îÄ‚îÄ' },
  { delay: 3200, type: 'tx', text: '‚Üí TX: 192.168.1.11:4100  ‚Üí  151.101.1.140:443  [TCP SYN]' },
  { delay: 3600, type: 'nat', text: '‚ö° NAT: 192.168.1.11:4100  ‚Üî  203.0.113.1:49153  [NEW ENTRY]' },
  { delay: 4000, type: 'table', text: 'üìã Table Entry #2 created: IN 192.168.1.11:4100 | OUT 203.0.113.1:49153' },
  { delay: 4600, type: 'step', text: '‚îÄ‚îÄ Packet 3: Host A makes DNS query ‚îÄ‚îÄ' },
  { delay: 5000, type: 'tx', text: '‚Üí TX: 192.168.1.10:5500  ‚Üí  8.8.8.8:53  [UDP]' },
  { delay: 5400, type: 'nat', text: '‚ö° NAT: 192.168.1.10:5500  ‚Üî  203.0.113.1:49154  [NEW ENTRY]' },
  { delay: 5800, type: 'table', text: 'üìã Table Entry #3 created: IN 192.168.1.10:5500 | OUT 203.0.113.1:49154' },
  { delay: 6400, type: 'step', text: '‚îÄ‚îÄ Reply Arrives for Host A HTTP ‚îÄ‚îÄ' },
  { delay: 6800, type: 'rx', text: '‚Üê RX: 93.184.216.34:80  ‚Üí  203.0.113.1:49152  [TCP ACK]' },
  { delay: 7200, type: 'nat', text: '‚ö° NAT LOOKUP: 203.0.113.1:49152 ‚Üí 192.168.1.10:3200 [TABLE HIT]' },
  { delay: 7600, type: 'rx', text: '‚Üê FORWARD: 93.184.216.34:80  ‚Üí  192.168.1.10:3200  ‚úì' },
  { delay: 8200, type: 'step', text: '‚îÄ‚îÄ Packet 4: Host C initiates new connection ‚îÄ‚îÄ' },
  { delay: 8600, type: 'tx', text: '‚Üí TX: 192.168.1.12:6000  ‚Üí  172.217.10.46:80  [TCP SYN]' },
  { delay: 9000, type: 'nat', text: '‚ö° NAT: 192.168.1.12:6000  ‚Üî  203.0.113.1:49155  [NEW ENTRY]' },
  { delay: 9400, type: 'table', text: 'üìã Table Entry #4 created: IN 192.168.1.12:6000 | OUT 203.0.113.1:49155' },
  { delay: 10200, type: 'step', text: '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê' },
  { delay: 10500, type: 'info', text: '‚úì SIMULATION COMPLETE ‚Äî 4 PAT entries active ‚Äî All using 203.0.113.1' },
];

const simTableData = [
  { ins: '192.168.1.10:3200', out: '203.0.113.1:49152', dst: '93.184.216.34:80', state: 'ESTABLISHED' },
  { ins: '192.168.1.11:4100', out: '203.0.113.1:49153', dst: '151.101.1.140:443', state: 'ESTABLISHED' },
  { ins: '192.168.1.10:5500', out: '203.0.113.1:49154', dst: '8.8.8.8:53', state: 'UDP' },
  { ins: '192.168.1.12:6000', out: '203.0.113.1:49155', dst: '172.217.10.46:80', state: 'SYN_SENT' },
];

let simTimeouts = [];
let simRunning = false;

function runSim() {
  if (simRunning) return;
  simRunning = true;
  document.getElementById('simPlayBtn').disabled = true;
  document.getElementById('simPlayBtn').textContent = '‚è≥ Running...';
  const log = document.getElementById('simLog');
  const tableBody = document.getElementById('simTableBody');
  log.innerHTML = '';
  tableBody.innerHTML = '';
  let tableIdx = 0;

  simEvents.forEach(ev => {
    const t = setTimeout(() => {
      const div = document.createElement('div');
      div.className = `log-entry ${ev.type}`;
      div.textContent = ev.text;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;

      if (ev.type === 'table' && tableIdx < simTableData.length) {
        const row = document.createElement('div');
        row.className = 'nat-table-row data';
        const d = simTableData[tableIdx++];
        row.innerHTML = `<div class="nat-col-inside">${d.ins}</div><div class="nat-col-outside">${d.out}</div><div>${d.dst}</div><div class="nat-col-state">${d.state}</div>`;
        tableBody.appendChild(row);
      }

      if (ev.text.includes('SIMULATION COMPLETE')) {
        document.getElementById('simPlayBtn').textContent = '‚úì Done';
        simRunning = false;
      }
    }, ev.delay);
    simTimeouts.push(t);
  });
}

function resetSim() {
  simTimeouts.forEach(clearTimeout);
  simTimeouts = [];
  simRunning = false;
  document.getElementById('simPlayBtn').disabled = false;
  document.getElementById('simPlayBtn').textContent = '‚ñ∂ Start Simulation';
  document.getElementById('simLog').innerHTML = '<div class="log-entry info">‚Üí Press "Start Simulation" to begin...</div><div class="log-entry info">‚Üí Network: 192.168.1.0/24  |  NAT Router: 203.0.113.1  |  Mode: PAT</div>';
  document.getElementById('simTableBody').innerHTML = '';
}

// ‚îÄ‚îÄ‚îÄ HEADER BUILDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildHeader() {
  const srcIp = document.getElementById('b-src-ip').value || '192.168.1.50';
  const srcPort = document.getElementById('b-src-port').value || '3200';
  const dstIp = document.getElementById('b-dst-ip').value || '8.8.8.8';
  const dstPort = document.getElementById('b-dst-port').value || '443';
  const proto = document.getElementById('b-proto').value;
  const ttl = document.getElementById('b-ttl').value || '64';
  const natType = document.getElementById('b-nat-type').value;
  const globalIp = document.getElementById('b-global-ip').value || '203.0.113.1';
  const globalPort = document.getElementById('b-global-port').value || '49152';
  const newTtl = document.getElementById('b-new-ttl').value || '63';

  const protoNum = { TCP: '6', UDP: '17', ICMP: '1' }[proto];
  const isPAT = natType === 'pat';

  const checksum1 = '0x' + Math.floor(Math.random() * 0xFFFF).toString(16).toUpperCase().padStart(4, '0');
  const checksum2 = '0x' + Math.floor(Math.random() * 0xFFFF).toString(16).toUpperCase().padStart(4, '0');

  const out = document.getElementById('headerOutput');
  out.innerHTML = `
<div class="header-section">
  <div class="header-section-title">‚îÄ‚îÄ ORIGINAL PACKET (Pre-NAT / Inside Local) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</div>
  <div style="background:#1e293b;border-radius:6px;padding:0.75rem;margin:0.5rem 0">
    <div class="header-section-title" style="color:#f87171">‚ñå IPv4 Header</div>
    <div class="header-field"><span class="hf-name">Version:</span><span class="hf-val">4</span><span class="hf-bits">4 bits</span></div>
    <div class="header-field"><span class="hf-name">IHL:</span><span class="hf-val">5 (20 bytes)</span><span class="hf-bits">4 bits</span></div>
    <div class="header-field"><span class="hf-name">DSCP/ECN:</span><span class="hf-val">0x00</span><span class="hf-bits">8 bits</span></div>
    <div class="header-field"><span class="hf-name">Total Length:</span><span class="hf-val">68 bytes</span><span class="hf-bits">16 bits</span></div>
    <div class="header-field"><span class="hf-name">Identification:</span><span class="hf-val">0x4A2F</span><span class="hf-bits">16 bits</span></div>
    <div class="header-field"><span class="hf-name">Flags:</span><span class="hf-val">DF=1, MF=0</span><span class="hf-bits">3 bits</span></div>
    <div class="header-field"><span class="hf-name">Fragment Offset:</span><span class="hf-val">0</span><span class="hf-bits">13 bits</span></div>
    <div class="header-field"><span class="hf-name">TTL:</span><span class="hf-val" style="color:#fbbf24">${ttl}</span><span class="hf-bits">8 bits</span></div>
    <div class="header-field"><span class="hf-name">Protocol:</span><span class="hf-val">${proto} (${protoNum})</span><span class="hf-bits">8 bits</span></div>
    <div class="header-field"><span class="hf-name">Header Checksum:</span><span class="hf-val" style="color:#fbbf24">${checksum1}</span><span class="hf-bits">16 bits</span></div>
    <div class="header-field"><span class="hf-name">Source IP:</span><span class="hf-val" style="background:#7f1d1d;padding:1px 6px;border-radius:3px;color:#fca5a5">${srcIp} ‚Üê INSIDE LOCAL</span><span class="hf-bits">32 bits</span></div>
    <div class="header-field"><span class="hf-name">Destination IP:</span><span class="hf-val">${dstIp}</span><span class="hf-bits">32 bits</span></div>
  </div>
  ${proto !== 'ICMP' ? `<div style="background:#1e293b;border-radius:6px;padding:0.75rem;margin:0.5rem 0">
    <div class="header-section-title" style="color:#f87171">‚ñå ${proto} Header</div>
    <div class="header-field"><span class="hf-name">Source Port:</span><span class="hf-val" style="background:#7f1d1d;padding:1px 6px;border-radius:3px;color:#fca5a5">${srcPort} ‚Üê ORIGINAL PORT</span><span class="hf-bits">16 bits</span></div>
    <div class="header-field"><span class="hf-name">Destination Port:</span><span class="hf-val">${dstPort}</span><span class="hf-bits">16 bits</span></div>
    ${proto === 'TCP' ? `<div class="header-field"><span class="hf-name">Sequence Number:</span><span class="hf-val">0x7A3F9C21</span><span class="hf-bits">32 bits</span></div>
    <div class="header-field"><span class="hf-name">Ack Number:</span><span class="hf-val">0x00000000</span><span class="hf-bits">32 bits</span></div>
    <div class="header-field"><span class="hf-name">Flags:</span><span class="hf-val">SYN</span><span class="hf-bits">9 bits</span></div>
    <div class="header-field"><span class="hf-name">Window Size:</span><span class="hf-val">65535</span><span class="hf-bits">16 bits</span></div>` : ''}
    <div class="header-field"><span class="hf-name">Checksum:</span><span class="hf-val" style="color:#fbbf24">${checksum1}</span><span class="hf-bits">16 bits</span></div>
  </div>` : ''}
</div>

<div class="header-section">
  <div style="color:#fbbf24;font-size:11px;text-align:center;margin:0.5rem 0;letter-spacing:0.1em">
    ‚ñº ‚ñº ‚ñº  NAT ROUTER PROCESSES PACKET  ‚ñº ‚ñº ‚ñº<br>
    <span style="color:#64748b;font-size:10px">Type: ${natType.toUpperCase()} | ${srcIp}:${srcPort} ‚Üí ${globalIp}:${isPAT ? globalPort : '(same)'}</span>
  </div>
</div>

<div class="header-section">
  <div class="header-section-title">‚îÄ‚îÄ TRANSLATED PACKET (Post-NAT / Inside Global) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</div>
  <div style="background:#1e293b;border-radius:6px;padding:0.75rem;margin:0.5rem 0">
    <div class="header-section-title" style="color:#34d399">‚ñå IPv4 Header (MODIFIED)</div>
    <div class="header-field"><span class="hf-name">Version:</span><span class="hf-val">4</span><span class="hf-bits">4 bits</span></div>
    <div class="header-field"><span class="hf-name">IHL:</span><span class="hf-val">5 (20 bytes)</span><span class="hf-bits">4 bits</span></div>
    <div class="header-field"><span class="hf-name">DSCP/ECN:</span><span class="hf-val">0x00</span><span class="hf-bits">8 bits</span></div>
    <div class="header-field"><span class="hf-name">Total Length:</span><span class="hf-val">68 bytes</span><span class="hf-bits">16 bits</span></div>
    <div class="header-field"><span class="hf-name">Identification:</span><span class="hf-val">0x4A2F</span><span class="hf-bits">16 bits</span></div>
    <div class="header-field"><span class="hf-name">Flags:</span><span class="hf-val">DF=1, MF=0</span><span class="hf-bits">3 bits</span></div>
    <div class="header-field"><span class="hf-name">Fragment Offset:</span><span class="hf-val">0</span><span class="hf-bits">13 bits</span></div>
    <div class="header-field"><span class="hf-name">TTL:</span><span class="hf-val hf-changed">‚¨á ${newTtl} (decremented)</span><span class="hf-bits">8 bits</span></div>
    <div class="header-field"><span class="hf-name">Protocol:</span><span class="hf-val">${proto} (${protoNum})</span><span class="hf-bits">8 bits</span></div>
    <div class="header-field"><span class="hf-name">Header Checksum:</span><span class="hf-val hf-changed">‚¨á ${checksum2} (recalculated)</span><span class="hf-bits">16 bits</span></div>
    <div class="header-field"><span class="hf-name">Source IP:</span><span class="hf-val" style="background:#064e3b;padding:1px 6px;border-radius:3px;color:#6ee7b7">‚¨á ${globalIp} ‚Üê INSIDE GLOBAL</span><span class="hf-bits">32 bits</span></div>
    <div class="header-field"><span class="hf-name">Destination IP:</span><span class="hf-val">${dstIp}</span><span class="hf-bits">32 bits</span></div>
  </div>
  ${proto !== 'ICMP' ? `<div style="background:#1e293b;border-radius:6px;padding:0.75rem;margin:0.5rem 0">
    <div class="header-section-title" style="color:#34d399">‚ñå ${proto} Header (MODIFIED)</div>
    <div class="header-field"><span class="hf-name">Source Port:</span><span class="hf-val" style="background:#064e3b;padding:1px 6px;border-radius:3px;color:#6ee7b7">${isPAT ? `‚¨á ${globalPort} ‚Üê PAT ASSIGNED` : srcPort + ' (unchanged)'}</span><span class="hf-bits">16 bits</span></div>
    <div class="header-field"><span class="hf-name">Destination Port:</span><span class="hf-val">${dstPort}</span><span class="hf-bits">16 bits</span></div>
    ${proto === 'TCP' ? `<div class="header-field"><span class="hf-name">Sequence Number:</span><span class="hf-val">0x7A3F9C21</span><span class="hf-bits">32 bits</span></div>
    <div class="header-field"><span class="hf-name">Flags:</span><span class="hf-val">SYN</span><span class="hf-bits">9 bits</span></div>
    <div class="header-field"><span class="hf-name">Window Size:</span><span class="hf-val">65535</span><span class="hf-bits">16 bits</span></div>` : ''}
    <div class="header-field"><span class="hf-name">Checksum:</span><span class="hf-val hf-changed">‚¨á ${checksum2} (recalculated)</span><span class="hf-bits">16 bits</span></div>
  </div>` : ''}
</div>

<div style="background:#0f2027;border:1px solid #1e3a5f;border-radius:6px;padding:0.75rem;margin-top:0.5rem;font-size:10px;color:#64748b">
  ‚óè NAT TABLE ENTRY: ${srcIp}:${srcPort} ‚Üî ${globalIp}:${isPAT ? globalPort : '(n/a)'} | DST: ${dstIp}:${dstPort} | PROTO: ${proto} | TTL: Session
</div>`;
}

// ‚îÄ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const questions = [
  {
    q: "What does 'Inside Local' refer to in NAT terminology?",
    options: ["The public IP address seen by outside hosts", "The private IP address of the internal host", "The router's WAN interface address", "The destination address in the NAT table"],
    correct: 1,
    exp: "Inside Local is the actual private (RFC 1918) IP address configured on the internal host ‚Äî it is not routable on the public internet."
  },
  {
    q: "Which Cisco IOS keyword enables PAT (NAT Overload) on a dynamic NAT configuration?",
    options: ["static", "pool", "overload", "inside"],
    correct: 2,
    exp: "The 'overload' keyword appended to the 'ip nat inside source list' command enables PAT, allowing multiple hosts to share a single public IP via port multiplexing."
  },
  {
    q: "A company has 500 internal hosts and one public IP address from their ISP. Which NAT type is most appropriate?",
    options: ["Static NAT", "Dynamic NAT", "PAT (NAT Overload)", "Twice NAT"],
    correct: 2,
    exp: "PAT (NAT Overload) is the correct choice ‚Äî it uses unique source port numbers to allow all 500 hosts to share a single public IP address simultaneously."
  },
  {
    q: "Which NAT type supports unsolicited inbound connections from the internet?",
    options: ["Dynamic NAT", "PAT", "Static NAT", "NAT Overload"],
    correct: 2,
    exp: "Static NAT creates a permanent 1:1 mapping that allows inbound connections since the Inside Global address always maps to the same internal host. PAT and Dynamic NAT do not support this by default."
  },
  {
    q: "What happens when the port number range for PAT is exhausted?",
    options: ["The router reboots automatically", "New connections from internal hosts are dropped", "The router switches to static NAT", "Old entries are deleted immediately"],
    correct: 1,
    exp: "When all available ports (typically up to 65,535 per public IP) are in use, new connection attempts from inside hosts are rejected ‚Äî this is a resource exhaustion condition."
  },
  {
    q: "Which RFC defines the private IPv4 address ranges used with NAT?",
    options: ["RFC 791", "RFC 1918", "RFC 3022", "RFC 4787"],
    correct: 1,
    exp: "RFC 1918 defines the three private address blocks: 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16. These addresses are non-routable on the public internet."
  },
  {
    q: "When a NAT router receives an inbound packet destined for 203.0.113.1:49152, what does it do?",
    options: ["Drops it (inbound unsolicited)", "Looks up port 49152 in the NAT table and forwards to the mapped inside host", "Broadcasts it to all internal hosts", "Sends it to the default gateway"],
    correct: 1,
    exp: "For PAT, the router checks the NAT table for the Inside Global address:port combination. If a matching entry exists, it translates the destination to the Inside Local address:port and forwards the packet inward."
  },
  {
    q: "Which Cisco show command displays all current active NAT translations?",
    options: ["show ip nat statistics", "show ip interface brief", "show ip nat translations", "debug ip nat"],
    correct: 2,
    exp: "'show ip nat translations' displays the current translation table showing protocol, Inside Local, Inside Global, and Outside Global mappings for all active sessions."
  }
];

let answeredCount = 0;
let correctCount = 0;

function renderQuiz() {
  const container = document.getElementById('quiz-container');
  container.innerHTML = '';
  answeredCount = 0;
  correctCount = 0;

  questions.forEach((q, i) => {
    const div = document.createElement('div');
    div.className = 'quiz-card';
    div.id = `q-${i}`;
    div.innerHTML = `
      <div class="quiz-q-num">Question ${i+1} of ${questions.length}</div>
      <div class="quiz-question">${q.q}</div>
      <div class="quiz-options">
        ${q.options.map((opt, j) => `<button class="quiz-option" onclick="answerQ(${i}, ${j})">${opt}</button>`).join('')}
      </div>
      <div class="quiz-feedback" id="fb-${i}"></div>
    `;
    container.appendChild(div);
  });
}

function answerQ(qi, choice) {
  const q = questions[qi];
  const card = document.getElementById(`q-${qi}`);
  const btns = card.querySelectorAll('.quiz-option');
  const fb = document.getElementById(`fb-${qi}`);

  if (btns[0].disabled) return;

  btns.forEach(b => b.disabled = true);
  btns[choice].classList.add(choice === q.correct ? 'correct' : 'incorrect');
  if (choice !== q.correct) btns[q.correct].classList.add('reveal');

  fb.textContent = (choice === q.correct ? '‚úÖ Correct! ' : '‚ùå Incorrect. ') + q.exp;
  fb.className = `quiz-feedback show ${choice === q.correct ? 'good' : 'bad'}`;

  if (choice === q.correct) correctCount++;
  answeredCount++;

  if (answeredCount === questions.length) {
    const bar = document.getElementById('scoreBar');
    bar.style.display = 'flex';
    document.getElementById('scoreNum').textContent = correctCount;
    document.getElementById('scoreOf').textContent = `/ ${questions.length}`;
    const pct = Math.round(correctCount / questions.length * 100);
    const msgs = { 100: 'üèÜ Perfect Score! Excellent mastery!', 87: 'üåü Great job! Strong understanding.', 75: 'üëç Good work. Review a few areas.', 50: 'üìö Keep studying ‚Äî review the lesson.', 0: 'üîÅ Revisit the modules and try again.' };
    const key = Object.keys(msgs).reverse().find(k => pct >= k);
    document.getElementById('scoreMsg').textContent = msgs[key];
    bar.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
}

function resetQuiz() {
  document.getElementById('scoreBar').style.display = 'none';
  renderQuiz();
}

// Init
renderQuiz();
</script>
</body>
</html>
