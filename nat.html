<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NAT Translation Simulator | Network Security</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:         #f0f4f8;
    --bg2:        #e2e9f0;
    --surface:    #ffffff;
    --surface2:   #f5f8fb;
    --accent:     #0077aa;
    --accent-lt:  rgba(0,119,170,0.10);
    --accent2:    #d94f00;
    --accent3:    #1a7f37;
    --text:       #0f1e2e;
    --text-muted: #4a6580;
    --border:     #c4d4e2;
    --danger:     #cc2233;
    --warning:    #b07800;
    --safe:       #1a7f37;
    --private:    #0077aa;
    --public:     #d94f00;
    --nat:        #7744bb;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed; inset: 0;
    background-image:
      linear-gradient(rgba(0,100,160,0.05) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,100,160,0.05) 1px, transparent 1px);
    background-size: 40px 40px;
    animation: gridMove 25s linear infinite;
    pointer-events: none; z-index: 0;
  }
  @keyframes gridMove { 0%{background-position:0 0} 100%{background-position:40px 40px} }

  /* â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .hero {
    position: relative; z-index: 1;
    padding: 80px 40px 60px;
    text-align: center;
    background: radial-gradient(ellipse 80% 60% at 50% 0%, rgba(0,119,170,0.10) 0%, transparent 70%);
    border-bottom: 1px solid var(--border);
  }
  .hero-badge {
    display: inline-flex; align-items: center; gap: 8px;
    background: rgba(0,119,170,0.08); border: 1px solid rgba(0,119,170,0.25);
    border-radius: 100px; padding: 6px 16px;
    font-family: 'Space Mono', monospace; font-size: 0.7rem;
    color: var(--accent); letter-spacing: 0.1em; text-transform: uppercase;
    margin-bottom: 24px; animation: fadeInDown 0.6s ease both;
  }
  .hero-badge::before {
    content:''; width:6px; height:6px; background:var(--accent);
    border-radius:50%; animation: pulse 2s infinite;
  }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.4;transform:scale(.8)} }

  .hero-icon { display:block; font-size:3rem; margin-bottom:12px; animation: fadeInDown .5s ease both; }
  h1 {
    font-family: 'Syne', sans-serif; font-weight: 800;
    font-size: clamp(2.5rem,6vw,4.5rem); line-height: 1.05;
    letter-spacing: -0.03em; animation: fadeInDown 0.6s 0.1s ease both;
  }
  h1 span { background: linear-gradient(135deg,var(--accent),#3a6fd8); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
  .hero p { max-width:700px; margin:20px auto 0; color:var(--text-muted); font-size:1.05rem; line-height:1.7; font-weight:300; animation:fadeInDown .6s .2s ease both; }
  @keyframes fadeInDown { from{opacity:0;transform:translateY(-16px)} to{opacity:1;transform:translateY(0)} }

  /* â”€â”€ STATS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .stats-bar {
    display:flex; justify-content:center; gap:40px; padding:24px 40px;
    border-bottom:1px solid var(--border); background:var(--bg2);
    position:relative; z-index:1; flex-wrap:wrap; animation:fadeInDown .6s .3s ease both;
  }
  .stat { text-align:center; }
  .stat-num { font-family:'Space Mono',monospace; font-size:1.8rem; font-weight:700; color:var(--accent); display:block; line-height:1; }
  .stat-num.green  { color:var(--safe); }
  .stat-num.orange { color:var(--accent2); }
  .stat-num.purple { color:var(--nat); }
  .stat-label { font-size:0.72rem; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.1em; margin-top:4px; }

  /* â”€â”€ CONTAINER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .container { max-width:1300px; margin:0 auto; padding:50px 30px; position:relative; z-index:1; }

  .section-header { display:flex; align-items:center; gap:14px; margin-bottom:28px; }
  .section-icon {
    width:38px; height:38px; background:rgba(0,119,170,0.08); border:1px solid rgba(0,119,170,0.2);
    border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:1.1rem; flex-shrink:0;
  }
  .section-title { font-family:'Syne',sans-serif; font-size:1.3rem; font-weight:600; letter-spacing:-0.01em; }
  .section-title small { display:block; font-family:'DM Sans',sans-serif; font-weight:300; font-size:0.8rem; color:var(--text-muted); margin-top:2px; }

  /* â”€â”€ NETWORK TOPOLOGY DIAGRAM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .topology-section { margin-bottom:60px; }

  .topology-wrap {
    background:var(--surface); border:1px solid var(--border); border-radius:18px;
    overflow:hidden; box-shadow:0 4px 24px rgba(0,0,0,0.06);
  }
  .topology-toolbar {
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 20px; background:var(--bg2); border-bottom:1px solid var(--border); flex-wrap:wrap; gap:10px;
  }
  .topology-toolbar-title { font-family:'Syne',sans-serif; font-weight:600; font-size:0.9rem; }

  /* SVG topology */
  .topology-svg-wrap { padding:28px 24px; overflow-x:auto; }
  .topo-svg { width:100%; min-width:620px; height:220px; display:block; }

  /* Device boxes */
  .dev-box { rx:10; ry:10; }
  .dev-private { fill:#e8f4fb; stroke:#0077aa; stroke-width:2; }
  .dev-router  { fill:#f0eaf8; stroke:#7744bb; stroke-width:2; }
  .dev-internet{ fill:#fef3ec; stroke:#d94f00; stroke-width:2; }
  .dev-server  { fill:#eaf4ee; stroke:#1a7f37; stroke-width:2; }

  .dev-label { font-family:'Space Mono',monospace; font-size:10px; font-weight:700; text-anchor:middle; }
  .dev-ip    { font-family:'Space Mono',monospace; font-size:9px;  text-anchor:middle; }
  .dev-private-lbl { fill:#0077aa; }
  .dev-router-lbl  { fill:#7744bb; }
  .dev-internet-lbl{ fill:#d94f00; }
  .dev-server-lbl  { fill:#1a7f37; }

  .topo-line { stroke:#c4d4e2; stroke-width:2; stroke-dasharray:6,4; }
  .topo-line-active { stroke:#0077aa; stroke-width:3; animation: dashFlow 1s linear infinite; }
  @keyframes dashFlow { to { stroke-dashoffset: -20; } }

  /* Animated packet dot */
  .packet-dot {
    r: 8; fill: var(--accent);
    filter: drop-shadow(0 0 4px rgba(0,119,170,0.6));
    opacity: 0;
  }

  /* Zone labels */
  .zone-label { font-family:'Syne',sans-serif; font-size:11px; font-weight:700; }
  .zone-private  { fill:rgba(0,119,170,0.07); stroke:rgba(0,119,170,0.2); stroke-width:1; stroke-dasharray:4,3; rx:12; }
  .zone-internet { fill:rgba(217,79,0,0.07);  stroke:rgba(217,79,0,0.2);  stroke-width:1; stroke-dasharray:4,3; rx:12; }

  /* â”€â”€ SIMULATOR CONTROLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sim-controls {
    padding:24px;
    border-top:1px solid var(--border);
    background:var(--surface2);
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:16px;
    align-items:end;
  }

  .ctrl-group label {
    display:block; font-family:'Space Mono',monospace; font-size:0.7rem; font-weight:700;
    color:var(--text-muted); text-transform:uppercase; letter-spacing:0.08em; margin-bottom:6px;
  }

  .ctrl-select, .ctrl-input {
    width:100%; padding:9px 12px;
    background:var(--surface); border:1px solid var(--border); border-radius:9px;
    color:var(--text); font-family:'DM Sans',sans-serif; font-size:0.88rem; outline:none;
    transition:border-color .2s;
  }
  .ctrl-select:focus, .ctrl-input:focus { border-color:var(--accent); box-shadow:0 0 0 3px rgba(0,119,170,0.08); }

  .btn {
    display:inline-flex; align-items:center; justify-content:center; gap:6px;
    padding:10px 18px; border-radius:10px;
    font-family:'DM Sans',sans-serif; font-size:0.875rem; font-weight:600;
    cursor:pointer; transition:all .2s; border:none; outline:none; white-space:nowrap;
  }
  .btn-primary   { background:var(--accent); color:#fff; }
  .btn-primary:hover { background:#0060a0; transform:translateY(-1px); box-shadow:0 4px 12px rgba(0,119,170,0.25); }
  .btn-secondary { background:rgba(217,79,0,0.10); color:var(--accent2); border:1px solid rgba(217,79,0,0.25); }
  .btn-secondary:hover { background:rgba(217,79,0,0.18); transform:translateY(-1px); }
  .btn-ghost     { background:transparent; color:var(--text-muted); border:1px solid var(--border); }
  .btn-ghost:hover { color:var(--text); border-color:rgba(0,0,0,0.2); }
  .btn-auto      { background:rgba(26,127,55,0.10); color:var(--safe); border:1px solid rgba(26,127,55,0.25); }
  .btn-auto:hover { background:rgba(26,127,55,0.18); }
  .btn-auto.running { background:rgba(204,34,51,0.10); color:var(--danger); border-color:rgba(204,34,51,0.25); }

  /* â”€â”€ PACKET LOG & NAT TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sim-panels {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:20px;
    margin-bottom:60px;
  }

  .panel {
    background:var(--surface); border:1px solid var(--border); border-radius:16px;
    overflow:hidden; box-shadow:0 4px 16px rgba(0,0,0,0.05);
  }
  .panel-header {
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 18px; background:var(--bg2); border-bottom:1px solid var(--border);
    gap:10px; flex-wrap:wrap;
  }
  .panel-title { font-family:'Syne',sans-serif; font-weight:600; font-size:0.9rem; }
  .panel-badge {
    font-family:'Space Mono',monospace; font-size:0.65rem; font-weight:700;
    padding:3px 9px; border-radius:100px; text-transform:uppercase; letter-spacing:0.05em;
  }
  .badge-live { background:rgba(204,34,51,0.10); color:var(--danger); border:1px solid rgba(204,34,51,0.2); animation:badgePulse 2s infinite; }
  @keyframes badgePulse { 0%,100%{opacity:1} 50%{opacity:.5} }
  .badge-count { background:rgba(0,119,170,0.10); color:var(--accent); border:1px solid rgba(0,119,170,0.2); }

  .panel-body { overflow-y:auto; max-height:340px; }

  /* Packet log */
  .packet-log { font-family:'Space Mono',monospace; font-size:0.75rem; }
  .log-entry {
    display:grid; grid-template-columns:70px 1fr 24px 1fr 80px;
    gap:6px; align-items:center;
    padding:9px 16px; border-bottom:1px solid rgba(196,212,226,0.4);
    animation:logSlideIn .3s ease;
  }
  .log-entry:last-child { border-bottom:none; }
  @keyframes logSlideIn { from{opacity:0;transform:translateX(-8px)} to{opacity:1;transform:translateX(0)} }

  .log-dir { font-size:0.65rem; font-weight:700; padding:2px 6px; border-radius:4px; text-align:center; white-space:nowrap; }
  .log-out { background:rgba(0,119,170,0.10); color:var(--accent); border:1px solid rgba(0,119,170,0.2); }
  .log-in  { background:rgba(217,79,0,0.10); color:var(--accent2); border:1px solid rgba(217,79,0,0.2); }

  .log-src { color:var(--private); }
  .log-dst { color:var(--accent2); }
  .log-arrow { color:var(--text-muted); text-align:center; font-size:0.9rem; }

  .log-proto { font-size:0.65rem; padding:2px 6px; border-radius:4px; text-align:center; }
  .proto-http  { background:rgba(26,127,55,0.10); color:var(--safe); }
  .proto-https { background:rgba(26,127,55,0.15); color:#156030; }
  .proto-dns   { background:rgba(119,68,187,0.10); color:var(--nat); }
  .proto-ftp   { background:rgba(176,120,0,0.10); color:var(--warning); }
  .proto-ssh   { background:rgba(204,34,51,0.10); color:var(--danger); }

  .log-empty { padding:40px 20px; text-align:center; color:var(--text-muted); font-family:'DM Sans',sans-serif; font-size:0.88rem; }

  /* NAT Table */
  .nat-table-wrap { overflow-x:auto; }
  table.nat-table { width:100%; border-collapse:collapse; font-size:0.75rem; font-family:'Space Mono',monospace; }
  .nat-table th {
    font-size:0.63rem; font-weight:700; text-transform:uppercase; letter-spacing:0.08em;
    color:var(--text-muted); padding:9px 12px; text-align:left;
    background:var(--bg2); border-bottom:1px solid var(--border); white-space:nowrap;
  }
  .nat-table td { padding:9px 12px; border-bottom:1px solid rgba(196,212,226,0.4); vertical-align:middle; }
  .nat-table tr:last-child td { border-bottom:none; }
  .nat-table tr { transition:background .15s; }
  .nat-table tr:hover td { background:rgba(0,119,170,0.04); }
  .nat-table tr.new-row td { animation:rowHighlight 1.5s ease; }
  @keyframes rowHighlight { 0%{background:rgba(0,119,170,0.12)} 100%{background:transparent} }

  .nat-private { color:var(--private); }
  .nat-public  { color:var(--public); }
  .nat-ttl     { color:var(--text-muted); font-size:0.68rem; }

  .state-pill { font-size:0.62rem; padding:2px 7px; border-radius:100px; font-weight:700; }
  .state-active   { background:rgba(26,127,55,0.12); color:var(--safe); border:1px solid rgba(26,127,55,0.25); }
  .state-expired  { background:rgba(204,34,51,0.10); color:var(--danger); border:1px solid rgba(204,34,51,0.2); opacity:.6; }

  .nat-empty { padding:40px 20px; text-align:center; color:var(--text-muted); font-family:'DM Sans',sans-serif; font-size:0.88rem; }

  /* â”€â”€ PACKET INSPECTOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .inspector-section { margin-bottom:60px; }

  .inspector-wrap {
    background:var(--surface); border:1px solid var(--border); border-radius:18px;
    overflow:hidden; box-shadow:0 4px 24px rgba(0,0,0,0.06);
  }
  .inspector-header {
    padding:16px 20px; background:var(--bg2); border-bottom:1px solid var(--border);
    display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px;
  }
  .inspector-title { font-family:'Syne',sans-serif; font-weight:600; font-size:0.9rem; }

  .inspector-body { padding:24px; }

  .pkt-flow {
    display:grid; grid-template-columns:1fr auto 1fr auto 1fr;
    gap:0; align-items:center; margin-bottom:20px;
  }

  .pkt-box {
    border-radius:12px; padding:16px 14px; text-align:center;
    border:2px solid transparent; transition:all .25s;
  }
  .pkt-box.private-box { background:rgba(0,119,170,0.07); border-color:rgba(0,119,170,0.25); }
  .pkt-box.nat-box     { background:rgba(119,68,187,0.07); border-color:rgba(119,68,187,0.25); }
  .pkt-box.server-box  { background:rgba(26,127,55,0.07);  border-color:rgba(26,127,55,0.25); }

  .pkt-box-icon  { font-size:1.8rem; margin-bottom:6px; }
  .pkt-box-label { font-family:'Space Mono',monospace; font-size:0.65rem; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; margin-bottom:8px; }
  .pkt-box-label.lbl-private { color:var(--private); }
  .pkt-box-label.lbl-nat     { color:var(--nat); }
  .pkt-box-label.lbl-server  { color:var(--safe); }
  .pkt-box-ip { font-family:'Space Mono',monospace; font-size:0.8rem; font-weight:700; color:var(--text); margin-bottom:2px; }
  .pkt-box-port { font-family:'Space Mono',monospace; font-size:0.7rem; color:var(--text-muted); }

  .pkt-arrow {
    display:flex; flex-direction:column; align-items:center; padding:0 8px;
    font-family:'Space Mono',monospace; font-size:0.62rem; color:var(--text-muted); gap:4px;
  }
  .pkt-arrow-line {
    width:60px; height:2px; background:linear-gradient(90deg,var(--border),var(--accent),var(--border));
    position:relative;
  }
  .pkt-arrow-line::after { content:'â–¶'; position:absolute; right:-8px; top:-7px; font-size:0.7rem; color:var(--accent); }
  .pkt-arrow-tag { font-size:0.6rem; background:var(--accent-lt); color:var(--accent); border:1px solid rgba(0,119,170,0.2); padding:2px 6px; border-radius:4px; white-space:nowrap; }

  /* Packet fields breakdown */
  .pkt-fields { display:grid; grid-template-columns:1fr 1fr; gap:12px; }

  .pkt-field-card {
    background:var(--surface2); border:1px solid var(--border); border-radius:10px; padding:12px 14px;
  }
  .pkt-field-title { font-family:'Space Mono',monospace; font-size:0.65rem; font-weight:700; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.08em; margin-bottom:8px; }
  .pkt-field-row { display:flex; justify-content:space-between; align-items:center; margin-bottom:5px; gap:8px; }
  .pkt-field-name { font-size:0.78rem; color:var(--text-muted); font-weight:300; }
  .pkt-field-val  { font-family:'Space Mono',monospace; font-size:0.78rem; font-weight:700; }
  .val-private { color:var(--private); }
  .val-public  { color:var(--public); }
  .val-nat     { color:var(--nat); }
  .val-changed { background:rgba(119,68,187,0.10); color:var(--nat); border:1px solid rgba(119,68,187,0.25); border-radius:4px; padding:1px 5px; }

  .inspect-empty { padding:40px; text-align:center; color:var(--text-muted); font-size:0.9rem; }

  /* â”€â”€ NAT TYPES SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .types-section { margin-bottom:60px; }

  .types-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:14px; }

  .type-card {
    background:var(--surface); border:1px solid var(--border); border-radius:14px;
    padding:20px; transition:all .2s; border-left:4px solid transparent;
    cursor:default;
  }
  .type-card:hover { box-shadow:0 6px 22px rgba(0,0,0,0.08); transform:translateY(-2px); }

  .type-card.static  { border-left-color:#0077aa; }
  .type-card.dynamic { border-left-color:#1a7f37; }
  .type-card.pat     { border-left-color:#7744bb; }
  .type-card.dnat    { border-left-color:#d94f00; }
  .type-card.cgnat   { border-left-color:#b07800; }

  .type-icon { font-size:1.8rem; margin-bottom:10px; }
  .type-name {
    font-family:'Syne',sans-serif; font-weight:700; font-size:1rem; margin-bottom:6px;
  }
  .static  .type-name { color:#0077aa; }
  .dynamic .type-name { color:#1a7f37; }
  .pat     .type-name { color:#7744bb; }
  .dnat    .type-name { color:#d94f00; }
  .cgnat   .type-name { color:#b07800; }

  .type-desc { font-size:0.85rem; color:var(--text-muted); line-height:1.6; margin-bottom:10px; font-weight:300; }
  .type-example {
    background:var(--surface2); border:1px solid var(--border); border-radius:7px;
    padding:8px 12px; font-family:'Space Mono',monospace; font-size:0.7rem; line-height:1.7;
    color:var(--accent);
  }
  .type-badge {
    display:inline-block; font-family:'Space Mono',monospace; font-size:0.62rem; font-weight:700;
    padding:3px 9px; border-radius:100px; text-transform:uppercase; letter-spacing:0.05em; margin-bottom:10px;
  }
  .badge-static  { background:rgba(0,119,170,0.10);  color:#0077aa; border:1px solid rgba(0,119,170,0.25); }
  .badge-dynamic { background:rgba(26,127,55,0.10);  color:#1a7f37; border:1px solid rgba(26,127,55,0.25); }
  .badge-pat     { background:rgba(119,68,187,0.10); color:#7744bb; border:1px solid rgba(119,68,187,0.25); }
  .badge-dnat    { background:rgba(217,79,0,0.10);   color:#d94f00; border:1px solid rgba(217,79,0,0.25); }
  .badge-cgnat   { background:rgba(176,120,0,0.10);  color:#b07800; border:1px solid rgba(176,120,0,0.25); }

  /* â”€â”€ COMPARISON TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .compare-section { margin-bottom:60px; }
  .compare-table {
    width:100%; border-collapse:collapse; background:var(--surface);
    border:1px solid var(--border); border-radius:16px; overflow:hidden;
    box-shadow:0 4px 24px rgba(0,0,0,0.05); font-size:0.875rem;
  }
  .compare-table thead { background:var(--bg2); }
  .compare-table th {
    font-family:'Space Mono',monospace; font-size:0.7rem; font-weight:700;
    text-transform:uppercase; letter-spacing:0.1em; color:var(--text-muted);
    padding:13px 18px; text-align:left; border-bottom:1px solid var(--border);
  }
  .compare-table td {
    padding:13px 18px; border-bottom:1px solid rgba(196,212,226,0.5);
    vertical-align:top; line-height:1.55; color:var(--text-muted);
  }
  .compare-table tr:last-child td { border-bottom:none; }
  .compare-table tr:hover td { background:rgba(0,119,170,0.03); }
  .compare-table td:first-child { font-family:'Space Mono',monospace; font-size:0.75rem; font-weight:700; color:var(--text); white-space:nowrap; }
  .good { color:var(--safe); font-weight:500; }
  .bad  { color:var(--danger); font-weight:500; }
  .warn { color:var(--warning); font-weight:500; }

  /* â”€â”€ QUIZ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .quiz-section {
    background:var(--surface); border:1px solid var(--border); border-radius:18px;
    overflow:hidden; margin-bottom:60px; box-shadow:0 4px 24px rgba(0,0,0,0.05);
  }
  .quiz-header {
    background:linear-gradient(135deg,rgba(0,119,170,0.07),rgba(119,68,187,0.07));
    border-bottom:1px solid var(--border); padding:20px 24px;
    display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
  }
  .quiz-title { font-family:'Syne',sans-serif; font-size:1.15rem; font-weight:600; }
  .quiz-score { font-family:'Space Mono',monospace; font-size:0.85rem; color:var(--text-muted); }
  .quiz-score span { color:var(--safe); font-weight:700; }
  .quiz-body { padding:28px 24px; }
  .progress-bar { height:3px; background:var(--border); border-radius:100px; overflow:hidden; margin-bottom:24px; }
  .progress-fill { height:100%; background:linear-gradient(90deg,var(--accent),#5080dc); border-radius:100px; transition:width .4s ease; }
  .question-text { font-size:1.05rem; font-weight:400; margin-bottom:20px; line-height:1.6; }
  .question-text em { color:var(--accent); font-style:normal; font-family:'Space Mono',monospace; }
  .options { display:flex; flex-direction:column; gap:10px; }
  .option {
    display:flex; align-items:center; gap:12px; padding:14px 18px;
    background:var(--surface2); border:1px solid var(--border); border-radius:12px;
    cursor:pointer; transition:all .2s; font-size:0.9rem; line-height:1.4; color:var(--text);
  }
  .option:hover:not(.disabled) { border-color:var(--accent); background:rgba(0,119,170,0.06); }
  .option.correct { background:rgba(26,127,55,0.08); border-color:var(--safe); color:#145e2a; }
  .option.wrong   { background:rgba(204,34,51,0.08);  border-color:var(--danger); color:#a01828; }
  .option.disabled{ cursor:default; }
  .option-letter {
    width:28px; height:28px; background:rgba(0,0,0,0.06); border-radius:6px;
    display:flex; align-items:center; justify-content:center;
    font-family:'Space Mono',monospace; font-size:0.75rem; font-weight:700; flex-shrink:0; color:var(--text-muted);
  }
  .option.correct .option-letter { background:var(--safe); color:#fff; }
  .option.wrong   .option-letter { background:var(--danger); color:#fff; }
  .quiz-feedback { margin-top:18px; padding:14px 18px; border-radius:12px; font-size:0.88rem; line-height:1.6; display:none; }
  .quiz-feedback.show    { display:block; animation:slideDown .2s ease; }
  .quiz-feedback.correct { background:rgba(26,127,55,0.07); border:1px solid rgba(26,127,55,0.25); color:#145e2a; }
  .quiz-feedback.wrong   { background:rgba(204,34,51,0.07); border:1px solid rgba(204,34,51,0.25); color:#a01828; }
  .quiz-nav { display:flex; justify-content:space-between; align-items:center; margin-top:24px; }
  .q-counter { font-family:'Space Mono',monospace; font-size:0.78rem; color:var(--text-muted); }

  @keyframes slideDown { from{opacity:0;transform:translateY(-8px)} to{opacity:1;transform:translateY(0)} }

  /* â”€â”€ SCROLL REVEAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .reveal { opacity:0; transform:translateY(24px); transition:opacity .5s ease,transform .5s ease; }
  .reveal.visible { opacity:1; transform:translateY(0); }

  footer {
    text-align:center; padding:32px 20px; color:var(--text-muted); font-size:0.8rem;
    border-top:1px solid var(--border); position:relative; z-index:1;
    font-family:'Space Mono',monospace; background:var(--bg2);
  }

  @media(max-width:900px) { .sim-panels { grid-template-columns:1fr; } }
  @media(max-width:700px) {
    .hero{padding:50px 20px 40px}
    .container{padding:30px 16px}
    .pkt-flow{grid-template-columns:1fr;gap:8px}
    .pkt-arrow{flex-direction:row}
    .pkt-fields{grid-template-columns:1fr}
    .types-grid{grid-template-columns:1fr}
    .log-entry{grid-template-columns:60px 1fr 18px 1fr 60px;font-size:0.68rem}
  }
</style>
</head>
<body>

<!-- HERO -->
<header class="hero">
  <div class="hero-badge">Network Layer Â· RFC 3022</div>
  <span class="hero-icon">ğŸ”„</span>
  <h1>Network Address <span>Translation</span></h1>
  <p>NAT allows multiple devices on a private network to share a single public IP address. It maps private IP:port pairs to public IP:port pairs, enabling internet access while conserving IPv4 address space and adding a layer of network security.</p>
</header>

<!-- STATS BAR -->
<div class="stats-bar">
  <div class="stat"><span class="stat-num">~4.3B</span><div class="stat-label">IPv4 Addresses</div></div>
  <div class="stat"><span class="stat-num purple">PAT</span><div class="stat-label">Most Common Type</div></div>
  <div class="stat"><span class="stat-num green">65,535</span><div class="stat-label">Max Port Mappings</div></div>
  <div class="stat"><span class="stat-num orange">RFC 1918</span><div class="stat-label">Private Ranges</div></div>
</div>

<div class="container">

  <!-- â•â•â• NETWORK TOPOLOGY + SIMULATOR â•â•â• -->
  <div class="topology-section reveal">
    <div class="section-header">
      <div class="section-icon">ğŸ–§</div>
      <div class="section-title">
        Live NAT Traffic Simulator
        <small>Generate outbound or inbound traffic and watch address translation happen in real time</small>
      </div>
    </div>

    <div class="topology-wrap">
      <div class="topology-toolbar">
        <div class="topology-toolbar-title">Network Topology</div>
        <div style="font-size:0.75rem;color:var(--text-muted);font-style:italic;">Private 192.168.1.0/24 â†’ NAT Router (203.0.113.1) â†’ Internet</div>
      </div>

      <!-- SVG TOPOLOGY -->
      <div class="topology-svg-wrap">
        <svg class="topo-svg" viewBox="0 0 900 200" xmlns="http://www.w3.org/2000/svg">
          <!-- Zone backgrounds -->
          <rect x="10" y="10" width="310" height="180" class="zone-private"/>
          <rect x="590" y="10" width="300" height="180" class="zone-internet"/>
          <text x="22" y="28" class="zone-label" fill="rgba(0,119,170,0.5)">Private Network</text>
          <text x="602" y="28" class="zone-label" fill="rgba(217,79,0,0.5)">Internet</text>

          <!-- Private clients -->
          <rect x="30" y="40"  width="120" height="44" class="dev-box dev-private"/>
          <text x="90" y="58"  class="dev-label dev-private-lbl">PC-1</text>
          <text x="90" y="72"  class="dev-ip dev-private-lbl">192.168.1.10</text>

          <rect x="30" y="96"  width="120" height="44" class="dev-box dev-private"/>
          <text x="90" y="114" class="dev-label dev-private-lbl">PC-2</text>
          <text x="90" y="128" class="dev-ip dev-private-lbl">192.168.1.20</text>

          <rect x="30" y="152" width="120" height="36" class="dev-box dev-private"/>
          <text x="90" y="167" class="dev-label dev-private-lbl">PC-3</text>
          <text x="90" y="179" class="dev-ip dev-private-lbl">192.168.1.30</text>

          <!-- Lines from clients to router -->
          <line x1="150" y1="62"  x2="360" y2="96"  class="topo-line" id="line-pc1"/>
          <line x1="150" y1="118" x2="360" y2="100" class="topo-line" id="line-pc2"/>
          <line x1="150" y1="170" x2="360" y2="106" class="topo-line" id="line-pc3"/>

          <!-- NAT Router -->
          <rect x="340" y="60" width="140" height="80" class="dev-box dev-router"/>
          <text x="410" y="90"  class="dev-label dev-router-lbl">NAT Router</text>
          <text x="410" y="106" class="dev-ip dev-router-lbl">IN: 192.168.1.1</text>
          <text x="410" y="120" class="dev-ip dev-router-lbl">OUT: 203.0.113.1</text>

          <!-- Line router to internet -->
          <line x1="480" y1="100" x2="600" y2="100" class="topo-line" id="line-wan" stroke-dasharray="8,4"/>

          <!-- Internet servers -->
          <rect x="610" y="40"  width="130" height="44" class="dev-box dev-server"/>
          <text x="675" y="58"  class="dev-label dev-server-lbl">Web Server</text>
          <text x="675" y="72"  class="dev-ip dev-server-lbl">93.184.216.34</text>

          <rect x="610" y="96"  width="130" height="44" class="dev-box dev-internet"/>
          <text x="675" y="114" class="dev-label dev-internet-lbl">DNS Server</text>
          <text x="675" y="128" class="dev-ip dev-internet-lbl">8.8.8.8</text>

          <rect x="610" y="152" width="130" height="36" class="dev-box dev-server"/>
          <text x="675" y="168" class="dev-label dev-server-lbl">HTTPS Server</text>
          <text x="675" y="180" class="dev-ip dev-server-lbl">172.217.14.78</text>

          <!-- Animated packet dot -->
          <circle class="packet-dot" id="anim-pkt" cx="90" cy="62" r="7"/>
        </svg>
      </div>

      <!-- CONTROLS -->
      <div class="sim-controls">
        <div class="ctrl-group">
          <label>Source Device</label>
          <select class="ctrl-select" id="ctrl-src">
            <option value="192.168.1.10">PC-1 (192.168.1.10)</option>
            <option value="192.168.1.20">PC-2 (192.168.1.20)</option>
            <option value="192.168.1.30">PC-3 (192.168.1.30)</option>
          </select>
        </div>
        <div class="ctrl-group">
          <label>Destination Server</label>
          <select class="ctrl-select" id="ctrl-dst">
            <option value="93.184.216.34">Web Server (93.184.216.34)</option>
            <option value="8.8.8.8">DNS Server (8.8.8.8)</option>
            <option value="172.217.14.78">HTTPS Server (172.217.14.78)</option>
          </select>
        </div>
        <div class="ctrl-group">
          <label>Protocol</label>
          <select class="ctrl-select" id="ctrl-proto">
            <option value="HTTP">HTTP (port 80)</option>
            <option value="HTTPS">HTTPS (port 443)</option>
            <option value="DNS">DNS (port 53)</option>
            <option value="FTP">FTP (port 21)</option>
            <option value="SSH">SSH (port 22)</option>
          </select>
        </div>
        <div class="ctrl-group">
          <label>Packet Count</label>
          <input class="ctrl-input" type="number" id="ctrl-count" value="1" min="1" max="20">
        </div>
        <div class="ctrl-group" style="display:flex;gap:8px;flex-wrap:wrap;align-items:flex-end;">
          <button class="btn btn-primary" onclick="sendPackets('out')">â–¶ Send Outbound</button>
          <button class="btn btn-secondary" onclick="sendPackets('in')">â—€ Receive Inbound</button>
          <button class="btn btn-auto" id="auto-btn" onclick="toggleAuto()">âš¡ Auto-Generate</button>
          <button class="btn btn-ghost" onclick="clearAll()">âœ• Clear</button>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• LIVE PANELS â•â•â• -->
  <div class="sim-panels reveal">
    <!-- Packet Log -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">ğŸ“‹ Packet Traffic Log</div>
        <span class="panel-badge badge-live" id="log-live">â— LIVE</span>
      </div>
      <div class="panel-body" id="packet-log">
        <div class="log-empty">No traffic yet â€” send packets to begin</div>
      </div>
    </div>

    <!-- NAT Translation Table -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">ğŸ—‚ï¸ NAT Translation Table</div>
        <span class="panel-badge badge-count" id="nat-count">0 entries</span>
      </div>
      <div class="panel-body nat-table-wrap" id="nat-table-wrap">
        <div class="nat-empty">NAT table is empty â€” send outbound traffic to populate</div>
      </div>
    </div>
  </div>

  <!-- â•â•â• PACKET INSPECTOR â•â•â• -->
  <div class="inspector-section reveal">
    <div class="section-header">
      <div class="section-icon">ğŸ”¬</div>
      <div class="section-title">
        Packet Inspector
        <small>Click any log entry to inspect how NAT rewrites the packet headers</small>
      </div>
    </div>
    <div class="inspector-wrap">
      <div class="inspector-header">
        <div class="inspector-title">Header Rewrite Analysis</div>
        <span id="inspect-proto-badge" style="font-family:'Space Mono',monospace;font-size:0.7rem;color:var(--text-muted);">Select a packet from the log</span>
      </div>
      <div class="inspector-body" id="inspector-body">
        <div class="inspect-empty">ğŸ‘† Send some packets above, then click a log entry to inspect the NAT header rewrite</div>
      </div>
    </div>
  </div>

  <!-- â•â•â• NAT TYPES â•â•â• -->
  <div class="types-section reveal">
    <div class="section-header">
      <div class="section-icon">ğŸ—‚ï¸</div>
      <div class="section-title">
        NAT Types Explained
        <small>Different NAT strategies for different use cases</small>
      </div>
    </div>
    <div class="types-grid">

      <div class="type-card static">
        <div class="type-icon">ğŸ“Œ</div>
        <span class="type-badge badge-static">Static NAT</span>
        <div class="type-name">One-to-One Mapping</div>
        <div class="type-desc">A single private IP is permanently mapped to a single public IP. Used for servers that must always be reachable from the internet at the same address. Does not conserve IP addresses.</div>
        <div class="type-example">192.168.1.10 â†” 203.0.113.10<br>192.168.1.20 â†” 203.0.113.20<br># Fixed, permanent mapping</div>
      </div>

      <div class="type-card dynamic">
        <div class="type-icon">ğŸ”€</div>
        <span class="type-badge badge-dynamic">Dynamic NAT</span>
        <div class="type-name">Pool-Based Mapping</div>
        <div class="type-desc">Private IPs are mapped to a pool of public IPs on a first-come, first-served basis. If the pool is exhausted, new connections are denied. Provides some IP conservation but still requires multiple public IPs.</div>
        <div class="type-example">192.168.1.10 â†’ 203.0.113.5  (from pool)<br>192.168.1.20 â†’ 203.0.113.6  (from pool)<br># Dynamic, returns to pool on disconnect</div>
      </div>

      <div class="type-card pat">
        <div class="type-icon">ğŸ”¢</div>
        <span class="type-badge badge-pat">PAT / NAT Overload</span>
        <div class="type-name">Port Address Translation</div>
        <div class="type-desc">The most common form â€” many private IPs share ONE public IP, differentiated by unique source port numbers. Also called NAT Overload or NAPT. This is how home routers work and is the simulator's default mode.</div>
        <div class="type-example">192.168.1.10:5001 â†’ 203.0.113.1:40001<br>192.168.1.20:5002 â†’ 203.0.113.1:40002<br># Same public IP, different ports</div>
      </div>

      <div class="type-card dnat">
        <div class="type-icon">ğŸ“¥</div>
        <span class="type-badge badge-dnat">DNAT / Port Forwarding</span>
        <div class="type-name">Destination NAT</div>
        <div class="type-desc">Rewrites the destination IP (and optionally port) of incoming packets, redirecting them to an internal server. Used for hosting web servers, game servers, or remote desktop behind a NAT router.</div>
        <div class="type-example">Incoming: 203.0.113.1:80<br>â†’ Forwarded: 192.168.1.100:80<br># Port forwarding to internal web server</div>
      </div>

      <div class="type-card cgnat">
        <div class="type-icon">ğŸŒ</div>
        <span class="type-badge badge-cgnat">CGNAT</span>
        <div class="type-name">Carrier-Grade NAT</div>
        <div class="type-desc">ISPs use CGNAT (RFC 6598) to apply NAT at the provider level, giving customers RFC 1918 addresses or the 100.64.0.0/10 range. Creates double-NAT situations and complicates peer-to-peer applications and port forwarding.</div>
        <div class="type-example">Your Home IP: 100.64.0.5 (CGNAT range)<br>ISP NAT: 100.64.0.5 â†’ 203.0.113.1<br># Double NAT â€” limits hosting</div>
      </div>

    </div>
  </div>

  <!-- â•â•â• RFC 1918 PRIVATE RANGES â•â•â• -->
  <div class="compare-section reveal">
    <div class="section-header">
      <div class="section-icon">ğŸ“‹</div>
      <div class="section-title">
        RFC 1918 Private Address Ranges
        <small>These addresses are non-routable on the public internet â€” NAT translates them to public IPs</small>
      </div>
    </div>
    <table class="compare-table">
      <thead>
        <tr>
          <th>Range</th>
          <th>CIDR Notation</th>
          <th>Subnet Mask</th>
          <th>Total Addresses</th>
          <th>Typical Use</th>
          <th>Routable?</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>10.0.0.0 â€“ 10.255.255.255</td>
          <td>10.0.0.0/8</td>
          <td>255.0.0.0</td>
          <td>16,777,216</td>
          <td>Large enterprises, ISPs</td>
          <td><span class="bad">âœ— Private only</span></td>
        </tr>
        <tr>
          <td>172.16.0.0 â€“ 172.31.255.255</td>
          <td>172.16.0.0/12</td>
          <td>255.240.0.0</td>
          <td>1,048,576</td>
          <td>Medium networks, cloud VPCs</td>
          <td><span class="bad">âœ— Private only</span></td>
        </tr>
        <tr>
          <td>192.168.0.0 â€“ 192.168.255.255</td>
          <td>192.168.0.0/16</td>
          <td>255.255.0.0</td>
          <td>65,536</td>
          <td>Home & small office networks</td>
          <td><span class="bad">âœ— Private only</span></td>
        </tr>
        <tr>
          <td>100.64.0.0 â€“ 100.127.255.255</td>
          <td>100.64.0.0/10</td>
          <td>255.192.0.0</td>
          <td>4,194,304</td>
          <td>CGNAT (ISP-level NAT, RFC 6598)</td>
          <td><span class="warn">âš  CGNAT only</span></td>
        </tr>
        <tr>
          <td>127.0.0.0 â€“ 127.255.255.255</td>
          <td>127.0.0.0/8</td>
          <td>255.0.0.0</td>
          <td>16,777,216</td>
          <td>Loopback (localhost)</td>
          <td><span class="bad">âœ— Loopback only</span></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- â•â•â• QUIZ â•â•â• -->
  <div class="reveal">
    <div class="section-header">
      <div class="section-icon">ğŸ§ </div>
      <div class="section-title">
        Knowledge Check Quiz
        <small>Test your understanding of NAT, PAT, and address translation</small>
      </div>
    </div>
    <div class="quiz-section">
      <div class="quiz-header">
        <div class="quiz-title">NAT Protocol Quiz</div>
        <div class="quiz-score">Score: <span id="score-display">0</span> / <span id="total-display">0</span></div>
      </div>
      <div class="quiz-body">
        <div class="progress-bar"><div class="progress-fill" id="quiz-progress" style="width:0%"></div></div>
        <div class="question-text" id="question-text"></div>
        <div class="options" id="options-container"></div>
        <div class="quiz-feedback" id="quiz-feedback"></div>
        <div class="quiz-nav">
          <div class="q-counter" id="q-counter"></div>
          <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()" style="display:none;">Next Question â†’</button>
        </div>
      </div>
    </div>
  </div>

</div><!-- /.container -->

<footer>Â© 2024 NAT Translation Simulator Â· Moraine Valley Community College &nbsp;|&nbsp; Network Security Curriculum</footer>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT â€” Simulator Engine
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ROUTER_IP   = '203.0.113.1';
const PORT_BASE   = 40000;
const TTL_DEFAULT = 300; // seconds

const PROTO_PORTS = { HTTP:80, HTTPS:443, DNS:53, FTP:21, SSH:22 };

const DEVICES = {
  '192.168.1.10': { name:'PC-1', svgY:62 },
  '192.168.1.20': { name:'PC-2', svgY:118 },
  '192.168.1.30': { name:'PC-3', svgY:170 }
};

const SERVERS = {
  '93.184.216.34': { name:'Web Server',   svgY:62 },
  '8.8.8.8':       { name:'DNS Server',   svgY:118 },
  '172.217.14.78': { name:'HTTPS Server', svgY:170 }
};

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let natTable   = {};   // key: "privateIP:privatePort" â†’ { publicPort, dstIP, dstPort, proto, ttl, ts }
let packetLog  = [];   // array of packet objects
let portCounter = PORT_BASE;
let autoTimer   = null;
let logSeq      = 0;

// â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function randPort(min=1024, max=65535) {
  return Math.floor(Math.random() * (max - min)) + min;
}

function nextPublicPort() {
  portCounter++;
  if (portCounter > 65535) portCounter = PORT_BASE + 1;
  return portCounter;
}

function protoClass(p) {
  return 'proto-' + p.toLowerCase();
}

function dirClass(d) { return d === 'out' ? 'log-out' : 'log-in'; }
function dirLabel(d) { return d === 'out' ? 'â–¶ OUT' : 'â—€ IN'; }

function timeStr() {
  const d = new Date();
  return d.getHours().toString().padStart(2,'0') + ':' +
         d.getMinutes().toString().padStart(2,'0') + ':' +
         d.getSeconds().toString().padStart(2,'0');
}

// â”€â”€ NAT TABLE OPERATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getNatEntry(privateIP, privatePort, dstIP, proto) {
  const key = `${privateIP}:${privatePort}:${dstIP}:${proto}`;
  if (!natTable[key]) {
    natTable[key] = {
      privateIP, privatePort,
      publicPort: nextPublicPort(),
      dstIP, proto,
      state: 'active',
      ts: timeStr(),
      pktCount: 0
    };
  }
  natTable[key].pktCount++;
  return natTable[key];
}

// â”€â”€ RENDER NAT TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderNatTable() {
  const wrap = document.getElementById('nat-table-wrap');
  const entries = Object.values(natTable);
  document.getElementById('nat-count').textContent = entries.length + ' entr' + (entries.length===1?'y':'ies');

  if (!entries.length) {
    wrap.innerHTML = '<div class="nat-empty">NAT table is empty â€” send outbound traffic to populate</div>';
    return;
  }

  let html = `<table class="nat-table"><thead><tr>
    <th>Private IP : Port</th>
    <th>Protocol</th>
    <th>Public IP : Port</th>
    <th>Destination</th>
    <th>Pkts</th>
    <th>State</th>
    <th>Created</th>
  </tr></thead><tbody>`;

  entries.forEach((e, i) => {
    html += `<tr class="${i === entries.length-1 ? 'new-row' : ''}">
      <td class="nat-private">${e.privateIP}:${e.privatePort}</td>
      <td><span class="log-proto ${protoClass(e.proto)}">${e.proto}</span></td>
      <td class="nat-public">${ROUTER_IP}:${e.publicPort}</td>
      <td class="nat-private" style="color:var(--text-muted)">${e.dstIP}:${PROTO_PORTS[e.proto]}</td>
      <td class="nat-ttl">${e.pktCount}</td>
      <td><span class="state-pill state-${e.state}">${e.state}</span></td>
      <td class="nat-ttl">${e.ts}</td>
    </tr>`;
  });
  html += '</tbody></table>';
  wrap.innerHTML = html;
}

// â”€â”€ RENDER PACKET LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPacketLog() {
  const logEl = document.getElementById('packet-log');
  if (!packetLog.length) {
    logEl.innerHTML = '<div class="log-empty">No traffic yet â€” send packets to begin</div>';
    return;
  }
  logEl.innerHTML = [...packetLog].reverse().map((p, idx) => {
    const isOut = p.dir === 'out';
    const srcDisplay = isOut
      ? `<span class="log-src">${p.privateIP}:${p.privatePort}</span>`
      : `<span class="log-dst">${p.dstIP}:${PROTO_PORTS[p.proto]}</span>`;
    const dstDisplay = isOut
      ? `<span class="log-dst">${p.dstIP}:${PROTO_PORTS[p.proto]}</span>`
      : `<span class="log-src">${p.privateIP}:${p.privatePort}</span>`;

    return `<div class="log-entry" style="cursor:pointer" onclick="inspectPacket(${p.seq})" title="Click to inspect">
      <span class="log-dir ${dirClass(p.dir)}">${dirLabel(p.dir)}</span>
      ${srcDisplay}
      <span class="log-arrow">â†’</span>
      ${dstDisplay}
      <span class="log-proto ${protoClass(p.proto)}">${p.proto}</span>
    </div>`;
  }).join('');
}

// â”€â”€ PACKET INSPECTOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function inspectPacket(seq) {
  const p = packetLog.find(x => x.seq === seq);
  if (!p) return;

  document.getElementById('inspect-proto-badge').textContent =
    `${p.proto} Â· ${p.dir.toUpperCase()} Â· ${p.ts}`;

  const isOut = p.dir === 'out';
  const srcIP   = isOut ? p.privateIP  : ROUTER_IP;
  const srcPort = isOut ? p.privatePort: p.publicPort;
  const dstIP   = p.dstIP;
  const dstPort = PROTO_PORTS[p.proto];

  const natSrcIP   = isOut ? ROUTER_IP    : p.privateIP;
  const natSrcPort = isOut ? p.publicPort : p.privatePort;

  const body = document.getElementById('inspector-body');
  body.innerHTML = `
    <div class="pkt-flow">
      <div class="pkt-box ${isOut ? 'private-box' : 'server-box'}">
        <div class="pkt-box-icon">${isOut ? 'ğŸ’»' : 'ğŸŒ'}</div>
        <div class="pkt-box-label ${isOut ? 'lbl-private' : 'lbl-server'}">${isOut ? DEVICES[p.privateIP]?.name||'Client' : SERVERS[p.dstIP]?.name||'Server'}</div>
        <div class="pkt-box-ip">${srcIP}</div>
        <div class="pkt-box-port">Port: ${srcPort}</div>
      </div>
      <div class="pkt-arrow">
        <div class="pkt-arrow-line"></div>
        <div class="pkt-arrow-tag">Before NAT</div>
      </div>
      <div class="pkt-box nat-box">
        <div class="pkt-box-icon">ğŸ”„</div>
        <div class="pkt-box-label lbl-nat">NAT Router</div>
        <div class="pkt-box-ip">${ROUTER_IP}</div>
        <div class="pkt-box-port">Rewrites headers</div>
      </div>
      <div class="pkt-arrow">
        <div class="pkt-arrow-line"></div>
        <div class="pkt-arrow-tag">After NAT</div>
      </div>
      <div class="pkt-box ${isOut ? 'server-box' : 'private-box'}">
        <div class="pkt-box-icon">${isOut ? 'ğŸŒ' : 'ğŸ’»'}</div>
        <div class="pkt-box-label ${isOut ? 'lbl-server' : 'lbl-private'}">${isOut ? SERVERS[p.dstIP]?.name||'Server' : DEVICES[p.privateIP]?.name||'Client'}</div>
        <div class="pkt-box-ip">${dstIP}</div>
        <div class="pkt-box-port">Port: ${dstPort}</div>
      </div>
    </div>

    <div class="pkt-fields">
      <div class="pkt-field-card">
        <div class="pkt-field-title">ğŸ“¤ Packet Before NAT (${isOut ? 'Outbound from Client' : 'Reply from Server'})</div>
        <div class="pkt-field-row">
          <span class="pkt-field-name">Source IP</span>
          <span class="pkt-field-val val-private">${srcIP}</span>
        </div>
        <div class="pkt-field-row">
          <span class="pkt-field-name">Source Port</span>
          <span class="pkt-field-val val-private">${srcPort}</span>
        </div>
        <div class="pkt-field-row">
          <span class="pkt-field-name">Destination IP</span>
          <span class="pkt-field-val val-public">${isOut ? dstIP : ROUTER_IP}</span>
        </div>
        <div class="pkt-field-row">
          <span class="pkt-field-name">Destination Port</span>
          <span class="pkt-field-val val-public">${isOut ? dstPort : p.publicPort}</span>
        </div>
        <div class="pkt-field-row">
          <span class="pkt-field-name">Protocol</span>
          <span class="pkt-field-val">${p.proto} / ${dstPort === 53 ? 'UDP' : 'TCP'}</span>
        </div>
      </div>

      <div class="pkt-field-card">
        <div class="pkt-field-title">ğŸ“¥ Packet After NAT (${isOut ? 'Seen by Internet Server' : 'Delivered to Client'})</div>
        <div class="pkt-field-row">
          <span class="pkt-field-name">Source IP</span>
          <span class="pkt-field-val ${isOut ? 'val-nat' : 'val-public'}">${isOut ? ROUTER_IP : dstIP} ${isOut ? '<span class="val-changed">CHANGED</span>' : ''}</span>
        </div>
        <div class="pkt-field-row">
          <span class="pkt-field-name">Source Port</span>
          <span class="pkt-field-val ${isOut ? 'val-nat' : 'val-public'}">${isOut ? p.publicPort : dstPort} ${isOut ? '<span class="val-changed">CHANGED</span>' : ''}</span>
        </div>
        <div class="pkt-field-row">
          <span class="pkt-field-name">Destination IP</span>
          <span class="pkt-field-val val-public">${isOut ? dstIP : p.privateIP} ${!isOut ? '<span class="val-changed">CHANGED</span>' : ''}</span>
        </div>
        <div class="pkt-field-row">
          <span class="pkt-field-name">Destination Port</span>
          <span class="pkt-field-val val-public">${isOut ? dstPort : p.privatePort} ${!isOut ? '<span class="val-changed">CHANGED</span>' : ''}</span>
        </div>
        <div class="pkt-field-row">
          <span class="pkt-field-name">Protocol</span>
          <span class="pkt-field-val">${p.proto} / ${dstPort === 53 ? 'UDP' : 'TCP'}</span>
        </div>
      </div>

      <div class="pkt-field-card" style="grid-column:1/-1">
        <div class="pkt-field-title">ğŸ”„ NAT Translation Entry Used</div>
        <div class="pkt-field-row">
          <span class="pkt-field-name">Private Endpoint</span>
          <span class="pkt-field-val val-private">${p.privateIP}:${p.privatePort}</span>
        </div>
        <div class="pkt-field-row">
          <span class="pkt-field-name">Public Endpoint</span>
          <span class="pkt-field-val val-nat">${ROUTER_IP}:${p.publicPort}</span>
        </div>
        <div class="pkt-field-row">
          <span class="pkt-field-name">Translation Type</span>
          <span class="pkt-field-val val-nat">PAT (Port Address Translation)</span>
        </div>
        <div class="pkt-field-row">
          <span class="pkt-field-name">What Changed</span>
          <span class="pkt-field-val">${isOut
            ? 'Source IP ' + p.privateIP + ' â†’ ' + ROUTER_IP + ' Â· Source Port ' + p.privatePort + ' â†’ ' + p.publicPort
            : 'Dest IP ' + ROUTER_IP + ':' + p.publicPort + ' â†’ ' + p.privateIP + ':' + p.privatePort
          }</span>
        </div>
      </div>
    </div>`;
}

// â”€â”€ SEND PACKETS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sendPackets(dir) {
  const srcIP   = document.getElementById('ctrl-src').value;
  const dstIP   = document.getElementById('ctrl-dst').value;
  const proto   = document.getElementById('ctrl-proto').value;
  const count   = Math.min(20, Math.max(1, parseInt(document.getElementById('ctrl-count').value)||1));

  for (let i = 0; i < count; i++) {
    setTimeout(() => emitPacket(dir, srcIP, dstIP, proto), i * 180);
  }
}

function emitPacket(dir, srcIP, dstIP, proto) {
  const privatePort = randPort();
  const nat = getNatEntry(srcIP, privatePort, dstIP, proto);

  const pkt = {
    seq: ++logSeq,
    dir, proto,
    privateIP: srcIP, privatePort,
    dstIP, dstPort: PROTO_PORTS[proto],
    publicPort: nat.publicPort,
    ts: timeStr()
  };

  packetLog.push(pkt);
  if (packetLog.length > 200) packetLog.shift();

  renderPacketLog();
  renderNatTable();
  animatePacket(dir, srcIP, dstIP);

  // Auto-inspect the latest packet
  inspectPacket(pkt.seq);
}

// â”€â”€ AUTO-GENERATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const AUTO_SRCS   = ['192.168.1.10','192.168.1.20','192.168.1.30'];
const AUTO_DSTS   = ['93.184.216.34','8.8.8.8','172.217.14.78'];
const AUTO_PROTOS = ['HTTP','HTTPS','DNS','FTP','SSH'];

function toggleAuto() {
  const btn = document.getElementById('auto-btn');
  if (autoTimer) {
    clearInterval(autoTimer);
    autoTimer = null;
    btn.textContent = 'âš¡ Auto-Generate';
    btn.classList.remove('running');
  } else {
    btn.textContent = 'â¹ Stop Auto';
    btn.classList.add('running');
    autoTimer = setInterval(() => {
      const src   = AUTO_SRCS[Math.floor(Math.random()*AUTO_SRCS.length)];
      const dst   = AUTO_DSTS[Math.floor(Math.random()*AUTO_DSTS.length)];
      const proto = AUTO_PROTOS[Math.floor(Math.random()*AUTO_PROTOS.length)];
      const dir   = Math.random() > 0.35 ? 'out' : 'in';
      emitPacket(dir, src, dst, proto);
    }, 900);
  }
}

// â”€â”€ CLEAR ALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function clearAll() {
  if (autoTimer) { clearInterval(autoTimer); autoTimer = null; document.getElementById('auto-btn').textContent='âš¡ Auto-Generate'; document.getElementById('auto-btn').classList.remove('running'); }
  natTable  = {};
  packetLog = [];
  portCounter = PORT_BASE;
  logSeq = 0;
  renderPacketLog();
  renderNatTable();
  document.getElementById('inspector-body').innerHTML = '<div class="inspect-empty">ğŸ‘† Send some packets above, then click a log entry to inspect the NAT header rewrite</div>';
  document.getElementById('inspect-proto-badge').textContent = 'Select a packet from the log';
}

// â”€â”€ SVG PACKET ANIMATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function animatePacket(dir, srcIP, dstIP) {
  const dot = document.getElementById('anim-pkt');
  const devY = DEVICES[srcIP]?.svgY || 100;
  const srvY = SERVERS[dstIP]?.svgY || 100;

  // Waypoints: client â†’ router left â†’ router right â†’ server
  const pts = dir === 'out'
    ? [ [90, devY], [390, 100], [470, 100], [675, srvY] ]
    : [ [675, srvY], [470, 100], [390, 100], [90, devY] ];

  dot.setAttribute('opacity', '1');
  dot.setAttribute('fill', dir==='out' ? '#0077aa' : '#d94f00');

  let step = 0;
  const STEPS = 30;

  function lerp(a, b, t) { return a + (b-a)*t; }

  function tick() {
    if (step > STEPS * (pts.length-1)) {
      dot.setAttribute('opacity','0');
      return;
    }
    const seg  = Math.floor(step / STEPS);
    const t    = (step % STEPS) / STEPS;
    const from = pts[Math.min(seg, pts.length-2)];
    const to   = pts[Math.min(seg+1, pts.length-1)];
    dot.setAttribute('cx', lerp(from[0], to[0], t));
    dot.setAttribute('cy', lerp(from[1], to[1], t));
    step++;
    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);
}

// â”€â”€ QUIZ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const questions = [
  {
    q: "What is the <em>primary purpose</em> of Network Address Translation (NAT)?",
    opts: [
      "Encrypt network traffic between hosts",
      "Allow multiple private IP devices to share one public IP address",
      "Assign IP addresses dynamically using DHCP",
      "Route packets between different autonomous systems"
    ],
    ans: 1,
    exp: "NAT allows many private IP devices (e.g., 192.168.x.x) to share a single public IP address, conserving the limited IPv4 address space while enabling internet access."
  },
  {
    q: "In <em>PAT (Port Address Translation)</em>, what differentiates connections from multiple private hosts sharing one public IP?",
    opts: [
      "Different public IP addresses",
      "Different VLAN tags",
      "Different source port numbers assigned by the NAT router",
      "Different TTL values in the IP header"
    ],
    ans: 2,
    exp: "PAT (also called NAT Overload) uses unique source port numbers to distinguish between sessions from different private hosts, all sharing one public IP address."
  },
  {
    q: "A host at <em>192.168.1.10:5050</em> sends a packet to 93.184.216.34:80. After PAT, what does the internet server see as the source?",
    opts: [
      "192.168.1.10:5050 â€” the original private address",
      "The router's public IP and an assigned public port (e.g., 203.0.113.1:40001)",
      "192.168.1.1:80 â€” the gateway's private IP",
      "0.0.0.0:0 â€” NAT removes the source"
    ],
    ans: 1,
    exp: "The internet server sees the NAT router's public IP (e.g., 203.0.113.1) with an assigned public port. The original private IP is hidden, replaced by the router's public endpoint."
  },
  {
    q: "Which address range is defined by <em>RFC 1918</em> as a private address space?",
    opts: [
      "172.217.0.0/16 (Google)",
      "192.0.2.0/24 (documentation)",
      "192.168.0.0/16 (home networks)",
      "100.64.0.0/10 (CGNAT)"
    ],
    ans: 2,
    exp: "RFC 1918 defines three private ranges: 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16. These are non-routable on the public internet and require NAT to reach it."
  },
  {
    q: "What does <em>DNAT (Destination NAT)</em> or port forwarding accomplish?",
    opts: [
      "It translates source IP addresses for outbound traffic",
      "It redirects incoming internet traffic to a specific internal server",
      "It compresses packet headers to save bandwidth",
      "It encrypts the destination IP address"
    ],
    ans: 1,
    exp: "DNAT rewrites the destination IP (and often port) of incoming packets, redirecting them to an internal host. This is how web servers and game servers behind NAT are made reachable from the internet."
  },
  {
    q: "An ISP assigns your home router <em>100.72.4.5</em> as its WAN IP. What type of NAT is the ISP using?",
    opts: [
      "Static NAT â€” one-to-one mapping",
      "Dynamic NAT â€” pool-based mapping",
      "CGNAT (Carrier-Grade NAT) â€” RFC 6598",
      "DNAT â€” port forwarding"
    ],
    ans: 2,
    exp: "The 100.64.0.0/10 range is defined by RFC 6598 for CGNAT (Carrier-Grade NAT). ISPs use this when they apply NAT at the provider level, giving customers non-public addresses."
  },
  {
    q: "When a web server replies to a NAT-translated request, how does the <em>NAT router know</em> which private host to forward the reply to?",
    opts: [
      "It broadcasts to all private hosts and lets them sort it out",
      "The web server includes the private IP in its response",
      "The NAT router maintains a translation table mapping public port â†’ private IP:port",
      "The TTL field decrements until it reaches the correct host"
    ],
    ans: 2,
    exp: "The NAT router maintains a stateful translation table. When the server's reply arrives at the public port, the router looks up that port in the table and rewrites the destination to the matching private IP:port."
  },
  {
    q: "Which NAT type uses a <em>fixed, permanent</em> one-to-one mapping between a private IP and a public IP?",
    opts: [
      "PAT / NAT Overload",
      "Dynamic NAT",
      "CGNAT",
      "Static NAT"
    ],
    ans: 3,
    exp: "Static NAT creates a permanent, one-to-one mapping between a private IP and a public IP. It does not conserve addresses but is used for servers that must always be reachable at the same public IP."
  }
];

let current=0, score=0, answered=0;

function renderQuestion() {
  const q = questions[current];
  document.getElementById('question-text').innerHTML = `<strong>Q${current+1}.</strong> ${q.q}`;
  document.getElementById('q-counter').textContent = `Question ${current+1} of ${questions.length}`;
  document.getElementById('quiz-progress').style.width = `${(current/questions.length)*100}%`;
  document.getElementById('next-btn').style.display = 'none';
  const fb = document.getElementById('quiz-feedback');
  fb.className = 'quiz-feedback'; fb.textContent = '';
  const container = document.getElementById('options-container');
  container.innerHTML = '';
  ['A','B','C','D'].forEach((ltr,i) => {
    if (!q.opts[i] && q.opts[i]!=='') return;
    const btn = document.createElement('div');
    btn.className = 'option';
    btn.innerHTML = `<span class="option-letter">${ltr}</span><span>${q.opts[i]}</span>`;
    btn.onclick = () => selectAnswer(i, q.ans, q.exp);
    container.appendChild(btn);
  });
}

function selectAnswer(sel, correct, exp) {
  document.querySelectorAll('.option').forEach((o,i) => {
    o.classList.add('disabled'); o.onclick = null;
    if (i===correct) o.classList.add('correct');
    else if (i===sel) o.classList.add('wrong');
  });
  answered++;
  if (sel===correct) score++;
  document.getElementById('score-display').textContent = score;
  document.getElementById('total-display').textContent = answered;
  const fb = document.getElementById('quiz-feedback');
  fb.className = `quiz-feedback show ${sel===correct?'correct':'wrong'}`;
  fb.textContent = (sel===correct ? 'âœ“ Correct! ' : 'âœ— Incorrect. ') + exp;
  document.getElementById('quiz-progress').style.width = `${((current+1)/questions.length)*100}%`;
  const nb = document.getElementById('next-btn');
  nb.textContent = current < questions.length-1 ? 'Next Question â†’' : 'ğŸ View Results';
  nb.onclick = current < questions.length-1 ? nextQuestion : showResults;
  nb.style.display = '';
}

function nextQuestion() { current++; renderQuestion(); }

function showResults() {
  const pct = Math.round((score/questions.length)*100);
  const grade = pct>=90?'Excellent! ğŸ†':pct>=70?'Good Job! ğŸ‘':pct>=50?'Keep Studying! ğŸ“š':'Review the NAT materials ğŸ”';
  document.querySelector('.quiz-body').innerHTML = `
    <div style="text-align:center;padding:30px 0">
      <div style="font-size:3.5rem;margin-bottom:16px">${pct>=80?'ğŸ‰':pct>=60?'ğŸ‘':'ğŸ“š'}</div>
      <div style="font-family:'Syne',sans-serif;font-size:2.5rem;font-weight:800;color:var(--accent);margin-bottom:8px">${pct}%</div>
      <div style="font-size:1.1rem;color:var(--text);margin-bottom:8px">${grade}</div>
      <div style="color:var(--text-muted);font-size:0.9rem;margin-bottom:28px">You scored ${score} out of ${questions.length} questions correctly.</div>
      <button class="btn btn-primary" onclick="restartQuiz()">â†º Retake Quiz</button>
    </div>`;
}

function restartQuiz() {
  current=0;score=0;answered=0;
  document.getElementById('score-display').textContent='0';
  document.getElementById('total-display').textContent='0';
  document.querySelector('.quiz-body').innerHTML=`
    <div class="progress-bar"><div class="progress-fill" id="quiz-progress" style="width:0%"></div></div>
    <div class="question-text" id="question-text"></div>
    <div class="options" id="options-container"></div>
    <div class="quiz-feedback" id="quiz-feedback"></div>
    <div class="quiz-nav">
      <div class="q-counter" id="q-counter"></div>
      <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()" style="display:none;">Next Question â†’</button>
    </div>`;
  renderQuestion();
}

renderQuestion();

// â”€â”€ SCROLL REVEAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const observer = new IntersectionObserver(entries => {
  entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
}, { threshold: 0.05 });
document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
</script>
</body>
</html>
