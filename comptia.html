<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CompTIA Certification Practice Test Generator - AI Powered</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: white;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .api-status {
            display: inline-block;
            padding: 8px 16px;
            margin-top: 10px;
            border-radius: 20px;
            font-size: 0.9em;
            background-color: rgba(255,255,255,0.2);
        }

        .api-status.connected {
            background-color: #10b981;
        }

        .api-status.disconnected {
            background-color: #dc2626;
        }

        .navigation {
            background-color: #f8f9fa;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background-color: #1e3a8a;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .nav-btn.active {
            background-color: #dc2626;
        }

        .section {
            display: none;
            background-color: white;
            padding: 30px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .selection-panel {
            margin: 20px 0;
        }

        .selection-group {
            margin: 20px 0;
        }

        .selection-group label {
            display: block;
            font-weight: bold;
            color: #1e3a8a;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        select, input[type="number"], input[type="text"], input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #3b82f6;
            border-radius: 6px;
            font-size: 1em;
            background-color: white;
            transition: border-color 0.3s ease;
        }

        select:focus, input[type="number"]:focus, input[type="text"]:focus, input[type="password"]:focus {
            outline: none;
            border-color: #1e3a8a;
        }

        .info-box {
            background-color: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .info-box h3 {
            color: #1e3a8a;
            margin-bottom: 10px;
        }

        .info-box.warning {
            background-color: #fef3c7;
            border-left-color: #f59e0b;
        }

        .info-box.success {
            background-color: #d1fae5;
            border-left-color: #10b981;
        }

        .info-box.error {
            background-color: #fee2e2;
            border-left-color: #dc2626;
        }

        .generate-btn {
            background-color: #dc2626;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.2em;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s ease;
        }

        .generate-btn:hover {
            background-color: #991b1b;
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(220, 38, 38, 0.3);
        }

        .generate-btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .question-container {
            background-color: white;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .question-header {
            background-color: #1e3a8a;
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .question-text {
            font-size: 1.1em;
            margin: 15px 0;
            color: #1f2937;
            line-height: 1.8;
        }

        .options {
            margin: 20px 0;
        }

        .option {
            background-color: #f8f9fa;
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background-color: #eff6ff;
            border-color: #3b82f6;
        }

        .option.selected {
            background-color: #dbeafe;
            border-color: #1e3a8a;
        }

        .option.correct {
            background-color: #d1fae5;
            border-color: #10b981;
        }

        .option.incorrect {
            background-color: #fee2e2;
            border-color: #dc2626;
        }

        .explanation {
            background-color: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            display: none;
        }

        .explanation.show {
            display: block;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .action-btn {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background-color: #1e3a8a;
            transform: translateY(-2px);
        }

        .action-btn.check {
            background-color: #10b981;
        }

        .action-btn.check:hover {
            background-color: #059669;
        }

        .score-display {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
            font-size: 1.3em;
        }

        .domain-info {
            background-color: #f0f9ff;
            border: 1px solid #3b82f6;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }

        .domain-info h4 {
            color: #1e3a8a;
            margin-bottom: 8px;
        }

        .progress-bar {
            background-color: #e5e7eb;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading-spinner.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        footer {
            background-color: #1f2937;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
        }

        .cert-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .cert-card {
            background-color: white;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cert-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            border-color: #1e3a8a;
        }

        .cert-card h3 {
            color: #1e3a8a;
            margin-bottom: 10px;
        }

        .cert-card p {
            color: #6b7280;
            font-size: 0.9em;
        }

        .cert-card .badge {
            display: inline-block;
            background-color: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-top: 10px;
        }

        .radio-option {
            display: block;
            margin: 8px 0;
        }

        .radio-option input[type="radio"] {
            width: auto;
            margin-right: 10px;
        }

        .api-config {
            background-color: #f8f9fa;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .api-config h3 {
            color: #1e3a8a;
            margin-bottom: 15px;
        }

        .toggle-section {
            cursor: pointer;
            user-select: none;
        }

        .collapsible-content {
            display: none;
            margin-top: 15px;
        }

        .collapsible-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .nav-buttons {
                flex-direction: column;
            }

            .nav-btn {
                width: 100%;
            }

            .cert-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>üéì CompTIA Certification Practice Test Generator</h1>
            <p>AI-Powered Dynamic Question Generation</p>
            <div class="api-status" id="apiStatus">üîå API: Not Configured</div>
        </div>
    </header>

    <div class="container">
        <div class="navigation">
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showSection('home')">üè† Home</button>
                <button class="nav-btn" onclick="showSection('select')">üìù Generate Test</button>
                <button class="nav-btn" onclick="showSection('config')">‚öôÔ∏è API Config</button>
                <button class="nav-btn" onclick="showSection('about')">‚ÑπÔ∏è About</button>
            </div>
        </div>

        <!-- Home Section -->
        <div id="home" class="section active">
            <h2 style="color: #1e3a8a; margin-bottom: 20px;">Welcome to the AI-Powered Practice Test Generator</h2>
            
            <div class="info-box success">
                <h3>üöÄ New Feature: Dynamic AI Question Generation</h3>
                <p>This practice test generator now uses AI to create unlimited, contextually-accurate practice questions tailored to your specific exam and domain!</p>
            </div>

            <div class="info-box">
                <h3>üìö Available Certifications</h3>
                <p>This comprehensive practice test generator covers 10 CompTIA certifications with AI-generated questions across all domains.</p>
            </div>

            <div class="cert-grid">
                <div class="cert-card">
                    <h3>CompTIA IT Fundamentals+ (ITF+)</h3>
                    <p><strong>Exam:</strong> FC0-U61 | <strong>Domains:</strong> 6</p>
                    <p>Foundational IT concepts for beginners</p>
                    <span class="badge">AI Enabled</span>
                </div>
                <div class="cert-card">
                    <h3>CompTIA A+ Core 1</h3>
                    <p><strong>Exam:</strong> 220-1101 | <strong>Domains:</strong> 5</p>
                    <p>Hardware, networking, and mobile devices</p>
                    <span class="badge">AI Enabled</span>
                </div>
                <div class="cert-card">
                    <h3>CompTIA A+ Core 2</h3>
                    <p><strong>Exam:</strong> 220-1102 | <strong>Domains:</strong> 4</p>
                    <p>Operating systems and security</p>
                    <span class="badge">AI Enabled</span>
                </div>
                <div class="cert-card">
                    <h3>CompTIA Network+</h3>
                    <p><strong>Exam:</strong> N10-009 | <strong>Domains:</strong> 5</p>
                    <p>Networking configuration and management</p>
                    <span class="badge">AI Enabled</span>
                </div>
                <div class="cert-card">
                    <h3>CompTIA Server+</h3>
                    <p><strong>Exam:</strong> SK0-005 | <strong>Domains:</strong> 7</p>
                    <p>Server administration and troubleshooting</p>
                    <span class="badge">AI Enabled</span>
                </div>
                <div class="cert-card">
                    <h3>CompTIA Linux+</h3>
                    <p><strong>Exam:</strong> XK0-005 | <strong>Domains:</strong> 4</p>
                    <p>Linux system management and security</p>
                    <span class="badge">AI Enabled</span>
                </div>
                <div class="cert-card">
                    <h3>CompTIA Security+</h3>
                    <p><strong>Exam:</strong> SY0-701 | <strong>Domains:</strong> 5</p>
                    <p>Cybersecurity fundamentals</p>
                    <span class="badge">AI Enabled</span>
                </div>
                <div class="cert-card">
                    <h3>CompTIA PenTest+</h3>
                    <p><strong>Exam:</strong> PT0-003 | <strong>Domains:</strong> 5</p>
                    <p>Penetration testing and vulnerability assessment</p>
                    <span class="badge">AI Enabled</span>
                </div>
                <div class="cert-card">
                    <h3>CompTIA SecAI+</h3>
                    <p><strong>Exam:</strong> CY0-001 | <strong>Domains:</strong> 4</p>
                    <p>AI security and governance (NEW!)</p>
                    <span class="badge">AI Enabled</span>
                </div>
                <div class="cert-card">
                    <h3>CompTIA Project+</h3>
                    <p><strong>Exam:</strong> PK0-005 | <strong>Domains:</strong> 4</p>
                    <p>IT project management</p>
                    <span class="badge">AI Enabled</span>
                </div>
            </div>

            <div class="info-box">
                <h3>üéØ Features</h3>
                <ul style="margin-left: 20px;">
                    <li>‚ú® <strong>AI-Generated Questions:</strong> Unlimited unique questions using OpenAI API</li>
                    <li>üéØ <strong>Domain-Specific:</strong> Questions tailored to exact exam domains</li>
                    <li>üî¢ <strong>Flexible Count:</strong> Generate 5, 10, 15, 20, or 25 questions</li>
                    <li>üìä <strong>Instant Feedback:</strong> Detailed explanations for every answer</li>
                    <li>üìà <strong>Progress Tracking:</strong> Monitor your performance in real-time</li>
                    <li>üîÑ <strong>Fallback Mode:</strong> Built-in questions if API is unavailable</li>
                </ul>
            </div>

            <button class="generate-btn" onclick="showSection('select')">Get Started ‚Üí</button>
        </div>

        <!-- API Configuration Section -->
        <div id="config" class="section">
            <h2 style="color: #1e3a8a; margin-bottom: 20px;">‚öôÔ∏è API Configuration</h2>

            <div class="info-box warning">
                <h3>üîë OpenAI API Key Required</h3>
                <p>To use AI-powered question generation, you need an OpenAI API key. Your API key is stored locally in your browser and never sent to any server except OpenAI.</p>
            </div>

            <div class="api-config">
                <h3>OpenAI API Settings</h3>
                
                <div class="selection-group">
                    <label for="apiKey">OpenAI API Key:</label>
                    <input type="password" id="apiKey" placeholder="sk-..." autocomplete="off">
                    <small style="color: #6b7280; display: block; margin-top: 5px;">
                        Get your API key from <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #3b82f6;">platform.openai.com</a>
                    </small>
                </div>

                <div class="selection-group">
                    <label for="apiModel">AI Model:</label>
                    <select id="apiModel">
                        <option value="gpt-4o-mini">GPT-4o Mini (Recommended - Fast & Cost-effective)</option>
                        <option value="gpt-4o">GPT-4o (Higher Quality)</option>
                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Budget Option)</option>
                    </select>
                </div>

                <button class="action-btn" onclick="saveAPIConfig()">üíæ Save Configuration</button>
                <button class="action-btn" onclick="testAPIConnection()">üîå Test Connection</button>
                <button class="action-btn" style="background-color: #dc2626;" onclick="clearAPIConfig()">üóëÔ∏è Clear API Key</button>
            </div>

            <div class="info-box">
                <h3>üí∞ Estimated Costs</h3>
                <p><strong>GPT-4o Mini:</strong> ~$0.001 per question (~$0.025 for 25 questions)</p>
                <p><strong>GPT-4o:</strong> ~$0.002 per question (~$0.05 for 25 questions)</p>
                <p><strong>GPT-3.5 Turbo:</strong> ~$0.0005 per question (~$0.0125 for 25 questions)</p>
                <p style="margin-top: 10px;"><em>Note: These are approximate costs. Actual costs may vary based on question complexity.</em></p>
            </div>

            <div class="info-box success">
                <h3>üîí Privacy & Security</h3>
                <ul style="margin-left: 20px;">
                    <li>Your API key is stored only in your browser's local storage</li>
                    <li>No data is sent to any server except OpenAI's API</li>
                    <li>Questions are generated on-demand and not stored</li>
                    <li>You maintain full control over your API usage</li>
                </ul>
            </div>
        </div>

        <!-- Test Selection Section -->
        <div id="select" class="section">
            <h2 style="color: #1e3a8a; margin-bottom: 20px;">Configure Your Practice Test</h2>

            <div class="selection-panel">
                <div class="selection-group">
                    <label for="examSelect">1Ô∏è‚É£ Select Certification Exam:</label>
                    <select id="examSelect" onchange="updateDomains()">
                        <option value="">-- Choose an Exam --</option>
                        <option value="itf">CompTIA IT Fundamentals+ (ITF+) - FC0-U61</option>
                        <option value="acore1">CompTIA A+ Core 1 - 220-1101</option>
                        <option value="acore2">CompTIA A+ Core 2 - 220-1102</option>
                        <option value="network">CompTIA Network+ - N10-009</option>
                        <option value="server">CompTIA Server+ - SK0-005</option>
                        <option value="linux">CompTIA Linux+ - XK0-005</option>
                        <option value="security">CompTIA Security+ - SY0-701</option>
                        <option value="pentest">CompTIA PenTest+ - PT0-003</option>
                        <option value="secai">CompTIA SecAI+ - CY0-001</option>
                        <option value="project">CompTIA Project+ - PK0-005</option>
                    </select>
                </div>

                <div id="domainSection" style="display: none;">
                    <div class="selection-group">
                        <label for="domainSelect">2Ô∏è‚É£ Select Domain:</label>
                        <select id="domainSelect" onchange="showDomainInfo()">
                            <option value="">-- Choose a Domain --</option>
                        </select>
                    </div>

                    <div id="domainInfo" class="domain-info" style="display: none;">
                        <h4>Domain Information</h4>
                        <p id="domainDescription"></p>
                    </div>
                </div>

                <div id="questionSection" style="display: none;">
                    <div class="selection-group">
                        <label for="questionCount">3Ô∏è‚É£ Number of Questions:</label>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <label class="radio-option">
                                <input type="radio" name="questionCount" value="5" checked> 5 Questions
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="questionCount" value="10"> 10 Questions
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="questionCount" value="15"> 15 Questions
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="questionCount" value="20"> 20 Questions
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="questionCount" value="25"> 25 Questions
                            </label>
                        </div>
                    </div>

                    <div class="info-box" id="generationInfo">
                        <h3>‚ú® AI Generation Mode</h3>
                        <p id="generationModeText">Configure your API key in the API Config section to enable AI-powered question generation.</p>
                    </div>

                    <button class="generate-btn" onclick="generateTest()" id="generateButton">üöÄ Generate Practice Test</button>
                </div>
            </div>
        </div>

        <!-- Test Display Section -->
        <div id="test" class="section">
            <h2 style="color: #1e3a8a; margin-bottom: 20px;" id="testTitle">Practice Test</h2>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%">0%</div>
            </div>

            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
                <p style="color: #1e3a8a; font-size: 1.2em;">ü§ñ AI is generating your custom questions...</p>
                <p style="color: #6b7280;">This may take 10-30 seconds depending on the number of questions.</p>
            </div>

            <div id="questionsContainer"></div>

            <div class="action-buttons" id="testActions" style="display: none;">
                <button class="action-btn check" onclick="checkAnswers()">‚úì Check Answers</button>
                <button class="action-btn" onclick="showSection('select')">‚Üê New Test</button>
                <button class="action-btn" onclick="resetTest()">üîÑ Reset</button>
            </div>

            <div id="scoreDisplay" class="score-display" style="display: none;">
                <h3>Your Score: <span id="scoreText"></span></h3>
                <p id="scoreFeedback"></p>
            </div>
        </div>

        <!-- About Section -->
        <div id="about" class="section">
            <h2 style="color: #1e3a8a; margin-bottom: 20px;">About This Practice Test Generator</h2>
            
            <div class="info-box">
                <h3>Purpose</h3>
                <p>This AI-powered practice test generator helps students prepare for CompTIA certification exams by providing unlimited, contextually-accurate practice questions across all exam domains.</p>
            </div>

            <div class="info-box success">
                <h3>What's New? üéâ</h3>
                <ul style="margin-left: 20px;">
                    <li><strong>AI-Powered Generation:</strong> Uses OpenAI's GPT models to create exam-specific questions</li>
                    <li><strong>Unlimited Questions:</strong> Generate as many practice tests as you need</li>
                    <li><strong>Domain-Focused:</strong> Questions are tailored to specific exam domains and objectives</li>
                    <li><strong>Detailed Explanations:</strong> Each question includes comprehensive explanations</li>
                    <li><strong>Fallback Support:</strong> Built-in question bank when API is unavailable</li>
                </ul>
            </div>

            <div class="info-box">
                <h3>How to Use</h3>
                <ol style="margin-left: 20px;">
                    <li><strong>Configure API:</strong> Go to API Config and enter your OpenAI API key</li>
                    <li><strong>Select Exam:</strong> Choose your target certification exam</li>
                    <li><strong>Choose Domain:</strong> Select the specific domain you want to practice</li>
                    <li><strong>Set Quantity:</strong> Choose how many questions (5-25)</li>
                    <li><strong>Generate Test:</strong> Click "Generate Practice Test" and wait for AI to create questions</li>
                    <li><strong>Take Test:</strong> Answer all questions</li>
                    <li><strong>Review:</strong> Click "Check Answers" for immediate feedback and explanations</li>
                </ol>
            </div>

            <div class="info-box">
                <h3>Study Tips</h3>
                <ul style="margin-left: 20px;">
                    <li>Start with smaller question sets (5-10) to build confidence</li>
                    <li>Focus on one domain at a time for comprehensive coverage</li>
                    <li>Review explanations carefully, even for correct answers</li>
                    <li>Generate multiple tests for the same domain to see different question variations</li>
                    <li>Take notes on concepts you find challenging</li>
                    <li>Use this tool alongside official CompTIA study materials</li>
                </ul>
            </div>

            <div class="info-box warning">
                <h3>‚ö†Ô∏è Important Notes</h3>
                <ul style="margin-left: 20px;">
                    <li>This is a study tool and not affiliated with CompTIA</li>
                    <li>AI-generated questions are designed to match exam style but may not reflect actual exam questions</li>
                    <li>Always refer to official CompTIA exam objectives and study materials</li>
                    <li>API costs are your responsibility - monitor your OpenAI usage</li>
                </ul>
            </div>

            <div class="info-box">
                <h3>Developer Information</h3>
                <p><strong>Created by:</strong> Professor John Doe<br>
                <strong>Institution:</strong> Moraine Valley Community College<br>
                <strong>Purpose:</strong> Educational Resource for CompTIA Certification Students<br>
                <strong>Version:</strong> 2.0 (2026) - AI Enhanced</p>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2026 CompTIA Practice Test Generator | Educational Use Only</p>
        <p>CompTIA¬Æ is a registered trademark of CompTIA, Inc. | Powered by OpenAI</p>
    </footer>

    <script>
        // Comprehensive exam data structure
        const examData = {
            itf: {
                name: "CompTIA IT Fundamentals+ (ITF+)",
                exam: "FC0-U61",
                domains: {
                    "d1": {
                        name: "IT Concepts and Terminology (17%)",
                        description: "Covers basic computing concepts, data representation, and fundamental IT tools",
                        topics: "Binary, hexadecimal, decimal, data representation (ASCII, Unicode), data types (char, strings, numbers, boolean), units of measure (bits, bytes, MHz, GHz)"
                    },
                    "d2": {
                        name: "Infrastructure (22%)",
                        description: "Hardware, operating systems, and network connectivity fundamentals",
                        topics: "Computer hardware components, motherboards, CPUs, RAM, storage devices, peripheral devices, networking basics, TCP/IP, OSI model"
                    },
                    "d3": {
                        name: "Applications and Software (18%)",
                        description: "Software installation, configuration, and troubleshooting",
                        topics: "Operating systems, productivity software, collaboration software, software licensing, installation methods, software troubleshooting"
                    },
                    "d4": {
                        name: "Software Development (12%)",
                        description: "Programming concepts, development environments, and methodologies",
                        topics: "Programming language categories, interpreted vs compiled, logic components, loops, conditional statements, variables, functions"
                    },
                    "d5": {
                        name: "Database Fundamentals (11%)",
                        description: "Database concepts, structures, and basic management",
                        topics: "Database concepts, relational databases, SQL basics, tables, records, fields, primary keys, queries, database management"
                    },
                    "d6": {
                        name: "Security (20%)",
                        description: "Security principles, threats, and best practices for data protection",
                        topics: "Confidentiality, integrity, availability (CIA), authentication methods, encryption, malware types, social engineering, security best practices"
                    }
                }
            },
            acore1: {
                name: "CompTIA A+ Core 1",
                exam: "220-1101",
                domains: {
                    "d1": {
                        name: "Mobile Devices (15%)",
                        description: "Laptop hardware, mobile device types, and device setup",
                        topics: "Laptop hardware components, display types, mobile device connectivity, touchscreen technology, mobile device accessories, synchronization"
                    },
                    "d2": {
                        name: "Networking (20%)",
                        description: "TCP/IP, networking hardware, and wireless technologies",
                        topics: "OSI model, TCP vs UDP, ports and protocols, IPv4 and IPv6, DHCP, DNS, VLANs, network types (LAN, WAN, PAN, MAN), wireless standards (802.11)"
                    },
                    "d3": {
                        name: "Hardware (25%)",
                        description: "PC components, peripherals, and power supplies",
                        topics: "Motherboards, CPUs, RAM types (DDR3, DDR4, DDR5), storage devices (HDD, SSD, NVMe), power supplies, cooling systems, expansion cards"
                    },
                    "d4": {
                        name: "Virtualization and Cloud Computing (11%)",
                        description: "Cloud concepts and virtualization technologies",
                        topics: "Cloud service models (IaaS, PaaS, SaaS), cloud deployment models, hypervisors (Type 1, Type 2), virtual machines, resource requirements"
                    },
                    "d5": {
                        name: "Hardware and Network Troubleshooting (29%)",
                        description: "Troubleshooting methodology and common hardware issues",
                        topics: "CompTIA troubleshooting methodology, POST errors, BSOD, boot failures, hardware diagnostics, network connectivity issues, printer problems"
                    }
                }
            },
            acore2: {
                name: "CompTIA A+ Core 2",
                exam: "220-1102",
                domains: {
                    "d1": {
                        name: "Operating Systems (31%)",
                        description: "Windows, macOS, Linux installation and configuration",
                        topics: "Windows editions, installation methods, command-line tools, Control Panel utilities, system settings, macOS features, Linux basics"
                    },
                    "d2": {
                        name: "Security (25%)",
                        description: "Security measures, encryption, and access controls",
                        topics: "Physical security, logical security, malware prevention, social engineering, authentication methods, encryption, access control lists, security best practices"
                    },
                    "d3": {
                        name: "Software Troubleshooting (22%)",
                        description: "OS troubleshooting and application issues",
                        topics: "Windows troubleshooting, boot issues, application crashes, performance problems, malware removal, mobile OS issues"
                    },
                    "d4": {
                        name: "Operational Procedures (22%)",
                        description: "Safety procedures, documentation, and change management",
                        topics: "Safety procedures, environmental impacts, communication techniques, professionalism, ticketing systems, change management, backup procedures, disaster recovery"
                    }
                }
            },
            network: {
                name: "CompTIA Network+",
                exam: "N10-009",
                domains: {
                    "d1": {
                        name: "Networking Fundamentals (24%)",
                        description: "OSI model, network topologies, and cabling standards",
                        topics: "OSI model layers, TCP/IP model, network topologies (star, mesh, ring), cabling standards (Cat5e, Cat6, fiber), network devices"
                    },
                    "d2": {
                        name: "Network Implementations (19%)",
                        description: "Devices, virtualization, and infrastructure",
                        topics: "Routers, switches, firewalls, wireless access points, VLANs, network segmentation, virtualization, WAN technologies"
                    },
                    "d3": {
                        name: "Network Operations (16%)",
                        description: "Monitoring, documentation, and business continuity",
                        topics: "Network monitoring tools, documentation types, baseline configuration, change management, business continuity, disaster recovery"
                    },
                    "d4": {
                        name: "Network Security (19%)",
                        description: "Security concepts, tools, and secure architecture",
                        topics: "Common threats, authentication methods, ACLs, firewalls, VPN, wireless security (WPA2, WPA3), network hardening"
                    },
                    "d5": {
                        name: "Network Troubleshooting (22%)",
                        description: "Troubleshooting methodology and common network issues",
                        topics: "Troubleshooting methodology, connectivity issues, performance problems, network tools (ping, traceroute, nslookup), cable testing"
                    }
                }
            },
            server: {
                name: "CompTIA Server+",
                exam: "SK0-005",
                domains: {
                    "d1": {
                        name: "Server Architecture (12%)",
                        description: "Server form factors and components",
                        topics: "Rack mount, tower, blade servers, server components, power supplies, redundancy, hot-swappable components"
                    },
                    "d2": {
                        name: "Server Administration (24%)",
                        description: "Server management and configuration",
                        topics: "Server roles, Active Directory, DNS, DHCP, file services, print services, web services, virtualization management"
                    },
                    "d3": {
                        name: "Storage (12%)",
                        description: "Storage technologies and RAID configurations",
                        topics: "RAID levels (0, 1, 5, 6, 10), SAN, NAS, DAS, hot spare, storage protocols (iSCSI, Fibre Channel)"
                    },
                    "d4": {
                        name: "Security (13%)",
                        description: "Server security measures and best practices",
                        topics: "Physical security, access controls, patch management, hardening, encryption, certificate management, security policies"
                    },
                    "d5": {
                        name: "Networking (10%)",
                        description: "Network protocols and server connectivity",
                        topics: "Network protocols, VLANs, load balancing, network bonding, IPv4/IPv6, DNS, DHCP"
                    },
                    "d6": {
                        name: "Disaster Recovery (9%)",
                        description: "Backup, recovery, and business continuity",
                        topics: "Backup types (full, incremental, differential), backup media, disaster recovery plans, RTO, RPO, high availability"
                    },
                    "d7": {
                        name: "Troubleshooting (20%)",
                        description: "Server troubleshooting methodology",
                        topics: "Troubleshooting methodology, hardware diagnostics, log analysis, performance monitoring, common server issues"
                    }
                }
            },
            linux: {
                name: "CompTIA Linux+",
                exam: "XK0-005",
                domains: {
                    "d1": {
                        name: "System Management (32%)",
                        description: "Linux fundamentals, file management, and software configuration",
                        topics: "Linux filesystem hierarchy, file permissions, package management (apt, yum), system services, user management, process management"
                    },
                    "d2": {
                        name: "Security (21%)",
                        description: "Identity management, firewalls, and access controls",
                        topics: "User authentication, sudo, SELinux, AppArmor, firewall configuration (iptables, firewalld), SSH, encryption"
                    },
                    "d3": {
                        name: "Scripting, Containers, and Automation (19%)",
                        description: "Bash scripting, Git, and container operations",
                        topics: "Bash scripting, shell commands, version control (Git), container concepts, Docker basics, automation tools"
                    },
                    "d4": {
                        name: "Troubleshooting (28%)",
                        description: "Performance issues, security problems, and system diagnostics",
                        topics: "System logs, troubleshooting tools, performance monitoring, network troubleshooting, boot issues, hardware diagnostics"
                    }
                }
            },
            security: {
                name: "CompTIA Security+",
                exam: "SY0-701",
                domains: {
                    "d1": {
                        name: "General Security Concepts (12%)",
                        description: "CIA triad, zero trust, and security controls",
                        topics: "Confidentiality, integrity, availability, non-repudiation, authentication, authorization, accounting, zero trust architecture, security controls"
                    },
                    "d2": {
                        name: "Threats, Vulnerabilities, and Mitigations (22%)",
                        description: "Threat actors, attack vectors, and mitigation techniques",
                        topics: "Threat actors, social engineering, malware types, application attacks, network attacks, cryptographic attacks, vulnerability management, mitigation strategies"
                    },
                    "d3": {
                        name: "Security Architecture (18%)",
                        description: "Secure network design and infrastructure security",
                        topics: "Network security architecture, segmentation, VPNs, zero trust, cloud security, secure protocols, cryptography implementation"
                    },
                    "d4": {
                        name: "Security Operations (28%)",
                        description: "Security tools, incident response, and digital forensics",
                        topics: "Security monitoring, SIEM, IDS/IPS, incident response, digital forensics, vulnerability scanning, penetration testing"
                    },
                    "d5": {
                        name: "Security Program Management and Oversight (20%)",
                        description: "Governance, risk management, and compliance",
                        topics: "Security governance, risk management, compliance requirements, security awareness training, vendor management, data protection"
                    }
                }
            },
            pentest: {
                name: "CompTIA PenTest+",
                exam: "PT0-003",
                domains: {
                    "d1": {
                        name: "Planning and Scoping (14%)",
                        description: "Engagement planning and ethical considerations",
                        topics: "Rules of engagement, scope definition, legal considerations, compliance requirements, target identification, authorization"
                    },
                    "d2": {
                        name: "Information Gathering and Vulnerability Scanning (22%)",
                        description: "Reconnaissance and vulnerability identification",
                        topics: "Passive reconnaissance, active reconnaissance, OSINT, scanning techniques, vulnerability assessment, enumeration"
                    },
                    "d3": {
                        name: "Attacks and Exploits (30%)",
                        description: "Social engineering, network attacks, and exploitation",
                        topics: "Social engineering attacks, network-based attacks, wireless attacks, application-based attacks, exploit techniques, privilege escalation, persistence"
                    },
                    "d4": {
                        name: "Reporting and Communication (18%)",
                        description: "Documentation and remediation recommendations",
                        topics: "Report writing, vulnerability documentation, risk scoring, remediation recommendations, executive summaries, technical details"
                    },
                    "d5": {
                        name: "Tools and Code Analysis (16%)",
                        description: "Penetration testing tools and script analysis",
                        topics: "Reconnaissance tools, scanning tools, exploitation frameworks, network tools, web application tools, scripting, code analysis"
                    }
                }
            },
            secai: {
                name: "CompTIA SecAI+",
                exam: "CY0-001",
                domains: {
                    "d1": {
                        name: "Basic AI Concepts Related to Cybersecurity (17%)",
                        description: "AI fundamentals, machine learning, and LLMs",
                        topics: "AI types (generative, discriminative), machine learning concepts, deep learning, neural networks, transformers, LLMs, AI lifecycle"
                    },
                    "d2": {
                        name: "Securing AI Systems (40%)",
                        description: "AI security controls, data protection, and model security",
                        topics: "AI-specific threats, adversarial attacks, data poisoning, model theft, prompt injection, AI system hardening, secure AI deployment, monitoring"
                    },
                    "d3": {
                        name: "AI-Assisted Security (24%)",
                        description: "Using AI for threat detection and automation",
                        topics: "AI in threat detection, anomaly detection, automated response, AI-enhanced SIEM, threat hunting with AI, security orchestration"
                    },
                    "d4": {
                        name: "AI Governance, Risk, and Compliance (19%)",
                        description: "AI regulations, ethical considerations, and compliance",
                        topics: "AI regulations (EU AI Act, NIST AI RMF), ethical AI, bias in AI, AI risk management, compliance frameworks, responsible AI practices"
                    }
                }
            },
            project: {
                name: "CompTIA Project+",
                exam: "PK0-005",
                domains: {
                    "d1": {
                        name: "Project Management Concepts (33%)",
                        description: "Project characteristics, methodologies, and stakeholder management",
                        topics: "Project characteristics, Agile vs Waterfall, SDLC, Scrum, project constraints, stakeholder management, resource management"
                    },
                    "d2": {
                        name: "Project Life Cycle Phases (30%)",
                        description: "Initiation, planning, execution, and closure phases",
                        topics: "Project initiation, planning activities, work breakdown structure, scheduling, execution monitoring, change management, project closure"
                    },
                    "d3": {
                        name: "Tools and Documentation (19%)",
                        description: "Project tools, scheduling, and documentation",
                        topics: "Project management software, Gantt charts, network diagrams, documentation types, communication plans, status reports"
                    },
                    "d4": {
                        name: "Basics of IT and Governance (18%)",
                        description: "IT concepts, regulatory compliance, and governance",
                        topics: "IT infrastructure basics, cloud concepts, security considerations, regulatory requirements, governance structures, compliance"
                    }
                }
            }
        };

        // Fallback question bank (same as before, abbreviated for space)
        const questionBank = {
            itf: {
                d1: [
                    {
                        question: "Which number system uses base-16 and includes digits 0-9 and letters A-F?",
                        options: ["Binary", "Decimal", "Hexadecimal", "Octal"],
                        correct: 2,
                        explanation: "Hexadecimal is a base-16 number system that uses digits 0-9 and letters A-F to represent values. It's commonly used in computing for representing binary data in a more compact form."
                    },
                    {
                        question: "What does ASCII stand for in data representation?",
                        options: ["American Standard Code for Information Interchange", "Advanced System Code for International Integration", "Automated Standard Character Identification Index", "Application Specific Code for Internet Integration"],
                        correct: 0,
                        explanation: "ASCII (American Standard Code for Information Interchange) is a character encoding standard used to represent text in computers and communication equipment."
                    }
                ]
            }
            // Additional fallback questions would go here...
        };

        // Global variables
        let currentExam = '';
        let currentDomain = '';
        let currentQuestions = [];
        let userAnswers = [];
        let testGenerated = false;
        let apiKey = '';
        let apiModel = 'gpt-4o-mini';

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAPIConfig();
            updateAPIStatus();
            console.log('CompTIA Practice Test Generator Loaded - AI Enhanced');
        });

        // API Configuration Functions
        function loadAPIConfig() {
            const savedKey = localStorage.getItem('openai_api_key');
            const savedModel = localStorage.getItem('openai_model');
            
            if (savedKey) {
                apiKey = savedKey;
                document.getElementById('apiKey').value = savedKey;
            }
            
            if (savedModel) {
                apiModel = savedModel;
                document.getElementById('apiModel').value = savedModel;
            }
            
            updateAPIStatus();
        }

        function saveAPIConfig() {
            const keyInput = document.getElementById('apiKey').value.trim();
            const modelSelect = document.getElementById('apiModel').value;
            
            if (!keyInput) {
                alert('Please enter an API key.');
                return;
            }
            
            if (!keyInput.startsWith('sk-')) {
                alert('Invalid API key format. OpenAI API keys start with "sk-"');
                return;
            }
            
            apiKey = keyInput;
            apiModel = modelSelect;
            
            localStorage.setItem('openai_api_key', apiKey);
            localStorage.setItem('openai_model', apiModel);
            
            updateAPIStatus();
            alert('‚úÖ API configuration saved successfully!');
        }

        function clearAPIConfig() {
            if (confirm('Are you sure you want to clear your API key?')) {
                localStorage.removeItem('openai_api_key');
                localStorage.removeItem('openai_model');
                apiKey = '';
                document.getElementById('apiKey').value = '';
                updateAPIStatus();
                alert('API key cleared.');
            }
        }

        function updateAPIStatus() {
            const statusElement = document.getElementById('apiStatus');
            const generationInfo = document.getElementById('generationInfo');
            const generationText = document.getElementById('generationModeText');
            
            if (apiKey) {
                statusElement.textContent = '‚úÖ API: Connected';
                statusElement.className = 'api-status connected';
                if (generationInfo) {
                    generationInfo.className = 'info-box success';
                    generationText.textContent = `AI-powered question generation enabled using ${apiModel}. Your questions will be generated dynamically based on the selected exam and domain.`;
                }
            } else {
                statusElement.textContent = '‚ùå API: Not Configured';
                statusElement.className = 'api-status disconnected';
                if (generationInfo) {
                    generationInfo.className = 'info-box warning';
                    generationText.textContent = 'Configure your API key in the API Config section to enable AI-powered question generation. Fallback questions will be used otherwise.';
                }
            }
        }

        async function testAPIConnection() {
            if (!apiKey) {
                alert('Please enter an API key first.');
                return;
            }
            
            const button = event.target;
            button.disabled = true;
            button.textContent = 'üîÑ Testing...';
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: apiModel,
                        messages: [{
                            role: 'user',
                            content: 'Test connection. Respond with "OK".'
                        }],
                        max_tokens: 10
                    })
                });
                
                if (response.ok) {
                    alert('‚úÖ API connection successful!');
                } else {
                    const error = await response.json();
                    alert(`‚ùå API connection failed: ${error.error?.message || 'Unknown error'}`);
                }
            } catch (error) {
                alert(`‚ùå API connection failed: ${error.message}`);
            } finally {
                button.disabled = false;
                button.textContent = 'üîå Test Connection';
            }
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Update domains based on selected exam
        function updateDomains() {
            const examSelect = document.getElementById('examSelect');
            const domainSelect = document.getElementById('domainSelect');
            const domainSection = document.getElementById('domainSection');
            const questionSection = document.getElementById('questionSection');
            
            currentExam = examSelect.value;
            
            if (currentExam) {
                domainSection.style.display = 'block';
                domainSelect.innerHTML = '<option value="">-- Choose a Domain --</option>';
                
                const domains = examData[currentExam].domains;
                for (let key in domains) {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = domains[key].name;
                    domainSelect.appendChild(option);
                }
            } else {
                domainSection.style.display = 'none';
                questionSection.style.display = 'none';
            }
            
            document.getElementById('domainInfo').style.display = 'none';
        }

        // Show domain information
        function showDomainInfo() {
            const domainSelect = document.getElementById('domainSelect');
            currentDomain = domainSelect.value;
            
            if (currentDomain) {
                const domainInfo = examData[currentExam].domains[currentDomain];
                document.getElementById('domainDescription').textContent = domainInfo.description;
                document.getElementById('domainInfo').style.display = 'block';
                document.getElementById('questionSection').style.display = 'block';
                updateAPIStatus();
            } else {
                document.getElementById('domainInfo').style.display = 'none';
                document.getElementById('questionSection').style.display = 'none';
            }
        }

        // Generate practice test with AI
        async function generateTest() {
            const questionCount = parseInt(document.querySelector('input[name="questionCount"]:checked').value);
            
            // Show loading
            showSection('test');
            document.getElementById('loadingSpinner').classList.add('active');
            document.getElementById('questionsContainer').innerHTML = '';
            document.getElementById('testActions').style.display = 'none';
            
            try {
                if (apiKey) {
                    // Generate questions using AI
                    currentQuestions = await generateQuestionsWithAI(questionCount);
                } else {
                    // Use fallback questions
                    currentQuestions = getFallbackQuestions(questionCount);
                }
                
                userAnswers = new Array(questionCount).fill(null);
                
                // Display test
                displayTest();
                testGenerated = true;
            } catch (error) {
                console.error('Error generating test:', error);
                alert('Error generating questions. Using fallback questions instead.');
                currentQuestions = getFallbackQuestions(questionCount);
                userAnswers = new Array(questionCount).fill(null);
                displayTest();
                testGenerated = true;
            } finally {
                document.getElementById('loadingSpinner').classList.remove('active');
                document.getElementById('testActions').style.display = 'flex';
            }
        }

        // Generate questions using OpenAI API
        async function generateQuestionsWithAI(count) {
            const examInfo = examData[currentExam];
            const domainInfo = examInfo.domains[currentDomain];
            
            const prompt = `Generate ${count} multiple-choice practice questions for the ${examInfo.name} (${examInfo.exam}) certification exam, specifically for the domain: ${domainInfo.name}.

Domain description: ${domainInfo.description}
Key topics to cover: ${domainInfo.topics}

Requirements:
1. Each question must have exactly 4 answer choices (A, B, C, D)
2. Only ONE answer should be correct
3. Questions should be at the appropriate difficulty level for this certification
4. Include realistic distractors (incorrect answers that seem plausible)
5. Provide a detailed explanation for why the correct answer is right

Format your response as a JSON array with this exact structure:
[
  {
    "question": "Question text here?",
    "options": ["Option A", "Option B", "Option C", "Option D"],
    "correct": 0,
    "explanation": "Detailed explanation of why this answer is correct and others are wrong."
  }
]

Return ONLY the JSON array, no other text.`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: apiModel,
                    messages: [{
                        role: 'system',
                        content: 'You are an expert CompTIA certification instructor who creates high-quality practice exam questions. Always respond with valid JSON only.'
                    }, {
                        role: 'user',
                        content: prompt
                    }],
                    temperature: 0.7,
                    max_tokens: 3000
                })
            });

            if (!response.ok) {
                throw new Error(`API request failed: ${response.status}`);
            }

            const data = await response.json();
            const content = data.choices[0].message.content;
            
            // Parse JSON response
            let questions;
            try {
                // Remove markdown code blocks if present
                const jsonMatch = content.match(/\[[\s\S]*\]/);
                if (jsonMatch) {
                    questions = JSON.parse(jsonMatch[0]);
                } else {
                    questions = JSON.parse(content);
                }
            } catch (parseError) {
                console.error('JSON parse error:', parseError);
                throw new Error('Failed to parse AI response');
            }

            return questions;
        }

        // Get fallback questions
        function getFallbackQuestions(count) {
            let availableQuestions = [];
            
            if (questionBank[currentExam] && questionBank[currentExam][currentDomain]) {
                availableQuestions = questionBank[currentExam][currentDomain];
            }
            
            // Generate synthetic questions if needed
            while (availableQuestions.length < count) {
                availableQuestions.push(generateSyntheticQuestion(currentExam, currentDomain));
            }
            
            return shuffleArray(availableQuestions).slice(0, count);
        }

        // Generate synthetic question (fallback)
        function generateSyntheticQuestion(exam, domain) {
            const examInfo = examData[exam];
            const domainInfo = examInfo.domains[domain];
            
            return {
                question: `Which of the following best describes a key concept in ${domainInfo.name}?`,
                options: [
                    "Implementation of security controls and best practices",
                    "Configuration and management of system resources",
                    "Analysis and troubleshooting of technical issues",
                    "Planning and documentation of procedures"
                ],
                correct: Math.floor(Math.random() * 4),
                explanation: `This question relates to ${domainInfo.description}. Review the official CompTIA exam objectives for detailed coverage of this topic.`
            };
        }

        // Display test questions
        function displayTest() {
            const examInfo = examData[currentExam];
            const domainInfo = examInfo.domains[currentDomain];
            
            document.getElementById('testTitle').textContent = 
                `${examInfo.name} - ${domainInfo.name}`;
            
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            
            currentQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-container';
                questionDiv.innerHTML = `
                    <div class="question-header">
                        <span>Question ${index + 1} of ${currentQuestions.length}</span>
                        <span>${examInfo.exam}</span>
                    </div>
                    <div class="question-text">${q.question}</div>
                    <div class="options" id="options-${index}">
                        ${q.options.map((opt, optIndex) => `
                            <div class="option" onclick="selectAnswer(${index}, ${optIndex})">
                                ${String.fromCharCode(65 + optIndex)}. ${opt}
                            </div>
                        `).join('')}
                    </div>
                    <div class="explanation" id="explanation-${index}">
                        <strong>Explanation:</strong> ${q.explanation}
                    </div>
                `;
                container.appendChild(questionDiv);
            });
            
            document.getElementById('scoreDisplay').style.display = 'none';
            updateProgress();
        }

        // Select answer
        function selectAnswer(questionIndex, optionIndex) {
            if (!testGenerated) return;
            
            userAnswers[questionIndex] = optionIndex;
            
            const optionsDiv = document.getElementById(`options-${questionIndex}`);
            const options = optionsDiv.querySelectorAll('.option');
            
            options.forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                }
            });
            
            updateProgress();
        }

        // Update progress bar
        function updateProgress() {
            const answered = userAnswers.filter(a => a !== null).length;
            const total = currentQuestions.length;
            const percentage = (answered / total) * 100;
            
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percentage + '%';
            progressBar.textContent = Math.round(percentage) + '%';
        }

        // Check answers
        function checkAnswers() {
            let correct = 0;
            
            currentQuestions.forEach((q, index) => {
                const optionsDiv = document.getElementById(`options-${index}`);
                const options = optionsDiv.querySelectorAll('.option');
                const explanation = document.getElementById(`explanation-${index}`);
                
                options.forEach((opt, optIndex) => {
                    opt.onclick = null;
                    
                    if (optIndex === q.correct) {
                        opt.classList.add('correct');
                    }
                    if (userAnswers[index] === optIndex && optIndex !== q.correct) {
                        opt.classList.add('incorrect');
                    }
                });
                
                if (userAnswers[index] === q.correct) {
                    correct++;
                }
                
                explanation.classList.add('show');
            });
            
            const percentage = (correct / currentQuestions.length) * 100;
            const scoreDisplay = document.getElementById('scoreDisplay');
            const scoreText = document.getElementById('scoreText');
            const scoreFeedback = document.getElementById('scoreFeedback');
            
            scoreText.textContent = `${correct} / ${currentQuestions.length} (${percentage.toFixed(1)}%)`;
            
            if (percentage >= 90) {
                scoreFeedback.textContent = "üåü Excellent! You're well-prepared for this domain!";
            } else if (percentage >= 80) {
                scoreFeedback.textContent = "üëç Great job! Review the missed questions to improve further.";
            } else if (percentage >= 70) {
                scoreFeedback.textContent = "‚úì Good effort! Focus on areas where you missed questions.";
            } else {
                scoreFeedback.textContent = "üìö Keep studying! Review the domain objectives and try again.";
            }
            
            scoreDisplay.style.display = 'block';
            testGenerated = false;
        }

        // Reset test
        function resetTest() {
            userAnswers = new Array(currentQuestions.length).fill(null);
            displayTest();
            testGenerated = true;
        }

        // Utility function to shuffle array
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
    </script>
</body>
</html>
