<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spanning Tree Protocol (STP) ‚Äî Interactive Learning Module</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=IBM+Plex+Mono:wght@400;600&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #0a3d62;
    --accent: #e84118;
    --gold: #f9a825;
    --teal: #00897b;
    --light-blue: #e8f4fd;
    --bg: #ffffff;
    --surface: #f8f9fa;
    --border: #dee2e6;
    --text: #1a1a2e;
    --muted: #6c757d;
    --success: #2e7d32;
    --warning: #f57c00;
    --code-bg: #1e2a3a;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.7;
  }

  /* ‚îÄ‚îÄ TOP NAV ‚îÄ‚îÄ */
  #topnav {
    background: var(--primary);
    color: white;
    padding: 0 2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 2px 12px rgba(0,0,0,.25);
    min-height: 60px;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  #topnav .logo {
    font-family: 'DM Serif Display', serif;
    font-size: 1.3rem;
    letter-spacing: .5px;
    display: flex;
    align-items: center;
    gap: .6rem;
  }
  #topnav .logo span { color: var(--gold); }
  #topnav nav { display: flex; gap: 0.25rem; flex-wrap: wrap; }
  #topnav nav button {
    background: transparent;
    border: none;
    color: rgba(255,255,255,.78);
    font-family: 'Nunito', sans-serif;
    font-size: .82rem;
    font-weight: 700;
    cursor: pointer;
    padding: .4rem .75rem;
    border-radius: 20px;
    transition: all .2s;
    letter-spacing: .3px;
  }
  #topnav nav button:hover, #topnav nav button.active {
    background: rgba(255,255,255,.18);
    color: #fff;
  }

  /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
  #hero {
    background: linear-gradient(135deg, var(--primary) 0%, #1a5276 60%, #0d6efd22 100%);
    color: white;
    padding: 4rem 2rem 3rem;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  #hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.04'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  }
  #hero h1 {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(2rem, 5vw, 3.2rem);
    margin-bottom: .5rem;
    position: relative;
  }
  #hero h1 em { color: var(--gold); font-style: normal; }
  #hero .subtitle {
    font-size: 1.05rem;
    opacity: .85;
    max-width: 620px;
    margin: 0 auto 1.5rem;
    position: relative;
  }
  .badge-row { display: flex; gap: .75rem; justify-content: center; flex-wrap: wrap; position: relative; }
  .badge {
    background: rgba(255,255,255,.15);
    border: 1px solid rgba(255,255,255,.3);
    border-radius: 20px;
    padding: .35rem 1rem;
    font-size: .8rem;
    font-weight: 700;
    letter-spacing: .5px;
  }

  /* ‚îÄ‚îÄ SECTIONS ‚îÄ‚îÄ */
  .section { display: none; padding: 2.5rem 2rem; max-width: 1100px; margin: 0 auto; }
  .section.active { display: block; animation: fadeIn .35s ease; }
  @keyframes fadeIn { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:translateY(0); } }

  .section-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 3px solid var(--primary);
  }
  .section-header .icon {
    width: 52px; height: 52px;
    background: var(--primary);
    color: white;
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.5rem;
    flex-shrink: 0;
  }
  .section-header h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 1.9rem;
    color: var(--primary);
  }
  .section-header p { color: var(--muted); font-size: .95rem; margin-top: .2rem; }

  /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
  .card {
    background: white;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.25rem;
    box-shadow: 0 2px 8px rgba(0,0,0,.06);
    transition: box-shadow .2s;
  }
  .card:hover { box-shadow: 0 4px 16px rgba(0,0,0,.12); }
  .card h3 {
    font-size: 1.1rem;
    color: var(--primary);
    margin-bottom: .75rem;
    display: flex;
    align-items: center;
    gap: .5rem;
  }
  .card p, .card li { font-size: .95rem; color: #333; }
  .card ul { padding-left: 1.4rem; }
  .card ul li { margin-bottom: .35rem; }

  .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.25rem; }
  .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.25rem; }

  /* ‚îÄ‚îÄ INFO BOX ‚îÄ‚îÄ */
  .info-box {
    background: var(--light-blue);
    border-left: 5px solid var(--primary);
    border-radius: 0 10px 10px 0;
    padding: 1rem 1.25rem;
    margin: 1.25rem 0;
    font-size: .95rem;
  }
  .info-box.warning { background: #fff8e1; border-color: var(--warning); }
  .info-box.success { background: #e8f5e9; border-color: var(--success); }
  .info-box.danger  { background: #fce4ec; border-color: var(--accent); }
  .info-box strong { display: block; margin-bottom: .3rem; }

  /* ‚îÄ‚îÄ PORT STATES DIAGRAM ‚îÄ‚îÄ */
  .port-flow {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    gap: 0;
    margin: 2rem 0;
  }
  .port-state {
    text-align: center;
    padding: 1rem 1.25rem;
    border-radius: 10px;
    min-width: 110px;
    font-weight: 800;
    font-size: .85rem;
    letter-spacing: .5px;
    position: relative;
    cursor: default;
    transition: transform .15s;
  }
  .port-state:hover { transform: scale(1.05); }
  .ps-blocking  { background: #ffcdd2; color: #b71c1c; border: 2px solid #e53935; }
  .ps-listening { background: #fff9c4; color: #f57f17; border: 2px solid #fbc02d; }
  .ps-learning  { background: #c8e6c9; color: #1b5e20; border: 2px solid #43a047; }
  .ps-forwarding{ background: #bbdefb; color: #0d47a1; border: 2px solid #1976d2; }
  .ps-disabled  { background: #e0e0e0; color: #616161; border: 2px solid #9e9e9e; }
  .ps-arrow {
    font-size: 1.4rem;
    color: var(--muted);
    padding: 0 .5rem;
    display: flex;
    align-items: center;
  }
  .ps-timer { font-size: .7rem; font-weight: 600; opacity: .75; margin-top: .3rem; }

  /* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
  .tbl-wrap { overflow-x: auto; margin: 1rem 0; }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: .9rem;
  }
  thead th {
    background: var(--primary);
    color: white;
    padding: .7rem 1rem;
    text-align: left;
    font-weight: 700;
  }
  tbody tr:nth-child(even) { background: var(--surface); }
  tbody td { padding: .6rem 1rem; border-bottom: 1px solid var(--border); }

  /* ‚îÄ‚îÄ BPDU HEADER BUILDER ‚îÄ‚îÄ */
  #header-builder {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 2rem;
    margin-top: 1.5rem;
  }
  #header-builder h3 {
    font-family: 'DM Serif Display', serif;
    font-size: 1.5rem;
    color: var(--primary);
    margin-bottom: .5rem;
  }
  .field-row {
    display: grid;
    grid-template-columns: 180px 1fr 90px;
    align-items: center;
    gap: .75rem;
    padding: .6rem 0;
    border-bottom: 1px dashed var(--border);
  }
  .field-row:last-child { border-bottom: none; }
  .field-row label { font-weight: 700; font-size: .85rem; color: var(--primary); }
  .field-row input, .field-row select {
    font-family: 'IBM Plex Mono', monospace;
    font-size: .88rem;
    padding: .45rem .75rem;
    border: 2px solid var(--border);
    border-radius: 8px;
    background: white;
    width: 100%;
    transition: border-color .2s;
  }
  .field-row input:focus, .field-row select:focus {
    border-color: var(--primary);
    outline: none;
  }
  .field-bits {
    font-family: 'IBM Plex Mono', monospace;
    font-size: .75rem;
    color: var(--muted);
    text-align: right;
  }
  #bpdu-preview {
    margin-top: 1.5rem;
    background: var(--code-bg);
    color: #a8d8a8;
    border-radius: 10px;
    padding: 1.25rem 1.5rem;
    font-family: 'IBM Plex Mono', monospace;
    font-size: .82rem;
    line-height: 1.8;
    overflow-x: auto;
  }
  #bpdu-preview .field-label { color: #7ecfff; }
  #bpdu-preview .field-val   { color: #f5c542; }
  #bpdu-preview .field-hex   { color: #a8d8a8; }
  .btn-build {
    margin-top: 1.25rem;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    padding: .7rem 2rem;
    font-family: 'Nunito', sans-serif;
    font-weight: 800;
    font-size: .95rem;
    cursor: pointer;
    transition: background .2s;
    margin-right: .75rem;
  }
  .btn-build:hover { background: #1a5276; }
  .btn-reset {
    background: white;
    color: var(--primary);
    border: 2px solid var(--primary);
    border-radius: 8px;
    padding: .65rem 1.5rem;
    font-family: 'Nunito', sans-serif;
    font-weight: 800;
    font-size: .95rem;
    cursor: pointer;
    transition: all .2s;
  }
  .btn-reset:hover { background: var(--light-blue); }

  /* ‚îÄ‚îÄ VISUAL BPDU FRAME ‚îÄ‚îÄ */
  .bpdu-visual {
    display: flex;
    flex-wrap: wrap;
    gap: 3px;
    margin: 1.5rem 0;
  }
  .bpdu-field {
    text-align: center;
    border-radius: 6px;
    padding: .4rem .5rem;
    font-size: .72rem;
    font-weight: 700;
    cursor: pointer;
    transition: transform .15s;
    position: relative;
  }
  .bpdu-field:hover { transform: scale(1.08); z-index: 2; }
  .bpdu-field .field-name { display: block; }
  .bpdu-field .field-size { font-weight: 400; font-size: .65rem; opacity: .8; }
  .bf1 { background: #e3f2fd; border: 2px solid #1976d2; color: #0d47a1; }
  .bf2 { background: #fce4ec; border: 2px solid #e91e63; color: #880e4f; }
  .bf3 { background: #e8f5e9; border: 2px solid #43a047; color: #1b5e20; }
  .bf4 { background: #fff8e1; border: 2px solid #fbc02d; color: #e65100; }
  .bf5 { background: #f3e5f5; border: 2px solid #8e24aa; color: #4a148c; }
  .bf6 { background: #e0f7fa; border: 2px solid #00acc1; color: #006064; }
  .bf7 { background: #fff3e0; border: 2px solid #fb8c00; color: #bf360c; }
  .bf8 { background: #f9fbe7; border: 2px solid #c0ca33; color: #33691e; }

  /* ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ */
  .quiz-card {
    background: white;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,.06);
  }
  .quiz-card .q-num {
    font-size: .75rem;
    font-weight: 800;
    color: var(--accent);
    letter-spacing: 1px;
    margin-bottom: .5rem;
  }
  .quiz-card .q-text {
    font-size: 1rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: var(--text);
  }
  .opt-btn {
    display: block;
    width: 100%;
    text-align: left;
    background: var(--surface);
    border: 2px solid var(--border);
    border-radius: 8px;
    padding: .65rem 1rem;
    margin-bottom: .5rem;
    cursor: pointer;
    font-family: 'Nunito', sans-serif;
    font-size: .9rem;
    transition: all .18s;
  }
  .opt-btn:hover:not(:disabled) { border-color: var(--primary); background: var(--light-blue); }
  .opt-btn.correct { background: #e8f5e9; border-color: #43a047; color: #1b5e20; font-weight: 700; }
  .opt-btn.incorrect { background: #fce4ec; border-color: #e91e63; color: #880e4f; }
  .q-feedback {
    margin-top: .75rem;
    padding: .75rem 1rem;
    border-radius: 8px;
    font-size: .9rem;
    display: none;
  }
  .q-feedback.show { display: block; }
  .q-feedback.correct { background: #e8f5e9; color: #2e7d32; }
  .q-feedback.incorrect { background: #fce4ec; color: #c62828; }
  #quiz-score {
    background: var(--primary);
    color: white;
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
    font-size: 1.2rem;
    font-weight: 700;
    display: none;
    margin-top: 1rem;
  }
  #quiz-score .big { font-size: 2.5rem; font-family: 'DM Serif Display', serif; }

  /* ‚îÄ‚îÄ STP ANIMATION ‚îÄ‚îÄ */
  #stp-canvas-wrap {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1rem;
    margin: 1.5rem 0;
    text-align: center;
  }
  #stp-canvas { max-width: 100%; }
  .canvas-controls { display: flex; gap: .75rem; justify-content: center; flex-wrap: wrap; margin-top: 1rem; }
  .ctrl-btn {
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    padding: .55rem 1.25rem;
    font-family: 'Nunito', sans-serif;
    font-weight: 700;
    cursor: pointer;
    font-size: .88rem;
    transition: background .2s;
  }
  .ctrl-btn:hover { background: #1a5276; }
  .ctrl-btn.secondary { background: white; color: var(--primary); border: 2px solid var(--primary); }
  .ctrl-btn.secondary:hover { background: var(--light-blue); }
  #sim-log {
    background: var(--code-bg);
    color: #a8d8a8;
    border-radius: 10px;
    padding: 1rem 1.25rem;
    font-family: 'IBM Plex Mono', monospace;
    font-size: .8rem;
    line-height: 1.7;
    max-height: 180px;
    overflow-y: auto;
    margin-top: 1rem;
  }

  /* ‚îÄ‚îÄ TERM GLOSSARY ‚îÄ‚îÄ */
  .term-card {
    border-left: 4px solid var(--teal);
    background: white;
    border-radius: 0 10px 10px 0;
    padding: 1rem 1.25rem;
    margin-bottom: .9rem;
    box-shadow: 0 1px 4px rgba(0,0,0,.05);
  }
  .term-card .term { font-weight: 800; color: var(--primary); font-size: 1rem; }
  .term-card .abbr { font-family: 'IBM Plex Mono', monospace; font-size: .8rem; color: var(--accent); margin-left: .4rem; }
  .term-card .def  { font-size: .92rem; color: #333; margin-top: .35rem; }

  /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
  @media(max-width: 640px) {
    .field-row { grid-template-columns: 1fr; }
    .field-bits { text-align: left; }
    .port-flow { gap: .5rem; }
    .ps-arrow { display: none; }
  }

  /* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
  #progress-bar {
    height: 4px;
    background: var(--gold);
    width: 0%;
    transition: width .4s;
    position: fixed;
    top: 60px;
    left: 0;
    z-index: 999;
  }

  /* ‚îÄ‚îÄ TAG PILLS ‚îÄ‚îÄ */
  .tag { display: inline-block; padding: .2rem .65rem; border-radius: 20px; font-size: .73rem; font-weight: 700; letter-spacing: .4px; margin: .15rem; }
  .tag-blue   { background: #e3f2fd; color: #1565c0; }
  .tag-green  { background: #e8f5e9; color: #2e7d32; }
  .tag-red    { background: #fce4ec; color: #c62828; }
  .tag-orange { background: #fff3e0; color: #e65100; }

  /* ‚îÄ‚îÄ HIGHLIGHT BOX ‚îÄ‚îÄ */
  .highlight-box {
    background: linear-gradient(135deg, var(--primary), #1a5276);
    color: white;
    border-radius: 12px;
    padding: 1.5rem;
    margin: 1.5rem 0;
    text-align: center;
  }
  .highlight-box h3 { font-family: 'DM Serif Display', serif; font-size: 1.5rem; margin-bottom: .5rem; }
  .highlight-box p { opacity: .88; font-size: .95rem; }
</style>
</head>
<body>

<!-- TOP NAV -->
<nav id="topnav">
  <div class="logo">üå≥ <span>STP</span> Interactive Lesson</div>
  <nav>
    <button class="active" onclick="showSection('overview', this)">üìñ Overview</button>
    <button onclick="showSection('concepts', this)">üß† Concepts</button>
    <button onclick="showSection('election', this)">üó≥Ô∏è Root Election</button>
    <button onclick="showSection('portstates', this)">üîÑ Port States</button>
    <button onclick="showSection('bpdu', this)">üì¶ BPDU</button>
    <button onclick="showSection('builder', this)">üîß Header Builder</button>
    <button onclick="showSection('simulator', this)">üñ•Ô∏è Simulator</button>
    <button onclick="showSection('glossary', this)">üìö Glossary</button>
    <button onclick="showSection('quiz', this)">‚ùì Quiz</button>
  </nav>
</nav>
<div id="progress-bar"></div>

<!-- HERO -->
<header id="hero">
  <h1>Spanning Tree Protocol<br><em>(STP)</em> Mastery</h1>
  <p class="subtitle">A comprehensive interactive lesson for network administration students. Master STP concepts, BPDU structure, port states, and root bridge elections.</p>
  <div class="badge-row">
    <div class="badge">IEEE 802.1D</div>
    <div class="badge">Layer 2 Switching</div>
    <div class="badge">Loop Prevention</div>
    <div class="badge">RSTP ¬∑ PVST ¬∑ MSTP</div>
    <div class="badge">CompTIA Network+</div>
  </div>
</header>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê OVERVIEW -->
<section id="overview" class="section active">
  <div class="section-header">
    <div class="icon">üìñ</div>
    <div>
      <h2>What is Spanning Tree Protocol?</h2>
      <p>Understanding the purpose and history of STP</p>
    </div>
  </div>

  <div class="info-box">
    <strong>üéØ Learning Objectives</strong>
    After this module you will be able to: define STP and explain why it exists, describe the problems loops cause in Ethernet networks, identify STP variants (STP, RSTP, PVST+, MSTP), and relate STP to the OSI Data Link layer.
  </div>

  <div class="grid-2">
    <div class="card">
      <h3>üåê The Loop Problem</h3>
      <p>Ethernet networks use <strong>switches</strong> to connect devices. When switches are connected in a redundant topology (multiple paths between switches), a <strong>Layer 2 loop</strong> can form. This causes:</p>
      <ul style="margin-top:.6rem">
        <li><strong>Broadcast storms</strong> ‚Äî frames replicate endlessly</li>
        <li><strong>MAC table instability</strong> ‚Äî switches learn incorrect ports</li>
        <li><strong>Multiple frame delivery</strong> ‚Äî hosts receive duplicates</li>
        <li><strong>Network collapse</strong> ‚Äî 100% bandwidth consumed instantly</li>
      </ul>
    </div>
    <div class="card">
      <h3>üõ°Ô∏è STP Solution</h3>
      <p>STP (IEEE 802.1D, 1990) solves the loop problem by logically blocking redundant links while maintaining physical redundancy. It:</p>
      <ul style="margin-top:.6rem">
        <li>Elects a single <strong>Root Bridge</strong> as topology reference</li>
        <li>Calculates the <strong>best path</strong> to root from each switch</li>
        <li>Places redundant links in <strong>Blocking</strong> state</li>
        <li>Automatically <strong>reconverges</strong> when topology changes</li>
      </ul>
    </div>
  </div>

  <div class="highlight-box">
    <h3>OSI Layer 2 ‚Äî Data Link</h3>
    <p>STP operates at the <strong>Data Link Layer (Layer 2)</strong> of the OSI model. It uses <strong>BPDU (Bridge Protocol Data Unit)</strong> frames with a destination MAC of <code>01:80:C2:00:00:00</code> (STP multicast) to communicate between switches.</p>
  </div>

  <div class="card">
    <h3>üìú STP Variants Timeline</h3>
    <div class="tbl-wrap">
      <table>
        <thead><tr><th>Standard</th><th>Full Name</th><th>Year</th><th>Convergence</th><th>Key Feature</th></tr></thead>
        <tbody>
          <tr><td><span class="tag tag-blue">802.1D</span></td><td>Original STP</td><td>1990</td><td>30‚Äì50 sec</td><td>Loop prevention baseline</td></tr>
          <tr><td><span class="tag tag-green">PVST+</span></td><td>Per-VLAN STP Plus</td><td>Cisco</td><td>30‚Äì50 sec</td><td>Instance per VLAN (Cisco)</td></tr>
          <tr><td><span class="tag tag-orange">802.1w</span></td><td>Rapid STP (RSTP)</td><td>2001</td><td>1‚Äì6 sec</td><td>New port roles, rapid convergence</td></tr>
          <tr><td><span class="tag tag-red">802.1s</span></td><td>Multiple STP (MSTP)</td><td>2002</td><td>1‚Äì6 sec</td><td>Maps multiple VLANs to instances</td></tr>
          <tr><td><span class="tag tag-blue">Rapid PVST+</span></td><td>Rapid Per-VLAN STP</td><td>Cisco</td><td>1‚Äì6 sec</td><td>RSTP + per-VLAN (Cisco default)</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="info-box success">
    <strong>üí° Industry Note</strong>
    Modern Cisco switches run <strong>Rapid PVST+</strong> by default. While original STP is less common today, its concepts are foundational for all variants and are tested on CompTIA Network+, CCNA, and CISSP examinations.
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONCEPTS -->
<section id="concepts" class="section">
  <div class="section-header">
    <div class="icon">üß†</div>
    <div>
      <h2>Core STP Concepts</h2>
      <p>Key terminology and operational principles</p>
    </div>
  </div>

  <div class="grid-3">
    <div class="card" style="border-top: 4px solid var(--primary)">
      <h3>üëë Bridge ID (BID)</h3>
      <p>Every switch has a unique <strong>Bridge ID</strong> consisting of:</p>
      <ul style="margin-top:.5rem">
        <li><strong>Priority</strong>: 2 bytes (default 32768)</li>
        <li><strong>Extended System ID</strong>: VLAN number (optional)</li>
        <li><strong>MAC Address</strong>: 6 bytes (tie-breaker)</li>
      </ul>
      <div style="margin-top:.75rem; font-family:'IBM Plex Mono',monospace; font-size:.8rem; background:var(--surface); padding:.5rem .75rem; border-radius:6px; color:var(--primary)">
        BID = Priority (32768) + MAC<br>e.g., 32768:00:1A:2B:3C:4D:5E
      </div>
    </div>

    <div class="card" style="border-top: 4px solid var(--teal)">
      <h3>üå≥ Root Bridge</h3>
      <p>The switch with the <strong>lowest BID</strong> becomes the Root Bridge ‚Äî the reference point for the entire spanning tree topology. All paths are calculated relative to it.</p>
      <div class="info-box" style="margin-top:.75rem; font-size:.85rem">
        <strong>Best practice:</strong> Manually assign the Root Bridge to a high-performance, centrally located core switch using a lower priority (4096 or 8192).
      </div>
    </div>

    <div class="card" style="border-top: 4px solid var(--gold)">
      <h3>üí∞ Path Cost</h3>
      <p>STP calculates the <strong>best path to the root</strong> based on cumulative port costs. Lower cost = preferred path.</p>
      <div class="tbl-wrap" style="margin-top:.6rem">
        <table>
          <thead><tr><th>Speed</th><th>Cost (IEEE)</th></tr></thead>
          <tbody>
            <tr><td>10 Mbps</td><td>100</td></tr>
            <tr><td>100 Mbps</td><td>19</td></tr>
            <tr><td>1 Gbps</td><td>4</td></tr>
            <tr><td>10 Gbps</td><td>2</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="grid-2" style="margin-top:1rem">
    <div class="card">
      <h3>üîå Port Roles</h3>
      <ul>
        <li><strong>Root Port (RP)</strong> ‚Äî Best path toward root bridge (one per non-root switch)</li>
        <li><strong>Designated Port (DP)</strong> ‚Äî Best port on each segment toward root (forwards traffic)</li>
        <li><strong>Non-Designated / Blocked Port</strong> ‚Äî Redundant port placed in Blocking state</li>
        <li style="color:var(--teal)"><em>RSTP adds:</em> <strong>Alternate</strong> and <strong>Backup</strong> ports</li>
      </ul>
    </div>
    <div class="card">
      <h3>‚è±Ô∏è STP Timers</h3>
      <ul>
        <li><strong>Hello Time</strong> ‚Äî 2 sec: How often Root sends BPDUs</li>
        <li><strong>Forward Delay</strong> ‚Äî 15 sec: Time in Listening and Learning states</li>
        <li><strong>Max Age</strong> ‚Äî 20 sec: How long to store BPDU info before discarding</li>
      </ul>
      <div class="info-box warning" style="margin-top:.75rem; font-size:.85rem">
        <strong>‚ö†Ô∏è Convergence Time:</strong> STP convergence can take up to <strong>50 seconds</strong> (20 + 15 + 15) ‚Äî a major drawback addressed by RSTP.
      </div>
    </div>
  </div>

  <div class="card">
    <h3>üîí STP Enhancements & Security Features</h3>
    <div class="grid-2" style="gap:.75rem; margin-top:.5rem">
      <div>
        <p><span class="tag tag-blue">PortFast</span> Bypasses Listening/Learning on access ports (connected to end devices). Instantly moves to Forwarding.</p>
        <p style="margin-top:.5rem"><span class="tag tag-green">BPDU Guard</span> Disables a PortFast-enabled port if a BPDU is received ‚Äî prevents unauthorized switch connections.</p>
      </div>
      <div>
        <p><span class="tag tag-orange">Root Guard</span> Prevents external switches from becoming root bridge on a protected port.</p>
        <p style="margin-top:.5rem"><span class="tag tag-red">Loop Guard</span> Prevents Alternate/Root ports from becoming Designated if BPDUs stop arriving (prevents unidirectional link loops).</p>
      </div>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ROOT ELECTION -->
<section id="election" class="section">
  <div class="section-header">
    <div class="icon">üó≥Ô∏è</div>
    <div>
      <h2>Root Bridge Election Process</h2>
      <p>Step-by-step walk-through of how STP selects the Root Bridge</p>
    </div>
  </div>

  <div class="info-box">
    <strong>üìã Election Rules (in order of precedence)</strong>
    1. Lowest Bridge Priority ‚Üí 2. Lowest Bridge MAC Address (tie-breaker)
  </div>

  <!-- Interactive Priority Calculator -->
  <div id="header-builder" style="margin-bottom:2rem">
    <h3>üî¢ Bridge ID Calculator</h3>
    <p style="font-size:.9rem; color:var(--muted); margin-bottom:1.25rem">Enter switch parameters to compute Bridge IDs and determine the Root Bridge winner.</p>

    <div id="switches-container">
      <!-- Switches added dynamically -->
    </div>
    <div style="margin-top:1rem; display:flex; gap:.75rem; flex-wrap:wrap">
      <button class="btn-build" onclick="addSwitch()">+ Add Switch</button>
      <button class="btn-reset" onclick="electRoot()">‚ö° Run Election</button>
      <button class="btn-reset" onclick="resetElection()">‚Ü∫ Reset</button>
    </div>
    <div id="election-result" style="display:none; margin-top:1.5rem"></div>
  </div>

  <div class="card">
    <h3>üìê Root Port Selection (After Root Election)</h3>
    <p>On each <em>non-root</em> switch, the port with the <strong>lowest Root Path Cost</strong> becomes the Root Port. Ties are broken by:</p>
    <ol style="padding-left:1.4rem; margin-top:.6rem">
      <li style="margin-bottom:.35rem">Lowest <strong>Sender Bridge ID</strong></li>
      <li style="margin-bottom:.35rem">Lowest <strong>Sender Port ID</strong></li>
      <li>Lowest <strong>Receiving Port ID</strong></li>
    </ol>
  </div>

  <div class="card">
    <h3>üèÜ Designated Port Selection</h3>
    <p>For each network segment, the port with the <strong>lowest Root Path Cost</strong> on that segment becomes the Designated Port. If costs are equal, the switch with the lower BID wins. All Root Bridge ports are automatically Designated.</p>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PORT STATES -->
<section id="portstates" class="section">
  <div class="section-header">
    <div class="icon">üîÑ</div>
    <div>
      <h2>STP Port States</h2>
      <p>Understanding how ports transition through STP states</p>
    </div>
  </div>

  <div class="port-flow">
    <div class="port-state ps-disabled">
      <span>DISABLED</span>
      <div class="ps-timer">Admin off</div>
    </div>
    <div class="ps-arrow">‚Üí</div>
    <div class="port-state ps-blocking">
      <span>BLOCKING</span>
      <div class="ps-timer">Max Age (20s)</div>
    </div>
    <div class="ps-arrow">‚Üí</div>
    <div class="port-state ps-listening">
      <span>LISTENING</span>
      <div class="ps-timer">Fwd Delay (15s)</div>
    </div>
    <div class="ps-arrow">‚Üí</div>
    <div class="port-state ps-learning">
      <span>LEARNING</span>
      <div class="ps-timer">Fwd Delay (15s)</div>
    </div>
    <div class="ps-arrow">‚Üí</div>
    <div class="port-state ps-forwarding">
      <span>FORWARDING</span>
      <div class="ps-timer">Active ‚úì</div>
    </div>
  </div>

  <div class="card">
    <h3>üìä Port State Comparison Table</h3>
    <div class="tbl-wrap">
      <table>
        <thead><tr><th>State</th><th>Receives BPDUs</th><th>Sends BPDUs</th><th>Learns MACs</th><th>Forwards Data</th><th>Duration</th></tr></thead>
        <tbody>
          <tr><td><span class="tag tag-red">Disabled</span></td><td>No</td><td>No</td><td>No</td><td>No</td><td>Until enabled</td></tr>
          <tr><td><span class="tag tag-red">Blocking</span></td><td>Yes ‚úì</td><td>No</td><td>No</td><td>No</td><td>Max Age (20s)</td></tr>
          <tr><td><span class="tag tag-orange">Listening</span></td><td>Yes ‚úì</td><td>Yes ‚úì</td><td>No</td><td>No</td><td>Fwd Delay (15s)</td></tr>
          <tr><td><span class="tag tag-green">Learning</span></td><td>Yes ‚úì</td><td>Yes ‚úì</td><td>Yes ‚úì</td><td>No</td><td>Fwd Delay (15s)</td></tr>
          <tr><td><span class="tag tag-blue">Forwarding</span></td><td>Yes ‚úì</td><td>Yes ‚úì</td><td>Yes ‚úì</td><td>Yes ‚úì</td><td>Normal operation</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="grid-2" style="margin-top:1rem">
    <div class="card" style="border-left:4px solid #43a047">
      <h3>‚ö° RSTP Port States (Simplified)</h3>
      <p>RSTP (802.1w) reduces states to just 3:</p>
      <ul style="margin-top:.5rem">
        <li><span class="tag tag-red">Discarding</span> ‚Äî Combines Disabled + Blocking + Listening</li>
        <li><span class="tag tag-green">Learning</span> ‚Äî Same as STP Learning</li>
        <li><span class="tag tag-blue">Forwarding</span> ‚Äî Same as STP Forwarding</li>
      </ul>
    </div>
    <div class="card" style="border-left:4px solid var(--teal)">
      <h3>üîå RSTP Port Roles</h3>
      <ul>
        <li><strong>Root Port</strong> ‚Äî Best path to root</li>
        <li><strong>Designated Port</strong> ‚Äî Best port on segment</li>
        <li><strong>Alternate Port</strong> ‚Äî Backup to Root Port</li>
        <li><strong>Backup Port</strong> ‚Äî Backup Designated Port</li>
      </ul>
      <p style="margin-top:.6rem; font-size:.85rem; color:var(--teal)">RSTP achieves rapid convergence through <strong>proposal/agreement</strong> handshake mechanism.</p>
    </div>
  </div>

  <!-- Interactive Port State Toggle -->
  <div id="header-builder" style="margin-top:2rem">
    <h3>üéÆ Interactive Port State Explorer</h3>
    <p style="font-size:.9rem; color:var(--muted); margin-bottom:1.25rem">Click any port state to learn what happens at that stage.</p>
    <div style="display:flex; gap:1rem; flex-wrap:wrap; justify-content:center">
      <button class="ctrl-btn" onclick="showPortInfo('blocking')">Blocking</button>
      <button class="ctrl-btn" onclick="showPortInfo('listening')">Listening</button>
      <button class="ctrl-btn" onclick="showPortInfo('learning')">Learning</button>
      <button class="ctrl-btn" onclick="showPortInfo('forwarding')">Forwarding</button>
      <button class="ctrl-btn" onclick="showPortInfo('disabled')">Disabled</button>
    </div>
    <div id="port-info-box" style="margin-top:1.25rem; display:none; padding:1.25rem; background:white; border-radius:10px; border:2px solid var(--primary)">
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BPDU -->
<section id="bpdu" class="section">
  <div class="section-header">
    <div class="icon">üì¶</div>
    <div>
      <h2>Bridge Protocol Data Unit (BPDU)</h2>
      <p>Anatomy of the STP control message</p>
    </div>
  </div>

  <div class="info-box">
    <strong>üì° What is a BPDU?</strong>
    BPDUs are special Layer 2 frames exchanged by switches every <strong>Hello Time interval (2 seconds)</strong> to share STP topology information. They are sent to the STP multicast address <code>01:80:C2:00:00:00</code>.
  </div>

  <div class="card">
    <h3>üé® BPDU Frame Visual Map</h3>
    <p style="font-size:.88rem; color:var(--muted); margin-bottom:1rem">Each colored block represents a field. Hover for details. Width is proportional to byte length.</p>
    <div class="bpdu-visual" id="bpdu-visual"></div>
  </div>

  <div class="card">
    <h3>üìã Configuration BPDU Fields</h3>
    <div class="tbl-wrap">
      <table>
        <thead><tr><th>Field</th><th>Size</th><th>Value / Description</th></tr></thead>
        <tbody>
          <tr><td>Protocol Identifier</td><td>2 bytes</td><td>Always 0x0000 (Spanning Tree Protocol)</td></tr>
          <tr><td>Protocol Version</td><td>1 byte</td><td>0x00 = STP, 0x02 = RSTP, 0x03 = MSTP</td></tr>
          <tr><td>BPDU Type</td><td>1 byte</td><td>0x00 = Config, 0x80 = TCN (Topology Change Notification)</td></tr>
          <tr><td>Flags</td><td>1 byte</td><td>TC bit (bit 0), TCA bit (bit 7); RSTP adds bits 1‚Äì6</td></tr>
          <tr><td>Root Bridge ID</td><td>8 bytes</td><td>Priority + Extended SysID + MAC of Root Bridge</td></tr>
          <tr><td>Root Path Cost</td><td>4 bytes</td><td>Cumulative cost from sender to Root Bridge</td></tr>
          <tr><td>Bridge ID</td><td>8 bytes</td><td>Sender's own Bridge ID</td></tr>
          <tr><td>Port ID</td><td>2 bytes</td><td>Sender's port priority + port number</td></tr>
          <tr><td>Message Age</td><td>2 bytes</td><td>Hops from Root Bridge (in 1/256 sec increments)</td></tr>
          <tr><td>Max Age</td><td>2 bytes</td><td>Maximum age for stored BPDU info (default 20s)</td></tr>
          <tr><td>Hello Time</td><td>2 bytes</td><td>Hello interval (default 2s)</td></tr>
          <tr><td>Forward Delay</td><td>2 bytes</td><td>Listening/Learning duration (default 15s)</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="grid-2" style="margin-top:1rem">
    <div class="card">
      <h3>üö© BPDU Types</h3>
      <ul>
        <li><strong>Configuration BPDU</strong> ‚Äî Sent by Root Bridge every Hello Time; propagated by all switches. Contains full topology info (35 bytes).</li>
        <li style="margin-top:.5rem"><strong>TCN BPDU</strong> (Topology Change Notification) ‚Äî Sent toward Root when a topology change is detected (1 byte payload).</li>
        <li style="margin-top:.5rem"><strong>RST BPDU</strong> ‚Äî Used by RSTP; combines config and TCN into single message type.</li>
      </ul>
    </div>
    <div class="card">
      <h3>üè≥Ô∏è Flags Byte Breakdown</h3>
      <div style="font-family:'IBM Plex Mono',monospace; font-size:.82rem; background:var(--surface); padding:.75rem; border-radius:8px; margin-top:.5rem">
        <div style="display:flex; gap:.3rem; flex-wrap:wrap">
          <span style="background:#b71c1c;color:white;padding:.2rem .4rem;border-radius:4px">Bit 7<br>TCA</span>
          <span style="background:#0d47a1;color:white;padding:.2rem .4rem;border-radius:4px">Bit 6<br>Agr</span>
          <span style="background:#1b5e20;color:white;padding:.2rem .4rem;border-radius:4px">Bit 5<br>Fwd</span>
          <span style="background:#4a148c;color:white;padding:.2rem .4rem;border-radius:4px">Bit 4<br>Lrn</span>
          <span style="background:#e65100;color:white;padding:.2rem .4rem;border-radius:4px">Bit 3<br>Role</span>
          <span style="background:#006064;color:white;padding:.2rem .4rem;border-radius:4px">Bit 2<br>Role</span>
          <span style="background:#33691e;color:white;padding:.2rem .4rem;border-radius:4px">Bit 1<br>Prop</span>
          <span style="background:#bf360c;color:white;padding:.2rem .4rem;border-radius:4px">Bit 0<br>TC</span>
        </div>
        <p style="margin-top:.6rem; font-size:.78rem; color:var(--muted)">TC=Topology Change, TCA=TC Ack, Agr=Agreement, Fwd=Forwarding, Lrn=Learning, Prop=Proposal (RSTP bits 1-6)</p>
      </div>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER BUILDER -->
<section id="builder" class="section">
  <div class="section-header">
    <div class="icon">üîß</div>
    <div>
      <h2>STP BPDU Header Builder</h2>
      <p>Construct a complete BPDU frame field by field</p>
    </div>
  </div>

  <div class="info-box">
    <strong>üõ†Ô∏è Instructions</strong>
    Fill in each field below using the valid values described. Click <em>Build BPDU</em> to generate the hexadecimal representation of your BPDU frame. This mirrors what a real switch would transmit.
  </div>

  <div id="header-builder">
    <h3>üîß BPDU Frame Constructor</h3>
    <p style="font-size:.88rem;color:var(--muted);margin-bottom:1.5rem">IEEE 802.1D Configuration BPDU ‚Äî 35 bytes total</p>

    <div class="field-row">
      <label>Protocol ID</label>
      <select id="f-proto">
        <option value="0000">0x0000 ‚Äî Spanning Tree Protocol</option>
      </select>
      <span class="field-bits">2 bytes</span>
    </div>
    <div class="field-row">
      <label>Protocol Version</label>
      <select id="f-version">
        <option value="00">0x00 ‚Äî STP (802.1D)</option>
        <option value="02">0x02 ‚Äî RSTP (802.1w)</option>
        <option value="03">0x03 ‚Äî MSTP (802.1s)</option>
      </select>
      <span class="field-bits">1 byte</span>
    </div>
    <div class="field-row">
      <label>BPDU Type</label>
      <select id="f-type">
        <option value="00">0x00 ‚Äî Configuration BPDU</option>
        <option value="80">0x80 ‚Äî TCN BPDU</option>
        <option value="02">0x02 ‚Äî RST/MST BPDU</option>
      </select>
      <span class="field-bits">1 byte</span>
    </div>
    <div class="field-row">
      <label>Flags</label>
      <select id="f-flags">
        <option value="00">0x00 ‚Äî No flags</option>
        <option value="01">0x01 ‚Äî Topology Change (TC)</option>
        <option value="80">0x80 ‚Äî TC Acknowledgment (TCA)</option>
        <option value="81">0x81 ‚Äî TC + TCA</option>
      </select>
      <span class="field-bits">1 byte</span>
    </div>
    <div class="field-row">
      <label>Root Priority</label>
      <select id="f-root-pri">
        <option value="8000">32768 (Default)</option>
        <option value="1000">4096</option>
        <option value="2000">8192</option>
        <option value="6000">24576</option>
        <option value="F000">61440</option>
      </select>
      <span class="field-bits">2 bytes</span>
    </div>
    <div class="field-row">
      <label>Root Bridge MAC</label>
      <input type="text" id="f-root-mac" value="00:1A:2B:3C:4D:5E" placeholder="XX:XX:XX:XX:XX:XX">
      <span class="field-bits">6 bytes</span>
    </div>
    <div class="field-row">
      <label>Root Path Cost</label>
      <select id="f-cost">
        <option value="00000000">0 ‚Äî Root Bridge itself</option>
        <option value="00000002">2 ‚Äî 10 Gbps</option>
        <option value="00000004">4 ‚Äî 1 Gbps</option>
        <option value="00000013">19 ‚Äî 100 Mbps</option>
        <option value="00000064">100 ‚Äî 10 Mbps</option>
      </select>
      <span class="field-bits">4 bytes</span>
    </div>
    <div class="field-row">
      <label>Bridge Priority</label>
      <select id="f-bridge-pri">
        <option value="8000">32768 (Default)</option>
        <option value="1000">4096</option>
        <option value="2000">8192</option>
        <option value="6000">24576</option>
      </select>
      <span class="field-bits">2 bytes</span>
    </div>
    <div class="field-row">
      <label>Bridge MAC</label>
      <input type="text" id="f-bridge-mac" value="00:5E:4D:3C:2B:1A" placeholder="XX:XX:XX:XX:XX:XX">
      <span class="field-bits">6 bytes</span>
    </div>
    <div class="field-row">
      <label>Port ID</label>
      <input type="text" id="f-port" value="8001" placeholder="Hex: 80xx">
      <span class="field-bits">2 bytes</span>
    </div>
    <div class="field-row">
      <label>Message Age</label>
      <select id="f-msg-age">
        <option value="0000">0 (Root Bridge)</option>
        <option value="0100">1 hop</option>
        <option value="0200">2 hops</option>
        <option value="0300">3 hops</option>
      </select>
      <span class="field-bits">2 bytes</span>
    </div>
    <div class="field-row">
      <label>Max Age</label>
      <select id="f-max-age">
        <option value="1400">20 sec (default)</option>
        <option value="0F00">15 sec</option>
        <option value="1E00">30 sec</option>
      </select>
      <span class="field-bits">2 bytes</span>
    </div>
    <div class="field-row">
      <label>Hello Time</label>
      <select id="f-hello">
        <option value="0200">2 sec (default)</option>
        <option value="0100">1 sec</option>
        <option value="0400">4 sec</option>
      </select>
      <span class="field-bits">2 bytes</span>
    </div>
    <div class="field-row">
      <label>Forward Delay</label>
      <select id="f-fwd-delay">
        <option value="0F00">15 sec (default)</option>
        <option value="0400">4 sec (RSTP)</option>
        <option value="1400">20 sec</option>
      </select>
      <span class="field-bits">2 bytes</span>
    </div>

    <div style="margin-top:1.5rem">
      <button class="btn-build" onclick="buildBPDU()">üî® Build BPDU</button>
      <button class="btn-reset" onclick="resetBPDU()">‚Ü∫ Reset Defaults</button>
    </div>

    <div id="bpdu-preview" style="display:none"></div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SIMULATOR -->
<section id="simulator" class="section">
  <div class="section-header">
    <div class="icon">üñ•Ô∏è</div>
    <div>
      <h2>STP Network Simulator</h2>
      <p>Watch STP elect a root bridge and converge on a loop-free topology</p>
    </div>
  </div>

  <div id="stp-canvas-wrap">
    <canvas id="stp-canvas" width="700" height="380"></canvas>
    <div class="canvas-controls">
      <button class="ctrl-btn" onclick="simStep()">‚ñ∂ Next Step</button>
      <button class="ctrl-btn" onclick="simAuto()">‚è© Auto Run</button>
      <button class="ctrl-btn secondary" onclick="simReset()">‚Ü∫ Reset</button>
    </div>
  </div>

  <div id="sim-log">
    <span style="color:#7ecfff">// STP Simulation Log</span><br>
    <span style="color:var(--muted)">Click "Next Step" or "Auto Run" to begin simulation...</span>
  </div>

  <div class="info-box" style="margin-top:1.5rem">
    <strong>üì° Simulation Legend</strong>
    üü¶ = Root Bridge &nbsp;|&nbsp; üü© = Non-root Switch &nbsp;|&nbsp; üî¥ = Blocked Port &nbsp;|&nbsp; üü¢ = Forwarding Port &nbsp;|&nbsp; RP = Root Port &nbsp;|&nbsp; DP = Designated Port
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GLOSSARY -->
<section id="glossary" class="section">
  <div class="section-header">
    <div class="icon">üìö</div>
    <div>
      <h2>STP Glossary</h2>
      <p>Key terms and definitions for network administrators</p>
    </div>
  </div>

  <div style="margin-bottom:1.25rem">
    <input type="text" id="glossary-search" placeholder="üîç Search terms..." oninput="filterGlossary()"
      style="width:100%;padding:.65rem 1rem;border:2px solid var(--border);border-radius:10px;font-size:.95rem;font-family:'Nunito',sans-serif">
  </div>

  <div id="glossary-list"></div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê QUIZ -->
<section id="quiz" class="section">
  <div class="section-header">
    <div class="icon">‚ùì</div>
    <div>
      <h2>Knowledge Check Quiz</h2>
      <p>Test your understanding of Spanning Tree Protocol</p>
    </div>
  </div>

  <div id="quiz-container"></div>
  <div id="quiz-score"></div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê JAVASCRIPT -->
<script>
// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showSection(id, btn) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('#topnav nav button').forEach(b => b.classList.remove('active'));
  if(btn) btn.classList.add('active');

  const sections = ['overview','concepts','election','portstates','bpdu','builder','simulator','glossary','quiz'];
  const idx = sections.indexOf(id);
  document.getElementById('progress-bar').style.width = ((idx+1)/sections.length*100)+'%';

  if(id === 'bpdu') buildBPDUVisual();
  if(id === 'quiz') buildQuiz();
  if(id === 'glossary') buildGlossary();
  if(id === 'simulator') { simReset(); }
  if(id === 'election') buildElectionUI();
}

// ‚îÄ‚îÄ BPDU VISUAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const bpduFields = [
  { name:'Proto ID', size:'2B', cls:'bf1', desc:'Always 0x0000 ‚Äì identifies Spanning Tree Protocol' },
  { name:'Version', size:'1B', cls:'bf2', desc:'0x00=STP, 0x02=RSTP, 0x03=MSTP' },
  { name:'Type', size:'1B', cls:'bf3', desc:'0x00=Config BPDU, 0x80=TCN BPDU' },
  { name:'Flags', size:'1B', cls:'bf4', desc:'Bit0=TC, Bit7=TCA (RSTP adds bits 1-6)' },
  { name:'Root BID', size:'8B', cls:'bf5', desc:'Root Bridge ID: Priority(2B)+SysID+MAC(6B)' },
  { name:'Root Cost', size:'4B', cls:'bf6', desc:'Cumulative path cost from sender to Root Bridge' },
  { name:'Bridge BID', size:'8B', cls:'bf5', desc:'Sender\'s own Bridge ID' },
  { name:'Port ID', size:'2B', cls:'bf7', desc:'Sender\'s port: Priority(1B) + Port#(1B)' },
  { name:'Msg Age', size:'2B', cls:'bf1', desc:'Hops from Root (in 1/256 sec)' },
  { name:'Max Age', size:'2B', cls:'bf2', desc:'Max age for stored BPDU (default 20s)' },
  { name:'Hello', size:'2B', cls:'bf3', desc:'Hello interval (default 2s)' },
  { name:'Fwd Delay', size:'2B', cls:'bf4', desc:'Listen/Learn duration (default 15s)' },
];

function buildBPDUVisual() {
  const wrap = document.getElementById('bpdu-visual');
  if (!wrap || wrap.children.length > 0) return;
  bpduFields.forEach(f => {
    const div = document.createElement('div');
    const bytes = parseInt(f.size);
    div.className = 'bpdu-field '+f.cls;
    div.style.flex = bytes;
    div.style.minWidth = (bytes*28)+'px';
    div.title = f.desc;
    div.innerHTML = `<span class="field-name">${f.name}</span><span class="field-size">${f.size}</span>`;
    div.onclick = () => {
      const prev = document.querySelector('.bpdu-field.selected');
      if(prev) prev.style.outline='';
      div.style.outline='3px solid var(--primary)';
      const info = document.createElement('div');
      info.textContent = 'üìå '+f.name+': '+f.desc;
      const box = document.getElementById('bpdu-visual');
      let old = document.getElementById('bpdu-info');
      if(old) old.remove();
      const d = document.createElement('div');
      d.id='bpdu-info';
      d.className='info-box';
      d.style.marginTop='.75rem';
      d.innerHTML='<strong>'+f.name+' ('+f.size+')</strong>'+f.desc;
      box.after(d);
    };
    wrap.appendChild(div);
  });
}

// ‚îÄ‚îÄ BPDU HEADER BUILDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function macToHex(mac) {
  return mac.replace(/:/g,'').toUpperCase();
}

function buildBPDU() {
  const proto    = document.getElementById('f-proto').value;
  const version  = document.getElementById('f-version').value;
  const type     = document.getElementById('f-type').value;
  const flags    = document.getElementById('f-flags').value;
  const rootPri  = document.getElementById('f-root-pri').value;
  const rootMac  = macToHex(document.getElementById('f-root-mac').value);
  const cost     = document.getElementById('f-cost').value;
  const bridgePri= document.getElementById('f-bridge-pri').value;
  const bridgeMac= macToHex(document.getElementById('f-bridge-mac').value);
  const port     = document.getElementById('f-port').value.replace(/:/g,'');
  const msgAge   = document.getElementById('f-msg-age').value;
  const maxAge   = document.getElementById('f-max-age').value;
  const hello    = document.getElementById('f-hello').value;
  const fwdDelay = document.getElementById('f-fwd-delay').value;

  const raw = proto+version+type+flags+rootPri+rootMac+cost+bridgePri+bridgeMac+port.padStart(4,'0')+msgAge+maxAge+hello+fwdDelay;
  const hex = raw.match(/.{1,2}/g).join(' ');

  const versionMap = {'00':'STP (802.1D)','02':'RSTP (802.1w)','03':'MSTP (802.1s)'};
  const typeMap = {'00':'Configuration BPDU','80':'TCN BPDU','02':'RST/MST BPDU'};
  const flagsMap = {'00':'None','01':'Topology Change','80':'TC Acknowledgment','81':'TC + TCA'};

  const preview = document.getElementById('bpdu-preview');
  preview.style.display='block';
  preview.innerHTML = `
<span style="color:#7ecfff">// IEEE 802.1D BPDU Frame ‚Äî ${raw.length/2} bytes</span>
<span style="color:#888">// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
<span class="field-label">Protocol ID:    </span><span class="field-val">0x${proto.toUpperCase()}</span>          <span style="color:#888">‚Üí Spanning Tree Protocol</span>
<span class="field-label">Version:        </span><span class="field-val">0x${version.toUpperCase()}</span>              <span style="color:#888">‚Üí ${versionMap[version]||'Unknown'}</span>
<span class="field-label">BPDU Type:      </span><span class="field-val">0x${type.toUpperCase()}</span>              <span style="color:#888">‚Üí ${typeMap[type]||'Unknown'}</span>
<span class="field-label">Flags:          </span><span class="field-val">0x${flags.toUpperCase()}</span>              <span style="color:#888">‚Üí ${flagsMap[flags]||flags}</span>
<span class="field-label">Root BID:       </span><span class="field-val">${rootPri.toUpperCase()}.${rootMac.match(/.{2}/g).join(':')}</span>  <span style="color:#888">‚Üí Priority + MAC</span>
<span class="field-label">Root Path Cost: </span><span class="field-val">0x${cost.toUpperCase()}</span>          <span style="color:#888">‚Üí ${parseInt(cost,16)}</span>
<span class="field-label">Bridge BID:     </span><span class="field-val">${bridgePri.toUpperCase()}.${bridgeMac.match(/.{2}/g).join(':')}</span>  <span style="color:#888">‚Üí Sender Bridge ID</span>
<span class="field-label">Port ID:        </span><span class="field-val">0x${port.padStart(4,'0').toUpperCase()}</span>            <span style="color:#888">‚Üí Port Priority + Number</span>
<span class="field-label">Message Age:    </span><span class="field-val">0x${msgAge.toUpperCase()}</span>            <span style="color:#888">‚Üí ${parseInt(msgAge,16)/256} hops</span>
<span class="field-label">Max Age:        </span><span class="field-val">0x${maxAge.toUpperCase()}</span>            <span style="color:#888">‚Üí ${parseInt(maxAge,16)/256}s</span>
<span class="field-label">Hello Time:     </span><span class="field-val">0x${hello.toUpperCase()}</span>            <span style="color:#888">‚Üí ${parseInt(hello,16)/256}s</span>
<span class="field-label">Forward Delay:  </span><span class="field-val">0x${fwdDelay.toUpperCase()}</span>            <span style="color:#888">‚Üí ${parseInt(fwdDelay,16)/256}s</span>

<span style="color:#888">// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
<span style="color:#7ecfff">// RAW HEX DUMP:</span>
<span class="field-hex">${hex}</span>
  `.trim();
}

function resetBPDU() {
  document.getElementById('f-version').value='00';
  document.getElementById('f-type').value='00';
  document.getElementById('f-flags').value='00';
  document.getElementById('f-root-pri').value='8000';
  document.getElementById('f-root-mac').value='00:1A:2B:3C:4D:5E';
  document.getElementById('f-cost').value='00000000';
  document.getElementById('f-bridge-pri').value='8000';
  document.getElementById('f-bridge-mac').value='00:5E:4D:3C:2B:1A';
  document.getElementById('f-port').value='8001';
  document.getElementById('f-msg-age').value='0000';
  document.getElementById('f-max-age').value='1400';
  document.getElementById('f-hello').value='0200';
  document.getElementById('f-fwd-delay').value='0F00';
  document.getElementById('bpdu-preview').style.display='none';
}

// ‚îÄ‚îÄ ELECTION SIMULATOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let switchCount = 0;
function buildElectionUI() {
  if(document.getElementById('switches-container').children.length > 0) return;
  switchCount = 0;
  addSwitch('SW1','32768','00:1A:2B:3C:4D:01');
  addSwitch('SW2','32768','00:1A:2B:3C:4D:02');
  addSwitch('SW3','4096', '00:1A:2B:3C:4D:03');
}
function addSwitch(name, priority, mac) {
  switchCount++;
  const n = name || 'SW'+switchCount;
  const p = priority || '32768';
  const m = mac || ('00:AA:BB:CC:DD:'+switchCount.toString(16).padStart(2,'0').toUpperCase());
  const container = document.getElementById('switches-container');
  const div = document.createElement('div');
  div.className = 'field-row';
  div.id = 'sw-row-'+switchCount;
  div.style.gridTemplateColumns = '100px 120px 1fr auto';
  div.innerHTML = `
    <input type="text" value="${n}" placeholder="Name" style="font-weight:700">
    <select onchange="">
      <option value="4096" ${p=='4096'?'selected':''}>4096</option>
      <option value="8192" ${p=='8192'?'selected':''}>8192</option>
      <option value="32768" ${p=='32768'?'selected':''}>32768 (default)</option>
      <option value="61440">61440</option>
    </select>
    <input type="text" value="${m}" placeholder="MAC Address" style="font-family:'IBM Plex Mono',monospace; font-size:.85rem">
    <button onclick="this.parentElement.remove()" style="background:#fce4ec;border:none;border-radius:6px;padding:.35rem .65rem;cursor:pointer;font-size:.8rem;color:#c62828">‚úï</button>
  `;
  container.appendChild(div);
}
function electRoot() {
  const rows = document.querySelectorAll('#switches-container .field-row');
  if(rows.length < 2) { alert('Add at least 2 switches!'); return; }
  const switches = [];
  rows.forEach(row => {
    const inputs = row.querySelectorAll('input');
    const selects = row.querySelectorAll('select');
    const name = inputs[0]?.value || 'SW?';
    const pri  = parseInt(selects[0]?.value || '32768');
    const mac  = inputs[1]?.value || '00:00:00:00:00:00';
    switches.push({ name, pri, mac });
  });
  switches.sort((a,b) => {
    if(a.pri !== b.pri) return a.pri - b.pri;
    return a.mac.replace(/:/g,'').localeCompare(b.mac.replace(/:/g,''));
  });
  const root = switches[0];
  let html = `<div class="card"><h3>‚ö° Election Results</h3><div class="tbl-wrap"><table>
    <thead><tr><th>Rank</th><th>Switch</th><th>Priority</th><th>MAC</th><th>BID</th><th>Role</th></tr></thead><tbody>`;
  switches.forEach((sw, i) => {
    const isRoot = i === 0;
    const bid = sw.pri.toString()+':'+sw.mac;
    html += `<tr ${isRoot?'style="background:#e8f5e9;font-weight:700"':''}>
      <td>${i+1}</td><td>${sw.name}</td><td>${sw.pri}</td><td><code>${sw.mac}</code></td><td><code style="font-size:.8rem">${bid}</code></td>
      <td>${isRoot?'<span class="tag tag-green">üëë ROOT BRIDGE</span>':'<span class="tag tag-blue">Non-Root</span>'}</td>
    </tr>`;
  });
  html += '</tbody></table></div>';
  html += `<div class="info-box success" style="margin-top:1rem"><strong>‚úÖ Root Bridge: ${root.name}</strong> won with Priority=${root.pri} and MAC=${root.mac}. All ports on ${root.name} become <strong>Designated Ports</strong>. Other switches calculate their Root Ports based on path cost toward ${root.name}.</div></div>`;
  const res = document.getElementById('election-result');
  res.innerHTML = html;
  res.style.display='block';
}
function resetElection() {
  document.getElementById('switches-container').innerHTML='';
  document.getElementById('election-result').style.display='none';
  switchCount=0;
  buildElectionUI();
}

// ‚îÄ‚îÄ PORT STATE INFO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const portInfoData = {
  blocking: { title:'üî¥ Blocking', color:'#fce4ec', border:'#e53935', body:'The port receives BPDUs to detect topology changes but does NOT forward data frames or learn MAC addresses. This is the default state for redundant (non-designated) ports. Duration: controlled by Max Age timer (20 sec). The port will move to Listening if a better path is found.' },
  listening: { title:'üü° Listening', color:'#fff9c4', border:'#fbc02d', body:'The port actively participates in STP by sending and receiving BPDUs. It does NOT yet forward data or learn MACs. This state allows STP to elect root ports and designated ports. Duration: Forward Delay (15 sec default).' },
  learning: { title:'üü¢ Learning', color:'#e8f5e9', border:'#43a047', body:'The port begins building the MAC address table by learning source MAC addresses from incoming frames. However, it still does NOT forward data frames. This reduces flooding when the port transitions to Forwarding. Duration: Forward Delay (15 sec default).' },
  forwarding: { title:'üîµ Forwarding', color:'#e3f2fd', border:'#1976d2', body:'The port is fully operational ‚Äî it sends and receives data frames, learns MAC addresses, and participates in STP BPDU exchange. Only Root Ports and Designated Ports reach Forwarding state. This is the desired operational state.' },
  disabled: { title:'‚ö´ Disabled', color:'#f5f5f5', border:'#9e9e9e', body:'The port is administratively shut down by a network administrator. It does not participate in STP at all and does not forward any frames. Configure with "shutdown" command on Cisco IOS. Not the same as Blocking ‚Äî Blocking is STP-controlled, Disabled is admin-controlled.' },
};
function showPortInfo(state) {
  const info = portInfoData[state];
  const box = document.getElementById('port-info-box');
  box.style.display='block';
  box.style.borderColor=info.border;
  box.style.background=info.color;
  box.innerHTML=`<strong style="font-size:1.05rem">${info.title}</strong><p style="margin-top:.5rem;font-size:.93rem">${info.body}</p>`;
}

// ‚îÄ‚îÄ SIMULATOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const canvas = document.getElementById('stp-canvas');
const ctx = canvas ? canvas.getContext('2d') : null;

const switches = [
  { id:'SW1', x:120, y:80,  priority:32768, mac:'001A2B3C4D01', label:'SW1\n32768', ports:[] },
  { id:'SW2', x:580, y:80,  priority:32768, mac:'001A2B3C4D02', label:'SW2\n32768', ports:[] },
  { id:'SW3', x:120, y:300, priority:4096,  mac:'001A2B3C4D03', label:'SW3\n4096',  ports:[] },
  { id:'SW4', x:580, y:300, priority:32768, mac:'001A2B3C4D04', label:'SW4\n32768', ports:[] },
];

const links = [
  { from:0, to:1, state:'', portA:'DP', portB:'RP', cost:4  },
  { from:0, to:2, state:'', portA:'DP', portB:'RP', cost:4  },
  { from:1, to:3, state:'', portA:'DP', portB:'RP', cost:4  },
  { from:2, to:3, state:'', portA:'DP', portB:'',   cost:4  },
  { from:1, to:2, state:'', portA:'',   portB:'',   cost:4  },
];

let simStepIdx = 0;
let simInterval = null;

const simSteps = [
  { msg:'üîÑ All switches power on. Each sends BPDUs claiming to be the Root Bridge.', fn: () => simDraw('init') },
  { msg:'üìä Comparing BIDs: SW3 has lowest Priority (4096). SW3 wins the Root Bridge election!', fn: () => simDraw('elected') },
  { msg:'üîå SW1 calculates Root Port: path to SW3 via direct link (cost 4). SW1 RP = port toward SW3.', fn: () => simDraw('rp1') },
  { msg:'üîå SW2 calculates Root Port: SW2‚ÜíSW1‚ÜíSW3 (cost 8) vs SW2‚ÜíSW4‚ÜíSW3 (cost 8). Tie! Use lowest BID: SW1 wins. SW2 RP = port toward SW1.', fn: () => simDraw('rp2') },
  { msg:'üîå SW4 calculates Root Port: SW4‚ÜíSW3 direct (cost 4). SW4 RP = port toward SW3.', fn: () => simDraw('rp4') },
  { msg:'üö´ Redundant link SW1‚ÄìSW2 and SW2‚ÄìSW4: one port must be BLOCKED to prevent loop!', fn: () => simDraw('block') },
  { msg:'‚úÖ STP Convergence complete! Loop-free topology achieved. Blocked ports maintain physical redundancy.', fn: () => simDraw('done') },
];

function simDraw(phase) {
  if(!ctx) return;
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0,0,W,H);

  // background
  ctx.fillStyle='#f8f9fa'; ctx.fillRect(0,0,W,H);
  ctx.strokeStyle='#dee2e6'; ctx.lineWidth=1;
  ctx.strokeRect(1,1,W-2,H-2);

  // draw links
  links.forEach(link => {
    const a = switches[link.from], b = switches[link.to];
    const isBlocked = (link.state==='blocked');
    ctx.beginPath();
    ctx.moveTo(a.x,a.y);
    ctx.lineTo(b.x,b.y);
    if(isBlocked) {
      ctx.strokeStyle='#e53935'; ctx.lineWidth=3;
      ctx.setLineDash([8,5]);
    } else if(link.state==='active') {
      ctx.strokeStyle='#43a047'; ctx.lineWidth=3;
      ctx.setLineDash([]);
    } else {
      ctx.strokeStyle='#aaa'; ctx.lineWidth=2;
      ctx.setLineDash([4,3]);
    }
    ctx.stroke();
    ctx.setLineDash([]);

    // port labels
    if(link.portA||link.portB) {
      const midX = (a.x+b.x)/2, midY = (a.y+b.y)/2;
      ctx.font='bold 10px IBM Plex Mono, monospace';
      ctx.fillStyle = isBlocked?'#e53935':'#0d47a1';
      ctx.textAlign='center';
      if(link.portA) ctx.fillText(link.portA, (a.x*2+b.x)/3, (a.y*2+b.y)/3-5);
      if(link.portB) ctx.fillText(link.portB, (b.x*2+a.x)/3, (b.y*2+a.y)/3-5);
    }

    // blocked X
    if(isBlocked) {
      const midX=(a.x+b.x)/2, midY=(a.y+b.y)/2;
      ctx.font='bold 18px sans-serif';
      ctx.fillStyle='#e53935';
      ctx.textAlign='center';
      ctx.textBaseline='middle';
      ctx.fillText('‚úï', midX, midY);
    }
  });

  // draw switches
  switches.forEach(sw => {
    const isRoot = (phase==='elected'||phase==='rp1'||phase==='rp2'||phase==='rp4'||phase==='block'||phase==='done') && sw.id==='SW3';
    const r = 38;
    ctx.beginPath();
    ctx.arc(sw.x, sw.y, r, 0, Math.PI*2);
    ctx.fillStyle = isRoot ? '#0a3d62' : '#1976d2';
    ctx.fill();
    ctx.strokeStyle = isRoot ? '#f9a825' : '#e3f2fd';
    ctx.lineWidth = isRoot ? 4 : 2;
    ctx.stroke();

    ctx.font = 'bold 12px Nunito, sans-serif';
    ctx.fillStyle = 'white';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(sw.id, sw.x, sw.y-8);
    ctx.font = '10px Nunito, sans-serif';
    ctx.fillStyle = isRoot ? '#f9a825' : 'rgba(255,255,255,.8)';
    ctx.fillText('Pri:'+sw.priority, sw.x, sw.y+8);

    if(isRoot) {
      ctx.font='18px sans-serif';
      ctx.fillText('üëë', sw.x, sw.y-26);
    }
  });

  // legend
  ctx.font='11px Nunito, sans-serif';
  ctx.fillStyle='#555';
  ctx.textAlign='left';
  ctx.textBaseline='bottom';
  ctx.fillText('Phase: '+phase.toUpperCase(), 10, H-10);
}

function applyPhase(phase) {
  links.forEach(l => { l.state=''; l.portA=''; l.portB=''; });
  if(phase==='elected'||phase==='rp1'||phase==='rp2'||phase==='rp4'||phase==='block'||phase==='done') {
    // SW3 is root ‚Äî all its ports are DP
    links[1].state='active'; links[1].portA='DP'; // SW3(2)‚ÜíSW1(0)
    links[2].state='active'; links[2].portB='DP'; // SW3(2)‚ÜíSW4?
  }
  if(phase==='rp1'||phase==='rp2'||phase==='rp4'||phase==='block'||phase==='done') {
    links[1].portB='RP'; // SW1 root port toward SW3
  }
  if(phase==='rp4'||phase==='block'||phase==='done') {
    links[2].portB='RP'; // SW3-SW4 link... let's simplify
    links[3].state='active'; links[3].portA='DP'; links[3].portB='RP';
  }
  if(phase==='block'||phase==='done') {
    links[0].state='active'; links[0].portA='DP'; links[0].portB='RP';
    links[4].state='blocked';
  }
  if(phase==='done') {
    links[0].state='active';
    links[1].state='active';
    links[2].state='active';
    links[3].state='active';
    links[4].state='blocked';
  }
  simDraw(phase);
}

function simStep() {
  if(simStepIdx >= simSteps.length) { simStepIdx=0; }
  const step = simSteps[simStepIdx];
  const log = document.getElementById('sim-log');
  log.innerHTML += `<br><span style="color:#f5c542">Step ${simStepIdx+1}:</span> ${step.msg}`;
  log.scrollTop=log.scrollHeight;
  const phases = ['init','elected','rp1','rp2','rp4','block','done'];
  applyPhase(phases[simStepIdx]);
  simStepIdx++;
}

function simAuto() {
  if(simInterval) { clearInterval(simInterval); simInterval=null; return; }
  simInterval = setInterval(() => {
    simStep();
    if(simStepIdx >= simSteps.length) { clearInterval(simInterval); simInterval=null; }
  }, 1800);
}

function simReset() {
  simStepIdx=0;
  if(simInterval) { clearInterval(simInterval); simInterval=null; }
  links.forEach(l => { l.state=''; l.portA=''; l.portB=''; });
  const log = document.getElementById('sim-log');
  log.innerHTML=`<span style="color:#7ecfff">// STP Simulation Log</span><br><span style="color:var(--muted)">Click "Next Step" or "Auto Run" to begin simulation...</span>`;
  simDraw('init');
}

// ‚îÄ‚îÄ GLOSSARY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const glossaryData = [
  { term:'Spanning Tree Protocol', abbr:'STP', def:'IEEE 802.1D standard that prevents Layer 2 loops by logically blocking redundant switch links while maintaining physical redundancy.' },
  { term:'Bridge Protocol Data Unit', abbr:'BPDU', def:'Control frame exchanged between switches every 2 seconds to share STP topology information. Sent to MAC 01:80:C2:00:00:00.' },
  { term:'Bridge ID', abbr:'BID', def:'Unique identifier for each switch: 2-byte Priority + optional Extended System ID + 6-byte MAC address. Lowest BID = Root Bridge.' },
  { term:'Root Bridge', abbr:'RB', def:'The switch with the lowest Bridge ID; serves as the reference point for all path calculations in the spanning tree topology.' },
  { term:'Root Port', abbr:'RP', def:'The port on a non-root switch with the lowest cost path to the Root Bridge. One per non-root switch.' },
  { term:'Designated Port', abbr:'DP', def:'The port on each network segment with the best (lowest cost) path toward the Root Bridge. Forwards data toward hosts.' },
  { term:'Blocked Port', abbr:'BP', def:'A port placed in Blocking state to prevent loops. Receives BPDUs but does not forward data or learn MAC addresses.' },
  { term:'Root Path Cost', abbr:'RPC', def:'The cumulative cost of all ports along the path from a switch to the Root Bridge. Lower cost paths are preferred.' },
  { term:'Hello Time', abbr:'', def:'STP timer: how often the Root Bridge originates Configuration BPDUs. Default = 2 seconds.' },
  { term:'Forward Delay', abbr:'', def:'STP timer: duration spent in Listening and Learning states. Default = 15 seconds each.' },
  { term:'Max Age', abbr:'', def:'STP timer: how long a switch stores BPDU information before discarding it. Default = 20 seconds.' },
  { term:'Topology Change Notification', abbr:'TCN', def:'Special BPDU sent toward the Root Bridge when a topology change is detected (e.g., a link goes up or down).' },
  { term:'PortFast', abbr:'', def:'Cisco STP enhancement that allows an access port to immediately transition to Forwarding state, bypassing Listening/Learning. Used on end-device ports only.' },
  { term:'BPDU Guard', abbr:'', def:'Security feature that disables a PortFast-enabled port if a BPDU is received, preventing unauthorized switches from connecting.' },
  { term:'Root Guard', abbr:'', def:'Prevents a port from becoming a Root Port even if superior BPDUs are received, protecting the intended Root Bridge.' },
  { term:'Rapid Spanning Tree Protocol', abbr:'RSTP', def:'IEEE 802.1w enhancement that achieves sub-second convergence using a proposal/agreement mechanism and new port roles (Alternate, Backup).' },
  { term:'Per-VLAN Spanning Tree Plus', abbr:'PVST+', def:'Cisco implementation that runs a separate STP instance for each VLAN, allowing per-VLAN traffic engineering and load balancing.' },
  { term:'Multiple Spanning Tree Protocol', abbr:'MSTP', def:'IEEE 802.1s standard that maps multiple VLANs to fewer STP instances, reducing overhead while supporting per-VLAN topologies.' },
  { term:'Alternate Port', abbr:'', def:'RSTP port role: a blocked port that provides an alternate path to the Root Bridge (backup for Root Port).' },
  { term:'Backup Port', abbr:'', def:'RSTP port role: a blocked port on the same segment as a Designated Port on the same switch (rare configuration).' },
  { term:'Broadcast Storm', abbr:'', def:'Network condition where Layer 2 loops cause broadcast frames to replicate endlessly, consuming all available bandwidth and crashing the network.' },
  { term:'Convergence', abbr:'', def:'The process by which all switches in a network agree on the same loop-free topology. STP convergence takes 30‚Äì50 sec; RSTP takes 1‚Äì6 sec.' },
];

function buildGlossary() {
  const container = document.getElementById('glossary-list');
  if(container.children.length > 0) return;
  glossaryData.forEach(item => {
    const div = document.createElement('div');
    div.className='term-card';
    div.dataset.term = (item.term+' '+item.abbr).toLowerCase();
    div.innerHTML=`<div><span class="term">${item.term}</span>${item.abbr?`<span class="abbr">(${item.abbr})</span>`:''}</div><div class="def">${item.def}</div>`;
    container.appendChild(div);
  });
}

function filterGlossary() {
  const q = document.getElementById('glossary-search').value.toLowerCase();
  document.querySelectorAll('.term-card').forEach(card => {
    card.style.display = card.dataset.term.includes(q) ? '' : 'none';
  });
}

// ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const quizData = [
  { q:'At which OSI layer does STP operate?', opts:['Layer 1 ‚Äì Physical','Layer 2 ‚Äì Data Link','Layer 3 ‚Äì Network','Layer 4 ‚Äì Transport'], ans:1, exp:'STP operates at Layer 2 (Data Link), specifically to prevent loops in switched Ethernet networks.' },
  { q:'What determines the Root Bridge in STP?', opts:['Highest MAC address','Lowest Bridge ID','Highest priority value','Fastest link speed'], ans:1, exp:'The switch with the lowest Bridge ID (Priority + MAC) wins the Root Bridge election.' },
  { q:'What is the default STP Hello Time?', opts:['1 second','5 seconds','2 seconds','10 seconds'], ans:2, exp:'The Root Bridge sends Configuration BPDUs every 2 seconds by default (Hello Time = 2s).' },
  { q:'In what state does a port learn MAC addresses but NOT forward data?', opts:['Blocking','Listening','Learning','Forwarding'], ans:2, exp:'In the Learning state, a port builds the MAC table from incoming frames but does not yet forward user data.' },
  { q:'What does BPDU Guard do?', opts:['Blocks all BPDUs','Disables PortFast on all ports','Shuts down a PortFast port that receives a BPDU','Prevents Root Bridge changes'], ans:2, exp:'BPDU Guard err-disables a PortFast-enabled port if any BPDU is received, protecting against rogue switch connections.' },
  { q:'What is the default STP convergence time?', opts:['5 seconds','15 seconds','30‚Äì50 seconds','2 seconds'], ans:2, exp:'STP convergence can take up to 50 seconds: Max Age (20s) + Listening (15s) + Learning (15s).' },
  { q:'Which field in the BPDU identifies the sending switch?', opts:['Root Bridge ID','Bridge ID','Port ID','Protocol Identifier'], ans:1, exp:'The Bridge ID field (8 bytes) contains the sender\'s own switch identity: priority + MAC address.' },
  { q:'What type of BPDU is sent to notify about a topology change?', opts:['Configuration BPDU','RST BPDU','TCN BPDU','Hello BPDU'], ans:2, exp:'A Topology Change Notification (TCN) BPDU is sent toward the Root Bridge when a topology change occurs.' },
  { q:'RSTP (802.1w) reduces STP states to how many?', opts:['2','3','4','5'], ans:1, exp:'RSTP uses just 3 states: Discarding, Learning, and Forwarding, compared to STP\'s 5 states.' },
  { q:'The Root Path Cost for a 1 Gbps link is:', opts:['100','19','4','2'], ans:2, exp:'Per IEEE 802.1D revised port cost table: 1 Gbps = 4, 100 Mbps = 19, 10 Mbps = 100, 10 Gbps = 2.' },
];

let quizAnswered = {};

function buildQuiz() {
  const container = document.getElementById('quiz-container');
  if(container.children.length > 0) return;
  quizAnswered = {};
  quizData.forEach((q, qi) => {
    const div = document.createElement('div');
    div.className='quiz-card';
    div.innerHTML = `
      <div class="q-num">QUESTION ${qi+1} OF ${quizData.length}</div>
      <div class="q-text">${q.q}</div>
      <div class="q-opts" id="opts-${qi}">
        ${q.opts.map((opt,oi) => `<button class="opt-btn" onclick="answerQuiz(${qi},${oi})">${String.fromCharCode(65+oi)}. ${opt}</button>`).join('')}
      </div>
      <div class="q-feedback" id="fb-${qi}"></div>
    `;
    container.appendChild(div);
  });
  const scoreDiv = document.createElement('button');
  scoreDiv.className='btn-build';
  scoreDiv.textContent='üìä Show My Score';
  scoreDiv.onclick=showScore;
  scoreDiv.style.marginTop='1rem';
  container.appendChild(scoreDiv);
}

function answerQuiz(qi, oi) {
  if(quizAnswered[qi] !== undefined) return;
  quizAnswered[qi] = oi;
  const opts = document.querySelectorAll(`#opts-${qi} .opt-btn`);
  const fb = document.getElementById('fb-'+qi);
  const correct = quizData[qi].ans;
  opts.forEach((btn,i) => {
    btn.disabled=true;
    if(i===correct) btn.classList.add('correct');
    if(i===oi && i!==correct) btn.classList.add('incorrect');
  });
  fb.classList.add('show');
  if(oi===correct) {
    fb.classList.add('correct');
    fb.innerHTML='‚úÖ Correct! '+quizData[qi].exp;
  } else {
    fb.classList.add('incorrect');
    fb.innerHTML='‚ùå Incorrect. '+quizData[qi].exp;
  }
}

function showScore() {
  const total = quizData.length;
  const correct = Object.entries(quizAnswered).filter(([qi,oi]) => parseInt(oi)===quizData[qi].ans).length;
  const answered = Object.keys(quizAnswered).length;
  const pct = Math.round(correct/total*100);
  const scoreDiv = document.getElementById('quiz-score');
  scoreDiv.style.display='block';
  let grade = pct>=90?'üèÜ Excellent!':pct>=75?'üëç Good Job!':pct>=60?'üìö Keep Studying':'üí° Review Needed';
  scoreDiv.innerHTML=`<div class="big">${correct}/${total}</div><div style="font-size:1.4rem;margin:.5rem 0">${pct}% ‚Äî ${grade}</div><div style="font-size:.9rem;opacity:.8">${answered} of ${total} questions answered</div>`;
  scoreDiv.scrollIntoView({behavior:'smooth'});
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.addEventListener('load', () => {
  simReset();
});
</script>
</body>
</html>
